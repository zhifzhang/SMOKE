::: {.navheader}
4.4. How to use SMOKE
:::

[Prev](ch04s03.html) 

Chapter 4. How to Use SMOKE

 [Next](ch04s04s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_scripts_how_use_smoke}4.4. How to use SMOKE {#how-to-use-smoke .title style="clear: both"}
----------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[4.4.1. Change Assigns file to set scenario names, grid names, and
other case-specific configuration
information](ch04s04.html#sect_scripts_change_assigns)]{.section}

[[4.4.2. Use new inventory data](ch04s04s02.html)]{.section}

[[4.4.3. Select which pollutants in the inventory are
kept](ch04s04s03.html)]{.section}

[[4.4.4. Set fallback stack paramaters](ch04s04s04.html)]{.section}

[[4.4.5. Changing output and intermediate directory
names](ch04s04s05.html)]{.section}

[[4.4.6. Change which programs are run](ch04s04s06.html)]{.section}

[[4.4.7. Set up country codes, state codes, or county
codes](ch04s04s07.html)]{.section}

[[4.4.8. Set up list of known SCCs and ORIS
IDs](ch04s04s08.html)]{.section}

[[4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic
and biogenic)](ch04s04s09.html)]{.section}

[[4.4.10. Use a different speciation mechanism or change speciation
inputs](ch04s04s10.html)]{.section}

[[4.4.11. Setup projection and control
scenarios](ch04s04s11.html)]{.section}

[[4.4.12. Use MOVES for on-road mobile
sources](ch04s04s12.html)]{.section}

[[4.4.13. Change temporal processing](ch04s04s13.html)]{.section}

[[4.4.14. Use **Elevpoint** for selecting elevated and PinG
sources](ch04s04s14.html)]{.section}

[[4.4.15. Use BEIS3](ch04s04s15.html)]{.section}

[[4.4.16. Change meteorology data](ch04s04s16.html)]{.section}

[[4.4.17. Plume Rise Calculation for Fires](ch04s04s17.html)]{.section}

[[4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version
4.7)](ch04s04s18.html)]{.section}

[[4.4.19. Model for CMAQ](ch04s04s19.html)]{.section}

[[4.4.20. Model for UAM and CAM~X~](ch04s04s20.html)]{.section}

[[4.4.21. Determine if a run worked correctly and
troubleshoot](ch04s04s21.html)]{.section}

[[4.4.22. Change reports](ch04s04s22.html)]{.section}

[[4.4.23. Generating CMAQ-ready Source Apportionment Input Data
Files](ch04s04s23.html)]{.section}

[[4.4.24. Generating AERMOD-ready Input Data Files
\[SMOKE4AERMOD)](ch04s04s24.html)]{.section}
:::

This section builds on the previous section to describe how to use the
SMOKE files, scripts, and programs to create emission inputs for your
air quality model. The first part of setting up SMOKE for a case other
than the test case that comes with SMOKE is to create an Assigns file
and script files for your case. If you have not read through the earlier
parts of this chapter, we recommend that you do so. There are some
critical points that you need to understand about the Assigns file and
scripts. In [Section 4.1,
"Introduction"](ch04.html#sect_scripts_introduction "4.1. Introduction"),
we have described that an Assigns file must always be used when starting
to work with SMOKE and the UNIX commands to do that. In [Section 4.2.2,
"Script descriptions"](ch04s02s02.html "4.2.2. Script descriptions"), we
have already described the purpose and use of the Assigns file and
scripts, so please refer to that section for more information on these.

You may use this section as a step-by-step guide for all of the changes
that you need to make to the scripts and files for running SMOKE. If you
read it straight through and follow all of the steps that apply to your
situation, then you will have set up SMOKE for your modeling case. If
you are already familiar with SMOKE, you may also use this section as a
reference for changing specific parts of the configuration to meet
specific needs.

To create your own scripts and use your own data for the first time, you
must take the following steps:

::: {.orderedlist}
1.  Copy the example Assigns file to your own copy. The name of the
    Assigns file is not critical to the success of this step, but it is
    useful to name the file something that you will be able to identify
    easily for the modeling case for which it will be used.

    **`cp ASSIGNS.nctox.cmaq.cb05_soa.us12-nc` *`<yourfile>`***

2.  Modify the necessary features of the Assigns file for your case. For
    example, change the scenario names, episode dates, duration, grid
    name, or speciation name. Some of these changes require additional
    input files. See [Section 4.4.1, "Change Assigns file to set
    scenario names, grid names, and other case-specific configuration
    information"](ch04s04.html#sect_scripts_change_assigns "4.4.1. Change Assigns file to set scenario names, grid names, and other case-specific configuration information")
    for more details on the settings that you can change and the values
    to use for each.

3.  Invoke the Assigns file. This will create all of the input and
    output directories that you will need to set up your case:

    **`source <yourfile>`**

4.  Copy the appropriate nctox scripts to your own scripts, change the
    Assigns file listed in the script to the one that you created in the
    previous step.

5.  Using one or more of the subsections in this chapter, create your
    input files and change the options in the scripts. The subsections
    below explain what files and settings need to be changed and checked
    for many types of operations for configuring SMOKE.
:::

You need not always start from the example Assigns file. Once you have
your own case-specific Assigns files, you may use them as starting
points for creating other files.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_change_assigns}4.4.1. Change Assigns file to set scenario names, grid names, and other case-specific configuration information {#change-assigns-file-to-set-scenario-names-grid-names-and-other-case-specific-configuration-information .title}

</div>

</div>
:::

This subsection provides an overview of all of the Assigns file settings
that you may need to change. The remaining subsections in this chapter
include more detail about the changes as associated with specific
modeling needs. For example, [Section 4.4.10, "Use a different
speciation mechanism or change speciation
inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs")
explains how to change the Assigns file to set different chemical
mechanisms as well as all of the files needed.

In the 5-step list provided in the previous section, note that the
Assigns file must first be changed (step 2) and then invoked (step 3) to
create the input and output directories for your case. Ideally, all of
the settings in the list below would be done in step 2 before step 3 is
performed. If this is not possible, however, you should [*at a
minimum*]{.emphasis} set the first five items on the list below before
moving to step 3. These are the variables that affect the input and
output directory names, so if they are set, then the directories that
you need to use will for all other configuration steps will be set up
for you.

The list below provides the typical settings that may need to be changed
to be consistent with the case that you need. Each item in the list
references a different section of this chapter and [Table 4.1, "Variable
in Assigns file for naming files and
directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories")
or [Table 4.2, "Variables in Assigns file for controlling time period
and grid of
processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing")
for more information. The variables in the [Table 4.1, "Variable in
Assigns file for naming files and
directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories")
are used for naming files and directories. [Table 4.2, "Variables in
Assigns file for controlling time period and grid of
processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing")
includes the settings for controlling the time period and grid of your
SMOKE runs.

The checklist of major Assigns settings to change is:

::: {.orderedlist}
1.  Change the `INVID`{.envar}, `INVEN`{.envar}, and `INVOP`{.envar}
    values to a new inventory name. The simplest approach is to set
    these three variables to the same name, but different names can be
    used. Examples of which files or directories are affected by these
    settings are provided in [Table 4.1, "Variable in Assigns file for
    naming files and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories").
    See also [Section 4.4.2, "Use new inventory
    data"](ch04s04s02.html "4.4.2. Use new inventory data").

2.  Change the `ABASE`{.envar}, `BBASE`{.envar}, `MBASE`{.envar},
    `PBASE`{.envar}, and `EBASE`{.envar} values to a new scenario name.
    The simplest approach is to set these three variables to the same
    name, but different names can be used. Examples of which files or
    directories are affected by these settings are provided in
    [Table 4.1, "Variable in Assigns file for naming files and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories").
    See also [Section 4.4.2, "Use new inventory
    data"](ch04s04s02.html "4.4.2. Use new inventory data").

3.  Change the `METSCEN`{.envar} value to your meteorology scenario
    name. This will affect the name of the input directory for the
    meteorology files (the `$METDAT`{.filename} directory, which can be
    a linked directory if you do not want to install your meteorology
    files under the SMOKE directory structure).

4.  Change the `SPC`{.envar} value to one of the supported speciation
    mechanisms (see [Section 4.4.10.1, "Choosing from default
    mechanisms"](ch04s04s10.html#sect_scripts_use_default_spc "4.4.10.1. Choosing from default mechanisms"))
    or to a new speciation mechanism (see [Section 4.4.10.2, "Setup of
    new mechanism or changing an existing
    mechanism"](ch04s04s10.html#sect_scripts_use_new_spc "4.4.10.2. Setup of new mechanism or changing an existing mechanism")).

5.  Change the `GRID`{.envar} and `IOAPI_GRIDNAME_1`{.envar} values to
    the grid names for naming files. See also [Section 4.4.9, "Use a new
    modeling grid or change spatial inputs (anthropogenic and
    biogenic)"](ch04s04s09.html "4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic and biogenic)").

6.  Change the run period naming settings `ESDATE`{.envar} and
    `NDAYS`{.envar} (see [Table 4.1, "Variable in Assigns file for
    naming files and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories")).
    See also [Section 4.4.13.4, "Changing the dates, times, and duration
    of model-ready SMOKE emissions
    files"](ch04s04s13.html#sect_scripts_duration_output "4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE emissions files").

7.  Change the episode settings `EPI_STDATE`{.envar},
    `EPI_STTIME`{.envar}, `EPI_RUNLEN`{.envar}, and `EPI_NDAY`{.envar}
    and the run period settings `G_STDATE`{.envar}, `G_STTIME`{.envar},
    and `G_RUNLEN`{.envar}. See [Table 4.2, "Variables in Assigns file
    for controlling time period and grid of
    processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing")
    and [Section 4.4.13.3, "Changing the
    episode"](ch04s04s13.html#sect_scripts_change_episode "4.4.13.3. Changing the episode")
    and [Section 4.4.13.4, "Changing the dates, times, and duration of
    model-ready SMOKE emissions
    files"](ch04s04s13.html#sect_scripts_duration_output "4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE emissions files").

8.  Change the `YEAR`{.envar} value to the year of your base case
    inventory.
:::

::: {.table}
[]{#tbl_scripts_variables_files}

**Table 4.1. Variable in Assigns file for naming files and directories**

  Environment Variable   Description
  ---------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `INVID`{.envar}        Inventory input directory identifier. Controls directory path of input inventory. `INVDIR`{.envar} = `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}
  `INVOP`{.envar}        Base year inventory output name. Controls output file names for SMOKE intermediate inventory files and other output files from **Smkinven** and inventory-only reports from **Smkreport**. This variable is used to initialize the `FYIOP`{.envar} variable, which is also used in the Assigns file and is equal to `INVOP`{.envar} for base case modeling. `FYIOP`{.envar} is reset by the `set_case.scr`{.filename} helper script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings") documentation on `FYEAR`{.envar} and `CNTLCASE`{.envar})
  `INVEN`{.envar}        Base year inventory name, with version. Controls directory path of output inventory. `INVOPD`{.envar} = `$SMKDAT`{.filename}/inventory/`$INVEN`{.envar}
  `ABASE`{.envar}        Scenario identifier for area/non-point and nonroad mobile sources. Controls output file names and directories for outputs from SMOKE programs other than **Smkinven** (e.g., locations and file names of all matrices, hourly emissions, model-ready files). This variable is used to initialize the `ASCEN`{.envar} variable, which is also used in the Assigns file and is equal to `ABASE`{.envar} for base case modeling. `ASCEN`{.envar} is reset by the `set_case.scr`{.filename} helper script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings") documentation on `FYEAR`{.envar} and `CNTLCASE`{.envar}). Should be set to the same value as `BBASE`{.envar}, `MBASE`{.envar}, `PBASE`{.envar}, and `EBASE`{.envar} for the basic configuration.
  `BBASE`{.envar}        Scenario identifier for biogenic sources that works the same way as `ABASE`{.envar}, but affects the `BSCEN`{.envar} variable.
  `MBASE`{.envar}        Scenario identifier for on-road mobile sources that works the same way as `ABASE`{.envar}, but affects the `MSCEN`{.envar} variable.
  `PBASE`{.envar}        Scenario identifier for on-road mobile sources that works the same way as `ABASE`{.envar}, but affects the `PSCEN`{.envar} variable.
  `EBASE`{.envar}        Scenario identifier for merged emissions sources. Controls output file names and directories for outputs for final model-ready files. Sets the path for the `STATIC`{.envar}, `SCENARIO`{.envar}, and `OUTPUT`{.envar} directories and file names for the merged outputs for multiple source categories from the **Smkmerge** program (e.g., the `EGTS3D_L`{.envar} file).
  `METSCEN`{.envar}      Meteorology scenario name. Sets the `METDAT`{.envar} directory for the MCIP meteorology files and can be used to set the meteorology file names (not done in example nctox scripts). Also helps set names for meteorology-dependent SMOKE intermediate files for biogenics (**Tmpbeis3** outputs `B3GTS_S`{.envar} and `B3GTS_L`{.envar}), on-road mobile (**Temporal** output `MTMP`{.envar}), and point (**Laypoint** outputs `PLAY`{.envar} and `PLAY_EX`{.envar}).
  `GRID`{.envar}         Grid name used for naming files that depend on the selected grid. User must coordinate `GRID`{.envar} settings with `IOAPI_GRIDNAME_1`{.envar} setting [Table 4.2, "Variables in Assigns file for controlling time period and grid of processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing"). Dependent files include gridding matrix, gridded land use and biogenic emissions, hourly mobile emissions, layer-fractions files, model-ready emissions, and some reports.
  `SPC`{.envar}          Speciation profile name for selecting input files and naming output files and directories that depend on the chemical mechanism. This setting can be overridden by the `SPC_OVERRIDE`{.envar} script setting (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")). The `SPC`{.envar} setting sets input files `GSPRO`{.envar} and `GSREF`{.envar}; speciation matrix intermediate file names, and output directories `OUTPUT`{.envar}, `A_OUT`{.envar}, `B_OUT`{.envar}, `M_OUT`{.envar}, `N_OUT`{.envar}, and `P_OUT`{.envar}.
  `ESDATE`{.envar}       Starting date for first modeled period in episode. Has format YYYYMMDD where YYYY is the 4-digit year, MM is the two-digit month (e.g., 07 for July), and DD is the two-digit day (e.g., 01 for the first). Users should coordinate this with the `G_STDATE`{.envar} setting [Table 4.2, "Variables in Assigns file for controlling time period and grid of processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing"). The Assigns file resets this variable if the `G_STDATE_ADVANCE`{.envar} variable is set by a calling script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")).
  `MSDATE`{.envar}       Meteorology file dates. This variable can be used to help name time-dependent meteorology files or directory names. In the example scripts for the nctox case, however, this variable is not used and the `G_STDATE`{.envar} variable is used instead.
  `NDAYS`{.envar}        Number of days in a modeling period. To break up a modeling episode into multiple modeling periods of one or more days, the user must set and coordinate this setting with the `G_RUNLEN`{.envar} setting [Table 4.2, "Variables in Assigns file for controlling time period and grid of processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing"). `NDAYS`{.envar} represents the number of days indicated in hours by the `G_RUNLEN`{.envar} variable. `NDAYS`{.envar} is used for naming hourly emissions files output from the **Temporal** program, biogenic outputs from **Tmpbio**, layer fractions files from **Laypoint**, and model-ready emissions files from **Smkmerge**.
  `YEAR`{.envar}         Base case modeling year. This setting is used to set several things in coordination with the `FYEAR`{.envar} and `SMK_FUTURE_YN`{.envar} script settings (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")). For growth modeling, it is used in the file name for the `GCNTL`{.envar} input file, set by the growth/control example nctox scripts. This setting can be overridden by the `YEAR_OVERRIDE`{.envar} setting, also described in [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings"). Lastly, it is used to set the file name for the winter/summer designations file output from **Metscan**, called the `BIOSEASON`{.envar} file.
:::

::: {.table}
[]{#tbl_scripts_variables_time}

**Table 4.2. Variables in Assigns file for controlling time period and
grid of processing**

  Environment Variable         Description
  ---------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `G_STDATE`{.envar}           Julian starting date of first modeled period in episode. Has format YYYYDDD where YYYY is a 4-digit year and DDD is a 3-digit Julian date (e.g., 001 for the first day of the year). Users should coordinate this with the `ESDATE`{.envar} setting [Table 4.1, "Variable in Assigns file for naming files and directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories"). The Assigns file resets this variable if the `G_STDATE_ADVANCE`{.envar} variable is set by a calling script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")). Controls operation of time-dependent programs **Temporal**, **Tmpbio**, **Laypoint**, and **Smkmerge**.
  `G_STTIME`{.envar}           Start time of each period in the episode. Has format HHMMSS where HH is a 2-digit hour (leading zero not required), MM is a 2-digit minute (set to 00 for SMOKE), and SS is a 2-digit second (set to 00 for SMOKE).
  `G_RUNLEN`{.envar}           Duration of each run period in episode. To break up a modeling episode into multiple modeling periods of one or more days, the user must set and coordinate this setting with the `NDAYS`{.envar} setting [Table 4.1, "Variable in Assigns file for naming files and directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories"). `G_RUNLEN`{.envar} has format HHHHMMSS, where HHHH is a 4-digit duration in hours (leading zeros not required), MM and HH should be set as for `G_STTIME`{.envar}. `G_RUNLEN`{.envar} controls the duration modeled for each run of the **Temporal**, **Tmpbio**, **Laypoint**, and **Smkmerge** programs. Must be set one hour greater than the number of days times 24 (e.g., a two-day period length is 2 x 24 + 1 = 49).
  `G_TSTEP`{.envar}            Time step. Has format HHMMSS with format the same as described for `G_STTIME`{.envar}. The current version of SMOKE allows this setting to only be 10000, for hourly timesteps.
  `EPI_STDATE`{.envar}         Episode start date. Has the same format as `G_STDATE`{.envar}. Does not change during the course of an episodic run. In the Assigns file, should be set the same as `G_STDATE`{.envar}.
  `EPI_STTIME`{.envar}         Episode start time. Has the same format as `G_STTIME`{.envar}. Does not change during the course of an episodic run. In the Assigns file, should be set the same as `G_STTIME`{.envar}.
  `EPI_RUNLEN`{.envar}         Episode duration. Has the same format as `G_RUNLEN`{.envar}. Does not change during the course of an episodic run. In the Assigns file, should be set for the entire duration of the modeling episode, which must be greater than or equal to `G_RUNLEN`{.envar} minus one hour, is limited to at most one year, and for best results, should be a multiple of `G_RUNLEN`{.envar} minus one hour. For example, if `G_RUNLEN`{.envar} is 250000 (one day plus the required one additional hour), `EPI_RUNLEN`{.envar} must be at least 240000 and at most 365 x 240000 = 87600000. This example would run an annual episode using 24-hour run periods.
  `EPI_NDAY`{.envar}           The number of days in the episode. Should be the value of `EPI_RUNLEN`{.envar} divided by 240000. This settings controls for how many days to use the automatic looping in the example scripts, which loops over all of the periods (set by `G_RUNLEN`{.envar}) during the episode (set by `EPI_RUNLEN`{.envar}).
  `IOAPI_GRIDNAME_1`{.envar}   The selected grid. Controls which grid will be selected by the **Grdmat** program from the `GRIDDESC`{.envar} file. Users should coordinate this setting with the `GRID`{.envar} setting from [Table 4.1, "Variable in Assigns file for naming files and directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories"), which is used for naming files. This setting must match the grid names in the gridded land use and spatial surrogates files' headers.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------- -------------------- --------------------------------
  [Prev](ch04s03.html)                  [Up](ch04.html)             [Next](ch04s04s02.html)
  4.3. Running the SMOKE test case     [Home](index.html)     4.4.2. Use new inventory data
  ----------------------------------- -------------------- --------------------------------
:::
