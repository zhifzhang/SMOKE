::: {.navheader}
5.2.4. MOVES Post-processing scripts
:::

[Prev](ch05s02s03.html) 

5.2. MOVES Utility Scripts

 [Next](ch05s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#section_moves_postprocessing_scripts}5.2.4. MOVES Post-processing scripts {#moves-post-processing-scripts .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.1. Overview](ch05s02s04.html#d0e18221)]{.section}

[[5.2.4.2. **Moves2smkEF.pl**](ch05s02s04.html#d0e18237)]{.section}

[[5.2.4.3.
**gen\_8digit\_scc.pl**](ch05s02s04.html#sect_moves_gen_sccxref)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18221}5.2.4.1. Overview {#overview .title}

</div>

</div>
:::

The MOVES Post-processing scripts consist of two Perl scripts. One is
called **"[Moves2smkEF.pl]{.quote}"** which extracts the emissions
factor tables from the MOVES databases and converts them into a format
that can be used as SMOKE inputs. The second script, called
**"[gen\_8digit\_scc.pl]{.quote}"**, produces a file mapping 8-digit
SCCs to 10-digit SCCs used when importing activity data in **Smkinven**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18237}5.2.4.2. **Moves2smkEF.pl** {#moves2smkef.pl .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.2.1. Description](ch05s02s04.html#d0e18241)]{.section}

[[5.2.4.2.2. Processing Order](ch05s02s04.html#d0e18293)]{.section}

[[5.2.4.2.3. Files, Environment Variables and Run
Syntax](ch05s02s04.html#d0e18310)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18241}5.2.4.2.1. Description {#description .title}

</div>

</div>
:::

The MOVES post-processor script **"[Moves2smkEF.pl]{.quote}"** extracts
the emission factor tables from the MOVES databases (RPD, RPV, RPP, and
RPH MOVES formatted Lookup tables) and converts them into a format that
can be processed using **Movesmrg**.

::: {.orderedlist}
1.  Create a new field for \'countyID\'

    None of the MOVES lookup tables contain a countyID field solely
    dedicated to a state-county FIPS code, but SMOKE needs this
    information. For this reason, **Moves2smkEF.pl** creates a county
    field by extracting it from other fields that include county codes
    as part of their value. The RPD table has a linkID field that
    contains countyID in the leading five digits followed by more
    numbers to allow for future implementation of link modeling. The RPV
    table has a zoneID field that is countyID with a trailing zero. The
    RPP table has a TemperatureProfileID field, which also leads with
    countyID and is trailed by other numbers to indicate month and other
    identification. The RPH table has a linkID field the same as the RPD
    table. The postprocessing script parses countyID from linkID, zoneID
    and TemperatureProfileID and stores it as a separate field.

2.  Map MOVES pollutantID to output pollutant/species name

    The pollutant mapping file has columns for MOVES2014 Pollutant ID,
    MOVES2014 Pollutant Name, and SMOKE Pollutant/Model Species Name.
    **Moves2smkEF.pl** reads this list to determine which MOVES
    pollutants to output in the emission factor files and what name to
    use for each pollutant. Because MOVES2014 contains emission factors
    for both inventory pollutants and model species, the sample
    pollutant mapping file included with SMOKE uses the \_INV suffix to
    distinguish inventory pollutants from model species.

3.  Cross-tab pollutantID to reduce output table size

    Each of the four MOVES lookup tables contains a pollutantID field,
    and associated emission rates for each are listed in the
    ratePerDistance, ratePerVehicle, or ratePerHour field (depending on
    lookup table). This table structure repeats the leftmost fields
    (e.g., MOVESRunID, yearID, monthID) for each pollutantID, which
    greatly increases the total number of rows. The cross-tabbing
    postprocessing step replaces the column for \'ratePerDistance\' (or
    \'ratePerVehicle\' or \'ratePerHour\') with additional
    pollutant-specific columns containing values of emission rates. For
    example, new field headings would include \'CO\_INV\', \'NOX\',
    \'BENZENE\_INV\', etc. Performing this cross-tab on the pollutant
    emission rates significantly reduces the size of the tables for use
    by SMOKE.

4.  Aggregate emission factors by fuel type, source type, road type,
    and/or process type

    To reduce the total number of sources to be processed in SMOKE,
    **Moves2smkEF.pl** supports user-specified aggregations of MOVES
    fuel types, source types, road types, and process types to SCCs.

5.  Apply formulas to calculate additional inventory pollutants or model
    species

    Formulas can be applied to augment the existing MOVES output
    pollutants. For example, speciated versions of criteria pollutants
    are not provided in the MOVES2014 output nor are speciated emission
    factors for brake and tire wear.

6.  Create final emission rate lookup tables in SMOKE format

    The four postprocessed tables named rateperdistance\_smoke,
    ratepervehicle\_smoke, rateperprofile\_smoke, and rateperhour\_smoke
    are exported from MySQL into ASCII files for their use in SMOKE.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18293}5.2.4.2.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Moves2smkEF.pl** is run after **Runspec\_generator.pl**, and before
any SMOKE processing. The **Moves2smkEF.pl** is written in Perl,
generates SMOKE-ready MOVES lookup tables (i.e., RPD, RPV, RPP, and RPH)
by each representative county and fuel month for inputs to
[**Movesmrg**](ch06s08.html "6.8. Movesmrg").
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18310}5.2.4.2.3. Files, Environment Variables and Run Syntax {#files-environment-variables-and-run-syntax .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.2.3.1. Input Files](ch05s02s04.html#d0e18313)]{.section}

[[5.2.4.2.3.2. Run Command syntax](ch05s02s04.html#d0e18415)]{.section}

[[5.2.4.2.3.3. Output Files](ch05s02s04.html#d0e18439)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e18313}5.2.4.2.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
[]{#tbl_moves_lookup_tables}

+--------------------------+--------------+--------------------------+
| File Name                | Format       | Description              |
+==========================+==============+==========================+
|   -----------------      | MOVES format | Columns in the MOVES     |
|   rateperdistance        |              | Emission Rate Lookup     |
|   ratepervehicle         |              | Table are described in   |
|   rateperprofile         |              | [Table 2.10, "MOVES      |
|   rateperhour            |              | Emission Rate Lookup     |
|   -----------------      |              | Table (MOVES             |
|                          |              | Format)"]                |
|                          |              | (ch02s16s02.html#tbl_con |
|                          |              | cepts_moves_lookup_tbl_m |
|                          |              | v_format "Table 2.10. MO |
|                          |              | VES Emission Rate Lookup |
|                          |              |  Table (MOVES Format)"). |
+--------------------------+--------------+--------------------------+
|                          |              |                          |
+--------------------------+--------------+--------------------------+
| `InputDBList`{.envar}:   | ASCII        | List of MySQL database   |
|                          |              | names to process         |
|                          |              | generated by             |
|                          |              | *                        |
|                          |              | *Runspec\_generator.pl** |
+--------------------------+--------------+--------------------------+
| `Polluta                 | ASCII        | List of formulas used to |
| ntFormulasFile`{.envar}: |              | calculate additional     |
|                          |              | emission factors         |
+--------------------------+--------------+--------------------------+
| `FuelT                   | ASCII        | List of MOVES fuel type  |
| ypeMappingFile`{.envar}: |              | IDs and corresponding    |
|                          |              | aggregated fuel type ID  |
+--------------------------+--------------+--------------------------+
| `SourceT                 | ASCII        | List of MOVES source     |
| ypeMappingFile`{.envar}: |              | type IDs and             |
|                          |              | corresponding aggregated |
|                          |              | source type ID           |
+--------------------------+--------------+--------------------------+
| `RoadT                   | ASCII        | List of MOVES road type  |
| ypeMappingFile`{.envar}: |              | IDs and corresponding    |
|                          |              | aggregated road type ID  |
+--------------------------+--------------+--------------------------+
| `ProcessT                | ASCII        | List of MOVES process    |
| ypeMappingFile`{.envar}: |              | type IDs and             |
|                          |              | corresponding aggregated |
|                          |              | process type ID          |
+--------------------------+--------------+--------------------------+
| `Pollut                  | ASCII        | List of MOVES pollutant  |
| antMappingFile`{.envar}: |              | IDs and corresponding    |
|                          |              | pollutant name; only     |
|                          |              | listed pollutants will   |
|                          |              | be included in output    |
|                          |              | emission factor tables   |
+--------------------------+--------------+--------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e18415}5.2.4.2.3.2. Run Command syntax {#run-command-syntax .title}

</div>

</div>
:::

``` {.programlisting}
moves2smkEF.pl [-r RPD|RPV|RPP|RPH] [--formulas PollutantFormulasFile] [--fuel_agg FuelTypeMappingFile] [--src_agg SourceTypeMappingFile] [--road_agg RoadTypeMappingFile] [--proc_agg ProcessTypeMappingFile] InputDBList PollutantMappingFile [OutputPath]
```

::: {.itemizedlist}
-   RPD\|RPP\|RPV\|RPH - optional type of emission factors to process
    (rate-per-distance, rate-per-vehicle, rate-per-profile, or
    rate-per-hour); if not specified, script will process all four types
-   PollutantFormulasFile - list of formulas used to calculate
    additional emission factors
-   FuelTypeMappingFile - list of MOVES fuel type IDs and corresponding
    aggregated fuel type ID
-   SourceTypeMappingFile - list of MOVES source type IDs and
    corresponding aggregated source type ID
-   RoadTypeMappingFile - list of MOVES road type IDs and corresponding
    aggregated road type ID
-   ProcessTypeMappingFile - list of MOVES process type IDs and
    corresponding aggregated process type ID
-   InputDBList - list of MySQL database names to process (generated by
    runspec\_generator.pl MOVES preprocessor)
-   PollutantMappingFile - list of MOVES pollutant IDs and corresponding
    pollutant name
-   OutputPath - optional; overrides the output path specified in
    InputDBList
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e18439}5.2.4.2.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
[]{#tbl_smoke_lookup_tables}

  File Name                                 Format   Description
  ----------------------------------------- -------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `rateperdistance_smoke*.csv`{.envar}      ASCII    RPD SMOKE formatted lookup table (fuel month specific). The format of MOVES lookup tables are described in [Table 2.11, "MOVES Emission Rate Lookup Table (SMOKE Format)"](ch02s16s02.html#tbl_concepts_moves_lookup_tbl_sm_format "Table 2.11. MOVES Emission Rate Lookup Table (SMOKE Format)").
  `ratepervehicle_smoke*.csv`{.envar}       ASCII    RPV SMOKE formatted lookup table (fuel month specific)
  `rateperprofile_smoke*.csv`{.envar}       ASCII    RPP SMOKE formatted lookup table (fuel month specific)
  `rateperhour_smoke*.csv`{.envar}          ASCII    RPH SMOKE formatted lookup table (fuel month specific)
  `mcrlist.rateperdistance*.lst`{.envar}:   ASCII    list of MOVES-based rateperdistance lookup tables
  `mcrlist.ratepervehicle*.lst`{.envar}:    ASCII    list of MOVES-based ratepervehicle lookup tables
  `mcrlist.rateperprofile*.lst`{.envar}:    ASCII    list of MOVES-based rateperprofile lookup tables
  `mcrlist.rateperhour*.lst`{.envar}:       ASCII    list of MOVES-based rateperhour lookup tables
:::
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_moves_gen_sccxref}5.2.4.3. **gen\_8digit\_scc.pl** {#gen_8digit_scc.pl .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.3.1. Description](ch05s02s04.html#d0e18530)]{.section}

[[5.2.4.3.2. Processing Order](ch05s02s04.html#d0e18541)]{.section}

[[5.2.4.3.3. Files, Environment Variables and Run
Syntax](ch05s02s04.html#d0e18559)]{.section}

[[5.2.4.3.4. Run Command syntax](ch05s02s04.html#d0e18626)]{.section}

[[5.2.4.3.5. Output Files](ch05s02s04.html#d0e18644)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18530}5.2.4.3.1. Description {#description-1 .title}

</div>

</div>
:::

The **gen\_8digit\_scc.pl** script generates a file mapping 8-digits
SCCs to aggregated SCCs produced by **Moves2smkEF.pl**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18541}5.2.4.3.2. Processing Order {#processing-order-1 .title}

</div>

</div>
:::

The Perl script performs the following steps:

::: {.itemizedlist}
-   Connect to the first database listed in the InputDBList file

-   Query the specified database table (rateperdistance, ratepervehicle,
    rateperprofile, or rateperhour) and generate a list of all SCCs in
    the MOVES2014 output

-   Apply the fuel type, source type, road type, and process type
    mappings to generate a list of 10-digit aggregated SCCs

-   Output the list of 10-digit aggregated SCCs with corresponding
    8-digit SCC (first 8 digits of 10-digit SCC)
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18559}5.2.4.3.3. Files, Environment Variables and Run Syntax {#files-environment-variables-and-run-syntax-1 .title}

</div>

<div>

##### []{#d0e18559}5.2.4.3.3. Files, Environment Variables and Run Syntax {#files-environment-variables-and-run-syntax-2 .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                           Format   Description
  ----------------------------------- -------- -----------------------------------------------------------------------------------------------------------------------------
  `FuelTypeMappingFile`{.envar}:      ASCII    List of MOVES fuel type IDs and corresponding aggregated fuel type ID
  `SourceTypeMappingFile`{.envar}:    ASCII    List of MOVES source type IDs and corresponding aggregated source type ID
  `RoadTypeMappingFile`{.envar}:      ASCII    List of MOVES road type IDs and corresponding aggregated road type ID
  `ProcessTypeMappingFile`{.envar}:   ASCII    List of MOVES process type IDs and corresponding aggregated process type ID
  `InputDBList`{.envar}:              ASCII    List of MySQL database names to process generated by **Runspec\_generator.pl**; only the first database listed will be used
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18626}5.2.4.3.4. Run Command syntax {#run-command-syntax-1 .title}

</div>

</div>
:::

``` {.programlisting}
gen_8digit_scc.pl -r RPD|RPV|RPP|RPH [--fuel_agg FuelTypeMappingFile] [--src_agg SourceTypeMappingFile] [--road_agg RoadTypeMappingFile] [--proc_agg ProcessTypeMappingFile] InputDBList
```

::: {.itemizedlist}
-   RPD\|RPP\|RPV\|RPH - emission factor table to query
    (rateperdistance, ratepervehicle, rateperprofile, or rateperhour)
-   FuelTypeMappingFile - list of MOVES fuel type IDs and corresponding
    aggregated fuel type ID
-   SourceTypeMappingFile - list of MOVES source type IDs and
    corresponding aggregated source type ID
-   RoadTypeMappingFile - list of MOVES road type IDs and corresponding
    aggregated road type ID
-   ProcessTypeMappingFile - list of MOVES process type IDs and
    corresponding aggregated process type ID
-   InputDBList - list of MySQL database names to process (generated by
    runspec\_generator.pl MOVES preprocessor); only first database
    listed will be used
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18644}5.2.4.3.5. Output Files {#output-files-1 .title}

</div>

</div>
:::

**gen\_8digit\_scc.pl** outputs a list of 10-digit SCCs and
corresponding 8-digit SCCs. Users should direct this output to the file
of their choosing.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -------------------------------
  [Prev](ch05s02s03.html)     [Up](ch05s02.html)             [Next](ch05s03.html)
  5.2.3. Run MOVES Model      [Home](index.html)     5.3.  SMOKE Utility Programs
  -------------------------- -------------------- -------------------------------
:::
