::: {.navheader}
2.12. Spatial processing
:::

[Prev](ch02s11s05.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s12s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_spatial_processing}2.12. Spatial processing {#spatial-processing .title style="clear: both"}
-------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.12.1. Defining the gridded region to output from
SMOKE](ch02s12.html#d0e5849)]{.section}

[[2.12.2. Assigning sources to grid cells](ch02s12s02.html)]{.section}

[[2.12.3. Creating the spatial allocation intermediate
files](ch02s12s03.html)]{.section}
:::

The spatial processing operation, or [*gridding*]{.emphasis}, combines
the grid specification for the air-quality modeling domain with source
locations from the SMOKE inventory file. The resulting gridding matrix
is a sparse matrix that describes in which grid cells the emissions for
each source occur within the modeling domain. The gridding matrix is
applied to the inventory emissions to transform source-based inventory
emissions to gridded emissions.

The SMOKE **Grdmat** program creates the gridding matrix for area,
mobile, and point sources. The gridding step is different depending on
the type of source being processed.

::: {.itemizedlist}
-   For area sources, county-total emissions are spread among the cells
    intersecting the county through the use of gridding surrogates.

-   For mobile sources, the data can be provided by county (as area
    sources are), or the data can be provided as line sources
    ("[links]{.quote}"). County-based mobile emissions are apportioned
    with gridding surrogates, preferably with surrogates based on the
    different road types for which the mobile emissions are provided.
    The line-source emissions are apportioned depending on the length of
    the link in each cell.

-   For point sources, emissions are apportioned to the grid cell
    intersecting the point.
:::

As shown in [Figure 2.22, "Relationship between inventory and gridding
matrix"](ch02s12.html#fig_concepts_spatial_processing "Figure 2.22. Relationship between inventory and gridding matrix"),
the gridding matrix contains the SMOKE source IDs that intersect each
grid cell, and the source-to-cell factors for each. The gridding matrix
is a sparse matrix because each source intersects only a small number of
cells relative to the total number of cells in the domain, and the
storage format shown in the figure reflects a sparse storage format. In
the example in [Figure 2.22, "Relationship between inventory and
gridding
matrix"](ch02s12.html#fig_concepts_spatial_processing "Figure 2.22. Relationship between inventory and gridding matrix"),
source 1 intersects cells 1 and 2, with 10% of the emissions in cell 1
and 30% of the emissions in cell 2. The remainder of the source's
emissions (60%) are either outside the grid or in other cells not shown
in this example. Source 2 is completely inside the domain; 40% of its
emissions are in cell 1, 30% are in cell 2, and 30% are in cell 4. If
this were a point-source speciation matrix, there would be only one cell
associated with each source because each point source exists in only one
cell.

::: {.figure}
[]{#fig_concepts_spatial_processing}

**Figure 2.22. Relationship between inventory and gridding matrix**

::: {.mediaobject}
![Relationship between inventory and gridding
matrix](images\concepts\spatial_processing_html.jpg)
:::
:::

Note that the gridding matrix depends only upon the source locations,
the grid definition, and in some cases gridding surrogates and
cross-references. It is therefore independent of the other steps of
emissions processing.

Spatial processing addresses the following issues during emissions
processing:

::: {.orderedlist}
1.  Defining the gridded region to output from SMOKE

2.  Assigning sources to grid cells

3.  Creating the spatial allocation intermediate files
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5849}2.12.1. Defining the gridded region to output from SMOKE {#defining-the-gridded-region-to-output-from-smoke .title}

</div>

</div>
:::

The grid for which the spatial allocation step outputs the gridding
matrix depends upon the `IOAPI_GRIDNAME_1`{.envar} environment variable
setting and the `GRIDDESC`{.envar} input file. The file contains all of
the settings needed by the I/O API to define each grid (together, these
settings are called a grid definition), and it contains many such grid
definitions. The `IOAPI_GRIDNAME_1`{.envar} setting selects the specific
grid to use during a specific run, and it must match the grid name
provided in the `GRIDDESC`{.envar} file. The settings used by the I/O
API to define a grid are documented as part of the [I/O API web
site](http://www.baronams.com/products/ioapi/GRIDDESC.html).

There is another file format, called the `G_GRIDPATH`{.envar} file, that
can be provided to **Grdmat** instead of the `GRIDDESC`{.envar} file.
However, the `G_GRIDPATH`{.envar} format allows only one grid per file.
It is included as an acceptable input to SMOKE to allow SMOKE to be
backwardly compatible with previous versions. All new users are advised
to use a single `GRIDDESC`{.envar} file to store all of their modeling
grids, instead of using multiple `G_GRIDDPATH`{.envar} files, one for
each grid. The `IOAPI_GRIDNAME_1`{.envar} setting is not used by
**Grdmat** when the `G_GRIDPATH`{.envar} format is used.

The gridded region selected at run time does not need to cover all of
the counties in the inventory. If the gridded region is smaller than the
inventory, this processing step will still include the counties or parts
of counties that do not overlap the grid. This allows users who are
performing emissions processing using nested grids to import the
inventory once and apply gridding matrices for each grid to the same
inventory, creating gridded emissions for all nested grids without
having to adjust the inventory files. The downside of this approach is
that SMOKE does not give a warning if a county that is in the inventory
is not in the spatial surrogates, or if a lat-lon coordinate is not
inside the grid. It assumes that these sources are intended to be
dropped and proceeds without comment. Thus, you must ensure that your
surrogate files contain the counties in your inventory that are inside
the grid and that your lat-lon coordinates for point and link sources
are correct.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------- -------------------- ------------------------------------------
  [Prev](ch02s11s05.html)                             [Up](ch02.html)                       [Next](ch02s12s02.html)
  2.11.5. Creating speciation intermediate files     [Home](index.html)     2.12.2. Assigning sources to grid cells
  ------------------------------------------------- -------------------- ------------------------------------------
:::
