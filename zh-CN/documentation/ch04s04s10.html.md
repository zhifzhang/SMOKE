::: {.navheader}
4.4.10. Use a different speciation mechanism or change speciation inputs
:::

[Prev](ch04s04s09.html) 

4.4. How to use SMOKE

 [Next](ch04s04s11.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_change_speciation}4.4.10. Use a different speciation mechanism or change speciation inputs {#use-a-different-speciation-mechanism-or-change-speciation-inputs .title}

</div>

</div>
:::

::: {.toc}
[[4.4.10.1. Choosing from default
mechanisms](ch04s04s10.html#sect_scripts_use_default_spc)]{.section}

[[4.4.10.2. Setup of new mechanism or changing an existing
mechanism](ch04s04s10.html#sect_scripts_use_new_spc)]{.section}

[[4.4.10.3. Changing speciation
assignments](ch04s04s10.html#d0e14544)]{.section}

[[4.4.10.4. Changing the definition of NONHAPVOC or
NONHAPTOG](ch04s04s10.html#d0e14598)]{.section}
:::

A common change to the SMOKE configuration is to select a speciation
approach for an air quality model and chemical mechanism. In [Chapter 4,
*How to Use SMOKE*](ch04.html "Chapter 4. How to Use SMOKE"), we noted
that many speciation files are available for download from EPA. In this
section, we describe how to use the `SPC`{.envar} value in the Assigns
file to select these.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_use_default_spc}4.4.10.1. Choosing from default mechanisms {#choosing-from-default-mechanisms .title}

</div>

</div>
:::

SMOKE provides several chemical mechanisms that one can select for
modeling. In the default SMOKE configuration, only a few small changes
are necessary to the Assigns file and script to use a different chemical
mechanism.

::: {.orderedlist}
1.  Set the `SPC`{.envar} setting in the Assigns file.

    The `SPC`{.envar} setting in the Assigns file controls which
    chemical mechanism is used by the scripts and SMOKE programs.
    Depending on what source categories you are modeling, the air
    quality model that you are using, and the chemical mechanism for
    that air quality model. See the default data files described in
    [Chapter 4, *How to Use
    SMOKE*](ch04.html "Chapter 4. How to Use SMOKE") for the actual file
    names that will be used for each source category. Where different
    files are needed for different source categories, the Assigns file
    will automatically detect this and set the `GSPRO`{.envar} and
    `GSREF`{.envar} files accordingly.

2.  Determine whether VOC-to-TOG or ROG-to-TOG is needed and set script
    accordingly.

    If your inventory contains the pollutant VOC or ROG and you are
    modeling for CMAQ, UAM, or CAM~X~, then you will need to use SMOKE's
    `GSCNV`{.envar} file to convert the VOC or ROG mass to TOG mass.

    The SMOKE **Spcmat** program will use the `GSCNV`{.envar} file if
    the `POLLUTANT_CONVERSION`{.envar} setting in the script is Y. This
    is the default configuration for the CMAQ run scripts.

    If your inventory contains TOG, then the
    `POLLUTANT_CONVERSION`{.envar} setting in the run script should be
    set to N.

3.  Ensure that the inventory pollutants that need speciation match the
    inventory pollutants in the speciation profiles and cross-reference
    files.

    All of the pollutants in your inventory that you wish to include in
    the outputs must have valid profiles in the `GSPRO`{.envar} and
    `GSREF`{.envar} files. If the pollutant is left out of the
    `GSREF`{.envar} file, the pollutant will be dropped from modeling
    (in some cases, this is desirable, but a warning will be generated
    by **Spcmat**). For each pollutant in your inventory check that:

    ::: {.orderedlist}
    a.  The pollutant has one or more entries in the `GSREF`{.envar}
        file. In some cases, you may have to add entries. For example,
        not all `GSREF`{.envar} files have "[ROG]{.quote}" entries, but
        these can easily be added simply by copying the VOC assignments
        and changing the VOC label to ROG.

    b.  For CMAQ, UAM, and CAM~X~ and the pollutant is VOC or ROG, check
        that the TOG profiles are in the `GSPRO`{.envar} file.

    c.  For all models and all other pollutants, check that the profiles
        are included in the `GSPRO`{.envar} file.
    :::

4.  Ensure that the correct Assigns file is used in your run scripts.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_use_new_spc}4.4.10.2. Setup of new mechanism or changing an existing mechanism {#setup-of-new-mechanism-or-changing-an-existing-mechanism .title}

</div>

</div>
:::

::: {.orderedlist}
1.  Create and install the `GSPRO`{.envar} file.

    If only a few changes will be made to a `GSPRO`{.envar} file, you
    can simply copy an existing `GSPRO`{.envar} file to a new file. If
    more extensive changes are needed to create a new mechanism,
    currently, there is no utility for creating a `GSPRO`{.envar} file
    in SMOKE. For now, users must use the file format in [Chapter 8,
    *SMOKE Input Files*](ch08.html "Chapter 8. SMOKE Input Files") and a
    high degree of expertise to develop new `GSPRO`{.envar} files.

    Install the `GSPRO`{.envar} file in the `$GE_DAT`{.filename}
    directory. For the default `GSPRO`{.envar} file for that chemical
    mechanism (i.e., the one that applies to the most source
    categories), name the file `gspro.$SPC`{.filename}.txt. If your
    speciation profile is specific to a certain source category, name
    the `GSPRO`{.envar} file as follows:

    ::: {.itemizedlist}
    -   area/non-road mobile: `gspro.$SPC`{.filename}.a.txt

    -   on-road mobile: `gspro.$SPC`{.filename}.m.txt

    -   point: `gspro.$SPC`{.filename}.p.txt
    :::

2.  Create and install the `GSREF`{.envar} file.

    You may be able to simply copy a `GSREF`{.envar} file to a new name,
    depending on whether the profile codes are different for your new
    mechanism. In many cases, the same profile codes are used (e.g.,
    from the SPECIATE database), but the profiles themselves are all
    that have changed.

    If you need to create a new `GSREF`{.envar} from scratch, you will
    need to ensure that all of the SCCs and all of the pollutants in the
    inventory have profile assignments. Any pollutant in the inventory
    that is not included in the `GSREF`{.envar} file will be dropped
    from modeling. Any SCC that is not included will be assigned the
    default profile, which is the profile assigned to SCC = 0.

    Name the `GSREF`{.envar} file using a similar approach as for the
    `GSPRO`{.envar} file, but use the "[gsref]{.quote}" prefix instead
    of the "[gspro]{.quote}" prefix. Therefore, the default file for
    that chemical mechanism (the one that applies to the most source
    categories) should be named `gsref.$SPC`{.filename}.txt. Any
    source-category-specific files should use the names as follows:

    ::: {.itemizedlist}
    -   area/non-road mobile: `gsref.$SPC`{.filename}.a.txt

    -   on-road mobile: `gsref.$SPC`{.filename}.m.txt

    -   point: `gsref.$SPC`{.filename}.p.txt
    :::

3.  Create the pollutant-to-pollutant conversion file, if necessary.

    If the speciation profiles change or new profiles are added for VOC
    speciation, a `GSCNV`{.envar} file must be created accordingly. This
    can be accomplished by copying and editing the example
    `GSCNV`{.envar} file or creating a new `GSCNV`{.envar} file from
    scratch. This requires a high degree of expertise and must be
    closely coordinated with creating the `GSPRO`{.envar} file.

4.  Edit the `INVTABLE`{.envar} file.

    Particularly for toxics modeling, changes to the `GSPRO`{.envar}
    file must be coordinated with changes to the `INVTABLE`{.envar} file
    in the following ways:

    ::: {.itemizedlist}
    -   If the definition of NONHAPVOC changes, the `INVTABLE`{.envar}
        definition of NONHAPVOC must change as well.

    -   If there are new explicit model species, these must be
        identified in the `INVTABLE`{.envar} file.

    -   If there are new model species that are not part of the chemical
        mechanism, these must be identified in the `INVTABLE`{.envar}
        file.

    -   If there are new pollutants, these must be included in the
        `INVTABLE`{.envar} file (as well as the raw inventories, of
        course).
    :::

5.  Coordinate with MOVES inputs.

    When processing using on-road mobile emissions and SMOKE running
    MOVES, users need to create the `MEPROC`{.envar} file that contains
    a list of MOVES pollutants by emissions processes created by MOVES.
    This SMOKE input need to be coordinated so that the pollutants
    expected by the chemical mechanism are all created by SMOKE/MOVES.
    This requires that the `MEPROC`{.envar} file have all
    pollutant/process combinations for the required pollutants and that
    the MOVES inputs are configured to generate emissions for those
    pollutants. The `MEPROC`{.envar} file is documented in
    [Section 8.9.2.1.4, "`MEPROC`{.envar}: List of mobile emission
    processes and associated activities and
    pollutants"](ch08s09s02.html#sect_input_meproc_moves "8.9.2.1.4. MEPROC: List of mobile emission processes and associated activities and pollutants").
    The MOVES inputs are documented in the MOVES manual, and the
    limitations placed on these files by SMOKE are documented in
    [Section 4.4.12, "Use MOVES for on-road mobile
    sources"](ch04s04s12.html "4.4.12. Use MOVES for on-road mobile sources").

6.  Edit the Assigns file and scripts

    Make sure to change the `SPC`{.envar} variable in your Assigns file
    to the one for your new chemical mechanism. Also make sure that your
    run scripts use the Assigns file with the correct `SPC`{.envar}
    setting.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14544}4.4.10.3. Changing speciation assignments {#changing-speciation-assignments .title}

</div>

</div>
:::

Speciation assignments can be changed so that different speciation
profiles are used for certain SCCs and pollutants or to add SCCs and
pollutants. You will need to ensure that all of the SCCs and all of the
pollutants in the inventory have profile assignments. Any pollutant in
the inventory that is not included in the `GSREF`{.envar} file will be
dropped from modeling. Any SCC that is not included will be assigned the
default profile, which is the profile assigned to SCC = 0.

::: {.orderedlist}
1.  Adding entries to an existing cross-reference file.

    Edit an existing cross-reference file or copy it to a new file for
    editing. Insert the new speciation assignments based on the format
    of the file, described in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files").

2.  Create new speciation cross-reference file(s) for your case.

    Copy the speciation cross-reference (`GSREF`{.envar}) file for the
    chemical mechanism that you are using (or a chemical mechanism that
    is most similar to the one you have created). Edit the speciation
    profile assignments using the file format, described in [Chapter 8,
    *SMOKE Input Files*](ch08.html "Chapter 8. SMOKE Input Files"). The
    naming convention for the new file must be consistent with the
    convention described in the previous subsection.

3.  Change the pollutant-to-pollutant conversion file.

    If different SCCs get different profiles, then the `GSCNV`{.envar}
    file must be changed as well. The VOC-to-TOG factor in the
    `GSCNV`{.envar} depends on the profile that has been assigned to an
    SCC. So, the factor must be consistent with the profile assigned.
    Calculating the VOC-to-TOG factor requires some expertise, and this
    is outside the scope of this manual. However, if you change an SCC
    to use an existing profile, you can determine the correct VOC-to-TOG
    factor by first finding another SCC that uses that profile and then
    setting the VOC-to-TOG factor to be the same as the one for that
    other SCC.

4.  If any new files are created, ensure that the Assigns file uses all
    new files.

    Make sure that the `SPC`{.envar} setting in the Assigns is correct
    and that the Assigns file will set the `GSPRO`{.envar},
    `GSREF`{.envar}, and `GSCNV`{.envar} files so that any new files
    will be used by the programs.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14598}4.4.10.4. Changing the definition of NONHAPVOC or NONHAPTOG {#changing-the-definition-of-nonhapvoc-or-nonhaptog .title}

</div>

</div>
:::

The definition of NONHAPVOC and NONHAPTOG simply must be consistent
between the `GSPRO`{.envar} file and the `INVTABLE`{.envar} file. This
change applies only to chemical mechanisms that use VOC model species
and can therefore benefit from the integration of toxics and criteria
VOC. This includes all models that SMOKE supports.

::: {.orderedlist}
1.  Edit the `INVTABLE`{.envar} file.

    You can add pollutants and change their NONHAPVOC status using the
    `INVTABLE`{.envar} file format provided in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files").

2.  Create new speciation profiles.

    The speciation profiles must use the same definition of NONHAPVOC or
    NONHAPTOG. The header of the file must be updated to reflect the new
    definitions. The profiles for NONHAPVOC and NONHAPTOG must also be
    updated to be consistent. Finally, all other TOG profiles must be
    updated to be consistent with the definition.

3.  Coordinate with MOVES inputs.

    When processing using on-road mobile emissions and SMOKE running
    MOVES, users need to create the `MEPROC`{.envar} file that contains
    a list of MOVES pollutants by emissions processes created by MOVES.
    This SMOKE input need to be coordinated so that the pollutants
    expected by the chemical mechanism are all created by SMOKE/MOVES.
    This requires that the `MEPROC`{.envar} file have all
    pollutant/process combinations for the required pollutants and that
    the MOVES inputs are configured to generate emissions for those
    pollutants. The `MEPROC`{.envar} file is documented in
    [Section 8.9.2.1.4, "`MEPROC`{.envar}: List of mobile emission
    processes and associated activities and
    pollutants"](ch08s09s02.html#sect_input_meproc_moves "8.9.2.1.4. MEPROC: List of mobile emission processes and associated activities and pollutants").
    The MOVES inputs are documented in the MOVES manual, and the
    limitations placed on these files by SMOKE are documented in
    [Section 4.4.12, "Use MOVES for on-road mobile
    sources"](ch04s04s12.html "4.4.12. Use MOVES for on-road mobile sources").
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------------------------------- -------------------- -------------------------------------------------
  [Prev](ch04s04s09.html)                                                                  [Up](ch04s04.html)                            [Next](ch04s04s11.html)
  4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic and biogenic)     [Home](index.html)     4.4.11. Setup projection and control scenarios
  --------------------------------------------------------------------------------------- -------------------- -------------------------------------------------
:::
