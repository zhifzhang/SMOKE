::: {.navheader}
Chapter 6. SMOKE Core Programs
:::

[Prev](ch05s03s15.html) 

 

 [Next](ch06s02.html)

------------------------------------------------------------------------

::: {.chapter lang="en"}
::: {.titlepage}
<div>

<div>

[]{#ch_programs}Chapter 6. SMOKE Core Programs {#chapter-6.-smoke-core-programs .title}
----------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.1. Overview](ch06.html#d0e21574)]{.section}

[[6.2. **Cntlmat**](ch06s02.html)]{.section}

[[6.3. **Elevpoint**](ch06s03.html)]{.section}

[[6.4. **Grdmat**](ch06s04.html)]{.section}

[[6.5. **Grwinven**](ch06s05.html)]{.section}

[[6.6. **Laypoint**](ch06s06.html)]{.section}

[[6.7. **Met4moves**](ch06s07.html)]{.section}

[[6.8. **Movesmrg**](ch06s08.html)]{.section}

[[6.9. **Mrgelev**](ch06s09.html)]{.section}

[[6.10. **Mrggrid**](ch06s10.html)]{.section}

[[6.11. **Mrgpt**](ch06s11.html)]{.section}

[[6.12. **Normbeis3**](ch06s12.html)]{.section}

[[6.13. **Smkinven**](ch06s13.html)]{.section}

[[6.14. **Smkmerge**](ch06s14.html)]{.section}

[[6.15. **Spcmat**](ch06s15.html)]{.section}

[[6.16. **Temporal**](ch06s16.html)]{.section}

[[6.17. **Tmpbeis3**](ch06s17.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#d0e21574}6.1. Overview {#overview .title style="clear: both"}
--------------------------

</div>

</div>
:::

[Figure 6.1, "SMOKE core
programs"](ch06.html#fig_programs_core_programs "Figure 6.1. SMOKE core programs")
shows the SMOKE core programs and how they relate to each other. We
define the core programs as those needed for the actual emissions
processing; we exclude QA and utility programs such as **Smkreport**
(these programs are discussed in [Chapter 7, *SMOKE Quality
Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance") and
[Chapter 5, *SMOKE Utility
Tools*](ch05.html "Chapter 5. SMOKE Utility Tools")). The lines between
the boxes represent one or more files passing between the programs, and
show the dependencies among the programs. Note that we have omitted some
redundant file dependencies to make the diagram easier to understand.
Unless otherwise noted, the SMOKE core programs are applied for the
anthropogenic source categories: area-, mobile-, and point-source
processing (biogenic processing follows a separate path from the other
source categories). When a program that applies to multiple source
categories is used, it can be run for only one source category at a
time, with the exception of **Smkmerge** and **Mrggrid**.

::: {.figure}
[]{#fig_programs_core_programs}

**Figure 6.1. SMOKE core programs**

::: {.mediaobject}
![SMOKE core programs](images\programs\core_programs_html.jpg)
:::
:::

The [**Smkinven**](ch06s13.html "6.13. Smkinven") program, at left in
[Figure 6.1, "SMOKE core
programs"](ch06.html#fig_programs_core_programs "Figure 6.1. SMOKE core programs"),
is responsible for importing the stationary area/non-point, nonroad,
on-road mobile, and point source inventory emissions data. For mobile
sources, **Smkinven** can also import activity data in the form of VMT
and vehicle speed for use in generating emission factors. For point
sources, **Smkinven** can also import day- and hour-specific data. The
output from **Smkinven** is used as input to nearly every other core
SMOKE program.

Also at left, the [**Normbeis3**](ch06s12.html "6.12. Normbeis3")
program imports the gridded land use data and biogenic emissions factors
,and creates gridded, normalized (time-independent) biogenic emissions.

[**Grdmat**](ch06s04.html "6.4. Grdmat") creates the gridding matrix for
the anthropogenic source categories.

The [**Temporal**](ch06s16.html "6.16. Temporal") program is used to
create an hourly emissions file for the anthropogenic source categories.
It can read in day-specific and hour-specific data, and merge this with
estimated daily and hourly data created from the annual emissions data
using temporal profiles.

[**Elevpoint**](ch06s03.html "6.3. Elevpoint") preprocesses the selected
PinG and major point sources. **Elevpoint** is not used when no PinG or
major point sources need to be defined. In this case, SMOKE can create
elevated emissions for all point sources, so there is no need to
specifically indicate the major point sources.

[**Laypoint**](ch06s06.html "6.6. Laypoint") computes the plume rise for
all point sources based on the meteorology data.

[**Spcmat**](ch06s15.html "6.15. Spcmat") creates the speciation
matrices (both mass and molar) for the anthropogenic source categories.
It uses the user-selected chemical mechanism.

[**Cntlmat**](ch06s02.html "6.2. Cntlmat") creates the growth matrices,
multiplicative control matrices, and reactivity control matrices for the
anthropogenic source categories. This program is not used for base-year
emissions without controls.

[**Grwinven**](ch06s05.html "6.5. Grwinven") is used to grow the
emissions to past or future years using the growth matrix created by
**Cntlmat** and the imported inventory data from **Smkinven**. It writes
both SMOKE inventory format (I/O API NetCDF) and ORL format. The output
from **Grwinven** is used in place of the original output from
**Smkinven** when processing past or future years.

[**Tmpbeis3**](ch06s17.html "6.17. Tmpbeis3") applies meteorology
adjustments to the normalized emissions created by **Normbeis3**.
**Tmpbeis3** also applies the speciation profiles needed for the
user-selected chemical mechanism to create gridded, hourly,
model-species biogenic emissions data for use in **Smkmerge** and
**Mrggrid**. The **Normbeis3** and **Tmpbeis3** programs taken together
are the equivalent of SMOKE-BEIS3.

[**Smkmerge**](ch06s14.html "6.14. Smkmerge") is used to combine all
emissions and matrices to create the gridded, hourly, model-species
emissions needed for an AQM. It can merge for one source category at a
time or all source categories at once, and it can read in the
model-ready biogenic emissions to merge with the anthropogenic source
categories. It can merge the matrices with the inventory data output
from **Smkinven** or the hourly emissions from **Temporal**, and it can
optionally merge the speciation, gridding, or control matrices, or any
combination. It also writes state and county emissions totals.

[**Movesmrg**](ch06s08.html "6.8. Movesmrg") is only used for mobile
sources to compute hourly emissions using the hourly VMT from
**Temporal**, the MOVES emission rates lookup tables (i.e., RPD, RPH,
RPV and RPP), the gridded/averaged temperatures meteorology data and
more. If VMT are not used, then the emissions from **Smkinven** are
combined with the temporal factors, and the emission factors are not
used at all.

In the remaining sections of this chapter, we provide detailed program
descriptions, in alphabetic order.

[**Mrgelev**](ch06s09.html "6.9. Mrgelev") is used to combine ASCII
elevated files created by **Smkmerge**. These files contain point-source
data needed by AQMs including CAMx and UAM models.

[**Mrggrid**](ch06s10.html "6.10. Mrggrid") is used to combine gridded
emission data files, which can be speciated or non-speciated, and hourly
or time-independent. It can combine a 3-D point source file with any
number of 2-D files from other source categories. This program is
optional and provides a convenient way to merge model-ready output files
outside of **Smkmerge**.

[**Mrgpt**](ch06s11.html "6.11. Mrgpt") is used to combine multiple
point sources inline-mode hourly speciated emission data and ASCII
elevated files created by **Smkmerge**. This program is optional and
allows the users to process multiple point sources separately in inline
mode through **Smkmerge** prior to merging them for CMAQ model.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch05s03s15.html)                            [Next](ch06s02.html)
  5.3.15. **Uam2ncf**         [Home](index.html)         6.2. **Cntlmat**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.2. **Cntlmat**
:::

[Prev](ch06.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s02s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_cntlmat}6.2. **Cntlmat** {#cntlmat .title style="clear: both"}
------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.2.1. Description](ch06s02.html#d0e21753)]{.section}

[[6.2.2. Processing Order](ch06s02s02.html)]{.section}

[[6.2.3. Files and Environment Variables](ch06s02s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e21753}6.2.1. Description {#description .title}

</div>

</div>
:::

::: {.toc}
[[6.2.1.1. Application Logic for the Multiplicative Control
Matrix](ch06s02.html#d0e21794)]{.section}

[[6.2.1.2. Source Matching
Hierarchy](ch06s02.html#sect_programs_cntlmat_source_match)]{.section}
:::

[*Processing categories:*]{.emphasis} area, mobile, point

The **Cntlmat** program uses control packets to create a growth matrix,
and/or a multiplicative control matrix, and/or a reactivity control
matrix. **Cntlmat** allows seven different control packet types: /MACT/,
/CONTROL/, /EMS\_CONTROL/, /CTG/, /ALLOWABLE/, /REACTIVITY/, and
/PROJECTION/. The format of each packet type is given in [Section 8.6.1,
"`GCNTL`{.envar}: Files for controls and/or past- and future-year
growth"](ch08s06.html#sect_input_gcntl "8.6.1. GCNTL: Files for controls and/or past- and future-year growth").

::: {.itemizedlist}
-   Growth matrix - This contains past- or future-year growth factors
    for all sources.

-   Multiplicative control matrix - This matrix contains the combination
    of various types ofcontrols typically used in emissions processing:
    CTG, MACT, RACT, control efficiency, rule effectiveness, rule
    penetration, allowable emissions, and caps. The logic used when
    applying this matrix is described below this bulleted list.

-   Reactivity matrix - This matrix contains the information needed for
    applying reactivity controls.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e21794}6.2.1.1. Application Logic for the Multiplicative Control Matrix {#application-logic-for-the-multiplicative-control-matrix .title}

</div>

</div>
:::

::: {.toc}
[[6.2.1.1.1. /MACT/ packet](ch06s02.html#d0e21814)]{.section}

[[6.2.1.1.2. /CONTROL/ packet](ch06s02.html#d0e21950)]{.section}

[[6.2.1.1.3. /CTG/ packet](ch06s02.html#d0e22074)]{.section}

[[6.2.1.1.4. /ALLOWABLE/ packet](ch06s02.html#d0e22082)]{.section}
:::

The multiplicative matrix is built from entries in four packets: /MACT/,
/CONTROL/ or /EMS\_CONTROL/, /CTG/, and /ALLOWABLE/. The packets are
applied in the following order:

::: {.itemizedlist}
-   /MACT/

-   /CONTROL/ or /EMS\_CONTROL/ (cannot use both at same time)

-   /CTG/

-   /ALLOWABLE/
:::

With the exception of the /CONTROL/ packet, all controls are always
applied in addition to one another.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21814}6.2.1.1.1. /MACT/ packet {#mact-packet .title}

</div>

</div>
:::

The /MACT/ packet is designed to support the primary MACT controls
needed for toxics processing. It is applied first, and uses the
following logic. When a source is found that matches a /MACT/ packet
entry (source matching is addressed in [Section 6.2.1.2, "Source
Matching
Hierarchy"](ch06s02.html#sect_programs_cntlmat_source_match "6.2.1.2. Source Matching Hierarchy")),
**Cntlmat** first calculates a inventory efficiency value (Eff~inv~) for
that source based on the control efficiency (C~eff~), rule effectiveness
(R~eff~), and rule penetration (R~pen~) provided in the inventory:

Eff~inv~ = C~eff~ \[inventory\] x R~eff~ \[inventory\] x R~pen~
\[inventory\]

Next, a control factor is calculated for existing sources (Fac~exist~)
using the control efficiency of existing sources (Eff~exist~) and
fraction of new sources (Frac~new~) provided in the /MACT/ packet entry.
If Eff~exist~ \> Eff~inv~, then Fac~exist~ is calculated as:

Fac~exist~ = (1 - Frac~new~) x ((1 - Eff~exist~) / (1 - Eff~inv~))

Otherwise,

Fac~exist~ = (1 - Frac~new~)

**Cntlmat** then calculates a control factor for new sources (Fac~new~)
using the control efficiency of new sources (Eff~new~) provided in the
/MACT/ packet. If Eff~new~ \> Eff~inv~, then

Fac~new~ = Frac~new~ x ((1 - Eff~new~) / (1 - Eff~inv~))

Otherwise,

Fac~new~ = Frac~new~

Finally, the new and existing source factors are summed to compute the
final /MACT/ packet control factor (Fac~MACT~).

Fac~MACT~ = Fac~exist~ + Fac~new~

The /MACT/ packet is designed to be used only for sources with MACT
codes, currently nonpoint and point toxic sources.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21950}6.2.1.1.2. /CONTROL/ packet {#control-packet .title}

</div>

</div>
:::

After processing the /MACT/ packet, the /CONTROL/ packet is applied
using the following logic. Each entry in the /CONTROL/ packet can be
identified as "[replacement]{.quote}" or "[additive]{.quote}". If set to
"[replace]{.quote}", the /CONTROL/ entry will be used to replace the
controls from the /MACT/ packet or the base-year inventory controls;
otherwise, the control will be applied in addition to the controls from
the /MACT/ packet or the base-year inventory controls. When the controls
are replaced, the default behaviour of **Cntlmat** is to back out the
existing controls and apply the replacement controls. Usually, users
want to do this only when the replacement controls are more stringent
(i.e., a greater reduction) than the /MACT/ packet or base-year controls
- so this is the default behaviour of **Cntlmat**. This default
behaviour can be changed by setting the value of
`COMPARE_REPLACE_CONTROL`{.envar} to \"N\" in your run script. In this
case, the replacement controls will be applied regardless of the
existing controls from the base invetory or the /MACT/ packet, which
could result in increased emissions.

When an "[additive]{.quote}" entry is matched to a source, the /CONTROL/
packet factor (Fac~CONTROL~) the control packet information is applied
in addition to the exitsing controls, which further reduce the remaining
emissions.

For "[additive]{.quote}" control packet entries, the control factors are
calculated from the control efficiency, rule effectiveness, and rule
penetration values provided in the /CONTROL/ packet entry as follows:

Fac~CONTROL~ = (1 - C~eff~ \[packet\] x R~eff~ \[packet\] x R~pen~
\[packet\])

A cumulative control factor Fac~result~ is then calculated by
multiplying Fac~Existing~ x Fac~CONTROL~.

In the case of "[additive]{.quote}" controls only, The overall reduction
factor is then used to calculate an overall new control efficiency to be
put in any resulting inventory files as: C~eff~ \[result\] = 1 -
Fac~result~ . The final Rule Penetration and Rule Effectiveness values
are then set to 100%.

For "[replacement]{.quote}" entries, **Cntlmat** first "[backs
out]{.quote}" the existing controls provided in the inventory from the
control values provided in the /CONTROL/ packet entry as follows:

D = (1 - C~eff~ \[inventory\] x R~eff~ \[inventory\] x R~pen~
\[inventory\])

If D = 0.0, then the backout value, B, is equal to 0; otherwise, B =
1/D. Using this backout value, the /CONTROL/ factor is calculated as

Fac~CONTROL~ = B x (1 - C~eff~ \[packet\] x R~eff~ \[packet\] x R~pen~
\[packet\])

Unlike "[additive]{.quote}" entries, the Fac~CONTROL~ value for
"[replacement]{.quote}" entries replaces the factor calculated from the
/MACT/ packet or base year inventory (if any). The /CONTROL/ packet can
be applied to stationary area/nonpoint, nonroad, on-road mobile, and
point sources. On-road mobile source inventories do not include control
efficiency, rule effectiveness, or rule penetration fields. However, the
/CONTROL/ packet can still be used to apply adjustment factors to mobile
sources. In this case, B in the above formula will be 1 when computing
factor Fac~CONTROL~ that is applied to the emissions.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e22074}6.2.1.1.3. /CTG/ packet {#ctg-packet .title}

</div>

</div>
:::

The /CTG/ packet is processed next, as follows. The emission value
(after application of /MACT/, /CONTROL/, and/or /EMS CONTROL/) is
compared to the cutoff value specified as part of the /CTG/ packet
record. If the emission value exceeds the cutoff value, then the control
technology factor is applied to the emissions. If the resulting
emissions value still exceeds the cutoff value, then either the MACT
[*or*]{.emphasis} the RACT factor is used. The MACT factor is used if it
is defined (i.e., greater than zero); if it is not defined (less than or
equal to zero), then the RACT factor is used. If neither the MACT nor
RACT are defined, but the emissions are still greater than the cutoff,
then the emissions are set to the cutoff value.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e22082}6.2.1.1.4. /ALLOWABLE/ packet {#allowable-packet .title}

</div>

</div>
:::

Finally, the /ALLOWABLE/ packet is processed. The entries in this packet
override the /MACT/, /CONTROL/, /EMS CONTROL/, and /CTG/ packets. The
way this packet is applied depends on whether or not the Cap and Replace
values in the packet are defined (greater than zero).

::: {.itemizedlist}
-   If the Cap value is defined, **Cntlmat** compares the inventory
    emissions value to the Cap value, and sets a control factor, using
    the following procedure: If both the Cap and Replace values are
    defined, this control factor is the Replace value divided by the
    original emissions value. If only the Cap value is defined, the
    factor is the Cap value divided by the original emissions value.

-   If the Cap value is not defined, then the factor is the Replace
    value divided by the original emissions value.

-   If neither the Cap nor Replace values are defined, the packet entry
    is invalid and is ignored.
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_cntlmat_source_match}6.2.1.2. Source Matching Hierarchy {#source-matching-hierarchy .title}

</div>

</div>
:::

To match each sources with the appropriate control packet entry,
**Cntlmat** uses a hierarchy of source characteristics, trying to match
each source to the most specific control packet entry. Note that not all
combinations are applicable to all control packets (for example, there
is no MACT code associated with the /PROJECTION/ packet). "[Left
[*x*]{.emphasis} of SCC]{.quote}" refers to an 8- or 10-digit SCC with
all digits except the first [*x*]{.emphasis} set to 0. "[Left 2 of SIC
code]{.quote}" refers to a 4-digit SIC code with the third and fourth
digits set to 0. The maximum field width in SMOKE and its input files
for SCC is 20 characters as of SMOKE v4.0. The 8 or 10 digit SCC are
still supported, but if the SCC is greater than 10 digits the SCC
hierarchial approach will not be supported. The SIC may also be up to 20
characters in length, but if the SIC is larger than 4 characters then
the hierarchial approach will not be used.

For point sources, the following hierarchy is used, in order of most
specific to least specific. (NOTE: only for SCC less than or equal to 10
characters and SIC less than or equal to 4 characters)

::: {.orderedlist}
1.  Country/State/County code, plant ID, point ID, stack ID, segment ID,
    8-digit SCC code, pollutant

2.  Country/State/County code, plant ID, point ID, stack ID, segment ID,
    pollutant

3.  Country/State/County code, plant ID, point ID, stack ID, pollutant

4.  Country/State/County code, plant ID, point ID, pollutant

5.  Country/State/County code, plant ID, 8-digit SCC code, pollutant

6.  Country/State/County code, plant ID, MACT code, pollutant

7.  Country/State/County code, plant ID, pollutant

8.  Country/State/County code, plant ID, point ID, stack ID, segment ID,
    8-digit SCC code

9.  Country/State/County code, plant ID, point ID, stack ID, segment ID

10. Country/State/County code, plant ID, point ID, stack ID

11. Country/State/County code, plant ID, point ID

12. Country/State/County code, plant ID, 8-digit SCC code

13. Country/State/County code, plant ID, MACT code

14. Country/State/County code, plant ID

15. Country/State/County code, MACT code, 8-digit SCC code, pollutant

16. Country/State/County code, MACT code, pollutant

17. Country/State code, MACT code, 8-digit SCC code, pollutant

18. Country/State code, MACT code, pollutant

19. MACT, 8-digit SCC code, pollutant

20. MACT, pollutant

21. Country/State/County code, MACT code, 8-digit SCC code

22. Country/State/County code, MACT code

23. Country/State code, MACT code, 8-digit SCC code

24. Country/State code, MACT code

25. MACT code, 8-digit SCC code

26. MACT code

27. Country/State/County code, 4-digit SIC code, pollutant

28. Country/State/County code, left 2 of SIC code, pollutant

29. Country/State code, 4-digit SIC code, pollutant

30. Country/State code, left 2 of SIC code, pollutant

31. 4-digit SIC code, pollutant

32. Left 2 of SIC code, pollutant

33. Country/State/County code, 4-digit SIC code

34. Country/State/County code, left 2 of SIC code

35. Country/State code, 4-digit SIC code

36. Country/State code, left 2 of SIC code

37. 4-digit SIC code

38. Left 2 of SIC code

39. Country/State/County code, 8-digit SCC code, pollutant

40. Country/State/County code, left 6 of SCC code, pollutant

41. Country/State/County code, left 3 of SCC code, pollutant

42. Country/State/County code, left 1 of SCC code, pollutant

43. Country/State code, 8-digit SCC code, pollutant

44. Country/State code, left 6 of SCC code, pollutant

45. Country/State code, left 3 of SCC code, pollutant

46. Country/State code, left 1 of SCC code, pollutant

47. 8-digit SCC code, pollutant

48. Left 6 of SCC code, pollutant

49. Left 3 of SCC code, pollutant

50. Left 1 of SCC code, pollutant

51. Country/State/County code, 8-digit SCC code

52. Country/State/County code, left 6 of SCC code

53. Country/State/County code, left 3 of SCC code

54. Country/State/County code, left 1 of SCC code

55. Country/State code, 8-digit SCC code

56. Country/State code, left 6 of SCC code

57. Country/State code, left 3 of SCC code

58. Country/State code, left 1 of SCC code

59. 8-digit SCC code

60. Left 6 of SCC code

61. Left 3 of SCC code

62. Left 1 of SCC code

63. Country/State/County code, pollutant

64. Country/State/County code

65. Country/State code, pollutant

66. Country/State code

67. Pollutant
:::

For nonpoint/stationary area sources, the following hierarchy is used.
The maximum field width in SMOKE and its input files for SCC is 20
characters as of SMOKE v4.0. The 8 or 10 digit SCC are still supported,
but if the SCC is greater than 10 digits the SCC hierarchial approach
will not be supported. The SIC may also be up to 20 characters in
length, but if the SIC is larger than 4 characters then the hierarchial
approach will not be used. Nonpoint SCCs can have either 8 or 10 digits,
which is why there are two separate SCC levels mentioned for each of the
SCC-based assignments.(NOTE: hierarchial approach is only for SCC less
than or equal to 10 characters and SIC less than or equal to 4
characters)

::: {.orderedlist}
1.  Country/State/County code, MACT code, 8- or 10-digit SCC code,
    pollutant

2.  Country/State/County code, MACT code, pollutant

3.  Country/State code, MACT code, 8- or 10-digit SCC code, pollutant

4.  Country/State code, MACT code, pollutant

5.  MACT code, 8- or 10-digit SCC code, pollutant

6.  MACT code, pollutant

7.  Country/State/County code, MACT code, 8- or 10-digit SCC code

8.  Country/State/County code, MACT code

9.  Country/State code, MACT code, 8- or 10-digit SCC code

10. Country/State code, MACT code

11. MACT code, 8- or 10-digit SCC code

12. MACT code

13. Country/State/County code, 4-digit SIC code, pollutant

14. Country/State/County code, left 2 of SIC code, pollutant

15. Country/State code, 4-digit SIC code, pollutant

16. Country/State code, left 2 of SIC code, pollutant

17. 4-digit SIC code, pollutant

18. Left 2 of SIC code, pollutant

19. Country/State/County code, 4-digit SIC code

20. Country/State/County code, left 2 of SIC code

21. Country/State code, 4-digit SIC code

22. Country/State code, left 2 of SIC code

23. 4-digit SIC code

24. Left 2 of SIC code

25. Country/State/County code, 8- or 10-digit SCC code, pollutant

26. Country/State/County code, left 6 or left 7 of SCC code, pollutant

27. Country/State/County code, left 3 or left 4 of SCC code, pollutant

28. Country/State/County code, left 1 or left 2 of SCC code, pollutant

29. Country/State code, 8- or 10-digit SCC code, pollutant

30. Country/State code, left 6 or left 7 of SCC code, pollutant

31. Country/State code, left 3 or left 4 of SCC code, pollutant

32. Country/State code, left 1 or left 2 of SCC code, pollutant

33. 8- or 10-digit SCC code, pollutant

34. Left 6 or left 7 of SCC code, pollutant

35. Left 3 or left 4 of SCC code, pollutant

36. Left 1 or left 2 of SCC code, pollutant

37. Country/State/County code, 8- or 10-digit SCC code

38. Country/State/County code, left 6 or left 7 of SCC code

39. Country/State/County code, left 3 or left 4 of SCC code

40. Country/State/County code, left 1 or left 2 of SCC code

41. Country/State code, 8- or 10-digit SCC code

42. Country/State code, left 6 or left 7 of SCC code

43. Country/State code, left 3 or left 4 of SCC code

44. Country/State code, left 1 or left 2 of SCC code

45. 8- or 10-digit SCC code

46. Left 6 or left 7 of SCC code

47. Left 3 or left 4 of SCC code

48. Left 1 or left 2 of SCC code

49. Country/State/County code, pollutant

50. Country/State/County code

51. Country/State code, pollutant

52. Country/State code

53. Pollutant
:::

On-road mobile and nonroad sources are matched to the control packet
entries using the following hierarchy if the SCC length is less than 10
characters. As of SMOKE v4.0 the SCC character length may be up to 20
characters in length:(NOTE: this hierarchial approach is only for SCC
less than or equal to 10 characters and SIC less than or equal to 4
characters)

::: {.orderedlist}
1.  Country/State/County code, 10-digit SCC code, pollutant

2.  Country/State/County code, left 7 of SCC code, pollutant

3.  Country/State/County code, left 4 of SCC code, pollutant

4.  Country/State/County code, left 2 of SCC code, pollutant

5.  Country/State code, 10-digit SCC code, pollutant

6.  Country/State code, left 7 of SCC code, pollutant

7.  Country/State code, left 4 of SCC code, pollutant

8.  Country/State code, left 2 of SCC code, pollutant

9.  10-digit SCC code, pollutant

10. Left 7 of SCC code, pollutant

11. Left 4 of SCC code, pollutant

12. Left 2 of SCC code, pollutant

13. Country/State/County code, 10-digit SCC code

14. Country/State/County code, left 7 of SCC code

15. Country/State/County code, left 4 of SCC code

16. Country/State/County code, left 2 of SCC code

17. Country/State code, 10-digit SCC code

18. Country/State code, left 7 of SCC code

19. Country/State code, left 4 of SCC code

20. Country/State code, left 2 of SCC code

21. 10-digit SCC code

22. Left 7 of SCC code

23. Left 4 of SCC code

24. Left 2 of SCC code

25. Country/State/County code, pollutant

26. Country/State/County code

27. Country/State code, pollutant

28. Country/State code

29. Pollutant
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------- -------------------- --------------------------
  [Prev](ch06.html)                   [Up](ch06.html)       [Next](ch06s02s02.html)
  Chapter 6. SMOKE Core Programs     [Home](index.html)     6.2.2. Processing Order
  --------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.2.2. Processing Order
:::

[Prev](ch06s02.html) 

6.2. **Cntlmat**

 [Next](ch06s02s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e22576}6.2.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smkinven** must be executed before **Cntlmat**.

**Cntlmat** must be executed before **Smkmerge**. **Cntlmat** also needs
to be run prior to the **Grwinven** program, which requires at least one
growth or control matrix to be run.

**Cntlmat** is an optional program that needs to be run only when
controlled emissions are needed for the AQM.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------
  [Prev](ch06s02.html)     [Up](ch06s02.html)                    [Next](ch06s02s03.html)
  6.2. **Cntlmat**         [Home](index.html)     6.2.3. Files and Environment Variables
  ----------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
6.2.3. Files and Environment Variables
:::

[Prev](ch06s02s02.html) 

6.2. **Cntlmat**

 [Next](ch06s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e22603}6.2.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.2.3.1. Input Files](ch06s02s03.html#d0e22763)]{.section}

[[6.2.3.2. Input Environment
Variables](ch06s02s03.html#sect_programs_cntlmat_envar)]{.section}

[[6.2.3.3. Output Files](ch06s02s03.html#d0e22972)]{.section}
:::

::: {.figure}
[]{#fig_programs_cntlmat}

**Figure 6.2. Cntlmat input and output files**

::: {.mediaobject}
![Cntlmat input and output files](images\programs\cntlmat_html.jpg)
:::
:::

[Figure 6.2, "Cntlmat input and output
files"](ch06s02s03.html#fig_programs_cntlmat "Figure 6.2. Cntlmat input and output files")
shows the input and output files for the **Cntlmat** program. The input
files are the inventory file output from **Smkinven** (either
`AREA`{.envar}, `MOBL`{.envar}, or `PNTS`{.envar}), the control packets
file (`GCNTL`{.envar}), and the speciation profiles file
(`GSPRO`{.envar}) if there are reactivity controls (using the
/REACTIVITY/ packet).

If the `GCNTL`{.envar} file contains /MACT/, /CONTROL/ or
/EMS\_CONTROL/, /CTG/, and/or /ALLOWABLE/ packets, **Cntlmat** outputs a
multiplicative control matrix file (`ACMAT`{.envar}, `MCMAT`{.envar}, or
`PCMAT`{.envar}), a report of multiplicative controls (`ACREP`{.envar},
`MCREP`{.envar}, or `PCREP`{.envar}), and a report of all multiplicative
controls applied to the inventory (`ACSUMREP`{.envar},
`MCSUMREP`{.envar}, or `PCSUMREP`{.envar}). **Cntlmat** also outputs a
warning file (`ACTLWARN`{.envar}, `MCTLWARN`{.envar}, or
`PCTLWARN`{.envar}) regardless of which packets are used.

If the `GCNTL`{.envar} file contains a /PROJECTION/ packet, **Cntlmat**
outputs a growth matrix file (`APMAT`{.envar}, `MPMAT`{.envar}, or
`PPMAT`{.envar}) and a growth report (`APROJREP`{.envar},
`MPROJREP`{.envar}, or `PPROJREP`{.envar}).

If the `GCNTL`{.envar} file contains a /REACTIVITY/ packet, **Cntlmat**
outputs mole and mass-based reactivity matrix files (either
`ARMAT_L`{.envar} and `ARMAT_S`{.envar}, `MRMAT_L`{.envar} and
`MRMAT_S`{.envar}, or `PRMAT_L`{.envar} and `PRMAT_S`{.envar}), a
reactivity matrix supplement file (`ARSUP`{.envar}, `MRSUP`{.envar}, or
`PRSUP`{.envar}), and a report of reactivity controls
(`AREACREP`{.envar}, `MREACREP`{.envar}, or `PREACREP`{.envar}).
Finally, **Cntlmat** writes the `LOGFILE`{.envar} detailing the
program's execution.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e22763}6.2.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name\*                  Format      Description
  ---------------------------- ----------- ---------------------------------------------------------------
  `[AREA|MOBL|PNTS]`{.envar}   SMOKE map   Intermediate inventory file produced by **Smkinven**
  `GCNTL`{.envar}              ASCII       Control packets file
  `GSPRO`{.envar} (optional)   ASCII       Speciation profiles file; only needed for reactivity controls
:::

\* As in [Figure 6.2, "Cntlmat input and output
files"](ch06s02s03.html#fig_programs_cntlmat "Figure 6.2. Cntlmat input and output files"),
the notation `[AREA|MOBL|PNTS]`{.envar} is used to indicate that only
one of the three files is used for a given run.

The physical file name of the input file `GCNTL`{.envar} file is
typically overridden by the environment that is running **Cntlmat**. For
example, when running SMOKE from scripts using the Assigns file, the
projection factor inputs are available as the `[A|M|P]PROJ`{.envar}
files. So, for instance, the script must set `GCNTL`{.envar} as
`APROJ`{.envar} (or area-source processing) after the Assigns file has
been invoked by the script, but before the **Cntlmat** program is
actually run.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_cntlmat_envar}6.2.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `COMPARE_REPLACE_CONTROL:`{.envar} \[default: Y\]

    Controls the way a replacement control is applied.

    ::: {.itemizedlist}
    -   Y: When set to Y, Cntlmat compares the overall percent
        reductions (CEFF \* RPEN \* REFF) from a replacement control in
        the CONTROL packet against existing percent reductions (either
        from the base inventory or from a just-applied /MACT/ packet).
        If the packet\'s reduction is more control (greater reduction)
        than the existing controls, then it is applied. Otherwise, it is
        not applied.

    -   N: When set to N, Cntlmat applies replacement controls even if
        the control is less control than an existing control, which may
        result in an increase in emissions
    :::

-   `FULLSCC_ONLY:`{.envar} \[default: N\]

    Disables any sub-SCC cross-reference assignments that would
    otherwise be included in the cross-reference hierarchy. For example,
    the left-7, left-4, and left-2 levels of nonpoint and mobile SCCs
    would never be used. This is useful when zeros are a natural part of
    the SCC that the user does not want to assume are present for
    cross-reference hierarchy purposes. This option affects all Cntlmat
    input packets that use SCC assignments as part of their hierarchy.

-   `PROJECTION_YR_SPEC:`{.envar} \[default: Y\]

    Sets whether or not entries in the /PROJECTION/ packet are in
    year-specific format.

    ::: {.itemizedlist}
    -   Y: Year-specific format in use

    -   N: Year-specific format not in use
    :::

-   `REACTIVITY_POL`{.envar}: \[default: VOC\]

    Sets the pollutant name to use in computing the reactivity matrix.

-   `REPORT_DEFAULTS`{.envar}: \[default: Y\]

    Defines whether or not the program reports when a source uses the
    default cross-reference.

    ::: {.itemizedlist}
    -   Y: List sources in the log file when they use default
        cross-reference

    -   N: Do not list sources that use the default cross-reference
    :::

-   `SMK_AVEDAY_YN`{.envar}: \[default: N\]

    Indicates whether or not to read average day emissions instead of
    annual emissions from the inventory file.

    ::: {.itemizedlist}
    -   Y: Read average day emissions

    -   N: Do not read average day emissions, use annual emissions
        instead
    :::

-   `SMK_SOURCE`{.envar}: \[default: blank\]

    Defines the type of sources to be processed. Valid values are

    ::: {.itemizedlist}
    -   A: Area processing

    -   B: Biogenic processing

    -   M: Mobile processing

    -   P: Point processing
    :::

-   `SMK_TMPDIR`{.envar}: \[default: "[.]{.quote}"\]

    Sets the path for writing the temporary files needed when processing
    the /ALLOWABLE/, /CONTROL/, /CTG/, /EMS\_CONTROL/, /MACT/, and/or
    /PROJECTION/ packets (from the `GCNTL`{.envar} file).

-   `SPEC_OUTPUT`{.envar}: \[default: ALL\]

    Defines the types of speciation outputs to create.

    ::: {.itemizedlist}
    -   MASS: Output speciation matrix based on mass

    -   MOLE: Output speciation matrix based on moles

    -   ALL: Output both mass and mole speciation matrices
    :::

-   `XREF_SICOVERSCC`{.envar}: \[default: Y\]

    Determines how to deal with packet entries that have both an SCC and
    SIC

    ::: {.itemizedlist}
    -   Y: Match sources by SIC before SCC

    -   N: Match sources by SCC before SIC
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e22972}6.2.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name\*                Format           Description
  -------------------------- ---------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `[A|M|P]CMAT`{.envar}      I/O API NetCDF   Multiplicative control matrix
  `[A|M|P]CREP`{.envar}      ASCII            Report of multiplicative controls applied to the inventory
  `[A|M|P]CREP2`{.envar}     ASCII            Detailed before-and-after report of application of the /CONTROL/ packet only, which includes any comments appended to the end of the /CONTROL/ packet entries. These comments can describe the controls being applied with each packet row. This report then includes the base and future overall percent reductions on a source-by-source basis, and includes the CONTROL packet line-specific comments.
  `[A|M|P]CSUMREP`{.envar}   ASCII            Report of all controls applied to the inventory, with all controls listed under each source
  `[A|M|P]CTLWARN`{.envar}   ASCII            List of warnings
  `[A|M|P]PMAT`{.envar}      I/O API NetCDF   Growth matrix
  `[A|M|P]PROJREP`{.envar}   ASCII            Report of growth factors applied to the inventory
  `[A|M|P]REACREP`{.envar}   ASCII            Report of reactivity controls applied to the inventory
  `[A|M|P]RMAT_L`{.envar}    I/O API NetCDF   Mole-based reactivity matrix
  `[A|M|P]RMAT_S`{.envar}    I/O API NetCDF   Mass-based reactivity matrix
  `[A|M|P]RSUP`{.envar}      ASCII            Reactivity matrix supplemental file
  `LOGFILE`{.envar}          ASCII            Log generated from executing **Cntlmat**
:::

\* As in [Figure 6.2, "Cntlmat input and output
files"](ch06s02s03.html#fig_programs_cntlmat "Figure 6.2. Cntlmat input and output files"),
the notation `[A|M|P]`{.envar} is used to indicate that only one of the
three files is output for a given run.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s02s02.html)     [Up](ch06s02.html)     [Next](ch06s03.html)
  6.2.2. Processing Order     [Home](index.html)       6.3. **Elevpoint**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.3. **Elevpoint**
:::

[Prev](ch06s02s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s03s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_elevpoint}6.3. **Elevpoint** {#elevpoint .title style="clear: both"}
----------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.3.1. Description](ch06s03.html#d0e23099)]{.section}

[[6.3.2. Processing Order](ch06s03s02.html)]{.section}

[[6.3.3. Files and Environment Variables](ch06s03s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e23099}6.3.1. Description {#description .title}

</div>

</div>
:::

::: {.toc}
[[6.3.1.1. Plume rise
calculation](ch06s03.html#sect_programs_elevpoint_briggs)]{.section}

[[6.3.1.2. Summary](ch06s03.html#d0e23314)]{.section}
:::

[*Processing categories:*]{.emphasis} point

The **Elevpoint** program is used to select elevated point sources and
to prepare certain input files for special elevated source or PinG
processing. **Elevpoint** selects the major point source (MPS) and major
elevated point source emissions (MEPSE) records using a variety of
criteria, such as stack parameters, emissions, and analytical plume rise
calculations. (Note that MEPSE is another name for a PinG source.)

**Elevpoint** distinguishes PinG sources from non-PinG elevated sources
based on emission thresholds, highest day-specific emissions rank
compared to other sources, analytical plume rise, and/or stack
parameters such as height. **Elevpoint** flags sources as either
elevated or PinG based on instructions given in an input configuration
file, the `PELVCONFIG`{.envar} file. **Elevpoint** also permits grouping
of stacks at the same facility if the stack parameters are similar,
within tolerances you specify with the `PELVCONFIG`{.envar} file; the
result is call a "[stack group]{.quote}". For more information on
selecting and grouping elevated and PinG sources, refer to
[Section 8.9.3.1, "`PELVCONFIG`{.envar}: Elevated source selection
file"](ch08s09s03.html#sect_input_pelvconfig "8.9.3.1. PELVCONFIG: Elevated source selection file").

**Elevpoint** can also be used to calculate plume rise using the
"[cutoff]{.quote}" method. This is the method traditionally used to
prepare input files to the air quality models UAM-IV, UAM-V and CAM~X~,
which require a separate model-ready input file containing emissions for
elevated point sources. Below, we refer to this path as the "[UAM
style]{.quote}" of emissions processing.

For the cutoff method, the **Elevpoint** program uses the stack
parameters of the point sources and estimates the plume rise for each
source using a Briggs analytical solution (but not actual gridded
meteorology data); the details of this process are given in
[Section 6.3.1.1, "Plume rise
calculation"](ch06s03.html#sect_programs_elevpoint_briggs "6.3.1.1. Plume rise calculation").
**Elevpoint** then records all of the sources that have an estimated
plume rise greater than a specified cutoff as defined in the
`PELVCONFIG`{.envar} file using the "[RISE]{.quote}" instruction. Using
the `PELVCONFIG`{.envar} file, this cutoff method can be combined with
selection of elevated sources based on stack parameters and/or emissions
values.

When emissions values are part of these selection criteria,
**Elevpoint** computes the maximum daily emissions using one or more
`PTMP`{.envar} files. **Elevpoint** computes the maximum daily value of
any pollutant used as a selection criterion across all of the days that
you input. You have the option of providing either a list of paths and
file names of one or more `PTMP`{.envar} files, or a single
`PTMP`{.envar} file. The day or days that **Elevpoint** uses to compute
each source's maximum depends on the time zone in which the source
resides, based on the county and the `COSTCY`{.envar} file setting for
the time zone (the time zone is stored in the `PNTS`{.envar} file output
from **Smkinven**). When using emissions values as a selection
criterion, **Elevpoint** only considers sources that are within the grid
domain.

**Elevpoint** also creates a report file that contains all SMOKE sources
that have been selected as elevated, their source characteristics
(including stack parameters), emissions values used as selection
criteria, stack-group numbers, status as either elevated or PinG, and
which selection criteria were used to assign the status to the source.
The report does not include any low-level sources. This report is in
semicolon-delimited format for easier reading into a spreadsheet for
sorting, review, and making charts.

The **Elevpoint** program is not needed if the environment variables
`SMK_PING_METHOD`{.envar} and `SMK_ELEV_METHOD`{.envar} are both set to
0.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_elevpoint_briggs}6.3.1.1. Plume rise calculation {#plume-rise-calculation .title}

</div>

</div>
:::

The Briggs solution is documented in the following:

::: {.orderedlist}
1.  Briggs, Gary A., 1971: Some Recent Analyses of Plume Rise
    Observation, pp. 1029-1032 in [*Proceedings of the Second
    International Clean Air Congress*]{.emphasis}, edited by H. M.
    Englun and W. T. Beery. Academic Press, New York.

2.  Briggs, Gary A., 1972: Discussion on Chimney Plumes in Neutral and
    Stable Surroundings, [*Atmos. Environ.*]{.emphasis} 6, 507-510.
:::

The following formula is used in **Elevpoint**:

F = 0.25 x G x V~S~ x D~S~^2^ x (T~S~ - T)/T~S~

For F less than 55,

Plume rise = H~S~ + 21.31311057 x F^0.75^/U

Otherwise,

Plume rise = H~S~ + 38.87776061 x F^0.6^/U

where

::: {.itemizedlist}
-   F = Bouyancy flux (m^4^/s^3^)
-   G = Mean gravitational acceleration (9.80665 m/s^2^)
-   V~S~ = Stack gas exit velocity (m/s)
-   D~S~ = Inside stack diameter (m)
-   T~S~ = Stack gas temperature (K)
-   T = Default ambient air temperature (293 K)
-   U = Default wind speed (2 m/s)
-   H~S~ = Physical stack height (m)
:::

This represents an improved algorithm over the original so that the
discontinuity at F = 55 no longer exists. Now, the second term in the
plume rise formula approaches 595 as F approaches 55 from either side.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e23314}6.3.1.2. Summary {#summary .title}

</div>

</div>
:::

In summary, **Elevpoint** permits the following combinations of source
selection and processing:

::: {.itemizedlist}
-   Identify MEPSE/PinG sources for outputting to special PinG files
    only (all other point sources will be treated as potentially
    elevated by **Laypoint**).

-   Identify elevated sources (MPSs) with the `PELVCONFIG`{.envar} file,
    which might include using the cutoff method alone or in combination
    with other criteria.

-   Identify elevated sources (MPSs) and MEPSE/PinG sources with the
    `PELVCONFIG`{.envar} file with cutoff method (**Laypoint** not used)
    and identify MEPSE/PinG sources with the `PSPLIT`{.envar} file for
    outputting to special PinG files.
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- --------------------------
  [Prev](ch06s02s03.html)                     [Up](ch06.html)       [Next](ch06s03s02.html)
  6.2.3. Files and Environment Variables     [Home](index.html)     6.3.2. Processing Order
  ----------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.3.2. Processing Order
:::

[Prev](ch06s03.html) 

6.3. **Elevpoint**

 [Next](ch06s03s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e23347}6.3.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smkinven** must be run for point sources before **Elevpoint**. If the
`PELVCONFIG`{.envar} file uses emissions as a source-grouping or
source-selection criterion, then **Temporal** must be run before
**Elevpoint**.

**Elevpoint** must be run before **Laypoint**.

**Elevpoint** must be run before **Smkmerge** if elevated sources are to
be used.

**Elevpoint** is an optional program that is not needed if all of the
following criteria are met:

::: {.orderedlist}
1.  A UAM-style model (e.g., UAM, CAM~X~) is not being used.

2.  No MEPSE/PinG source processing is required.

3.  You are willing to run **Laypoint** for all point sources and treat
    all as "[potentially elevated]{.quote}". In this case, sources that
    rise above layer 1 will be "[elevated]{.quote}" for reporting
    purposes in **Smkreport**, but these sources may sometimes be within
    layer 1 if the plume rise algorithm in **Laypoint** computes it that
    way.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------
  [Prev](ch06s03.html)     [Up](ch06s03.html)                    [Next](ch06s03s03.html)
  6.3. **Elevpoint**       [Home](index.html)     6.3.3. Files and Environment Variables
  ----------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
6.3.3. Files and Environment Variables
:::

[Prev](ch06s03s02.html) 

6.3. **Elevpoint**

 [Next](ch06s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e23412}6.3.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.3.3.1. Input Files](ch06s03s03.html#d0e23474)]{.section}

[[6.3.3.2. Input Environment
Variables](ch06s03s03.html#sect_programs_elevpoint_envar)]{.section}

[[6.3.3.3. Output Files](ch06s03s03.html#d0e23789)]{.section}
:::

::: {.figure}
[]{#fig_programs_elevpoint}

**Figure 6.3. Elevpoint input and output files**

::: {.mediaobject}
![Elevpoint input and output files](images\programs\elevpoint_html.jpg)
:::
:::

[Figure 6.3, "Elevpoint input and output
files"](ch06s03s03.html#fig_programs_elevpoint "Figure 6.3. Elevpoint input and output files")
shows the input and output files for the **Elevpoint** program. The
input files are the grid description file (`GRIDDESC`{.envar}), an
elevated source configuration file (`PELVCONFIG`{.envar}), the
point-source inventory file output from **Smkinven** (`PNTS`{.envar}),
and, if the `PELVCONFIG`{.envar} file selects sources by emissions value
or rank, either a list of hourly emissions files output by **Temporal**
(`PTMPLIST`{.envar}) or an individual hourly emissions file
(`PTMP`{.envar}).

**Elevpoint** outputs a log file (`LOGFILE`{.envar}), an elevated point
source identification file (`PELV`{.envar}), an elevated and PinG source
report (`REPPELV`{.envar}), and a stack parameters file
(`STACK_GROUPS`{.envar}) if the `PELVCONFIG`{.envar} file is configured
to select stack groups.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e23474}6.3.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                       Format      Description
  ------------------------------- ----------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `GRIDDESC`{.envar}              ASCII       Description of the modeling grid
  `PELVCONFIG`{.envar}            ASCII       Elevated source configuration file
  `PNTS`{.envar}                  SMOKE map   Intermediate inventory file produced by **Smkinven**
  `PTMP`{.envar} (optional)       ASCII       Hourly emissions file produced by **Temporal**; needed only when `PELVCONFIG`{.envar} specifies emissions as one of the selection or grouping criteria and not using the `PTMPLIST`{.envar} file
  `PTMPLIST`{.envar} (optional)   ASCII       List of hourly emissions files produced by **Temporal**; needed only when `PELVCONFIG`{.envar} specifies emissions as one of the selection or grouping criteria
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_elevpoint_envar}6.3.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `ELEV_WRITE_FAKE_SRC`{.envar}: \[default: Y\]

    Defines whether the program needs to add a fake source group or not
    when there is no an elevated source group to output.

    ::: {.itemizedlist}
    -   Y: Add a fake source group when there is no an elevated source
        group to output

    -   N: Do not add a fake source group.
    :::

-   `ELEV_WRITE_LATLON`{.envar}: \[default: Y\]

    Defines whether write the latitude and longitude information of
    special elevated or PinG sources to the stack groups file
    [Section 9.3.2,
    "`STACK_GROUPS`{.envar}"](ch09s03s02.html "9.3.2. STACK_GROUPS") for
    air quality models CMAQ, and UAM-style.

    ::: {.itemizedlist}
    -   Y: Write the latitude and longitude information of elevated or
        PinG sources to the the stack group file.

    -   N: Do not write the latitude and longitude information of
        elevated or PinG sources to the the stack group file.
    :::

    The ELEV\_WRITE\_LATLON can not be N, when processing for PinG
    sources, since CMAQ does need the latitude and longitude to be
    included.

-   `G_RUNLEN`{.envar}: \[default: 240000\]

    Simulation length (HHMMSS)

-   `G_STDATE`{.envar}: \[default: 0\]

    Starting date of simulation (YYYYDDD)

-   `G_STTIME`{.envar}: \[default: 0\]

    Starting time of simulation (HHMMSS)

-   `G_TSTEP`{.envar}: \[default: 10000\]

    Time step (HHMMSS), only 10000 is allowed

-   `IOAPI_ISPH`{.envar}: \[default: 19\]

    Determines which USGS spheroid to use for grid-based calculations

    ::: {.itemizedlist}
    -   0: Clarke 1866
    -   1: Clarke 1880
    -   2: Bessel
    -   3: New International 1967
    -   4: International 1909
    -   5: WGS 72
    -   6: Everest
    -   7: WGS 66
    -   8: GRS 1980
    -   9: Airy
    -   10: Modified Everest
    -   11: Modified Airy
    -   12: WGS 84
    -   13: Southeast Asia
    -   14: Australian National
    -   15: Krassovsky
    -   16: Hough
    -   17: Mercury 1960
    -   18: Modified Mercury 1968
    -   19: Normal Sphere
    :::

    This environment variable can also be used to set custom spheroid
    representations. See the [I/O API
    documentation](http://www.baronams.com/products/ioapi/SETSPHERE.html)
    for more information.

-   `SMK_ELEV_METHOD`{.envar}: \[default: 0\]

    Defines the method to use in SMOKE for determining and processing
    elevated point sources. The setting chosen depends on the model
    output format needed from SMOKE. All PinG sources determined based
    on `SMK_PING_METHOD`{.envar} will automatically be considered
    elevated sources (as defined specifically for the model for which
    you are creating emissions).

    ::: {.itemizedlist}
    -   0: Treat all sources as potentially elevated, and let the
        **Laypoint** program determine which sources are elevated and
        which are not. This approach is appropriate only for SMOKE
        output for the CMAQ model.

    -   1: Use the "[Elevated]{.quote}" section of the
        `PELVCONFIG`{.envar} configuration file to select specific
        sources. This approach can be used for any of the model output
        formats - CMAQ and UAM-style.

        For UAM-style emissions processing, this environment variable
        must be set to 1 and the `PELVCONFIG`{.envar} file will be used
        to select specific sources. This method of processing is needed
        for UAM and CAM~X~ because they require use of the cutoff method
        discussed earlier. In rare cases of a very small inventory, it
        might be acceptable to specify 0 for this setting in UAM-style
        emissions processing, provided that you are sure that treating
        all sources as elevated sources in UAM-style models is
        acceptable. We do not recommend such an approach for typical
        SMOKE applications for UAM-style models.

    -   2: Use the "[Elevated]{.quote}" section of the
        `PELVCONFIG`{.envar} configuration file to select specific
        sources. This approach can be used for in-line plume rise in
        CMAQ. Must set `SMK_PING_METHOD`{.envar} = 0.

        For in-line plume rise processing in CMAQ, this environment
        variable must be set to 2 and the `PELVCONFIG`{.envar} file will
        be used to select specific sources. To reduce the total number
        of plume rise calculations that would be done in the CMAQ
        in-line plume rise module, **Elevpoint** needs to group sources
        with nearly identical stack parameters. **Elevpoint** outputs
        stack group file that identifies elevated source locations and
        stack parameters for in-line plume rise calculation in CMAQ. See
        [Section 4.4.18, "In-line Plume Rise Calculation in CMAQ model
        (as of version
        4.7)"](ch04s04s18.html "4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version 4.7)")
        for more detail.

        When using **Smkmerge** for in-line plume rise processing,
        `MRG_LAYERS_YN`{.envar} must set to N to create hourly speciated
        2-D surface layer emissions file. If
        `SMKMERGE_CUSTOM_OUTPUT`{.envar} is set to Y, the output file
        for the in-line emissions is called `INLNST_L`{.envar}.

        To process point fire emission (ptfire sector) without
        precomputed plume rise described in described in
        [Section 4.4.2.5, "Day-specific and hour-specific point and fire
        inventories"](ch04s04s02.html#sect_scripts_hour_day_invs "4.4.2.5. Day-specific and hour-specific point and fire inventories").
    :::

-   `SMK_PING_METHOD`{.envar}: \[default: 0\]

    Defines the method to use in determining PinG point sources.

    ::: {.itemizedlist}
    -   0: No PinG sources

    -   1: Use PinG section of `PELVCONFIG`{.envar} configuration file
    :::

    For all models that SMOKE supports use of PinG sources is optional.
    Some models may have limitations on the number of PinG sources
    supported, and you must make sure that these limitations are met;
    SMOKE does not automatically compare with these limitations, if any.

    For CMAQ, SMOKE will output a `STACK_GROUPS`{.envar} file from the
    **Elevpoint** program and a `PINGTS_[S|L]`{.envar} file from the
    **Smkmerge** program to support PinG. For UAM-style processing,
    SMOKE will flag PinG sources in the ASCII elevated file created by
    **Smkmerge**, and should be used with the `SMK_ASCIIELEV_YN`{.envar}
    option set to Y to create this ASCII elevated file.

-   `SMK_SOURCE`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e23789}6.3.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                Format           Description
  ------------------------ ---------------- -------------------------------------------------------------------------------------------------------------------------------
  `LOGFILE`{.envar}        ASCII            Log generated from executing **Elevpoint**
  `PELV`{.envar}           ASCII            Elevated point source identification file
  `REPPELV`{.envar}        ASCII            Reports the sources selected as elevated and PinG, plus other information about the sources, including why they were selected
  `STACK_GROUPS`{.envar}   I/O API NetCDF   PinG and/or elevated sources stack parameters file
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s03s02.html)     [Up](ch06s03.html)     [Next](ch06s04.html)
  6.3.2. Processing Order     [Home](index.html)          6.4. **Grdmat**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.4. **Grdmat**
:::

[Prev](ch06s03s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s04s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_grdmat}6.4. **Grdmat** {#grdmat .title style="clear: both"}
----------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.4.1. Description](ch06s04.html#d0e23845)]{.section}

[[6.4.2. Processing Order](ch06s04s02.html)]{.section}

[[6.4.3. Files and Environment Variables](ch06s04s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e23845}6.4.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} area, mobile, point

The **Grdmat** program produces the matrix that contains the factors for
spatially allocating the emission sources to the modeling domain.

For pre-gridded inventory data, grdmat is used to convert the data from
the input data grid (e.g. lat-lon for EDGAR/RCP/HTAP) to the output
modeling grid when the user sets IMPORT\_GRDNETCDF\_YN to Y. Spatial
surrogates (AGPRO or MGPRO) are not needed for processing gridded
inventory data with SMOKE. The input modeling domain information is
obtained from the GRIDMASK input file and the output grid is defined by
the IOAPI\_GRIDNAME\_1 environment variable in the GRID\_CRO\_2D file.

For inventory data that is not already pre-gridded, point sources are
assigned to grid cells using the geographic coordinates that are stored
in each point-source record. For area and mobile sources, a
cross-reference file matches the gridding surrogates to the source-level
emissions. When the gridding cross-reference files are applied, the
most-specific matches always override the less-specific ones.

For the current version of SMOKE, a gridding surrogates file must be
created for the specific grid of interest. This can be accomplished in a
variety of ways:

::: {.itemizedlist}
-   ArcInfo (or other GIS) processing by an expert in creating gridding
    surrogates.

-   Using the MIMS Spatial Allocation Tool.

-   Extracting surrogate data from a larger gridding surrogates file.
    National 4-km surrogates are available from the EPA at
    <http://www.epa.gov/ttn/chief/emch/spatial/newsurrogate.html>. To
    use these data for your modeling, you must use the same grid
    projection as was used to create the gridding surrogates.
:::

For area sources, the gridding cross-reference file provides the
following possible combinations, ordered from most specific to least
specific:

::: {.orderedlist}
1.  Country/state/county code and 10-digit SCC

2.  Country/state/county code and 7-digit SCC

3.  Country/state code and 10-digit SCC

4.  Country/state code and 7-digit SCC

5.  10-digit SCC

6.  7-digit SCC

7.  Country/state/county code

8.  Country/state code

9.  Ultimate default (country/state/county code = 0, SCC = 0)
:::

For mobile sources, the available combinations and their order are:

::: {.orderedlist}
1.  Country/state/county code, and 10-digit SCC

2.  Country/state code and 10-digit SCC

3.  Country/state/county code

4.  Country/state code

5.  10-digit SCC

6.  Ultimate default (country/state/county code = 0, SCC = 0)
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- --------------------------
  [Prev](ch06s03s03.html)                     [Up](ch06.html)       [Next](ch06s04s02.html)
  6.3.3. Files and Environment Variables     [Home](index.html)     6.4.2. Processing Order
  ----------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.4.2. Processing Order
:::

[Prev](ch06s04.html) 

6.4. **Grdmat**

 [Next](ch06s04s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e23926}6.4.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smkinven** must be run before **Grdmat**.

**Grdmat** must be run before gridded emissions may be produced using
**Smkmerge**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------
  [Prev](ch06s04.html)     [Up](ch06s04.html)                    [Next](ch06s04s03.html)
  6.4. **Grdmat**          [Home](index.html)     6.4.3. Files and Environment Variables
  ----------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
6.4.3. Files and Environment Variables
:::

[Prev](ch06s04s02.html) 

6.4. **Grdmat**

 [Next](ch06s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e23943}6.4.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.4.3.1. Input Files](ch06s04s03.html#d0e24017)]{.section}

[[6.4.3.2. Input Environment
Variables](ch06s04s03.html#d0e24095)]{.section}

[[6.4.3.3. Output Files](ch06s04s03.html#d0e24165)]{.section}
:::

::: {.figure}
[]{#fig_programs_grdmat}

**Figure 6.4. Grdmat input and output files**

::: {.mediaobject}
![Grdmat input and output files](images\programs\grdmat_html.jpg)
:::
:::

[Figure 6.4, "Grdmat input and output
files"](ch06s04s03.html#fig_programs_grdmat "Figure 6.4. Grdmat input and output files")
shows the input and output files for the **Grdmat** program. The input
files are the spatial surrogates file (`AGPRO`{.envar} or
`MGPRO`{.envar}), the spatial cross-reference file (`AGREF`{.envar} or
`MGREF`{.envar}), the inventory file output from **Smkinven**
(`AREA`{.envar}, `MOBL`{.envar}, or `PNTS`{.envar}), the surrogate
description file (`SRGDESC`{.envar}), and the grid description file
(`GRIDDESC`{.envar}).

**Grdmat** outputs a gridding matrix file (`AGMAT`{.envar},
`MGMAT`{.envar}, or `PGMAT`{.envar}) used by other SMOKE programs, and a
supplemental gridding file (`AGSUP`{.envar} or `MGSUP`{.envar}) that
includes all of the spatial surrogate codes assigned to each source.
Like all SMOKE programs, **Grdmat** writes a program log
(`LOGFILE`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e24017}6.4.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                               Format           Description
  --------------------------------------- ---------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `SRGDESC`{.envar}                       ASCII            Surrogate list, description and surrogate file name used in the modeling grid. Note: we recommand to use multiple files for individual surrogate code which are available from the [EPA's New Surrogates web site](http://www.epa.gov/ttn/chief/emch/spatial/newsurrogate.html).
  `SRGPRO_PATH/surrogate-files`{.envar}   ASCII            Gridding surrogate coefficients
  `[A|M]GREF`{.envar}                     ASCII            Gridding surrogate cross-reference file
  `[AREA|MOBL|PNTS]`{.envar}              SMOKE map        Intermediate inventory file produced by **Smkinven**
  `GRIDDESC`{.envar}                      ASCII            Description of the modeling grid
  `GRIDMASK`{.envar}                      I/O API NetCDF   Geographic level code and Timezone for each grid cell
  `GRID_CRO_2D`{.envar}                   I/O API NetCDF   Layer definitions for the CMAQ model domain
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e24095}6.4.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `FULLSCC_ONLY`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables").
    In this context, this option prevents left-7 SCC assignments using
    the gridding cross-reference file.

-   `IOAPI_GRIDNAME_1`{.envar}: output modeling grid that global gridded
    inventory data is re-gridded to.

-   `IOAPI_ISPH`{.envar}: See description in [Section 6.3.3.2, "Input
    Environment
    Variables"](ch06s03s03.html#sect_programs_elevpoint_envar "6.3.3.2. Input Environment Variables")

-   `IMPORT_GRDNETCDF_YN`{.envar}: Y to read the native netCDF annual
    inventory files

-   `REPORT_DEFAULTS`{.envar}: See description in [Section 6.2.3.2,
    "Input Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

-   `SRGPRO_PATH`{.envar}: Defines the location of the Area and Mobile
    spatial surrogate files. This should be a sub-directory in the
    `$GE_DAT`{.envar} directory.

-   `SMK_DEFAULT_SRGID`{.envar}: \[default: 100 (Models-3 population
    surrogate code)\] Mandatory, user MUST choose a fallback code.

-   `SMK_USE_FALLBACK`{.envar}: \[Y/N\]

    Defines the surrogate code number to use as a fallback surrogate
    when the surrogate number set by the cross-reference file would zero
    out the emissions for that source. This fallback surrogate is also
    used to define the county/state/country (FIPS) codes for use in
    **Grdmat**; therefore, a fallback surrogate code is mandatory even
    if the `SMK_USE_FALLBACK`{.envar} is set to \[N\]. This code should
    exist in the `SRGDESC`{.envar} file and be representative on all
    county/state/countries. See description in [Section 8.4.1,
    "`SRGDESC`{.envar}: Surrogate Designation, Description and Surrogate
    profile
    filename."](ch08s04.html#sect_input_srgdesc "8.4.1. SRGDESC: Surrogate Designation, Description and Surrogate profile filename.").

-   `SMK_SOURCE`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e24165}6.4.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name               Format           Description
  ----------------------- ---------------- -----------------------------------------------------------------------------------------------------------------------------------
  `[A|M|P]GMAT`{.envar}   I/O API NetCDF   Gridding matrix containing the factors needed to spatially allocate the input emissions to the grid cells in the modeling domain.
  `[A|M]GSUP`{.envar}     ASCII            Gridding supplemental file containing spatial surrogate codes for each source
  `LOGFILE`{.envar}       ASCII            Log generated from executing **Grdmat**
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s04s02.html)     [Up](ch06s04.html)     [Next](ch06s05.html)
  6.4.2. Processing Order     [Home](index.html)        6.5. **Grwinven**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.5. **Grwinven**
:::

[Prev](ch06s04s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s05s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_grwinven}6.5. **Grwinven** {#grwinven .title style="clear: both"}
--------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.5.1. Description](ch06s05.html#d0e24212)]{.section}

[[6.5.2. Processing Order](ch06s05s02.html)]{.section}

[[6.5.3. Files and Environment Variables](ch06s05s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e24212}6.5.1. Description {#description .title}

</div>

</div>
:::

[*Processing catagories:*]{.emphasis} area, mobile, point

The **Grwinven** program grows and controls inventory emissions and
activity data into the past/future by merging a SMOKE inventory file
(`AREA`{.envar}, `MOBL`{.envar}, or `PNTS`{.envar}) with its respective
growth and control matrices. This optional program need not be used if
these projections have been made outside of SMOKE. **Grwinven** outputs
new SMOKE I/O API inventory files, but not the corresponding inventory
ASCII files (because the program changes the data only in the I/O API
inventory files, so there is no need to output the same ASCII files).
The program can also output data in ORL format, or be used as a
converter from SMOKE to ORL format. **Grwinven** does not merge the
SMOKE inventory with reactivity matrices; this functionality is handled
by **Smkmerge**.

The **Grwinven** program writes out temporary emissions files when
creating an ORL-formatted inventory. You can set the directory to which
these temporary files go by setting the `SMK_TMPDIR`{.envar} environment
variable. These files can be quite large; at least 100 MB should be
available on the disk to which this environment variable is set.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- --------------------------
  [Prev](ch06s04s03.html)                     [Up](ch06.html)       [Next](ch06s05s02.html)
  6.4.3. Files and Environment Variables     [Home](index.html)     6.5.2. Processing Order
  ----------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.5.2. Processing Order
:::

[Prev](ch06s05.html) 

6.5. **Grwinven**

 [Next](ch06s05s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e24250}6.5.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smkinven** and **Cntlmat** must be run before **Grwinven**.

After running **Grwinven**, the output can be used similarly to the
output from **Smkinven**. If **Spcmat** or **Grdmat** have already been
run for a given inventory, these programs do not need to be rerun after
running **Grwinven** because the number and order of the sources in the
grown emissions files are the same as in the base case.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------
  [Prev](ch06s05.html)     [Up](ch06s05.html)                    [Next](ch06s05s03.html)
  6.5. **Grwinven**        [Home](index.html)     6.5.3. Files and Environment Variables
  ----------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
6.5.3. Files and Environment Variables
:::

[Prev](ch06s05s02.html) 

6.5. **Grwinven**

 [Next](ch06s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e24280}6.5.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.5.3.1. Input Files](ch06s05s03.html#d0e24378)]{.section}

[[6.5.3.2. Input Environment
Variables](ch06s05s03.html#d0e24456)]{.section}

[[6.5.3.3. Output Files](ch06s05s03.html#d0e24528)]{.section}
:::

::: {.figure}
[]{#fig_programs_grwinven}

**Figure 6.5. Grwinven input and output files**

::: {.mediaobject}
![Grwinven input and output files](images\programs\grwinven_html.jpg)
:::
:::

[Figure 6.5, "Grwinven input and output
files"](ch06s05s03.html#fig_programs_grwinven "Figure 6.5. Grwinven input and output files")
shows the input and output files for the **Grwinven** program. The input
files include at least one growth or control matrix output from
**Cntlmat** (`ACMAT01`{.envar}, `MCMAT01`{.envar}, or
`PCMAT01`{.envar}). If you are applying more than one growth or control
matrix (i.e. `SMK_NUM_CNTLMAT`{.envar} is greater than one), **Cntlmat**
will open additional matrices as needed (`ACMAT[xx]`{.envar},
`MCMAT[xx]`{.envar}, or `PCMAT[xx]`{.envar}). **Cntlmat** also uses the
inventory file output from **Smkinven** (`AREA`{.envar}, `MOBL`{.envar},
or `PNTS`{.envar}) and the country, state and county file
(`COSTCY`{.envar}).

**Grwinven** outputs new SMOKE intermediate inventory files
(`AREA_O`{.envar}, `MOBL_O`{.envar}, or `PNTS_O`{.envar}) that have been
controlled and/or grown into the past or future. Note that the suffix
\_O is used to distinguish the **Grwinven** output files from the input
files. You can also choose to output ASCII inventory files in ORL format
(`ARINV_O`{.envar}, `MBINV_O`{.envar}, or `PTINV_O`{.envar}).
**Grwinven** also writes a log file (`LOGFILE`{.envar}) and can create
an ASCII inventory file for activity data (`MBINV_AO`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e24378}6.5.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                                                Format           Description
  -------------------------------------------------------------------------------------------------------- ---------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `[A|M|P]CMAT_01`{.envar}                                                                                 I/O API NetCDF   Control or growth matrix output from **Cntlmat**; total number of files is determined by `SMK_NUM_CTLMAT`{.envar} setting
  `[A|M|P]CMAT_02`{.envar}, `[A|M|P]CMAT_03`{.envar}, \...                                                 I/O API NetCDF   Additional control or growth matrices; total number of files is determined by `SMK_NUM_CTLMAT`{.envar} setting
  `[AREA|MOBL|PNTS]`{.envar}                                                                               SMOKE map        Intermediate inventory file produced by **Smkinven**
  [`COSTCY`{.envar}](ch08s10s02.html "8.10.2. COSTCY: Country, state, and county names and data")          ASCII            Country, state, and county file
  [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")   ASCII            Geographical level codes and descriptions for gridded inventories, only when USE\_EXP\_GEO\_CODES is set to Y, (COSTCY is ignored when [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files") files are used)
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e24456}6.5.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `USE_EXP_GEO_CODES`{.envar}: \[default: N\]

    If set to Y then use GEOCODE\_LEVEL\[1-4\] files instead of the
    COSTCY file to define expanded geographical detail such as
    country-level(GEOCODE\_LEVEL1), country/state-level
    (GEOCODE\_LEVEL2), country/state/county-level (GEOCODE\_LEVEL3) or
    country/state/county/tribal-level (GEOCODE\_LEVEL4).

-   `ORL_NONROAD_OUT`{.envar}: \[default: N\]

    ::: {.itemizedlist}
    -   Y: Output NONROAD inventory in ORL format

    -   N: Do not output NONROAD inventory in ORL format
    :::

-   `SMK_GRWORLOUT_YN`{.envar}: \[default: N\]

    Indicates if an ORL-formatted grown and/or controlled inventory
    should be output. Currently only ORL nonpoint ond point inventory
    formats are supported. `SMK_GRWORLOUT_YN`{.envar} and
    `SMK_GRWIDAOUT_YN`{.envar} cannot be both set to Y in the same run.
    In SMOKE version 2.3, the Grwinven ORL output format was changed to
    use a more compact structure (eliminated spaces), uses commas, and
    includes semi-colons around all text fields. These changes make
    these files much smaller and easier to import to other software, but
    unfortunately harder to read in a text editor.

    ::: {.itemizedlist}
    -   Y: Output inventory in ORL format

    -   N: Do not output inventory in ORL format
    :::

-   `SMK_GRWSMKOUT_YN`{.envar}: \[default: Y\]

    ::: {.itemizedlist}
    -   Y: Output inventory in SMOKE I/O API format

    -   N: Do not output inventory in SMOKE I/O API format
    :::

-   `SMK_NUM_CTLMAT`{.envar}: \[default: 1\]

    Number of control and/or growth matrices to import and apply to the
    inventory.

-   `SMK_TMPDIR`{.envar}: \[default: `.`{.filename}\]

    Defines the path to use for temporary files that are written out
    when supplying the inventory.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e24528}6.5.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                             Format      Description
  ------------------------------------- ----------- -----------------------------------------------------------------------
  `[AREA_O|MOBL_O|PNTS_O]`{.envar}      SMOKE map   Annual and average-day inventory emissions and source characteristics
  `[ARINV_O|MBINV_O|PTINV_O]`{.envar}   ASCII       Annual and average-day inventory emissions and source characteristics
  `LOGFILE`{.envar}                     ASCII       Log generated from executing **Grwinven**
  `MBINV_AO`{.envar}                    ASCII       Annual activity inventory and source characteristics
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s05s02.html)     [Up](ch06s05.html)     [Next](ch06s06.html)
  6.5.2. Processing Order     [Home](index.html)        6.6. **Laypoint**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.6. **Laypoint**
:::

[Prev](ch06s05s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s06s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_laypoint}6.6. **Laypoint** {#laypoint .title style="clear: both"}
--------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.6.1. Description](ch06s06.html#d0e24584)]{.section}

[[6.6.2. Processing Order](ch06s06s02.html)]{.section}

[[6.6.3. Files and Environment Variables](ch06s06s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e24584}6.6.1. Description {#description .title}

</div>

</div>
:::

::: {.toc}
[[6.6.1.1. Plume rise calculation for
fires](ch06s06.html#sect_programs_laypoint_plume_rise_fires)]{.section}
:::

[*Processing categories:*]{.emphasis} point

The **Laypoint** program uses the SMOKE point-source inventory file with
gridded and hourly meteorology data to compute hourly plume rise for all
point sources. The plume rise is expressed in terms of layer fractions
for each source.

**Laypoint** is run only for the CMAQ styles of processing, in which all
of the plume rise calculations are done prior to input to the AQM. In
**Laypoint**, meteorological data are used to calculate the plume rise
for all point sources. Then, the plume is distributed into the vertical
layers that the plume intersects based on the pressure in each layer.
Only these fractions are stored (not the emissions in each layer), until
the SMOKE merge step (**Smkmerge**). Therefore, the plume rise
calculations do not need to be repeated for each control strategy or
grid. The **Laypoint** program calculates the plume rise for all days of
each meteorological scenario.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_laypoint_plume_rise_fires}6.6.1.1. Plume rise calculation for fires {#plume-rise-calculation-for-fires .title}

</div>

</div>
:::

Regardless whether the heat flux for wildfires is precomputed or
internally computed, the Pouliot-Godowitch plume rise algorithm (
http://www.epa.gov/ttn/chief/conference/ei14/session12/pouliot.pdf )
converts the heat flux (Q) to a bouyancy flux (F) for use in the plume
rise calculation (Equation 1). Hourly heat flux (Q) can be estimated
based upon daily area burned, fuel loading, material burned and a
constant default heat content (8000 BTU/lb). See more detail information
in [Section 4.4.17, "Plume Rise Calculation for
Fires"](ch04s04s17.html "4.4.17. Plume Rise Calculation for Fires").

To account for a smoldering fraction of the fire emissions, fire plumes
are distributed into both the model layers below the plume bottom and
into the model layers between the plume top and bottom. The smoldering
fraction of the total fire emissions is distributed into the model layer
below the plume bottom. The remaining part of emissions are distributed
into the model layers between the plume bottom and top.

Equation 2 estimates the plume bouyant efficiency (BE) which is the
portion of heat release from a fire that produces bouyancy, using the
fire size in acres. The smoldering fraction (S~fraction~) of the fire
plume is calculated from the BE (Equation 3). All the fire emissions are
allocated to the model layers using a weighting based on the hourly
sigma-pressure vertical coordinate. These equations are is used in
**Laypoint** when the variable `FIRE_PLUME_YN`{.envar} is set to Y. More
information about processing fire emissions is in [Section 4.4.17,
"Plume Rise Calculation for
Fires"](ch04s04s17.html "4.4.17. Plume Rise Calculation for Fires").

Fire-specific plume rise equations are following:

::: {.orderedlist}
1.  F = 0.00000258 x Q

2.  BE~size~ = 0.0703 x ln( [*acres*]{.emphasis} ) + 0.3

3.  S~fraction~ = 1 - BE~size~
:::

where

::: {.itemizedlist}
-   F = Bouyancy flux (m^4^/s^3^)
-   Q = Heat flux for fires (BTU/hr)
-   BE~size~ = bouyanct efficiency
-   acres = fire size in acres
-   S~fraction~ = smoldering fration
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- --------------------------
  [Prev](ch06s05s03.html)                     [Up](ch06.html)       [Next](ch06s06s02.html)
  6.5.3. Files and Environment Variables     [Home](index.html)     6.6.2. Processing Order
  ----------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.6.2. Processing Order
:::

[Prev](ch06s06.html) 

6.6. **Laypoint**

 [Next](ch06s06s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e24679}6.6.2. Processing Order {#processing-order .title}

</div>

</div>
:::

For elevated point sources, **Smkinven** and **Elevpoint** must be run
before **Laypoint** if using PinG and/or specific major point sources.

**Laypoint** must be run before elevated sources can be processed using
**Smkmerge**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------
  [Prev](ch06s06.html)     [Up](ch06s06.html)                    [Next](ch06s06s03.html)
  6.6. **Laypoint**        [Home](index.html)     6.6.3. Files and Environment Variables
  ----------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
6.6.3. Files and Environment Variables
:::

[Prev](ch06s06s02.html) 

6.6. **Laypoint**

 [Next](ch06s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e24700}6.6.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.6.3.1. Input Files](ch06s06s03.html#d0e24783)]{.section}

[[6.6.3.2. Input Environment
Variables](ch06s06s03.html#sect_programs_laypoint_envar)]{.section}

[[6.6.3.3. Output Files](ch06s06s03.html#d0e25102)]{.section}
:::

::: {.figure}
[]{#fig_programs_laypoint}

**Figure 6.6. Laypoint input and output files**

::: {.mediaobject}
![Laypoint input and output files](images\programs\laypoint_html.jpg)
:::
:::

[Figure 6.6, "Laypoint input and output
files"](ch06s06s03.html#fig_programs_laypoint "Figure 6.6. Laypoint input and output files")
shows the input and output files for the **Laypoint** program. The input
files include the grid description file (`GRIDDESC`{.envar}) and
meteorology files created by the meteorology preprocessor
(`GRID_CRO_3D`{.envar}, `MET_CRO_2D`{.envar}, `MET_CRO_3D`{.envar}, and
`MET_DOT_3D`{.envar}). If elevated sources have been selected,
**Laypoint** uses the the elevated point source identification file
output from **Elevpoint** (`PELV`{.envar}). Hourly plume data can be
read from the `PHOUR`{.envar} hourly inventory file and annual inventory
data is read from the `PNTS`{.envar} file, both output from
**Smkinven**. When processing fire sources, the `PDAY`{.envar} file
created by **Smkinven** and the `PTMP`{.envar} file created by
**Temporal** may be used.

**Laypoint** outputs a log file (`LOGFILE`{.envar}), hourly plume rise
layer fractions for all sources (`PLAY`{.envar}) or optionally only for
explicit sources (`PLAY_EX`{.envar}), and a report file
`REPRTLAY`{.envar} if reporting is turned on using the
`REP_LAYER_MAX`{.envar} setting.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e24783}6.6.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                          Format           Description
  ---------------------------------- ---------------- ----------------------------------------------------------------------------------------------------------
  `GRIDDESC`{.envar}                 ASCII            Description of the modeling grid
  `GRID_CRO_3D`{.envar} (optional)   I/O API NetCDF   Meteorology file produced by the meteorology preprocessor; only needed if using static layer information
  `MET_CRO_2D`{.envar}               I/O API NetCDF   Meteorology file produced by the meteorology preprocessor
  `MET_CRO_3D`{.envar}               I/O API NetCDF   Meteorology file produced by the meteorology preprocessor
  `MET_DOT_3D`{.envar}               I/O API NetCDF   Meteorology file produced by the meteorology preprocessor
  `PDAY`{.envar} (optional)          I/O API NetCDF   Daily point-source inventory file produced by **Smkinven**
  `PELV`{.envar} (optional)          ASCII            Elevated point source identification file produced by **Elevpoint**
  `PHOUR`{.envar} (optional)         I/O API NetCDF   Hourly point-source inventory file produced by **Smkinven**
  `PNTS`{.envar}                     SMOKE map        Intermediate inventory file produced by **Smkinven**
  `PTMP`{.envar}                     I/O API NetCDF   Hourly emissions file produced by **Temporal**
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_laypoint_envar}6.6.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `EXPLICIT_PLUMES_YN`{.envar}: \[default: N\]

    Indicates whether only explicit plume rise sources should be
    calculated.

    ::: {.itemizedlist}
    -   Y: Process only explicit plume rise sources; automatically sets
        `HOUR_PLUMEDATA_YN`{.envar} to Y

    -   N: Process all sources
    :::

-   `FIRE_AREA`{.envar}: \[default: 0.0\]

    Sets daily area burned in acres/day; only used when
    `FIRE_PLUME_YN`{.envar} is set to Y and `HOURLY_FIRE_YN`{.envar} is
    set to N.

-   `FIRE_HFLUX`{.envar}: \[default: 0.0\]

    Sets hourly heat flux value in BTU/hr; only used when
    `FIRE_PLUME_YN`{.envar} is set to Y and `HOURLY_FIRE_YN`{.envar} is
    set to N.

-   `FIRE_PLUME_YN`{.envar}: \[default: N\]

    Indicates if fire-specific plume rise calculations should be used.

    ::: {.itemizedlist}
    -   Y: Use fire-specific plume rise calculations for all sources

    -   N: Use traditional plume rise calculations based on stack
        parameters for all sources
    :::

-   `HOUR_PLUMEDATA_YN`{.envar}: \[default: N\]

    Indicates whether hourly plume rise data should be used.

    ::: {.itemizedlist}
    -   Y: Use hourly data; requires `PHOUR`{.envar} file

    -   N: Do not use hourly data
    :::

-   `HOURLY_FIRE_YN`{.envar}: \[default: N\]

    Indicates if hourly fire data should be used; only checked when
    `FIRE_PLUME_YN`{.envar} is set to Y.

    ::: {.itemizedlist}
    -   Y: Read hourly heat flux from `PTMP`{.envar} file and daily area
        burned from `PDAY`{.envar} file

    -   N: Get heat flux and area burned from environment variables
        `FIRE_AREA`{.envar} and `FIRE_HFLUX`{.envar}
    :::

-   `IOAPI_ISPH`{.envar}: See description in [Section 6.3.3.2, "Input
    Environment
    Variables"](ch06s03s03.html#sect_programs_elevpoint_envar "6.3.3.2. Input Environment Variables")

-   `PLUME_GTEMP_NAME`{.envar}: \[default: TEMP2\]

    Sets ground temperature variable name from meteorology file for
    plume rise calcuation.

-   `REP_LAYER_MAX`{.envar}: \[default: -1\]

    Layer number for reporting high plume rise; reporting is turned off
    if set to less than 1.

-   `SMK_EMLAYS`{.envar}: \[default: -1\]

    Number of emissions layers; must be at least 4 otherwise program
    will not run.

-   `SMK_SOURCE`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables").

-   `SMK_SPECELEV_YN`{.envar}: \[default: N\]

    Defines whether the **Elevpoint** output file `PELV`{.envar} will be
    used to set elevated sources.

    ::: {.itemizedlist}
    -   Y: Use the `PELV`{.envar} file to set elevated sources during
        run

    -   N: Let **Laypoint** plume rise calculation determine whether or
        not sources are elevated
    :::

-   `USE_EDMS_DATA_YN`{.envar}: \[default: N\]

    Process EDMS aviation source elevation height as its plume rise and
    distributes the emissions into the layer where it belongs to.

    ::: {.itemizedlist}
    -   Y: Skip plume rise calculation and distribute EDMS aviation
        emissions into the layer where it belongs to using its elevation
        height.

    -   N: Do not process EDMS aviation sources
    :::

-   `VELOC_RECALC`{.envar}: \[default: N\]

    Determines whether velocity should be recalculated based on hourly
    flow rates and stack diameter.

    ::: {.itemizedlist}
    -   Y: Recalculate velocity for hourly data

    -   N: Use velocity values from hourly inventory file
    :::

-   `VERTICAL_SPREAD`{.envar}: \[default: 0\]

    Sets the vertical spread method for determining the bottom and top
    heights of each plume.

    ::: {.itemizedlist}
    -   0: Use the default Turner approach where plume thickness equals
        the amount of plume rise

    -   1: Compute vertical spread using ambient temperature data
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e25102}6.6.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format           Description
  -------------------- ---------------- --------------------------------------------------------
  `LOGFILE`{.envar}    ASCII            Log generated from executing **Laypoint**
  `PLAY`{.envar}       I/O API NetCDF   Hourly plume rise layer fractions by source
  `PLAY_EX`{.envar}    I/O API NetCDF   Hourly plume rise layer fractions for explicit sources
  `REPRTLAY`{.envar}   ASCII            Report file for plumes exceeding specified layer
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s06s02.html)     [Up](ch06s06.html)     [Next](ch06s07.html)
  6.6.2. Processing Order     [Home](index.html)       6.7. **Met4moves**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.7. **Met4moves**
:::

[Prev](ch06s06s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s07s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_met4moves}6.7. **Met4moves** {#met4moves .title style="clear: both"}
----------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.7.1. Description](ch06s07.html#d0e25157)]{.section}

[[6.7.2. Processing Order](ch06s07s02.html)]{.section}

[[6.7.3. Files, Environment Variables and Run
Syntax](ch06s07s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e25157}6.7.1. Description {#description .title}

</div>

</div>
:::

::: {.toc}
[[6.7.1.1. Definition of a
"[day]{.quote}"](ch06s07.html#d0e25172)]{.section}
:::

[*Processing categories:*]{.emphasis} mobile

The **Met4moves** is a meteorological processor that prepares
temperature and relative humidity (RH) data for use by both MOVES and
SMOKE. **Met4moves** produces specific meteorological metrices for the
representative county(s) for MOVES and additional meteorological metrics
for all inventory counties in the county group for SMOKE

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e25172}6.7.1.1. Definition of a "[day]{.quote}" {#definition-of-a-day .title}

</div>

</div>
:::

**Met4moves** seeks to obtain 24 hours' worth of meteorology data for a
source for each day, which is necessary for generating emission factors.
However, the definition of a "[day]{.quote}" differs for sources in
different time zones. By default, **Met4moves** uses each source's time
zone to determine a day for that time zone. To instead use the same
day-start-time for all sources, the `UNIFORM_STIME`{.envar} environment
variable can be used.

If the inventory covers multiple time zones, all sources will not have
the same coverage of days. **Met4moves** will use meteorology data from
previous or subsequent days to fill in missing data. If appropriate data
are not available, the program will quit with an error and you must
provide additional meteorology data to cover the time period of
interest. Currently, **Met4moves** does not considers Daylight Saving
time in its determination of "[day]{.quote}".
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- --------------------------
  [Prev](ch06s06s03.html)                     [Up](ch06.html)       [Next](ch06s07s02.html)
  6.6.3. Files and Environment Variables     [Home](index.html)     6.7.2. Processing Order
  ----------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.7.2. Processing Order
:::

[Prev](ch06s07.html) 

6.7. **Met4moves**

 [Next](ch06s07s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e25201}6.7.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Met4moves** must be run prior to [MOVES processing
scripts](ch05s02.html "5.2. MOVES Utility Scripts"). The SMOKE Utility
program, [**Metcombine**](ch05s03s10.html "5.3.10. Metcombine"), needs
to be run prior to **Met4moves**. **Metcombine** allows the user to
combine ambient temperature, pressure and mixing ratio variables from
two different MCIP files (METCRO\_2D and METCRO\_3D) that are needed to
compute Relative Humidity (RH) in **Met4moves**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------------------
  [Prev](ch06s07.html)     [Up](ch06s07.html)                                [Next](ch06s07s03.html)
  6.7. **Met4moves**       [Home](index.html)     6.7.3. Files, Environment Variables and Run Syntax
  ----------------------- -------------------- -----------------------------------------------------
:::
::: {.navheader}
6.7.3. Files, Environment Variables and Run Syntax
:::

[Prev](ch06s07s02.html) 

6.7. **Met4moves**

 [Next](ch06s08.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e25224}6.7.3. Files, Environment Variables and Run Syntax {#files-environment-variables-and-run-syntax .title}

</div>

</div>
:::

::: {.toc}
[[6.7.3.1. Input Files](ch06s07s03.html#d0e25268)]{.section}

[[6.7.3.2. Input Environment
Variables](ch06s07s03.html#d0e25370)]{.section}

[[6.7.3.3. Output Files](ch06s07s03.html#d0e25488)]{.section}
:::

::: {.figure}
[]{#fig_programs_met4moves}

**Figure 6.7. Met4moves input and output files**

::: {.mediaobject}
![Met4moves input and output files](images\programs\met4moves_html.jpg)
:::
:::

[Figure 6.7, "Met4moves input and output
files"](ch06s07s03.html#fig_programs_met4moves "Figure 6.7. Met4moves input and output files")
shows the input and output files for the **Met4moves** program. The
input files are the Grid Description File from MCIP(`GRIDDESC`{.envar}),
the Surrogate Description file (`SRGDESC`{.envar}), the MCIP List of
Meteorology File
[(`METLIST`{.envar})](ch08s08.html#sect_input_metlist "8.8.1. METLIST: List of meteorology files"),
and the representative county cross-reference file
[(`MCXREF`{.envar})](ch08s09s02.html#sect_input_mcxref "8.9.2.1.3. MCXREF: Mobile representative county cross-reference file").

**Met4moves** outputs datasets for SMOKE that contain the daily gridded
min/max temperatures and averaged RH. **Met4moves** outputs for MOVES
datasets that provide all (min/max) temperature combinations for a
representative county, reflecting all min/max combinations for all
inventory counties in that county group. The associated RH values are
also included in these datasets. In addition, the datasets include the
24-h diurnal profiles needed for the RPP emission process, and contain
user-specified temperature increments for use by MOVES.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e25268}6.7.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                                                                                   Format   Description
  ------------------------------------------------------------------------------------------------------------------------------------------- -------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  [`COSTCY`{.envar}](ch08s10s02.html "8.10.2. COSTCY: Country, state, and county names and data")                                             ASCII    Country, state, county codes file, with time zones
  [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")                                      ASCII    Geographical level codes and descriptions for gridded inventories, only when USE\_EXP\_GEO\_CODES is set to Y, (COSTCY is ignored when [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files") files are used)
  [`GRIDDESC`{.envar}](ch08s04s06.html "8.4.6. GRIDDESC: Grids and projection information")                                                   ASCII    Modeling Domain Grid Description File
  [`MCXREF`{.envar}](ch08s09s02.html#sect_input_mcxref "8.9.2.1.3. MCXREF: Mobile representative county cross-reference file")                ASCII    Representative county cross-reference file; NOTE: The list of counties in the MCXREF file used by **Met4moves** must match the list of inventory counties used by SMOKE
  [`METLIST`{.envar}](ch08s08.html#sect_input_metlist "8.8.1. METLIST: List of meteorology files")                                            ASCII    A list of meteorology files containing temperature, mixing ratio, and surface pressure data created by **Metcombine**
  [`MFMREF`{.envar}](ch08s09s02.html#sect_input_mfmref "8.9.2.1.5. MFMREF: Mobile fuel month file for MOVES")                                 ASCII    Representative county fuel monthcross-reference file; NOTE: The list of counties in the MFMREF file used by **Met4moves** must match the list of inventory counties used by SMOKE
  [`SRGDESC`{.envar}](ch08s04.html#sect_input_srgdesc "8.4.1. SRGDESC: Surrogate Designation, Description and Surrogate profile filename.")   ASCII    Surrogate Description File
  `Surrogate File(s)`{.envar}                                                                                                                 ASCII    Surrogate file(s) selected by `SRG_LIST`{.envar}
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e25370}6.7.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `STDATE`{.envar}: \[default: 0\]

    This environment variable sets the overall episode start date:
    Julian format (YYYYDDD) for **Movesmrg**.

-   `ENDDATE`{.envar}: \[default: 0\]

    Sets the overall episode end date; Julian format (YYYYDDD).

-   `ENDTIME`{.envar}: \[default: 230000\]

-   `USE_EXP_GEO_CODES`{.envar}: \[default: N\]

    If set to Y then use GEOCODE\_LEVEL\[1-4\] files instead of the
    COSTCY file to define expanded geographical detail such as
    country-level(GEOCODE\_LEVEL1), country/state-level
    (GEOCODE\_LEVEL2), country/state/county-level (GEOCODE\_LEVEL3) or
    country/state/county/tribal-level (GEOCODE\_LEVEL4).

-   `PD_TEMP_INCREMENT`{.envar}: \[default: 5\]

    Defines the temperature increment (in deg. F) for RPD lookup table
    to create combinations of min/max temperature bins

-   `PH_TEMP_INCREMENT`{.envar}: \[default: 5\]

    Defines the temperature increment (in deg. F) for RPH lookup table
    to create combinations of min/max temperature bins

-   `PV_TEMP_INCREMENT`{.envar}: \[default: 5\]

    Defines the temperature increment (in deg. F) for RPV lookup table
    to create combinations of min/max temperature bins

-   `PP_TEMP_INCREMENT`{.envar}: \[default: 10\]

    Defines the temperature increment (in deg. F) for RPP lookup table
    to create combinations of min/max temperature bins

-   `MIN_NO_RH_BY_TEMPBIN`{.envar}: \[default: 1\]

    Defines the minimum number of data point for computing averaged RH
    by tempearature bin

-   `SPECIFIC_HUMIDITY_YN`{.envar}: \[default: N\]

    Defines whether compute specific humidity instead of relative
    humidity

-   `SRG_LIST`{.envar}: \[default: N\]

    Specifies the code(s) of the spatial surrogate(s) to be used in
    selecting the grid cells for the county (example: setenv SRG\_LIST
    \'100,230\').

-   `SRGPRO_PATH`{.envar}: \[default: N\]

    Defines the location of spatial surrogate files.

-   `TEMP_BUFFER_BIN`{.envar}: \[default: 0.0\]

    Defines the temperature buffer value (°F). This value will allow
    **Met4moves** to expand the min/max temperature range for MOVES RPP
    processing. If `TEMP_BUFFER_BIN`{.envar} is set to 10.0, the
    original max temperature which is 90.0°F will be treated as 100.0°F,
    and minimum temperaure (=30°F) will be treated as 20.0°F internally
    in **Met4moves**.

-   `TVARNAME`{.envar}: \[default: TEMP2\]

    Specifies the variable name for the temperature to extract from the
    **Met4moves** output file (`MOVES_OUTFILE`{.envar}).
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e25488}6.7.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                        Format   Description                                                                                                                                                                                                          
  -------------------------------------------------------------------------------- -------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---
  [MOVES\_OUTFILE](ch09s08.html#sect_intmed_moves_output "9.8.1. MOVES_OUTFILE")   ASCII    Contains the absolute minimum and maximum temperatures and average RH values and the 24 hour temperature profiles associated with each representative county (example filename: MOVES\_12km\_2009091-2009120.txt)    
  [MOVES\_RH\_OUTFILE](ch09s08s02.html "9.8.2. MOVES_RH_OUTFILE")                  ASCII    Contains the representative county-specific average RH, minimum and maximum temperature by temperature bin and fuel month.                                                                                           
  [SMOKE\_OUTFILE](ch09s08s03.html "9.8.3. SMOKE_OUTFILE(=METMOVES)")              ASCII    Contains gridded daily min/max temperatures in local timei for RPP mode run in **Movesmrg**                                                                                                                          
  `LOGFILE`{.envar}                                                                ASCII    Log generated from executing **Met4moves**                                                                                                                                                                           
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s07s02.html)     [Up](ch06s07.html)     [Next](ch06s08.html)
  6.7.2. Processing Order     [Home](index.html)        6.8. **Movesmrg**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.8. **Movesmrg**
:::

[Prev](ch06s07s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s08s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_movesmrg}6.8. **Movesmrg** {#movesmrg .title style="clear: both"}
--------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.8.1. Description](ch06s08.html#d0e25546)]{.section}

[[6.8.2. Processing Order](ch06s08s02.html)]{.section}

[[6.8.3. Files and Environment Variables](ch06s08s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e25546}6.8.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} mobile

**Movesmrg** is a mobile-sources-only program, loosely based on the
SMOKE program **Smkmerge**, that combines the intermediate files
produced by the other SMOKE programs (i.e., **SmkInven**, **Grdmat**,
**Spcmat**, **Temporal**). The **movesmrg** program is discussed in
detail in [Section 6.8, "**Movesmrg**"](ch06s08.html "6.8. Movesmrg").
Similar to [**Smkmerge**](ch06s14.html "6.14. Smkmerge"), the main goal
of [**Movesmrg**](ch06s08.html "6.8. Movesmrg") is to create (1)
gridded, speciated, hourly air quality model-ready input files and (2)
county-level SCC summaries. The primary difference between **Movesmrg**
and **Smkmerge** is that **Movesmrg** uses the SMOKE Formatted MOVES
emission rate lookup tables to compute emissions on the fly, by
multiplying the emissions factors by hourly VMT (for RatePerDistance
\[RPD\]), annual or monthly hotelling hours (for RatePerHour \[RPH\]) or
by monthly or annual vehicle populations (for RatePerVehicle \[RPV\] or
RatePerProfile \[RPP\]).

**Movesmrg** must be run four times to compute on-roadway and
off-network (including vapor venting) emissions processes individually,
since the emission rate calculation methods in SMOKE for these
categories are quite different. Once all three emissions processes have
been computed, the emission output files can be merged (optionally along
with other 2D sectors separate from onroad) using **Mrggrid**, which
combines any number of 2D or 3D hourly, gridded, and speciated emission
data files. See the section [Section 6.10,
"**Mrggrid**"](ch06s10.html "6.10. Mrggrid") for more details on the
above programs.

::: {.itemizedlist}
-   [**RPD, RPH and RPV Emission Calculations**]{.bold}

    For its RPD, RPH and RPV lookup table calculations, **Movesmrg**
    uses the gridded hourly temperatures in GMT, and then adjusts the
    hour of the RPD, RPH and RPV lookup tables from local time to GMT to
    get the emission rates for the representative county for the
    appropriate month. The key lookup fields for the factors are hourly
    temperature and avarage speed for the RPD lookup table calculation,
    hourly temperature for the RPH lookup table calculation, and hourly
    temperature and hour of the day in local time for the RPV table
    calculation.

-   [**RPP Emission Calculations**]{.bold}

    For the RPP lookup table calculations, **Movesmrg** uses the RPP
    lookup table as an input file for the emission rates that depend not
    on the gridded hourly temperatures, but on the temperature profiles
    output by the **Met4moves** program. The emissions estimates based
    on the RPP table are computed for the temporal averaging period
    specified for the temperature profiles, rather than using hourly
    gridded meteorology.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------- -------------------- --------------------------
  [Prev](ch06s07s03.html)                                 [Up](ch06.html)       [Next](ch06s08s02.html)
  6.7.3. Files, Environment Variables and Run Syntax     [Home](index.html)     6.8.2. Processing Order
  ----------------------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.8.2. Processing Order
:::

[Prev](ch06s08.html) 

6.8. **Movesmrg**

 [Next](ch06s08s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e25623}6.8.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Movesmrg** must be run after **Met4moves** and MOVES and before
**Mrggrid**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------
  [Prev](ch06s08.html)     [Up](ch06s08.html)                    [Next](ch06s08s03.html)
  6.8. **Movesmrg**        [Home](index.html)     6.8.3. Files and Environment Variables
  ----------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
6.8.3. Files and Environment Variables
:::

[Prev](ch06s08s02.html) 

6.8. **Movesmrg**

 [Next](ch06s09.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e25636}6.8.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.8.3.1. Input Files](ch06s08s03.html#d0e25763)]{.section}

[[6.8.3.2. Input Environment
Variables](ch06s08s03.html#d0e25952)]{.section}

[[6.8.3.3. Output Files](ch06s08s03.html#d0e26402)]{.section}
:::

::: {.figure}
[]{#fig_programs_movesmrg_mobile}

**Figure 6.8. Movesmrg input and output files**

::: {.mediaobject}
![Movesmrg input and output
files](images\programs\movesmrg_mobile_html.jpg)
:::
:::

[Figure 6.8, "Movesmrg input and output
files"](ch06s08s03.html#fig_programs_movesmrg_mobile "Figure 6.8. Movesmrg input and output files")
shows the input and output files for the **Movesmrg** program. The input
files are the country, state, and county codes file (`COSTCY`{.envar}),
the grid description file (`GRIDDESC`{.envar}), the inventory data table
(`INVTABLE`{.envar}), the representative county fuel month file
(`MFMREF`{.envar}), the list of emission process and associated
pollutants file (`MEPROC`{.envar}), the representative county
cross-reference file (`MCXREF`{.envar}), the list of emission factors
files by representative county file (`MRCLIST`{.envar}), the meteorology
files (`MET_CRO_2D`{.envar}), the gridding matrix from **Grdmat**
(`MGMAT`{.envar}), the inventory file output from **Smkinven**
(`MOBL`{.envar}), the speciation matrix from **Spcmat**
(`MSMAT_L`{.envar} or `MSMAT_S`{.envar}), the **Met4moves** output file
for SMOKE (`METMOVES`{.envar}
[`=SMOKE_OUTFILE)`{.envar}](ch09s08s03.html "9.8.3. SMOKE_OUTFILE(=METMOVES)"),
the MOVES-based lookup tables (RPD, RPV, and RPP), and the daily hour
VMT files from **Temporal** (`MTMP_(day)`{.envar}). Note that
`MET_CRO_2D`{.envar}, `METMOVES`{.envar}, and `MTMP_(day)`{.envar} are
optional files that are included only in certain situations.

**Movesmrg** outputs a model-ready emissions file `MGTS_L`{.envar} or
`MGTS_S`{.envar}, a report file `REPMGTS_S`{.envar}, and a log file
`LOGFILE`{.envar}.

When using source apportionment (see [Section 4.4.23, "Generating
CMAQ-ready Source Apportionment Input Data
Files"](ch04s04s23.html "4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files")),
**Movesmrg** will also read the source grouping file
(`SOURCE_GROUPS`{.envar}) and output the source group information
`SRCGROUPS_OUT`{.envar}, the emissions for each source group
`SGINLNTS_L`{.envar} or `SGINLNTS_S`{.envar}, and a source group report
file `SRCGRP_REPORT`{.envar}.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e25763}6.8.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                                                                                    Format   Description
  -------------------------------------------------------------------------------------------------------------------------------------------- -------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `COSTCY`{.envar}                                                                                                                             ASCII    Country, state and county codes file
  [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")                                       ASCII    Geographical level codes and descriptions for gridded inventories, only when USE\_EXP\_GEO\_CODES is set to Y, (COSTCY is ignored when [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files") files are used)
  [`CFPRO`{.envar}](ch08s09s02.html#sect_input_cfpro "8.9.2.1.2. CFPRO: Mobile source control factor input file") (optional)                   ASCII    Control factor file
  `GRIDDESC`{.envar}                                                                                                                           ASCII    Grid description file
  `INVTABLE`{.envar}                                                                                                                           ASCII    Inventory data table
  `MFMREF`{.envar}                                                                                                                             ASCII    Representative county fuel month file
  `MEPROC`{.envar}                                                                                                                             ASCII    List of emission process and associated pollutants file
  `MCXREF`{.envar}                                                                                                                             ASCII    Representative county cross-reference file
  `MRCLIST`{.envar}                                                                                                                            ASCII    List of emission factors files (i.e., RPD, RPV and RPP Lookup tables) by representative county file
  `METLIST`{.envar}                                                                                                                            ASCII    List of MCIP meteorology files
  `MGMAT`{.envar}                                                                                                                              ASCII    Gridding matrix from **Grdmat**
  `MOBL`{.envar}                                                                                                                               ASCII    Inventory file output from **Smkinven**
  `MSMAT_[L|S]`{.envar}                                                                                                                        ASCII    Speciation matrix from **Spcmat**
  `METMOVES`{.envar} ([`=SMOKE_OUTFILE)`{.envar}](ch09s08s03.html "9.8.3. SMOKE_OUTFILE(=METMOVES)") (optional)                                ASCII    Meteorology file from **Met4moves**
  `MTMP_{day}`{.envar}                                                                                                                         ASCII    Daily hour VMT files from **Temporal**
  [`SOURCE_GROUPS`{.envar}](ch08s10s13.html "8.10.13. SOURCE_GROUPS: Source apportionment groups") (optional)                                  ASCII    Source apportionment groups
  [`SPDIST`{.envar}](ch08s09s02.html#sect_input_spdist "8.9.2.1.7. SPDIST: Mobile average speed distribution profile input file") (optional)   ASCII    Weekday and weekend hour-specific 16-bins average speed distribution profiles
  [`SPDPRO`{.envar}](ch08s09s02.html#sect_input_spdpro "8.9.2.1.8. SPDPRO: Mobile hourly speed profile input file") (optional)                 ASCII    Weekday and weekend hourly speed profiles
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e25952}6.8.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `APPLY_NOX_HUMIDITY_ADJ: `{.envar}: \[default: N\]

    Allows **Movesmrg** to apply NOx humidity correction to gridded
    hourly NOx emissions for RPD\_MODE and RPH\_MODE runs. If there is a
    header \"HUMIDITY\_ADJUSTED\_NOX Y\" listed in the MOVES lookup
    tables, it means that NOx emissions in those MOVES lookup tables are
    already adjusted and this flag will be overwritten to N. No NOx
    humidity correction will be applied.

    ::: {.itemizedlist}
    -   Y: Apply NOx humidity correction to non-NOx humidity correction
        applied MOVES lookup tables from RPD and RPH runs.

    -   N: Do not apply NOx humidity correction.
    :::

-   `MEMORY_OPTIMIZE_YN: `{.envar}: \[default: Y\]

    Allows **Movesmrg** to use less RAM memory. However, it will
    increase computational time of RPD\_MODE and RPV\_MODE runs.

    ::: {.itemizedlist}
    -   Y: Runs **Movesmrg** in memory optimization mode.

    -   N: Runs **Movesmrg** faster mode using high capacity of RAM
        memory.
    :::

-   `MRG_BYDAY`{.envar}: \[default: blank\]

    String code that specifies which source category is to use a by-day
    approach for the hourly input files. It must be set to \"M\" for a
    **Movesmrg** to create an output file for each day.

-   `MRG_GRDOUT_YN`{.envar}: \[default: N\]

    Determines whether **Movesmrg** produces a gridded output file.

    ::: {.itemizedlist}
    -   Y: Read the gridding matrix produced by the **Grdmat**

    -   N: Do not read the gridding matrix.
    :::

-   `MRG_SPCOUT_YN`{.envar}: \[default: N\]

    Determines whether **Movesmrg** produces a speciated output file.

    ::: {.itemizedlist}
    -   Y: Read the gridding matrix produced by the **Spcmat**

    -   N: Do not read the gridding matrix.
    :::

-   `MRG_REPCNY_YN`{.envar}: \[default: N\]

    Determines whether **Movesmrg** produces a report of emission totals
    by county

    ::: {.itemizedlist}
    -   Y: Produce the report by **Movesmrg**

    -   N: Do not produce the report
    :::

-   `MRG_REPSTA_YN`{.envar}: \[default: N\]

    Determines whether **Movesmrg** produces a report of emission totals
    by state

    ::: {.itemizedlist}
    -   Y: Produce the report by **Movesmrg**

    -   N: Do not produce the report
    :::

-   `MRG_REPSCC_YN`{.envar}: \[default: N\]

    Determines whether **Movesmrg** produces a report of emission totals
    by SCC

    ::: {.itemizedlist}
    -   Y: Produce the report by **Movesmrg**

    -   N: Do not produce the report
    :::

-   `MRG_REPSRC_YN`{.envar}: \[default: N\]

    Determines whether **Movesmrg** produces a report of emission totals
    by source.

    ::: {.itemizedlist}
    -   Y: Produce the report by **Movesmrg**. It will reset
        `MRG_REPCNY_YN`{.envar} and `MRG_REPSCC_YN`{.envar} to N to
        avoid to outputing duplicate information into the report.

    -   N: Do not produce the report
    :::

-   If `MRG_GRDOUT_UNIT`{.envar} \[default: units\]

    String code that permits user to change the unit of the gridded
    output file.

-   If `MRG_TOTOUT_UNIT`{.envar} \[default: units\]

    String code that permits user to change the unit of the state/county
    total report file.

-   `MTMP_OUTPUT_YN`{.envar}: \[default: N\]

    Defines whether **Temporal** outputs the **Temporal** intermediate
    output file from [Section 9.14,
    "**Temporal**"](ch09s14.html "9.14. Temporal") for **Smkreport** to
    create hourly emissions summary report based on hourly gridded
    emissions estimated by **Movesmrg**.

    ::: {.itemizedlist}
    -   Y: Output Temporal intermediate output file

    -   N: Do not output Temporal intermediate output file
    :::

-   `RPD_MODE:`{.envar} \[default: N\]

    Determines whether **Movesmrg** processes rate-per-distance
    emissions.

    ::: {.itemizedlist}
    -   Y: Process rate-per-distance emissions

    -   N: Do not process rate-per-distance emissions
    :::

-   `RPH_MODE:`{.envar} \[default: N\]

    Determines whether **Movesmrg** processes rate-per-hour emissions.

    ::: {.itemizedlist}
    -   Y: Process rate-per-hour emissions

    -   N: Do not process rate-per-hour emissions
    :::

-   `RPV_MODE`{.envar}: \[default: N\]

    Determines whether **Movesmrg** processes rate-per-vehicle
    emissions.

    ::: {.itemizedlist}
    -   Y: Process rate-per-vehicle emissions

    -   N: Do not process rate-per-vehicle emissions
    :::

-   `RPP_MODE`{.envar}: \[default: N\]

    Determines whether **Movesmrg** processes rate-per-profile
    emissions.

    ::: {.itemizedlist}
    -   Y: Process rate-per-profile emissions

    -   N: Do not process rate-per-profile emissions
    :::

-   `SMK_MVSPATH`{.envar}: \[default: blank\]

    Defines the location of MOVES emission factors lookup tables.

-   `SMK_SOURCE`{.envar}: \[default: blank\]

    Sets the types of source category. It must be set to \"M\" for
    **Movesmrg**.

-   `SMK_SRCGROUP_OUTPUT_YN`{.envar}: \[default: N\]

    Indicates if source apportionment emissions should be output

    ::: {.itemizedlist}
    -   Y: Group sources and output source apportionment files

    -   N: Do not perform any source apportionment processing
    :::

-   `TEMP_BUFFER_BIN`{.envar}: \[default: 0.0\]

    Defines the temperature buffer value (°F). This value allows
    **Movesmrg** to cover the outside of min/max temperature range in
    `SMOKE_OUTFILE`{.envar} from **Met4moves** for **Movesmrg** RPP
    processing. If `TEMP_BUFFER_BIN`{.envar} is set to 10.0, the
    original max temperature which is 90.0°F will be treated as 100.0°F,
    and minimum temperaure (=30°F) will be treated as 20.0°F internally
    in **Movesmrg**. Emission rates for those temperatures outside of
    original temperature range will share the ones from original max/min
    temperatures.

-   `TMPVNAME`{.envar}: \[default: TEMP2\]

    Name of temperature variable to read from the meteorology files for
    **Movesmrg**.

-   `USE_AVG_SPD_DIST`{.envar}: \[default: N\]

    Allows the user to apply 16-speed bin average speed distribution
    profiles by region, SCC, day of week, and hour of day.

    ::: {.itemizedlist}
    -   Y: Apply 16-speed bin average speed distribution profiles.

    -   N: Do not apply average speed distribution profiles.
    :::

-   `USE_CONTROL_FACTORS`{.envar}: \[default: N\]

    Allows the user to apply control factor by region, SCC, pollutant,
    and month.

    ::: {.itemizedlist}
    -   Y: Apply control factors to MOVES emission rates from MOVES
        lookup tables.

    -   N: Do not apply control factor.
    :::

-   `USE_EXP_CONTROL_FAC_YN`{.envar}: \[default: N\]

    Allows the user to optionally apply pollutant/species-specific
    explict control factor by region, SCC, and month when
    `USE_CONTROL_FACTORS`{.envar} is set to Y.

    ::: {.itemizedlist}
    -   Y: Apply pollutant/species-specific explicit control factors to
        MOVES emission rates from MOVES lookup tables.

    -   N: Do not apply control factor.
    :::

-   `USE_EXP_GEO_CODES`{.envar}: \[default: N\]

    If set to Y then use GEOCODE\_LEVEL\[1-4\] files instead of the
    COSTCY file to define expanded geographical detail such as
    country-level(GEOCODE\_LEVEL1), country/state-level
    (GEOCODE\_LEVEL2), country/state/county-level (GEOCODE\_LEVEL3) or
    country/state/county/tribal-level (GEOCODE\_LEVEL4).

-   `USE_REF_CONTROL_FAC_YN`{.envar}: \[default: N\]

    Allows the user to optionally apply reference-county-level control
    factor by SCC, and month when `USE_CONTROL_FACTORS`{.envar} is set
    to Y.

    ::: {.itemizedlist}
    -   Y: Apply reference-county-level control factors to MOVES
        emission rates from MOVES lookup tables.

    -   N: Do not apply control factor.
    :::

-   `USE_HOURLY_SPEEDS`{.envar}: \[default: N\]

    Determine whether processes weekday/weekend hourly speed profiles or
    not.

    ::: {.itemizedlist}
    -   Y: Process weekday/weekend hourly speed profiles

    -   N: Do not process hourly speed profiles
    :::

-   `USE_SPCMAT_SPC_YN`{.envar}: \[default: N\]

    Determine whether estimate air quality model species using chemical
    speciation profiles or not.

    ::: {.itemizedlist}
    -   Y: Estimate model species emissions using GSPRO input file

    -   N: Estimate model species emissions directly from MOVES emission
        rates lookup tables
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e26402}6.8.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                   Format           Description
  --------------------------- ---------------- -------------------------------------------------------------------------------------------------------------------------------
  `MGTS[_S|_L]`{.envar}       I/O API NetCDF   Model Ready Emissions File
  `MTMP_INV`{.envar}          I/O API NetCDF   Hourly emissions by source
  `REPMGTS[_S|_L]`{.envar}    ASCII            Report File
  `LOGFILE`{.envar}           ASCII            Logfile
  `SGINLNTS[_S|_L]`{.envar}   I/O API NetCDF   Emissions by source group, formatted as CMAQ in-line emissions data, produced if `SMK_SRCGROUP_OUTPUT_YN`{.envar} is set to Y
  `SRCGROUPS_OUT`{.envar}     I/O API NetCDF   Source group information, produced if `SMK_SRCGROUP_OUTPUT_YN`{.envar} is set to Y
  `SRCGRP_REPORT`{.envar}     ASCII            Source group report file, produced if `SMK_SRCGROUP_OUTPUT_YN`{.envar} is set to Y
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s08s02.html)     [Up](ch06s08.html)     [Next](ch06s09.html)
  6.8.2. Processing Order     [Home](index.html)         6.9. **Mrgelev**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.9. **Mrgelev**
:::

[Prev](ch06s08s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s09s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_mrgelev}6.9. **Mrgelev** {#mrgelev .title style="clear: both"}
------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.9.1. Description](ch06s09.html#d0e26488)]{.section}

[[6.9.2. Processing Order](ch06s09s02.html)]{.section}

[[6.9.3. Files and Environment Variables](ch06s09s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e26488}6.9.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} point

The **Mrgelev** merges multiple ASCII elevated files created by
**Smkmerge**. The program can also output a binary elevated file needed
by CAMx and UAM models. **Mrgelev** also handles matching PinG sources
from different inputs, ensuring that only the top 300 emission sources
are marked as PinG sources in the final merged output. For PinG
matching, **Mrgelev** uses `PELV`{.envar} files output by **Elevpoint**.
**Mrgelev** uses the environment variable `MRG_DIFF_DAYS`{.envar} to
merge files from different days into a single file.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- --------------------------
  [Prev](ch06s08s03.html)                     [Up](ch06.html)       [Next](ch06s09s02.html)
  6.8.3. Files and Environment Variables     [Home](index.html)     6.9.2. Processing Order
  ----------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
6.9.2. Processing Order
:::

[Prev](ch06s09.html) 

6.9. **Mrgelev**

 [Next](ch06s09s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e26521}6.9.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Mrgelev** is used to merge ASCII elevated files created by
**Smkmerge**. If PinG matching is desired, then output files from
**Elevpoint** are required.

The output binary elevated file from **Mrgelev** is used when running
CAMx or UAM models.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- -----------------------------------------
  [Prev](ch06s09.html)     [Up](ch06s09.html)                    [Next](ch06s09s03.html)
  6.9. **Mrgelev**         [Home](index.html)     6.9.3. Files and Environment Variables
  ----------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
6.9.3. Files and Environment Variables
:::

[Prev](ch06s09s02.html) 

6.9. **Mrgelev**

 [Next](ch06s10.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e26539}6.9.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.9.3.1. Input Files](ch06s09s03.html#d0e26585)]{.section}

[[6.9.3.2. Input Environment
Variables](ch06s09s03.html#d0e26621)]{.section}

[[6.9.3.3. Output Files](ch06s09s03.html#d0e26680)]{.section}
:::

::: {.figure}
[]{#fig_programs_mrgelev}

**Figure 6.9. Mrgelev input and output files**

::: {.mediaobject}
![Mrgelev input and output files](images\programs\mrgelev_html.jpg)
:::
:::

[Figure 6.9, "Mrgelev input and output
files"](ch06s09s03.html#fig_programs_mrgelev "Figure 6.9. Mrgelev input and output files")
shows the input and output files for the **Mrgelev** program. The input
files are a list of the ASCII elevated files (`FILELIST`{.envar}) and
optionally a list of `PELV`{.envar} files created by **Elevpoint**
(`PELVLIST`{.envar}). In both files, the complete file name including
path must be provided. When using the `PELVLIST`{.envar} file, each file
must match the corresponding ASCII elevated file. The program outputs a
log file (`LOGFILE`{.envar}), a merged ASCII elevated file
(`OUTFILE`{.envar}), a merged binary elevated file (`PTSOURCE`{.envar}),
and a report file (`REPMRGELEV`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e26585}6.9.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format   Description
  -------------------- -------- ----------------------------------------------------------------------------------------------------------------------------------
  `FILELIST`{.envar}   ASCII    List of input ASCII elevated files including path and file name
  `PELVLIST`{.envar}   ASCII    List of input `PELV`{.envar} files including path and file name; leave environment variable unset if not processing PinG sources
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e26621}6.9.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `MRG_DIFF_DAYS`{.envar}: \[default: N\]

    This environment variable allows **Mrgelev** to merge files with
    data from different days.

    ::: {.itemizedlist}
    -   Y: Allow data from different dates to be merged together

        **Mrgelev** will use the environment variables
        `G_STDATE`{.envar}, `G_STTIME`{.envar}, `G_RUNLEN`{.envar}, and
        `G_TSTEP`{.envar} to set the start date, start time, length, and
        time step of the output file. All input files must have the same
        starting time as `G_STTIME`{.envar}, the same time step as
        `G_TSTEP`{.envar}, and must contain more than `G_RUNLEN`{.envar}
        steps of data. For each input file, if it contains data to cover
        the actual episode requested by `G_STDATE`{.envar},
        `G_STTIME`{.envar}, and `G_RUNLEN`{.envar}, then the data for
        the actual episode will be used; otherwise, data starting at the
        first time step of the file will be used.

    -   N: Require all merged data to be from the same date

        **Mrgelev** will determine the output file time period based on
        the latest starting input file and the earliest ending input
        file.
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e26680}6.9.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name              Format   Description
  ---------------------- -------- --------------------------------------------------------------------
  `LOGFILE`{.envar}      ASCII    Log generated from executing **Mrgelev**
  `OUTFILE`{.envar}      ASCII    Merged ASCII elevated file
  `PTSOURCE`{.envar}     Binary   Merged binary elevated file
  `REPMRGELEV`{.envar}   ASCII    Report file summarizing input and output emissions for QA purposes
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------
  [Prev](ch06s09s02.html)     [Up](ch06s09.html)     [Next](ch06s10.html)
  6.9.2. Processing Order     [Home](index.html)        6.10. **Mrggrid**
  -------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.10. **Mrggrid**
:::

[Prev](ch06s09s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s10s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_mrggrid}6.10. **Mrggrid** {#mrggrid .title style="clear: both"}
-------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.10.1. Description](ch06s10.html#d0e26735)]{.section}

[[6.10.2. Processing Order](ch06s10s02.html)]{.section}

[[6.10.3. Files and Environment Variables](ch06s10s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e26735}6.10.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} all

The purpose of the **Mrggrid** program is to combine gridded emission
data files, which can be speciated or nonspeciated, and hourly or
time-independent. It can combine any number of 3-D emissions files with
any number of 2-D emissions files. In fact, this program will work with
any I/O API NetCDF gridded files and need not be used only for emissions
files. The program merges whatever data variables are in the input
files. These files can each have different sets of data variables;
**Mrggrid** will sum values only for each variable that is common to two
or more files.

**Mrggrid** checks several features of the input files to ensure that
the data in these files are appropriate to be merged together. All input
files must have use the same time step. **Mrggrid** compares the units
of the variables with the same name and it creates an error message when
the units are not identical. It is not sufficient to have units that are
the same in meaning but different in syntax. For example, although
tons/hour and tons/hr represent the same units, **Mrggrid** will not
recognize this because of the different syntax. The user must resolve
unit discrepancies before running the program. In addition, **Mrggrid**
compares the horizontal grid settings across all 2-D and 3-D files, and
these settings must be identical in all respects (e.g., number of cells,
grid cell size, grid projection). Finally, **Mrggrid** checks the layer
structures across multiple 3-D files. The 3-D files can have a different
number of layers, as long as any layer common to two or more files has
the same thickness in each of the files; **Mrggrid** also checks the I/O
API type of vertical structures and top height, and these must be
identical across all 3-D files.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- ---------------------------
  [Prev](ch06s09s03.html)                     [Up](ch06.html)        [Next](ch06s10s02.html)
  6.9.3. Files and Environment Variables     [Home](index.html)     6.10.2. Processing Order
  ----------------------------------------- -------------------- ---------------------------
:::
::: {.navheader}
6.10.2. Processing Order
:::

[Prev](ch06s10.html) 

6.10. **Mrggrid**

 [Next](ch06s10s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e26769}6.10.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Mrggrid** can be used with any gridded output files from **Smkmerge**.
It can also be used with other I/O API NetCDF gridded files produced
outside of SMOKE.

Output files from **Mrggrid** are usually moodel-ready input files that
will be used in running an AQM.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s10.html)     [Up](ch06s10.html)                     [Next](ch06s10s03.html)
  6.10. **Mrggrid**        [Home](index.html)     6.10.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.10.3. Files and Environment Variables
:::

[Prev](ch06s10s02.html) 

6.10. **Mrggrid**

 [Next](ch06s11.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e26784}6.10.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.10.3.1. Input Files](ch06s10s03.html#d0e26815)]{.section}

[[6.10.3.2. Input Environment
Variables](ch06s10s03.html#d0e26887)]{.section}

[[6.10.3.3. Output Files](ch06s10s03.html#d0e26946)]{.section}
:::

::: {.figure}
[]{#fig_programs_mrggrid}

**Figure 6.10. Mrggrid input and output files**

::: {.mediaobject}
![Mrggrid input and output files](images\programs\mrggrid_html.jpg)
:::
:::

[Figure 6.10, "Mrggrid input and output
files"](ch06s10s03.html#fig_programs_mrggrid "Figure 6.10. Mrggrid input and output files")
shows the input and output files for the **Mrggrid** program. The input
file is simply a list of the logical file names for the files to be
merged (`FILELIST`{.envar}). The program outputs a log file
(`LOGFILE`{.envar}), a gridded, optionally layered, optionally hourly
emissions file (`OUTFILE`{.envar}), and if merging different days, a
report file (`REPMRGGRID`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e26815}6.10.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
+-----------------------+--------+-----------------------------+
| File Name             | Format | Description                 |
+=======================+========+=============================+
| `FILELIST`{.envar}    | ASCII  | List of                     |
|                       |        | [*logical*]{.emphasis} file |
|                       |        | name for 2-D and 3-D        |
|                       |        | gridded I/O API NetCDF      |
|                       |        | files; this file cannot     |
|                       |        | contain the full paths and  |
|                       |        | file names. Users should    |
|                       |        | make sure that the logical  |
|                       |        | file names that appear in   |
|                       |        | `FILELIST`{.envar} are      |
|                       |        | defined prior to running    |
|                       |        | **Mrggrid**.                |
+-----------------------+--------+-----------------------------+
| `ADJ_FACS`{.envar}    | ASCII  | File that lists the species |
|                       |        | name, the logical file      |
| (optional)            |        | name, and the factor to be  |
|                       |        | applied to all grid cells.  |
|                       |        | The species name must be in |
|                       |        | columns A, the logical file |
|                       |        | name in column B, and the   |
|                       |        | factor in columns C. SMOKE  |
|                       |        | will ignore the case of the |
|                       |        | text, treating lower- and   |
|                       |        | uppercase characters as if  |
|                       |        | they were the same. For     |
|                       |        | example, the following      |
|                       |        | `ADJ_FACS`{.envar} file     |
|                       |        | sample would multiply NO    |
|                       |        | emissions from the MGTS\_L  |
|                       |        | file by 1.3 (30% increase)  |
|                       |        | and multiply PAR from the   |
|                       |        | PGTS\_L file by 0.6 (40%    |
|                       |        | decrease).                  |
|                       |        |                             |
|                       |        | ``` {.programlisting}       |
|                       |        | NO, MGTS_L, 1.3             |
|                       |        | PAR, PGTS_L, 0.6            |
|                       |        | ```                         |
+-----------------------+--------+-----------------------------+
| `TAG_SPECIES`{.envar} | ASCII  | File that lists the logical |
|                       |        | file name, the species      |
| (optional)            |        | name, and the tag name to   |
|                       |        | be appended. The logical    |
|                       |        | file name in column B, the  |
|                       |        | species name must be in     |
|                       |        | columns B, and the factor   |
|                       |        | in columns C. SMOKE will    |
|                       |        | ignore the case of the      |
|                       |        | text, treating lower- and   |
|                       |        | uppercase characters as if  |
|                       |        | they were the same. For     |
|                       |        | example, the following      |
|                       |        | `TAG_SPECIES`{.envar} file  |
|                       |        | sample would append a tag   |
|                       |        | (t1) to the NO species from |
|                       |        | the MGTS\_L file and append |
|                       |        | a tag (t3) to the PAR from  |
|                       |        | the PGTS\_L file.           |
|                       |        |                             |
|                       |        | ``` {.programlisting}       |
|                       |        | MGTS_L, NO,  t1             |
|                       |        | PGTS_L, PAR, t3             |
|                       |        | ```                         |
+-----------------------+--------+-----------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e26887}6.10.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `MRG_DIFF_DAYS`{.envar}: \[default: N\]

    This environment variable allows **Mrggrid** to merge files with
    data from different days.

    ::: {.itemizedlist}
    -   Y: Allow data from different dates to be merged together

        **Mrggrid** will use the environment variables
        `G_STDATE`{.envar}, `G_STTIME`{.envar}, `G_RUNLEN`{.envar}, and
        `G_TSTEP`{.envar} to set the start date, start time, length, and
        time step of the output file. All input files must have the same
        starting time as `G_STTIME`{.envar}, the same time step as
        `G_TSTEP`{.envar}, and must contain more than `G_RUNLEN`{.envar}
        steps of data. For each input file, if it contains data to cover
        the actual episode requested by `G_STDATE`{.envar},
        `G_STTIME`{.envar}, and `G_RUNLEN`{.envar}, then the data for
        the actual episode will be used; otherwise, data starting at the
        first time step of the file will be used.

    -   N: Require all merged data to be from the same date

        **Mrggrid** will determine the output file time period based on
        the latest starting input file and the earliest ending input
        file.
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e26946}6.10.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                Format           Description
  ------------------------ ---------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `LOGFILE`{.envar}        ASCII            Log generated from executing **Mrggrid**
  `OUTFILE`{.envar}        I/O API NetCDF   Gridded, optionally layered, optionally hourly emission file
  `REPMRGGRID`{.envar}     ASCII            Report file generated when `MRG_DIFF_DAYS`{.envar} is set to Y; the report lists the date and time for each output time step along with the actual date and time of the data read from each file
  `REPMERG_ADJ`{.envar}    ASCII            Report file generated when `ADJ_FACS`{.envar} is set; the report lists the date, the logical file name, the species name, the factor applied, a daily total of species before and after applying adjustment factor, and the ratio (after/ratio). The report only lists when the ratio is not equal to 1.0
  `REPMERGE_SUM`{.envar}   ASCII            Report file generated when `ADJ_FACS`{.envar} is set; the report lists the date, the species name, a daily total of species over all the logical files before and after applying adjustment factors, and the ratio (after/ratio). The report only lists when the ratio is not equal to 1.0
  `REPMERGE_TAG`{.envar}   ASCII            Report file generated when `TAG_SPECIES`{.envar} is set; the report lists the logical files name, species name before and after appending the tag
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------
  [Prev](ch06s10s02.html)      [Up](ch06s10.html)     [Next](ch06s11.html)
  6.10.2. Processing Order     [Home](index.html)          6.11. **Mrgpt**
  --------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.11. **Mrgpt**
:::

[Prev](ch06s10s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s11s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_mrgpt}6.11. **Mrgpt** {#mrgpt .title style="clear: both"}
---------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.11.1. Description](ch06s11.html#d0e27030)]{.section}

[[6.11.2. Processing Order](ch06s11s02.html)]{.section}

[[6.11.3. Files and Environment Variables](ch06s11s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27030}6.11.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} Point

The purpose of the **Mrgpt** program is to combine inline-mode
model-ready multiple point speciated hourly emission data files (not
gridded) created by **Smkmerge** and ASCII elevated files created by
**Elevpoint**. The program merges whatever data variables are in the
input files. These files can each have different sets of data variables;
**Mrgpt** will sum values only for each variable that is common to two
or more files.

**Mrgpt** checks several features of the input files to ensure that the
data in these files are appropriate to be merged together. All input
files must have use the same time step. **Mrgpt** compares the units of
the variables with the same name and it creates an error message when
the units are not identical. It is not sufficient to have units that are
the same in meaning but different in syntax. For example, although
tons/hour and tons/hr represent the same units, **Mrggrid** will not
recognize this because of the different syntax. The user must resolve
unit discrepancies before running the program.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------
  [Prev](ch06s10s03.html)                      [Up](ch06.html)        [Next](ch06s11s02.html)
  6.10.3. Files and Environment Variables     [Home](index.html)     6.11.2. Processing Order
  ------------------------------------------ -------------------- ---------------------------
:::
::: {.navheader}
6.11.2. Processing Order
:::

[Prev](ch06s11.html) 

6.11. **Mrgpt**

 [Next](ch06s11s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27061}6.11.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Mrgpt** can be used with any hourly speciated emissions from
**Smkmerge** and any ASCII elevated output files from **Elevpoint**.

Output files from **Mrgpt** are inline-model model-ready input files
that will be used in running an AQM.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s11.html)     [Up](ch06s11.html)                     [Next](ch06s11s03.html)
  6.11. **Mrgpt**          [Home](index.html)     6.11.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.11.3. Files and Environment Variables
:::

[Prev](ch06s11s02.html) 

6.11. **Mrgpt**

 [Next](ch06s12.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27079}6.11.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.11.3.1. Input Files](ch06s11s03.html#d0e27122)]{.section}

[[6.11.3.2. Input Environment
Variables](ch06s11s03.html#d0e27190)]{.section}

[[6.11.3.3. Output Files](ch06s11s03.html#d0e27249)]{.section}
:::

::: {.figure}
[]{#fig_programs_mrgpt}

**Figure 6.11. Mrgpt input and output files**

::: {.mediaobject}
![Mrgpt input and output files](images\programs\mrgpt_html.jpg)
:::
:::

[Figure 6.11, "Mrgpt input and output
files"](ch06s11s03.html#fig_programs_mrgpt "Figure 6.11. Mrgpt input and output files")
shows the input and output files for the **Mrgpt** program. The input
files are a list of the logical file names for the speciated hourly
emissions files from **Smkmerge** to be merged (`FILELIST_INLN`{.envar})
and a list of the logical file names for the ASCII elevated output files
from **Elevpoint** to be merged (`FILELIST_STACK`{.envar}). The program
outputs a log file (`LOGFILE`{.envar}), a merged specated hourly
emissions file (`OUTFILE_INLN`{.envar}), a merged ASCII elevated output
file (`OUTFILE_STACK`{.envar}), and if merging different days, a report
file (`REPMRGGRID`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e27122}6.11.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
+--------------------------+--------+-----------------------------+
| File Name                | Format | Description                 |
+==========================+========+=============================+
| `FILELIST_INLN`{.envar}  | ASCII  | List of                     |
|                          |        | [*logical*]{.emphasis} file |
|                          |        | name for hourly speciated   |
|                          |        | I/O API NetCDF files; this  |
|                          |        | file cannot contain the     |
|                          |        | full paths and file names.  |
|                          |        | Users should make sure that |
|                          |        | the logical file names that |
|                          |        | appear in                   |
|                          |        | `FILELIST_INLN`{.envar} are |
|                          |        | defined prior to running    |
|                          |        | **Mrgpt**.                  |
+--------------------------+--------+-----------------------------+
| `FILELIST_STACK`{.envar} | ASCII  | List of                     |
|                          |        | [*logical*]{.emphasis} file |
|                          |        | name for ASCII elevated     |
|                          |        | output files; this file     |
|                          |        | cannot contain the full     |
|                          |        | paths and file names. Users |
|                          |        | should make sure that the   |
|                          |        | logical file names that     |
|                          |        | appear in                   |
|                          |        | `FILELIST_STACK`{.envar}    |
|                          |        | are defined prior to        |
|                          |        | running **Mrgpt**.          |
+--------------------------+--------+-----------------------------+
| `ADJ_FACS`{.envar}       | ASCII  | File that lists the species |
|                          |        | name, the logical file      |
| (optional)               |        | name, and the factor to be  |
|                          |        | applied to all grid cells.  |
|                          |        | The species name must be in |
|                          |        | columns A, the logical file |
|                          |        | name in column B, and the   |
|                          |        | factor in columns C. SMOKE  |
|                          |        | will ignore the case of the |
|                          |        | text, treating lower- and   |
|                          |        | uppercase characters as if  |
|                          |        | they were the same. For     |
|                          |        | example, the following      |
|                          |        | `ADJ_FACS`{.envar} file     |
|                          |        | sample would multiply NO    |
|                          |        | emissions from the          |
|                          |        | PTIPMTS\_L\_INLN file by    |
|                          |        | 1.3 (30% increase) and      |
|                          |        | multiply PAR from the       |
|                          |        | PTNONIPMTS\_L\_INLN file by |
|                          |        | 0.6 (40% decrease).         |
|                          |        |                             |
|                          |        | ``` {.programlisting}       |
|                          |        | NO, PTNONIPMTS_L_INLN, 1.3  |
|                          |        | PAR, PTIPMTS_L_INLN, 0.6    |
|                          |        | ```                         |
+--------------------------+--------+-----------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e27190}6.11.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `MRG_DIFF_DAYS`{.envar}: \[default: N\]

    This environment variable allows **Mrgpt** to merge files with data
    from different days.

    ::: {.itemizedlist}
    -   Y: Allow data from different dates to be merged together

        **Mrgpt** will use the environment variables `G_STDATE`{.envar},
        `G_STTIME`{.envar}, `G_RUNLEN`{.envar}, and `G_TSTEP`{.envar} to
        set the start date, start time, length, and time step of the
        output file. All input files must have the same starting time as
        `G_STTIME`{.envar}, the same time step as `G_TSTEP`{.envar}, and
        must contain more than `G_RUNLEN`{.envar} steps of data. For
        each input file, if it contains data to cover the actual episode
        requested by `G_STDATE`{.envar}, `G_STTIME`{.envar}, and
        `G_RUNLEN`{.envar}, then the data for the actual episode will be
        used; otherwise, data starting at the first time step of the
        file will be used.

    -   N: Require all merged data to be from the same date

        **Mrgpt** will determine the output file time period based on
        the latest starting input file and the earliest ending input
        file.
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e27249}6.11.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                 Format           Description
  ------------------------- ---------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `LOGFILE`{.envar}         ASCII            Log generated from executing **Mrgpt**
  `OUTFILE_INLN`{.envar}    I/O API NetCDF   Merged inline-mode hourly speciated emission file
  `OUTFILE_STACK`{.envar}   ASCII            Merged inline-mode ASCII point elevated file
  `REPMRGGRID`{.envar}      ASCII            Report file generated when `MRG_DIFF_DAYS`{.envar} is set to Y; the report lists the date and time for each output time step along with the actual date and time of the data read from each file
  `REPMERG_ADJ`{.envar}     ASCII            Report file generated when `ADJ_FACS`{.envar} is set; the report lists the date, the logical file name, the species name, the factor applied, a daily total of species before and after applying adjustment factor, and the ratio (after/ratio). The report only lists when the ratio is not equal to 1.0
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------
  [Prev](ch06s11s02.html)      [Up](ch06s11.html)     [Next](ch06s12.html)
  6.11.2. Processing Order     [Home](index.html)      6.12. **Normbeis3**
  --------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.12. **Normbeis3**
:::

[Prev](ch06s11s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s12s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_normbeis3}6.12. **Normbeis3** {#normbeis3 .title style="clear: both"}
-----------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.12.1. Description](ch06s12.html#d0e27319)]{.section}

[[6.12.2. Processing Order](ch06s12s02.html)]{.section}

[[6.12.3. Files and Environment Variables](ch06s12s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27319}6.12.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} biogenic

**Normbeis3** reads gridded land use data and emissions factors and
produces gridded normalized biogenic emissions. **Normbeis3** is the
first program in the SMOKE-BEIS3 model. The gridded land use includes
various number of land use types. Emissions factors are provided for
each land use type. The output gridded domain is the same as the input
domain for the land use data. Emission fluxes are normalized to 30 °C,
and isoprene and methyl-butenol fluxes are also normalized to a
photosynthetic active radiation (PAR) of 1000 µmol/m^2^s. **Normbeis3**
also computes normalized emissions for winter months, using a winter
factor read in from the emissions factor table.

For BEIS version 3.14 and 3.60, **Normbeis3** outputs winter and summer
normalized emissions for the 35 species/compounds (including 14
monoterpenes and 1 sesquiterpene) listed below, as well as winter and
summer leaf area indices (LAI). The output units for NO are grams of
nitrogen per hour; the output units for LAI are meters squared per
meters squared; the units for all other species/compounds are grams of
carbon per hour.

::: {.informaltable}
  Variable Name   Description
  --------------- ------------------------------------
  ISOP            Isoprene
  MBO             2-methyl-3-buten-2-ol
  METH            Methanol
  ETHE            Ethene
  PROPE           Propene
  ETHO            Ethanol
  ACET            Acetone
  HEXA            Hexanal
  HEXE            Hexenol
  HEXY            Hexenylacetate
  FORM            Formaldehyde
  ACTAL           Acetaldehyde
  BUTE            Butene
  ETHA            Ethane
  FORAC           Formic acid
  ACTAC           Acetic acid
  BUTO            Butenone (aka methyl vinyl ketone)
  CO              Carbon monoxide
  ORVOC           Other reactive VOCs
  NO              Nitric oxide
  LAI             Leaf area indices
  SESQT           Sesquiterpene
  MONO            [*Monoterpenes*]{.emphasis}
  APIN            Alpha-pinene
  BPIN            Beta-pinene
  D3CAR           Delta-3-carene
  DLIM            D-limonene
  CAMPH           Camphene
  MYRC            Myrcene
  ATERP           Alpha-terpinene
  BPHE            Beta-phellandrene
  SABI            Sabinene
  PCYM            P-cymene
  OCIM            Ocimene
  ATHU            Alpha-thujene
  TRPO            Terpinolene
  GTERP           Gamma-terpinene
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------
  [Prev](ch06s11s03.html)                      [Up](ch06.html)        [Next](ch06s12s02.html)
  6.11.3. Files and Environment Variables     [Home](index.html)     6.12.2. Processing Order
  ------------------------------------------ -------------------- ---------------------------
:::
::: {.navheader}
6.12.2. Processing Order
:::

[Prev](ch06s12.html) 

6.12. **Normbeis3**

 [Next](ch06s12s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27542}6.12.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Normbeis3** is the first program for processing biogenic emissions
using the SMOKE-BEIS3 prototype. **Normbeis3** must be executed before
**Tmpbeis3**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s12.html)     [Up](ch06s12.html)                     [Next](ch06s12s03.html)
  6.12. **Normbeis3**      [Home](index.html)     6.12.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.12.3. Files and Environment Variables
:::

[Prev](ch06s12s02.html) 

6.12. **Normbeis3**

 [Next](ch06s13.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27555}6.12.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.12.3.1. Input Files](ch06s12s03.html#d0e27618)]{.section}

[[6.12.3.2. Input Environment
Variables](ch06s12s03.html#d0e27697)]{.section}

[[6.12.3.3. Output Files](ch06s12s03.html#d0e27702)]{.section}
:::

::: {.figure}
[]{#fig_programs_normbeis3}

**Figure 6.12. Normbeis3 input and output files for BEIS v3.14**

::: {.mediaobject}
![Normbeis3 input and output files for BEIS
v3.14](images\programs\normbeis3_html.jpg)
:::
:::

[Figure 6.13, "Normbeis3 input and output files for BEIS
v3.60"](ch06s12s03.html#fig_programs_normbeis360 "Figure 6.13. Normbeis3 input and output files for BEIS v3.60")
shows the input and output files for the **Normbeis3** program for BEIS
v3.14. The input files are the emission factors file (`B3FAC`{.envar}),
the gridded land use file for the first 120 land use types
(`BELD3_A`{.envar}), the gridded land use types for the next 110 types
(`BELD3_B`{.envar}), and the land use totals data file
(`BELD3_TOT`{.envar}).

::: {.figure}
[]{#fig_programs_normbeis360}

**Figure 6.13. Normbeis3 input and output files for BEIS v3.60**

::: {.mediaobject}
![Normbeis3 input and output files for BEIS
v3.60](images\programs\normbeis360_html.jpg)
:::
:::

[Figure 6.12, "Normbeis3 input and output files for BEIS
v3.14"](ch06s12s03.html#fig_programs_normbeis3 "Figure 6.12. Normbeis3 input and output files for BEIS v3.14")
shows the input and output files for the **Normbeis3** program for BEIS
v3.60. The input files are the emission factors file
(`B360FAC`{.envar}), the gridded land use file for the first 286 land
use types (`BELD4`{.envar}).

**Normbeis3** outputs a gridded, normalized biogenic emissions file
(`B3GRD`{.envar}) and a log file (`LOGFILE`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e27618}6.12.3.1. Input Files {#input-files .title}

</div>

</div>
:::

Gridded land use data can be created using GIS software, such as
ArcInfo. Another tool that can be used to generate gridded land use data
is the SMOKE Tool in Models-3 (see Models-3 documentation). The typical
database used to generate the `BELD3_A`{.envar}, `BELD3_B`{.envar}, and
`BELD3_TOT`{.envar} files is the BELD3. Future versions of SMOKE may
include a method for creating land use files for use with **Normbeis3**.

::: {.informaltable}
  File Name             Format           Description
  --------------------- ---------------- ------------------------------------------------------------
  `B3FAC`{.envar}       ASCII            Emission factors file for BEIS v3.14
  `BELD3_A`{.envar}     I/O API NetCDF   Gridded land use (first 120 land use types) for BEIS v3.14
  `BELD3_B`{.envar}     I/O API NetCDF   Gridded land use (last 110 land use types) for BEIS v3.14
  `BELD3_TOT`{.envar}   I/O API NetCDF   Land use totals data for BEIS v3.14
  `B360FAC`{.envar}     ASCII            Emission factors file for BEIS v3.60
  `BELD4`{.envar}       ASCII            Gridded 286 land use for BEIS v3.60
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e27697}6.12.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

None
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e27702}6.12.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `B3GRD`{.envar}     I/O API NetCDF   Gridded, normalized biogenic emissions (in grams of carbon or nitrogen per hour, depending on the species) and LAI: contains both summer and winter normalized emissions
  `LOGFILE`{.envar}   ASCII            Log generated from executing **Normbeis3**
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------
  [Prev](ch06s12s02.html)      [Up](ch06s12.html)     [Next](ch06s13.html)
  6.12.2. Processing Order     [Home](index.html)       6.13. **Smkinven**
  --------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.13. **Smkinven**
:::

[Prev](ch06s12s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s13s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_smkinven}6.13. **Smkinven** {#smkinven .title style="clear: both"}
---------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.13.1. Description](ch06s13.html#d0e27742)]{.section}

[[6.13.2. Processing Order](ch06s13s02.html)]{.section}

[[6.13.3. Files and Environment Variables](ch06s13s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27742}6.13.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} area, mobile, point

**Smkinven** reads in the raw input data, sorts the records, and creates
the SMOKE inventory files that are required by most of the SMOKE
programs. The program is run separately for area-, mobile-, and
point-source processing. **Smkinven** reads annual, average-day,
day-specific, and hour-specific inventory files. The annual and
average-day inventory data are combined into a single inventory. The
output also indicates whether the data started out as annual or
average-day data; such "[temporal origin]{.quote}" information is needed
by the **Temporal** program to determine whether to apply monthly
adjustments. **Smkinven** can also import gridded one-layer annual or
average-day emissions in I/O API NetCDF or CF-compliant NetCDF format as
an area sourc.

**Smkinven** writes several SMOKE inventory files for each source
category: an ASCII file containing all character-string fields from the
inventory, individual I/O API NetCDF files containing emissions data for
each output pollutant, and an ASCII map file listing the names and
locations of each file. The character string fields cannot be stored in
the I/O API NetCDF file because of limitations of the I/O API library.
When day-specific and hour-specific data are available (this applies
only for point sources), **Smkinven** can also read these data, and
produce separate I/O API NetCDF files for each data type (day-specific
or hour-specific).

**Smkinven** supports the following input file formats and source
categories:

::: {.itemizedlist}
-   SMOKE one-record-per-line (ORL) format for nonpoint, nonroad mobile,
    on-road mobile, and point sources

-   SMOKE one-record-per-line (ORL) format for fire point sources
    (modified to support wildfires and prescribed fires characteristics
    and pollutants)

-   Special mobile link format

-   FF10 (Flat File 10) format for many different source categories
    including day-specific, hour-specific, monthly and annual for
    nonpoint, nonroad mobile, on-road mobile, and point sources (comma
    or semicolon delimited)

-   ASCII Continuous Emissions Monitoring (CEM) format (hour-specific
    point-source emissions)

-   List format (for combining multiple files of the same or compatible
    formats) for area, mobile, and point

-   LIST GRID format (for reading multiple gridded one-layer annual
    CF-compliant NetCDF inventory data) as area sources

-   Gridded one-layer annual or average-day NetCDF I/O API or
    CF-compliant NetCDF emissions data (must be treated as an area
    source)
:::

It is not possible to import only day- or hour-specific data from FF10
input files. If only such data are to be used, mock annual files must be
created; see [Section 8.2.6, "`PTDAY`{.envar}: Point source day-specific
emissions"](ch08s02s06.html "8.2.6. PTDAY: Point source day-specific emissions")
and [Section 8.2.7, "`PTHOUR`{.envar}: Point source hour-specific
emissions"](ch08s02s07.html "8.2.7. PTHOUR: Point source hour-specific emissions")
for more information on the required formats.

The list format is simply a list of file names with paths with a special
format identifier that allows all files in the list to be processed
together. To use a list format, all input files must have the same or
compatible formats.

The list grid format is simply a list of CF-compliant NetCDF file names
with paths with a special format identifier that allows all files in the
list to be processed together. To use a list grid format, all input
files must have the same or compatible formats with inventory data from
the same year.

When using CEM data, you are encouraged to preprocess your data to
prepare them down to the dates and/or sources in the domain. The sources
in the grid will be selected based on matching to the inventory (if the
inventory is for only states within the modeling grid) and/or by the
**Grdmat** program, which will remove sources outside the grid from the
model-ready results.

**Smkinven** also can process the hourly CEM data in a more
sophisticated way. Hourly heat input from the CEM data are used to
allocate annual emissons to hourly emission data. More information are
available at ([Section 5.3.4,
"**CEMScan**"](ch05s03s04.html "5.3.4. CEMScan")) and ([Section 2.9,
"Inventory import"](ch02s09.html "2.9. Inventory import"))

If new sources are added to the input files or sources are removed,
**Smkinven** must be rerun for that type of source. However,
**Smkinven** does not need to be rerun when processing additional
control scenarios, growth projections, speciation profiles, or modeling
grids.

By default, **Smkinven** will fill in missing average-day data with
annual data when possible. To fill in missing annual data with
average-day data, use the `FILL_ANNUAL`{.envar} setting.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------
  [Prev](ch06s12s03.html)                      [Up](ch06.html)        [Next](ch06s13s02.html)
  6.12.3. Files and Environment Variables     [Home](index.html)     6.13.2. Processing Order
  ------------------------------------------ -------------------- ---------------------------
:::
::: {.navheader}
6.13.2. Processing Order
:::

[Prev](ch06s13.html) 

6.13. **Smkinven**

 [Next](ch06s13s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27851}6.13.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smkinven** must be run for a given processing type (i.e., area,
mobile, point) before any other SMOKE programs for that processing type
can be run.

When processing CEM data, the utility program **CEMScan** must be run
before **Smkinven**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s13.html)     [Up](ch06s13.html)                     [Next](ch06s13s03.html)
  6.13. **Smkinven**       [Home](index.html)     6.13.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.13.3. Files and Environment Variables
:::

[Prev](ch06s13s02.html) 

6.13. **Smkinven**

 [Next](ch06s14.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e27866}6.13.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.13.3.1. Input Files](ch06s13s03.html#d0e28053)]{.section}

[[6.13.3.2. Input Environment
Variables](ch06s13s03.html#sect_programs_smkinven_envar)]{.section}

[[6.13.3.3. Output Files](ch06s13s03.html#d0e28876)]{.section}
:::

::: {.figure}
[]{#fig_programs_smkinven_area}

**Figure 6.14. Smkinven input and output files for area sources**

::: {.mediaobject}
![Smkinven input and output files for area
sources](images\programs\smkinven_area_html.jpg)
:::
:::

[Figure 6.14, "Smkinven input and output files for area
sources"](ch06s13s03.html#fig_programs_smkinven_area "Figure 6.14. Smkinven input and output files for area sources")
shows the input and output files for **Smkinven** for area sources. If
importing gridded data, **Smkinven** reads the `AG`{.envar} file; for
the annual inventory, **Smkinven** reads the `ARINV`{.envar} file. The
`ARTOPNT`{.envar} file is used to assign point-source locations to area
sources, and either the `COSTCY`{.envar} or `GEOCODE_LEVEL4`{.envar}
file is used to assign time zones to the annual inventory data.
**Smkinven** also uses the inventory data table (`INVTABLE`{.envar}),
the optional NONHAP exclusions file (`NHAPEXCLUDE`{.envar}), and the SCC
description file (`SCCDESC`{.envar}) if processing area-to-point
sources.

**Smkinven** outputs an annual and average-day inventory emissions file
(`AREA`{.envar}), a file listing the inventory SCCs (`ASCC`{.envar}), a
log file (`LOGFILE`{.envar}), and a report containing various
information about the processed inventory (`REPINVEN`{.envar}).

::: {.figure}
[]{#fig_programs_smkinven_mobile}

**Figure 6.15. Smkinven input and output files for mobile sources**

::: {.mediaobject}
![Smkinven input and output files for mobile
sources](images\programs\smkinven_mobile_html.jpg)
:::
:::

[Figure 6.15, "Smkinven input and output files for mobile
sources"](ch06s13s03.html#fig_programs_smkinven_mobile "Figure 6.15. Smkinven input and output files for mobile sources")
shows the input and output files for **Smkinven** for mobile sources.
The input files include the country, state and county codes file
(`COSTCY`{.envar}), the inventory data table (`INVTABLE`{.envar}), the
raw inventory file (`MBINV`{.envar}), and the SCC reference input file
(`SCCXREF`{.envar}) created by
[`Gen_8digit_scc.pl`{.envar}](ch05s02s04.html#sect_moves_gen_sccxref "5.2.4.3. gen_8digit_scc.pl").

**Smkinven** outputs a log file (`LOGFILE`{.envar}), an annual and
average-day inventory emissions file (`MOBL`{.envar}), a file listing
the inventory SCCs (`MSCC`{.envar}), and a report containing various
information about the processed inventory (`REPINVEN`{.envar}).

::: {.figure}
[]{#fig_programs_smkinven_point}

**Figure 6.16. Smkinven input and output files for point sources**

::: {.mediaobject}
![Smkinven input and output files for point
sources](images\programs\smkinven_point_html.jpg)
:::
:::

[Figure 6.16, "Smkinven input and output files for point
sources"](ch06s13s03.html#fig_programs_smkinven_point "Figure 6.16. Smkinven input and output files for point sources")
shows the input and output files for **Smkinven** for point sources. The
input files include the optional CEM summary file (`CEMSUM`{.envar})
created by **CEMScan**, the country, state and county codes file
(`COSTCY`{.envar}), the inventory data table (`INVTABLE`{.envar}), and
the optional NONHAP exclusions file (`NHAPEXCLUDE`{.envar}). If
importing hour-specific data, the ORIS facility description file
`ORISDESC`{.envar} is used. The `PSTK`{.envar} file provides replacement
stack parameters. Day-specific data is read from the `PTDAY`{.envar}
file, while hour-specific data comes from the `PTHOUR`{.envar} file; the
`PTINV`{.envar} file provides the raw inventory data. For hour-specific
data, the SCC description file (`SCCDESC`{.envar}) is also needed.

**Smkinven** outputs a log file (`LOGFILE`{.envar}), and optional
day-specific inventory (`PDAY`{.envar}), and an optional hour-spceific
inventory (`PHOUR`{.envar}). The annual and average-day inventory
emissions are stored in the `PNTS`{.envar} file and the `PSCC`{.envar}
file lists the inventory SCCs. Finally, the `REPINVEN`{.envar} report
contains various information about the processed inventory.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e28053}6.13.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                                                Format           Source Type   Description
  -------------------------------------------------------------------------------------------------------- ---------------- ------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `AG`{.envar} (optional)                                                                                  I/O API NetCDF   A             Gridded annual or average-day data; this file can be created by **Smkmerge** and must be time-independent
  `[AR|MB|PT]INV`{.envar}                                                                                  ASCII            A, M, P       Annual and average-day emissions and source characteristics raw inventory data
  `ARTOPNT`{.envar} (optional)                                                                             ASCII            A             Area-to-point cross-reference file for assigning X and Y locations to area sources
  `CEMSUM`{.envar} (optional)                                                                              ASCII            P             CEM summary data produced by **CEMScan**
  `COSTCY`{.envar}                                                                                         ASCII            A, M, P       Country, state, and county codes file, with time zones
  [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")   ASCII            A, B, M, P    Geographical level codes and descriptions for gridded inventories, only when USE\_EXP\_GEO\_CODES is set to Y, (COSTCY is ignored when [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files") files are used)
  `GRIDMASK`{.envar}                                                                                       I/O API NetCDF   A, B, M, P    Defines an integer geocode to specify the predominant country and state code covered by each grid cell (`GEOCODE_LEVEL`{.envar}) and an integer `TZONES`{.envar} to specify the predominant Time Zone for each grid cell.
  `INVTABLE`{.envar}                                                                                       ASCII            A, M, P       Inventory data table listing pollutant and activity names
  `NHAPEXCLUDE`{.envar} (optional)                                                                         ASCII            A, M, P       List of counties and SCCs to exclude from toxics integration
  `ORISDESC`{.envar} (optional)                                                                            ASCII            P             ORIS facility descriptions, needed for getting ORIS facility names for reporting purposes when CEM hour-specific data are read
  `PSTK`{.envar}                                                                                           ASCII            P             Replacement stack parameters file
  `PTDAY`{.envar} (optional)                                                                               ASCII            P             Day-specific raw inventory data
  `PTHOUR`{.envar} (optional)                                                                              ASCII            P             Hour-specific raw inventory data
  `SCCDESC`{.envar} (optional)                                                                             ASCII            P             SCC descriptions, needed for reading CEM hour-specific data only, to select electric generator facilities in the inventory
  `SCCXREF`{.envar} (optional)                                                                             ASCII            M             SCC cross reference input file created by [`Gen_8digit_scc.pl`{.envar}](ch05s02s04.html#sect_moves_gen_sccxref "5.2.4.3. gen_8digit_scc.pl"). It maps aggregated mobile activity SCC8 to full SCC10.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_smkinven_envar}6.13.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `USE_EXP_GEO_CODES`{.envar}: \[default: N\]

    If set to Y then use GEOCODE\_LEVEL\[1-4\] files instead of the
    COSTCY file to define expanded geographical detail such as
    country-level(GEOCODE\_LEVEL1), country/state-level
    (GEOCODE\_LEVEL2), country/state/county-level (GEOCODE\_LEVEL3) or
    country/state/county/tribal-level (GEOCODE\_LEVEL4).

-   `ALLOW_NEGATIVE`{.envar}: \[default: N\]

    Indicates if **Smkinven** should permit negative emissions values to
    be input from inventory files and output to `SMOKE`{.envar}
    intermediate files.

    ::: {.itemizedlist}
    -   Y: Accept negative emissions values and will allow compute
        variables (from the `SMKINVEN_FORMULA`{.envar} variable) to be
        negative. **Smkinven** gives warnings for each negative value in
        the inventory input and each computed value, until triggering
        the `SMK_MAXWARNING`{.envar} setting\'s values.

    -   N: Do not permit negative emissions values. Accept negative
        emissions values in the input inventory files, and will give
        errors for these. **Smkinven** will reset all negative computed
        values (from the `SMKINVEN_FORMULA`{.envar} variable) to zero.
        **Smkinven** gives warnings for each negative computed value and
        indicates that the value was reset to zero.
    :::

-   `CHECK_STACKS_YN`{.envar}: \[default: Y\]

    Indicates if stack parameter values should be checked for missing or
    out-of-range values; only checked if `SMK_SOURCE`{.envar} is set
    to P.

    ::: {.itemizedlist}
    -   Y: Check input stack parameters for missing or out-of-range
        values

    -   N: Do not check input stack parameter values
    :::

-   `DAY_SPECIFIC_YN`{.envar}: \[default: N\]

    Defines whether to import day-specific inventory data.

    ::: {.itemizedlist}
    -   Y: Import day-specific data

    -   N: Do not import day-specific data
    :::

-   `EXCLUDE_REF_SCC_YN`{.envar}: \[default: N\]

    Defines whether to exclude a list of SCCs that are not listed in
    [Section 8.10.11, "`SCCXREF`{.envar}: Reference SCC input
    file"](ch08s10s11.html "8.10.11. SCCXREF: Reference SCC input file").
    This option is only applicable when `USE_REF_SCC_YN`{.envar} is set
    to Y.

    ::: {.itemizedlist}
    -   Y: Import day-specific data

    -   N: Do not import day-specific data
    :::

-   `FF10_AVEDAY_ANNINV_YN`{.envar}: \[default N\]

    Uses area daily or hourly FF10-formatted invenotry as annual data.
    This will allow users to process ARDAY or ARHOUR invenotry data
    independently without artifical annual inventory data.

    ::: {.itemizedlist}
    -   Y: Use daily or hourly FF10-formatted inventory as annual data.

    -   N: Do not use daily or hourly FF10-formatted inventory as annual
        data. Just it as daily or hourly FF10-formatted inventory data.
    :::

-   `FILL_ANNUAL`{.envar}: \[default N\]

    Allows annual data to be filled in with average-day data.

    ::: {.itemizedlist}
    -   Y: Use "[Y]{.quote}" when annual emission numbers are blank for
        some records of the inventory but not all records. The emissions
        values will be filled in using the average-day emissions field,
        by multiplying the average-day number by the number of days in
        the inventory year (365 or 366). This option is useful when some
        sources have only annual data and some sources have only
        average-day data. Although the annual number will be filled in
        using the average-day one, the average-day emissions will be
        output from SMOKE as a whole.

    -   N: Do not fill in annual data based on average-day emissions
        values.
    :::

-   `FLOW_RATE_FACTOR`{.envar}: \[default: 0.0 ft^3^/MMBTU\]

    Used to calculate hourly flow rates from hourly heat input when
    reading CEM data. If `FLOW_RATE_FACTOR`{.envar} is set to zero or
    unset, then **Smkinven** will not calculate hourly flow rates.
    Detail information is described in [Section 2.9.19, "Processing
    hour-specific CEM
    data"](ch02s09s19.html "2.9.19. Processing hour-specific CEM data")

    hourly flow rate (m^3^/s) = \[`FLOW_RATE_FACTOR`{.envar}
    (ft^3^/MMBTU) \* hourly heat input (MMBTU/hr) \* 0.02831
    m^3^/ft^3^\] / 3600 s/hr

-   `FULLSCC_ONLY`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables").
    In this context, this option affects cross-referencing for the
    `ARTOPNT`{.envar}, and `NHAPEXCLUDE`{.envar} files by preventing
    left-7 SCC assignments. It also prevents left-2 and left-4 SCC
    assignments for NHAPEXCLUDE.

-   `HOUR_SPECIFIC_YN`{.envar}: \[default: N\]

    Defines whether to import hour-specific inventory data.

    ::: {.itemizedlist}
    -   Y: Import hour-specific data

    -   N: Do not import hour-specific data
    :::

-   `HOURLY_TO_DAILY`{.envar}: \[default: N\]

    Defines whether to treat the hour-specific inputs as day-specific
    data.

    ::: {.itemizedlist}
    -   Y: Use daily-total column only from hour-specific input file,
        and process as day-specific data. [*This setting does not work
        for input of hour-specific data using CEM format.*]{.emphasis}

    -   N: Treat hourly file as hourly data
    :::

-   `HOURLY_TO_PROFILE`{.envar}: \[default: N\]

    Defines whether to treat the hour-specific inputs as hour-specific
    temporal profiles.

    ::: {.itemizedlist}
    -   Y: Treat hourly data as temporal profile, and divide each hourly
        value by value in the daily total column of the file. The values
        are not renormalized. The resulting hour-specific output file
        will be recognized by the **Temporal** program as containing
        hourly profiles. [*This setting does not work for input of
        hour-specific data using CEM format.*]{.emphasis}

    -   N: Treat hourly file as hourly data
    :::

-   `IMPORT_AVEINV_YN`{.envar}: \[default: Y\]

    Defines whether to import the annual and average-day inventory data.
    This is set to N to import day-specific or hour-specific data after
    **Smkinven** has previously been run for the annual and average-day
    data.

    ::: {.itemizedlist}
    -   Y: Import annual and average-day inventory data from
        `PTINV`{.envar} file

    -   N: Use SMOKE inventory files from a previous run of **Smkinven**
        to get the SMOKE source characteristics to match with the
        day-specific and hour-specific sources
    :::

-   `IMPORT_GRDIOAPI_YN`{.envar}: \[default: N\]

    Defines whether the program will import a gridded I/O API NetCDF
    inventory file. This setting can be used only with area-source
    processing, and it overrides all other program settings for
    importing data (e.g., day- and hour-specific data import will be
    shut off).

    ::: {.itemizedlist}
    -   Y: Import gridded I/O API data

    -   N: Do not import gridded I/O API data
    :::

-   `INVNAME1`{.envar}: \[default: none\]

    Sets root for naming output map inventory file

-   `INVNAME2`{.envar}: \[default: none\]

    Sets root for naming output ASCII inventory file

-   `MIN_STK_HEIGHT`{.envar}: \[default: 0.5\]

    Define minimum stack height in unit of meter

-   `MAX_STK_HEIGHT`{.envar}: \[default: 5100.0\]

    Define maximum stack height in unit of meter

-   `MIN_STK_DIAMETER`{.envar}: \[default: 0.01\]

    Define minimum stack diameter in unit of meter

-   `MAX_STK_DIAMETER`{.envar}: \[default: 100.0\]

    Define maximum stack diameter in unit of meter

-   `MIN_STK_TEMPERATURE`{.envar}: \[default: 260.0\]

    Define minimum stack exit temperature in unit of Kelvin

-   `MAX_STK_TEMPERATURE`{.envar}: \[default: 2000.0\]

    Define maximum stack exit temperature in unit of Kelvin

-   `MIN_STK_VELOCITY`{.envar}: \[default: 0.0001\]

    Define minimum stack exit velocity in unit of m/sec

-   `MAX_STK_VELOCITY`{.envar}: \[default: 0.0001\]

    Define maximum stack exit velocity in unit of m/sec

-   `NONHAP_TYPE`{.envar}: \[default: VOC\]

    Define the name of organic compound inventory pollutant VOC or TOG
    for a proper integration between VOC or TOG, and hazardous air
    pollutants (HAPs) to compute NONHAPVOC or NONHAPTOG. See
    [Section 2.9.5, "Combine toxics and criteria
    inventories"](ch02s09s05.html "2.9.5. Combine toxics and criteria inventories")
    for a more detail description of criteria/HAP VOC integration. This
    option will be used only when `SMK_PROCESS_HAPS`{.envar} is set.

-   `NO_STACK_REPLACE_FUGITIVE`{.envar}: \[default: N\]

    Defines whether the program skips correcting any missing and/or
    out-of-range stack parameters.

    ::: {.itemizedlist}
    -   Y: Skip correcting any missing and/or out-of-range stack
        parameters

    -   N: Do not skip correcting any missing and/or out-of-range stack
        parameters
    :::

-   `OUTPUT_LOCAL_TIME`{.envar}: \[default: N\]

    Defines whether the program processes daily/hourly inventories in
    local time or not.

    ::: {.itemizedlist}
    -   Y: Process daily/hourly inventories in local time. No time zone
        shift.

    -   N: Apply time zone shift.
    :::

-   `RAW_DUP_CHECK`{.envar}: \[default: N\]

    Defines whether the program checks for duplicate records in the
    input file.

    ::: {.itemizedlist}
    -   Y: Check for duplicates, and produce a fatal error if found

    -   N: Do not check for duplicates, and add emissions from duplicate
        records
    :::

-   `SMK_ARTOPNT_YN`{.envar}: \[default: N\]

    ::: {.itemizedlist}
    -   Y: Assign X and Y coordinates to specified sources based on the
        `ARTOPNT`{.envar} cross-reference file

    -   N: Do not perform area-to-point processing
    :::

-   `SMK_BASEYR_OVERRIDE`{.envar}: \[default: 0\]

    Used to override the base year determined by the inventory.

-   `SMK_DEFAULT_TZONE`{.envar}: \[default: 5\]

    Defines the default time zone to use for sources that do not match
    entries in the `COSTCY`{.envar} or the `GEOCODE_LEVEL4`{.envar}
    file.

-   `SMK_MAXERROR`{.envar}: \[default: 100\]

    Defines the maximum number of ERROR statements to be displayed by
    SMOKE.

-   `SMK_MAXWARNING`{.envar}: \[default: 100\]

    Defines the maximum number of WARNING statements to be displayed by
    SMOKE.

-   `SMK_PROCESS_HAPS`{.envar}: \[default: blank\]

    Defines how to treat sources for combining criteria VOC and
    hazardous air pollutants (HAP) together. See [Section 2.9.5,
    "Combine toxics and criteria
    inventories"](ch02s09s05.html "2.9.5. Combine toxics and criteria inventories")
    for more detail.

    ::: {.itemizedlist}
    -   ALL: Treat all sources as integrated if a toxics inventory has
        been provided. Does not require an `NHAPEXCLUDE`{.envar} file

    -   NONE: Treat all sources as non-integrate if a toxics inventory
        has been provided. Does not require an `NHAPEXCLUDE`{.envar}
        file

    -   PARTIAL: Read the `NHAPEXCLUDE`{.envar} cross-reference file and
        either include or exclude the specified sources from the
        NONHAP\[VOC\|TOG\] calculation depending on the header of the
        `NHAPEXCLUDE`{.envar} file. See [Section 8.10.7,
        "`NHAPEXCLUDE`{.envar}: NonHAP VOC calculation
        inclusions/exclusions
        file"](ch08s10s07.html "8.10.7. NHAPEXCLUDE: NonHAP VOC calculation inclusions/exclusions file").
    :::

-   `SMK_SOURCE`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

-   `SMK_TMPDIR`{.envar}: \[default: `.`{.filename}\]

    Sets the path for writing temporary files needed when importing the
    inventory.

-   `SMKINVEN_FORMULA`{.envar}: \[default: blank\]

    Allows the user to specify a formula for computing one or more
    pollutant values from the values of other pollutants. To use, users
    should set the value of `SMKINVEN_FORMULA`{.envar} to a
    double-quote-enclosed string of 512 characters or less, using a
    comma-delimited list of formulas. No spaces are necessary in the
    formula list. Only formulas of a specific structure are accepted.
    Specifically, one of the following:

    ::: {.itemizedlist}
    -   OUTPUT = INPUT1 + INPUT2
    -   OUTPUT = INPUT1 - INPUT2
    :::

    For example, if the formula is set to
    "[PMC=PM10-PM2\_5,EXH\_\_PMC=EXH\_\_PM10-EXH\_\_PM2\_5]{.quote}",
    then **Smkinven** will compute two new variables: (1) PMC, as the
    difference between PM~10~ and PM~2.5~ and (2) EXH\_\_PMC as the
    difference between exhaust PM~10~ and exhaust PM~2.5~. The pollutant
    units are taken from the first variable in each formula. The
    variables used as input in the formula will still be output to the
    SMOKE inventory file. If the formula is not set, no additional
    variables will be written to the SMOKE inventory file. An output
    from one formula may not be used as an input to another formula. In
    the OUTPUT pollutant name is the same as an INPUT pollutant name
    from the inventory file, Smkinven will give an error indicating that
    the second pollutant could not be written (e.g. if computing PMC
    when PMC is already in the raw inventory data). If INPUT2 is
    ommitted, an error will also occur. Formulas using multiplication
    and division are not yet implemented.

-   `SMKINVEN_MONTH`{.envar}: \[default: 0 \]

    Defines the number of month to process. The integer month number
    will allow users to pick monthly total inventory data in area
    FF10-formatted invenotry data listed at [Table 8.15, "FF10 Format
    for
    `ARINV`{.envar}"](ch08s02s04.html#tbl_input_arinv_ff10 "Table 8.15. FF10 Format for ARINV").

-   `USE_REF_SCC_YN`{.envar}: \[default: N\]

    Defines whether use reference SCC (i.e., SCC8) to full SCC (i.e.,
    SCC10) mapping input file to convert reference SCC-level inventory
    to full SCC inventory. See detail from [Section 8.10.11,
    "`SCCXREF`{.envar}: Reference SCC input
    file"](ch08s10s11.html "8.10.11. SCCXREF: Reference SCC input file")

    ::: {.itemizedlist}
    -   Y: Use reference SCC mapping input file to convert reference
        SCCs to full SCCs.

    -   N: Do not use SCCXREF input file.
    :::

-   `VELOC_RECALC`{.envar}: \[default: N\]

    Defines whether stack velocity is recalculated in order to make the
    velocity consistent with the reported flow and diameter.

    ::: {.itemizedlist}
    -   Y: Recalculate stack velocity

    -   N: Output the input stack velocity
    :::

-   `WEST_HSPHERE`{.envar}: \[default: Y\]

    Defines how spatial coordinates are interpreted.

    ::: {.itemizedlist}
    -   Y: Convert longitudinal coordinates for the Western Hemisphere
        (positive values are converted to negative values)

    -   N: Do not convert longitude values (positive values are not
        changed)
    :::

-   `WKDAY_NORMALIZE`{.envar}: \[default: N\]

    Clarifies the nature of the "[average-day]{.quote}" data read in by
    **Smkinven** and will impact the **Temporal** program processing of
    average-day data for all formats.

    ::: {.itemizedlist}
    -   Y: Average-day emissions input to **Smkinven** are based on
        weekday emissions only. In **Temporal**, these emissions will be
        adjusted with weekly profiles normalized with weekdays only
        (Monday through Friday)

    -   N: Average-day emissions input to **Smkinven** are based on
        [*all days of the week*]{.emphasis}. In **Temporal**, these
        emissions will be adjusted with weekly profiles normalized with
        all days of the week.
    :::

-   `WRITE_ANN_ZERO`{.envar}: \[default: N\]

    Indicates if annual emission values equal to zero should be written
    to the intermediate inventory file

    ::: {.itemizedlist}
    -   Y: Write zero emission values; this option makes the
        intermediate inventory file larger but is sometimes necessary
        when only daily or hourly data is provided and the entries in
        the annual inventory are dummy values

    -   N: Do not write zero values
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e28876}6.13.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
+-------------------------+----------------+-------------------------+
| File Name               | Format         | Description             |
+=========================+================+=========================+
| `[A                     | SMOKE map      | Annual and average-day  |
| REA|MOBL|PNTS]`{.envar} |                | inventory emissions and |
|                         |                | source characteristics  |
+-------------------------+----------------+-------------------------+
| `[A                     | ASCII          | List of SCCs appearing  |
| SCC|MSCC|PSCC]`{.envar} |                | in the raw inventory    |
|                         |                | file                    |
+-------------------------+----------------+-------------------------+
| `LOGFILE`{.envar}       | ASCII          | Log generated from      |
|                         |                | executing **Smkinven**  |
+-------------------------+----------------+-------------------------+
| `ADAY | PDAY`{.envar}   | I/O API NetCDF | Day-specific inventory  |
|                         |                | emissions assigned to   |
|                         |                | sources in              |
|                         |                | annual/average-day      |
|                         |                | files (optional)        |
+-------------------------+----------------+-------------------------+
| `AHOUR | PHOUR`{.envar} | I/O API NetCDF | Hour-specific inventory |
|                         |                | emissions assigned to   |
|                         |                | sources in              |
|                         |                | annual/average day      |
|                         |                | files (optional)        |
+-------------------------+----------------+-------------------------+
| `REPINVEN`{.envar}      | ASCII          | Inventory report file;  |
| (optional)              |                | contents depend on the  |
|                         |                | inventory being         |
|                         |                | processed, but can      |
|                         |                | include:                |
|                         |                |                         |
|                         |                | CEM section:            |
|                         |                |                         |
|                         |                | ::: {.itemizedlist}     |
|                         |                | -   ORIS IDs from the   |
|                         |                |     CEM matched to the  |
|                         |                |     inventory           |
|                         |                | -   ORIS IDs from the   |
|                         |                |     CEM not matched to  |
|                         |                |     the inventory       |
|                         |                | -   Power-generating    |
|                         |                |     inventory sources   |
|                         |                |     not matched to the  |
|                         |                |     CEM                 |
|                         |                | :::                     |
|                         |                |                         |
|                         |                | Toxics section:         |
|                         |                |                         |
|                         |                | ::: {.itemizedlist}     |
|                         |                | -   Total emissions and |
|                         |                |     number of inventory |
|                         |                |     records by CAS      |
|                         |                |     number              |
|                         |                | -   Total emissions     |
|                         |                |     before and after    |
|                         |                |     aggregation by CAS  |
|                         |                |     number              |
|                         |                | :::                     |
|                         |                |                         |
|                         |                | Area-to-point section:  |
|                         |                |                         |
|                         |                | ::: {.itemizedlist}     |
|                         |                | -   SCCs in the         |
|                         |                |     `ARTOPNT`{.envar}   |
|                         |                |     file but not in the |
|                         |                |     inventory           |
|                         |                | -   Total emissions     |
|                         |                |     before and after    |
|                         |                |     area-to-point       |
|                         |                |     processing by       |
|                         |                |     pollutant, state,   |
|                         |                |     and SCC             |
|                         |                | :::                     |
+-------------------------+----------------+-------------------------+
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------
  [Prev](ch06s13s02.html)      [Up](ch06s13.html)     [Next](ch06s14.html)
  6.13.2. Processing Order     [Home](index.html)       6.14. **Smkmerge**
  --------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.14. **Smkmerge**
:::

[Prev](ch06s13s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s14s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_smkmerge}6.14. **Smkmerge** {#smkmerge .title style="clear: both"}
---------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.14.1. Description](ch06s14.html#d0e28982)]{.section}

[[6.14.2. Processing Order](ch06s14s02.html)]{.section}

[[6.14.3. Files and Environment Variables](ch06s14s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e28982}6.14.1. Description {#description .title}

</div>

</div>
:::

::: {.toc}
[[6.14.1.1. By-day processing](ch06s14.html#d0e29012)]{.section}
:::

[*Processing categories:*]{.emphasis} area, biogenic, mobile, point

The **Smkmerge** program combines the matrices produced by the other
SMOKE programs to produce the emissions files for input to the AQM. The
**Smkmerge** program may be run on any combination of source types and
may incorporate temporal, speciation, projection, and spatial
processing.

If **Smkmerge** is run to produce the input files to the AQM, all the
other SMOKE programs must already have been run. However, you can also
run **Smkmerge** to produce specialized reports. In that instance, only
the required subset of SMOKE programs must have been run prior to
**Smkmerge**.

**Smkmerge** can be used to create 2-D or 3-D gridded, hourly, speciated
files. It also outputs the hourly emissions file for PinG sources needed
by CMAQ. Finally, it outputs an ASCII elevated point sources file,
suitable for postprocessing with the Ptsrce program of EPS2.0/EPS2.5. If
PinG sources have been selected and an ASCII elevated sources file is
output, then SMOKE will set the stack diameters to negative values for
the PinG sources.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e29012}6.14.1.1. By-day processing {#by-day-processing .title}

</div>

</div>
:::

**Smkmerge** can use a by-day processing approach, to read in one-day
hourly files for each day of the week. When the `MRG_BYDAY`{.envar}
environment variable is set to A, M, P, or any combination of those
letters, **Smkmerge** reads a different logical file name for each day
of the week for the hourly emission input files for the indicated
sources.

For example, if the `MRG_SOURCE`{.envar} environment variable is set to
AMBP, **Smkmerge** will expect the following hourly input files:
`ATMP`{.envar}, `BGTS_[S|L]`{.envar}, `MTMP`{.envar}, and
`PTMP`{.envar}, for area, biogenic, mobile, and point source types
respectively. If, in addition, `MRG_BYDAY`{.envar} is set to
"[A]{.quote}", then the hourly input files expected by **Smkmerge** for
area sources would be the `ATMP_{day}`{.envar} files. The files for the
other source types would remain the same.

The `MRG_BYDAY`{.envar} option is useful for implementing a
Monday-weekday-Saturday-Sunday (MWSS) approach to save processing time
for long episodes. This approach is applicable when weekly temporal
profiles used by an inventory do not have variation between the five
weekdays. In the MWSS approach, Monday is processed separately, because
time zone differences across a large domain cause some Sunday emissions
for some time zones to be in the Monday file. Additional environment
variables other than the defaults in the Assigns file need to be set
when this option is applied. **Smkmerge** will prompt for a different
file for each day of the week, but the logical file names for Tuesday
through Friday can be defined as the same file when implementing the
MWSS approach.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------
  [Prev](ch06s13s03.html)                      [Up](ch06.html)        [Next](ch06s14s02.html)
  6.13.3. Files and Environment Variables     [Home](index.html)     6.14.2. Processing Order
  ------------------------------------------ -------------------- ---------------------------
:::
::: {.navheader}
6.14.2. Processing Order
:::

[Prev](ch06s14.html) 

6.14. **Smkmerge**

 [Next](ch06s14s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e29065}6.14.2. Processing Order {#processing-order .title}

</div>

</div>
:::

All other SMOKE core programs except the optional program **Mrggrid**
prepare input for the **Smkmerge** program. **Smkmerge** is the last
nonoptional SMOKE program to be run.

Individual output files from **Smkmerge** can be merged using
**Mrggrid** if desired.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s14.html)     [Up](ch06s14.html)                     [Next](ch06s14s03.html)
  6.14. **Smkmerge**       [Home](index.html)     6.14.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.14.3. Files and Environment Variables
:::

[Prev](ch06s14s02.html) 

6.14. **Smkmerge**

 [Next](ch06s15.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e29087}6.14.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.14.3.1. Input Files](ch06s14s03.html#d0e29532)]{.section}

[[6.14.3.2. Input Environment
Variables](ch06s14s03.html#d0e29821)]{.section}

[[6.14.3.3. Output Files](ch06s14s03.html#d0e30490)]{.section}
:::

::: {.figure}
[]{#fig_programs_smkmerge_area}

**Figure 6.17. Smkmerge input and output files for area sources**

::: {.mediaobject}
![Smkmerge input and output files for area
sources](images\programs\smkmerge_area_html.jpg)
:::
:::

[Figure 6.17, "Smkmerge input and output files for area
sources"](ch06s14s03.html#fig_programs_smkmerge_area "Figure 6.17. Smkmerge input and output files for area sources")
shows the input and output files for the **Smkmerge** program for area
sources. The inputs include the optional multiplicative control matrix
from **Cntlmat** (`ACMAT`{.envar}), the gridding matrix from **Grdmat**
(`AGMAT`{.envar}), the inventory file output from **Smkinven**
(`AREA`{.envar}), the optional reactivity matrix from **Cntlmat**
(`ARMAT`{.envar}), and the optional speciation matrix from **Spcmat**
(`ASMAT`{.envar}). **Smkmerge** can also use hourly emissions from
**Temporal**, either a single file (`PTMP`{.envar}) or hourly emissions
for each day of the week (`ATMP_{day}`{.envar}). The last three input
files are the country, state, and county codes file (`COSTCY`{.envar}),
the inventory data table (`INVTABLE`{.envar}), and the grid description
file (`GRIDDESC`{.envar}).

**Smkmerge** outputs a data file that is determined by the inputs and
can be a model-ready emissions file (`AG[T][S][C]_L`{.envar} or
`AG[T][S][C]_S`{.envar}), a log file (`LOGFILE`{.envar}), and an
optional report file (`REPAG[T][S][C]_L`{.envar} or
`REPAG[T][S][C]_S`{.envar}).

When using source apportionment (see [Section 4.4.23, "Generating
CMAQ-ready Source Apportionment Input Data
Files"](ch04s04s23.html "4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files")),
**Smkmerge** will also read the source grouping file
(`SOURCE_GROUPS`{.envar}) and output the source group information
`SRCGROUPS_OUT`{.envar}, the emissions for each source group
`SGINLNTS_L`{.envar} or `SGINLNTS_S`{.envar}, and a source group report
file `SRCGRP_REPORT`{.envar}.

::: {.figure}
[]{#fig_programs_smkmerge_biogenic}

**Figure 6.18. Smkmerge input and output files for biogenic sources**

::: {.mediaobject}
![Smkmerge input and output files for biogenic
sources](images\programs\smkmerge_biogenic_html.jpg)
:::
:::

[Figure 6.18, "Smkmerge input and output files for biogenic
sources"](ch06s14s03.html#fig_programs_smkmerge_biogenic "Figure 6.18. Smkmerge input and output files for biogenic sources")
shows the input and output files for the **Smkmerge** program for
biogenic sources. The inputs are the optional surrogates file
(`BGPRO`{.envar}), the model-ready emissions file (`BGTS`{.envar}), the
country, state, and county file (`COSTCY`{.envar}), the grid description
file (`GRIDDESC`{.envar}), and the inventory data table
(`INVTABLE`{.envar}).

**Smkmerge** outputs either a mole-based emissions file
(`BGTS_L_O`{.envar}) or a mass-based emissions file
(`BGTS_S_O`{.envar}). Note that \_O is appended to the output file name
to distinguish it from the input file. The program also writes a log
file (`LOGFILE`{.envar}) and an optional report file
(`REPBGTS_L`{.envar} or `REPBGTS_S`{.envar}).

When using source apportionment (see [Section 4.4.23, "Generating
CMAQ-ready Source Apportionment Input Data
Files"](ch04s04s23.html "4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files")),
**Smkmerge** will also read the source grouping file
(`SOURCE_GROUPS`{.envar}) and output the source group information
`SRCGROUPS_OUT`{.envar}, the emissions for each source group
`SGINLNTS_L`{.envar} or `SGINLNTS_S`{.envar}, and a source group report
file `SRCGRP_REPORT`{.envar}.

::: {.figure}
[]{#fig_programs_smkmerge_mobile}

**Figure 6.19. Smkmerge input and output files for mobile sources**

::: {.mediaobject}
![Smkmerge input and output files for mobile
sources](images\programs\smkmerge_mobile_html.jpg)
:::
:::

[Figure 6.19, "Smkmerge input and output files for mobile
sources"](ch06s14s03.html#fig_programs_smkmerge_mobile "Figure 6.19. Smkmerge input and output files for mobile sources")
shows the input and output files for the **Smkmerge** program for mobile
sources. The inputs include the country, state and county codes file
(`COSTCY`{.envar}), the inventory data table (`INVTABLE`{.envar}), and
the grid description file (`GRIDDESC`{.envar}). **Smkmerge** also reads
the optional multiplicative control matrix from **Cntlmat**
(`MCMAT`{.envar}), the gridding matrix from **Grdmat**
(`MGMAT`{.envar}), the inventory file output from **Smkinven**
(`MOBL`{.envar}), the optional reactivity matrix from **Cntlmat**
(`MRMAT`{.envar}), and the optional speciation matrix from **Spcmat**
(`MSMAT_L`{.envar} or `MSMAT_S`{.envar}). Hourly emissions can be input
either as a single file (`MTMP`{.envar}) or as hourly emissions for each
day of the week (`MTMP_{day}`{.envar}).

**Smkmerge** outputs a log file (`LOGFILE`{.envar}), a data file that is
determined by the inputs and can be a model-ready emissions file
(`MG[T][S][C]_L`{.envar} or `MG[T][S][C]_S`{.envar}), and an optional
report file (`REPMG[T][S][C]_L`{.envar} or `REPMG[T][S][C]_S`{.envar}).

When using source apportionment (see [Section 4.4.23, "Generating
CMAQ-ready Source Apportionment Input Data
Files"](ch04s04s23.html "4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files")),
**Smkmerge** will also read the source grouping file
(`SOURCE_GROUPS`{.envar}) and output the source group information
`SRCGROUPS_OUT`{.envar}, the emissions for each source group
`SGINLNTS_L`{.envar} or `SGINLNTS_S`{.envar}, and a source group report
file `SRCGRP_REPORT`{.envar}.

::: {.figure}
[]{#fig_programs_smkmerge_point}

**Figure 6.20. Smkmerge input and output files for point sources**

::: {.mediaobject}
![Smkmerge input and output files for point
sources](images\programs\smkmerge_point_html.jpg)
:::
:::

[Figure 6.20, "Smkmerge input and output files for point
sources"](ch06s14s03.html#fig_programs_smkmerge_point "Figure 6.20. Smkmerge input and output files for point sources")
shows the input and output files for the **Smkmerge** program for point
sources. The inputs include the country, state, and county codes file
(`COSTCY`{.envar}), the inventory data table (`INVTABLE`{.envar}), the
grid description file (`GRIDDESC`{.envar}), and the optional
multiplicative control matrix from **Cntlmat** (`PCMAT`{.envar}). If
using PinG or elevated sources, the `PELV`{.envar} file is used.
**Smkmerge** reads the gridding matrix output from **Grdmat**
(`PGMAT`{.envar}). The `PLAY`{.envar} file is used to merge layer
fractions, while the `PLAY_EX`{.envar} file is used for explicit plumes.
Other **Smkmerge** input files include the inventory file output from
**Smkinven** (`PNTS`{.envar}), the optional reactivity matrix from
**Cntlmat** (`PRMAT`{.envar}), and the optional speciation matrix from
**Spcmat** (`PSMAT`{.envar}). The hourly emissions from **Temporal** are
provided either as the `PTMP`{.envar} file or as hourly emissions for
each day of the week (`PTMP_{day}`{.envar}). Finally, **Smkmerge** can
read the optional elevated stack groups file (`STACK_GROUPS`{.envar}).

**Smkmerge** can output an elevated sources file
(`ELEV[T]S[_S|_L]`{.envar}) if requested. Like all other SMOKE programs,
**Smkmerge** outputs a log file (`LOGFILE`{.envar}) detailing the
program's execution. The main data file is determined by the inputs and
can be include a model-ready emissions file (`PG[T][S][C][3D]_L`{.envar}
or `PG[T][S][C][3D]_S`{.envar}). Other output files can be a PinG file
(`PING[T][S][C][_S][_L]`{.envar} and a report file
(`REPPG[T][S][C]_L`{.envar} or `REPPG[T][S][C]_S`{.envar}).

When using source apportionment (see [Section 4.4.23, "Generating
CMAQ-ready Source Apportionment Input Data
Files"](ch04s04s23.html "4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files")),
**Smkmerge** will also read the source grouping file
(`SOURCE_GROUPS`{.envar}) and the stack groups file
(`STACK_GROUPS`{.envar}), and output the source group information
`SRCGROUPS_OUT`{.envar}, the emissions for each source group
`SGINLNTS_L`{.envar} or `SGINLNTS_S`{.envar}, and a source group report
file `SRCGRP_REPORT`{.envar}.

::: {.figure}
[]{#fig_programs_smkmerge_all}

**Figure 6.21. Smkmerge input and output files for all source
categories**

::: {.mediaobject}
![Smkmerge input and output files for all source
categories](images\programs\smkmerge_all_html.jpg)
:::
:::

[Figure 6.21, "Smkmerge input and output files for all source
categories"](ch06s14s03.html#fig_programs_smkmerge_all "Figure 6.21. Smkmerge input and output files for all source categories")
shows the input and output files for the **Smkmerge** program for all
sources. The input and output files are a combination of those found in
the previous four figures.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e29532}6.14.3.1. Input Files {#input-files .title}

</div>

</div>
:::

The input files needed depend upon the input environment variables that
are set for this program. For example, if only area sources are being
merged, then only area-source-related inputs are required. Similarly, if
**Smkmerge** is being executed to produce speciated, gridded, temporally
allocated area and point sources, then all area- and point-related
inputs for area and point sources, speciation matrices, gridding
matrices, and temporal matrices are required.

::: {.informaltable}
  File Name                                                                                                     Format           Source Type   Description
  ------------------------------------------------------------------------------------------------------------- ---------------- ------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `[A|M|P]CMAT`{.envar} (optional)                                                                              I/O API NetCDF   A, M, P       Multiplicative control matrix, output by **Cntlmat** (used when `MRG_CTLMAT_MULT`{.envar} is set)
  `[A|M|P]GMAT`{.envar}                                                                                         I/O API NetCDF   A, M, P       Gridding matrix from **Grdmat**
  `[A|M|P]RMAT`{.envar} (optional)                                                                              I/O API NetCDF   A, M, P       Mass- or mole-based reactivity matrix, output by **Cntlmat** (used when `MRG_CTLMAT_REAC`{.envar} is set)
  `[A|M|P]SMAT`{.envar} (optional)                                                                              I/O API NetCDF   A, M, P       Mass- or mole-based speciation matrix from **Spcmat** (used when `MRG_SPCMAT_YN`{.envar} = Y)
  `[A|M|P]TMP`{.envar} (optional)                                                                               I/O API NetCDF   A, M, P       Hourly emissions from **Temporal** (used when `MRG_TEMPORAL_YN`{.envar} = Y and `MRG_BYDAY`{.envar} is not set)
  `[A|M|P]TMP_{day}`{.envar} (optional)                                                                         I/O API NetCDF   A, M, P       Hourly emissions from **Temporal** by day, where {day} = MON, TUE, WED, THU, FRI, SAT, SUN (used when `MRG_TEMPORAL_YN`{.envar} = Y and `MRG_BYDAY`{.envar} is set)
  `[AREA|MOBL|PNTS]`{.envar}                                                                                    SMOKE map        A, M, P       Intermediate area-, mobile-, or point-source inventory created by **Smkinven**
  `BGPRO`{.envar} (optional)                                                                                    ASCII            B             Gridding surrogates for computing biogenic state and county totals from gridded biogenic inputs
  `BGTS`{.envar}                                                                                                I/O API NetCDF   B             Biogenic model-ready emissions, to be input only when merging with other source categories, or when computing biogenic state and county totals, produced by **Tmpbio** or **Tmpbeis3**
  `COSTCY`{.envar}                                                                                              ASCII            A, B, M, P    Country, state, and county file with time zones
  [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")        ASCII            A, B, M, P    Geographical level codes and descriptions for gridded inventories, only when USE\_EXP\_GEO\_CODES is set to Y, (COSTCY is ignored when [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files") files are used)
  `INVTABLE`{.envar}                                                                                            ASCII            A, B, M, P    Inventory data table containing activity and pollutant names
  `GRIDDESC`{.envar}                                                                                            ASCII            A, B, M, P    Description of the modeling grid
  `PELV`{.envar} (optional)                                                                                     ASCII            P             Elevated point sources identification file, output by **Elevpoint**
  `PLAY`{.envar} (optional)                                                                                     I/O API NetCDF   P             Hourly plume rise layer fractions, output by **Laypoint** (used when `MRG_LAYERS_YN`{.envar} = Y and `EXPLICIT_PLUMES_YN`{.envar} = N)
  `PLAY_EX`{.envar} (optional)                                                                                  I/O API NetCDF   P             Hourly plume rise layer fractions for explicit sources, output by **Laypoint** (used when `MRG_LAYERS_YN`{.envar} = Y and `EXPLICIT_PLUMES_YN`{.envar} = Y)
  `STACK_GROUPS`{.envar} (optional)                                                                             I/O API NetCDF   P             Elevated sources stack parameters file, output by **Elevpoint**
  [`SOURCE_GROUPS`{.envar}](ch08s10s13.html "8.10.13. SOURCE_GROUPS: Source apportionment groups") (optional)   ASCII            A, B, M, P    Source apportionment groups
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e29821}6.14.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

NOTE: At least one of the `MRG_GRDOUT_YN`{.envar},
`MRG_REPSTA_YN`{.envar}, or `MRG_REPCNY_YN`{.envar} environment
variables must be set to Y.

::: {.itemizedlist}
-   `AREA_SURROGATE_NUM`{.envar}: \[default: 60\]

    Surrogate code of the area surrogate in the `BGPRO`{.envar} file, to
    use for totals of biogenic emissions by state and county.

-   `EXPLICIT_PLUMES_YN`{.envar}: \[default: N\]

    Indicates whether only explicit plume rise sources should be merged.

    ::: {.itemizedlist}
    -   Y: Merge only explicit plume rise sources; uses
        `PLAY_EX`{.envar} file

    -   N: Merge all plume rise sources; uses `PLAY`{.envar} file
    :::

-   `USE_EXP_GEO_CODES`{.envar}: \[default: N\]

    If set to Y, then use GEOCODE\_LEVEL\[1-4\] files instead of the
    COSTCY file to define expanded geographical detail such as
    country-level(GEOCODE\_LEVEL1), country/state-level
    (GEOCODE\_LEVEL2), country/state/county-level (GEOCODE\_LEVEL3) or
    country/state/county/tribal-level (GEOCODE\_LEVEL4).

-   `MRG_BYDAY`{.envar}: \[default: blank\]

    String code that specifies which source categories (if any) are to
    use a by-day approach for the hourly input files (see
    "[Description]{.quote}" section above for more information on this
    approach). Valid settings include A, M, P, or any combination. For
    example, set this environment variable to "[AMP]{.quote}" to have
    **Smkmerge** read the area-, mobile-, and point-source hourly
    emissions files individually for each day.

-   `MRG_CTLMAT_MULT`{.envar}: \[default: blank\]

    String code that specifies which source categories (if any) are to
    be processed using a multiplicative control matrix. Valid settings
    include A, M, P, or any combination. For example, set this
    environment variable to "[M]{.quote}" to have **Smkmerge** read the
    mobile-source multiplicative control matrix.

-   `MRG_CTLMAT_REAC`{.envar}: \[default: blank\]

    String code that specifies which source categories (if any) are to
    be processed using a reactivity control matrix. Valid settings
    include A, M, P, or any combination. For example, set this
    environment variable to "[MP]{.quote}" to have **Smkmerge** read the
    mobile- and point-source reactivity control matrices.

-   `MRG_GRDOUT_UNIT`{.envar}: \[default: input file units\]

    String code that permits the user to change the units of the gridded
    output file. For example, "[kg/hr]{.quote}" would convert the output
    emissions to kilograms per hour, before outputting the emissions
    data file. Not all conversions are known to SMOKE. Valid numerators
    are: "[tons]{.quote}", "[kg]{.quote}", "[moles]{.quote}", and
    "[g]{.quote}"; note that molar emissions cannot be output without
    the mole-based speciation matrices. Valid denominators are
    "[yr]{.quote}", "[dy]{.quote}", "[hr]{.quote}", and "[s]{.quote}".
    Note that if annual output is requested but not available in the
    input file, leap year adjustments are not made.

    Units required by CMAQ are moles/s and most other air quality models
    are moles/hr.

-   `MRG_GRDOUT_YN`{.envar}: \[default: N\]

    Defines whether the program produces a gridded output file.

    ::: {.itemizedlist}
    -   Y: Produce the file

    -   N: Do not produce the file
    :::

-   `MRG_LAYERS_YN`{.envar}: \[default: N\]

    Defines whether the program uses the layer fractions file.

    ::: {.itemizedlist}
    -   Y: Use the layer fractions file

    -   N: Do not use the layer fractions file
    :::

-   `MRG_MARKETPEN_YN`{.envar}: \[default: Y\]

    Defines whether the program uses market penetration from reactivity
    matrices.

    ::: {.itemizedlist}
    -   Y: Use market penetration

    -   N: Do not use market penetration
    :::

-   `MRG_METCHK_YN`{.envar}: \[default: Y\]

    Defines whether the program checks consistency of headers in the
    meteorology file.

    ::: {.itemizedlist}
    -   Y: Check contents of meteorology file headers

    -   N: Do not check headers
    :::

-   `MRG_REPCNY_YN`{.envar}: \[default: N\]

    Defines whether the program produces a report of emission totals by
    county.

    ::: {.itemizedlist}
    -   Y: Produce county-total emissions report

    -   N: Do not produce the report
    :::

-   `MRG_REPCTL_YN`{.envar}: \[default: N\]

    Defines whether the program reports controlled emissions or not.

    ::: {.itemizedlist}
    -   Y: Report controlled emissions

    -   N: Do not report controlled emissions
    :::

-   `MRG_REPSTA_YN`{.envar}: \[default: N\] Defines whether the program
    produces a report of emission totals by state.

    ::: {.itemizedlist}
    -   Y: Produce state-total emissions report

    -   N: Do not produce the report
    :::

-   `MRG_SOURCE`{.envar}: \[default: blank (processing halts)\]

    Series of character codes representing the type(s) of sources to be
    merged.

    ::: {.itemizedlist}
    -   A: Area sources

    -   B: Biogenic sources

    -   M: Mobile sources

    -   P: Point sources

    -   AP: Area and point sources

    -   AM: Area and mobile sources

    -   etc.
    :::

-   `MRG_SPCMAT_YN`{.envar}: \[default: N\]

    Defines whether the program produces speciated output.

    ::: {.itemizedlist}
    -   Y: Read the speciation matrix produced by the **Spcmat** program

    -   N: Do not read the speciation matrix
    :::

-   `MRG_TEMPORAL_YN`{.envar}: \[default: N\]

    Defines whether the program produces temporally allocated output.

    ::: {.itemizedlist}
    -   Y: Read the temporal matrix produced by the **Temporal** program

    -   N: Do not read the temporal matrix
    :::

-   `MRG_TOTOUT_UNIT`{.envar}: \[default: input file units, or per day
    if hourly input is used\]

    This variable is like the `MRG_GRDOUT_UNIT`{.envar} variable, except
    that it controls the state and county totals reports separately from
    the gridded outputs. The only difference is the temporal resolution
    of `MRG_TOTOUT_UNIT`{.envar}, which always outputs the emission
    values as daily totals, no matter what units are used.

-   `SMK_ASCIIELEV_YN`{.envar}: \[default: N\]

    Defines whether the program produces an ASCII elevated point sources
    file, suitable for postprocessing with the Ptsrce program in
    EPS2.0/EPS2.5.

    ::: {.itemizedlist}
    -   Y: Create the ASCII elevated point sources file

    -   N: Do not create the ASCII elevated point sources file
    :::

-   `SMK_AVEDAY_YN`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

    NOTE: This setting affects the **Smkmerge** results only when hourly
    emissions are not merged. To use hourly average-day emissions in
    **Smkmerge**, this variable must be set to Y for the **Temporal**
    program, so that average-day emissions will be used in creating the
    hourly emissions.

-   `SMK_EMLAYS`{.envar}: See description in [Section 6.6.3.2, "Input
    Environment
    Variables"](ch06s06s03.html#sect_programs_laypoint_envar "6.6.3.2. Input Environment Variables")

    Used to set the default value for `UAM_LAYERS`{.envar} when the
    **Smkmerge** output is to be used in UAM-V elevated-point-source
    output processing.

-   `SMK_PING_METHOD`{.envar}: See description in [Section 6.3.3.2,
    "Input Environment
    Variables"](ch06s03s03.html#sect_programs_elevpoint_envar "6.3.3.2. Input Environment Variables")

    Creates CMAQ PinG file or flags PinG sources in UAM-style elevated
    ASCII file (when the `SMK_ASCIIELEV_YN`{.envar} environment variable
    is set to Y).

-   `SMK_REPORT_TIME`{.envar}: \[default: 230000\]

    Time for writing daily reports from program (HHMMSS).

-   `SMK_SRCGROUP_OUTPUT_YN`{.envar}: \[default: N\]

    Indicates if source apportionment emissions should be output

    ::: {.itemizedlist}
    -   Y: Group sources and output source apportionment files

    -   N: Do not perform any source apportionment processing
    :::

-   `SMKMERGE_CUSTOM_OUTPUT`{.envar}: \[default: N\]

    Defines his/her own output file names from **Smkmerge**. Manually
    define environment variables for those output file names below:

    ::: {.itemizedlist}
    -   `[E|A|M|P]OUT`{.envar} : Processing source output file

    -   `ELEV`{.envar} : Elevated-point-sources file, produced if
        `SMK_ASCIIELEV_YN`{.envar} is set to Y; if PinG sources have
        also been selected, then the stack diameters listed in this file
        will be set to the negative value of their actual value.

    -   `PING`{.envar} : CMAQ PinG file, produced if
        `SMK_PING_METHOD`{.envar} is set to 1

    -   `INLN`{.envar} : CMAQ 2-D surface layer emissions file, produced
        if `SMK_ELEV_METHOD`{.envar} is set to 2. For in-line processing
        plume rise processing, `MRG_LAYERS_YN`{.envar} must set to N to
        create hourly speciated 2-D surface layer emissions file for
        CMAQ version 4.7 or later.

    -   `REP[E|A|M|P]G`{.envar} : Emission total report file, produced
        if either `MRG_REPSTA_YN`{.envar} or `MRG_REPCNY_YN`{.envar} is
        set to Y
    :::
:::

The rest of the variables in this list are relevant only when the
`SMK_ASCIIELEV_YN`{.envar} environment variable is set to Y. The
UAM-style elevated-point-source file referenced in the following
descriptions is produced by **Smkmerge** and used as input to the UAM
preprocessor Ptsrce.

::: {.itemizedlist}
-   `UAM_LAYERS`{.envar}: \[default: set by value of
    `SMK_EMLAYS`{.envar}\]

    Number of layers to output to the elevated-point-source file.

-   `UAM_NOTE`{.envar}: \[default: "[UAM elev pt emis from
    Smkmerge]{.quote}"\]

    Message to appear as a note in the elevated-point-source file.

-   `UAM_NPARAM`{.envar}: \[default: 20\]

    Number of parameters for control packet to appear in the
    elevated-point-source file.

-   `UAM_PRINT_LOCATIONS`{.envar}: \[default: 0\]

    Flag printed in the elevated-point-source file to control whether
    Ptsrce will print the locations table. 0=No; 1=Yes.

-   `UAM_PRINT_METHODS`{.envar}: \[default: 0\]

    Flag printed in the elevated-point-source file to control whether
    Ptsrce will print the methods table. 0=No; 1=Yes.

-   `UAM_PRINT_OUTGRD`{.envar}: \[default: 0\]

    Flag printed in the elevated-point-source file to control whether
    Ptsrce will print the output grid. 0=No; 1=Yes.

-   `UAM_PRINT_UNITS`{.envar}: \[default: 0\]

    Flag printed in the elevated-point-source file to control whether
    Ptsrce will print the units table. 0=No; 1=Yes.

-   `UAM_PRINT_VALUES`{.envar}: \[default: 0\]

    Flag printed in the elevated-point-source file to control whether
    Ptsrce will print the values table. 0=No; 1=Yes.

-   `UAM_PRINT_VERTMETH`{.envar}: \[default: 0\]

    Flag printed in the elevated-point-source file to control whether
    Ptsrce will print the vertical methods table. 0=No; 1=Yes.

-   `UAM_PTSRCE_OUTUNIT`{.envar}: \[default: 20\]

    Ptsrce output file unit number in the elevated-point-source file.

-   `UAM_VERTICAL_METHOD`{.envar}: \[default: STACKHGT\]

    Vertical method in the elevated-point-source file. Appropriate
    values are STACKHGT and PLUMERISE.

-   `UAM4_DIFFBREAK_UNIT`{.envar}: \[default: 0\]

    DIFFBREAK file unit number in the elevated-point-source file.

-   `UAM4_HTLOWR`{.envar}: \[default: 20\]

    Minimum height (in meters) of cells between the surface and the
    "[diffbreak]{.quote}" in the elevated-point-source file.

-   `UAM4_HTSFC`{.envar}: \[default: 0\]

    Height of the surface layer (in meters) in the elevated-point-source
    file.

-   `UAM4_HTUPPR`{.envar}: \[default: 100\]

    Minimum height (in meters) of cells between the
    "[diffbreak]{.quote}" and the top of the model in the
    elevated-point-source file.

-   `UAM4_LAYABOVE`{.envar}: \[default: `UAM_LAYERS`{.envar} -
    `UAM4_LAYBELOW`{.envar}\]

    Number of layers above the "[diffbreak]{.quote}" in the
    elevated-point-source file.

-   `UAM4_LAYBELOW`{.envar}: \[default: 3\]

    Number of layers below the "[diffbreak]{.quote}" in the
    elevated-point-source file.

-   `UAM4_METSCALARS_UNIT`{.envar}: \[default: 15\]

    METSCALARS file unit number in the elevated-point-source file. Used
    only for `UAM_VERTICAL_METHOD`{.envar} set to "[PLUMERISE]{.quote}".

-   `UAM4_REGIONTOP_UNIT`{.envar}: \[default: 0\]

    REGIONTOP file unit number in the elevated-point-source file.

-   `UAM4_TEMPERATUR_UNIT`{.envar}: \[default: 14\]

    TEMPERATUR file unit number in the elevated-point-source file. Used
    only for `UAM_VERTICAL_METHOD`{.envar} set to "[PLUMERISE]{.quote}".

-   `UAM4_WIND_UNIT`{.envar}: \[default: 16\]

    WIND file unit number in the elevated-point-source file. Used only
    for `UAM_VERTICAL_METHOD`{.envar} set to "[PLUMERISE]{.quote}".
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e30490}6.14.3.3. Output Files {#output-files .title}

</div>

</div>
:::

The output files produced by **Smkmerge** are determined by the values
of the input environment variables.

::: {.informaltable}
+-------------------------+----------------+-------------------------+
| File Name               | Format         | Description             |
+=========================+================+=========================+
| `[A|B|M|P|E]G[T][S][C][ | I/O API NetCDF | Merged emission file,   |
| 3D][_S|_L][_O]`{.envar} |                | produced when           |
|                         |                | `MRG_GRDOUT_YN`{.envar} |
|                         |                | is set to Y; actual     |
|                         |                | file name is determined |
|                         |                | by the environment      |
|                         |                | variables used to       |
|                         |                | configure **Smkmerge**, |
|                         |                | as follows:             |
|                         |                |                         |
|                         |                | ::: {.itemizedlist}     |
|                         |                | -   \[area\|biogenic\   |
|                         |                | |mobile\|point\|every\] |
|                         |                |                         |
|                         |                |  (`MRG_SOURCE`{.envar}) |
|                         |                | -   T = temporally      |
|                         |                |     allocated           |
|                         |                |     (`MR                |
|                         |                | G_TEMPORAL_YN`{.envar}) |
|                         |                | -   S = speciated       |
|                         |                |     (`                  |
|                         |                | MRG_SPCMAT_YN`{.envar}) |
|                         |                | -   C = controlled      |
|                         |                |     (`M                 |
|                         |                | RG_CTLMAT_MULT`{.envar} |
|                         |                |     or                  |
|                         |                |     `MR                 |
|                         |                | G_CTLMAT_REAC`{.envar}) |
|                         |                | -   3D = layered        |
|                         |                |     (`                  |
|                         |                | MRG_LAYERS_YN`{.envar}) |
|                         |                | -   \_S = mass-based    |
|                         |                |     speciation          |
|                         |                |                         |
|                         |                |   (`SPC_INPUT`{.envar}) |
|                         |                | -   \_L = mole-based    |
|                         |                |     speciation          |
|                         |                |                         |
|                         |                |   (`SPC_INPUT`{.envar}) |
|                         |                | -   \_O = used when     |
|                         |                |     only merging        |
|                         |                |     biogenic sources    |
|                         |                |                         |
|                         |                |   (`MRG_SOURCE`{.envar} |
|                         |                |     = B)                |
|                         |                | :::                     |
+-------------------------+----------------+-------------------------+
| `ELEV                   | ASCII          | Elevated-point-sources  |
| [T]S[C][_S|_L]`{.envar} |                | file, produced if       |
|                         |                | `SM                     |
|                         |                | K_ASCIIELEV_YN`{.envar} |
|                         |                | is set to Y; if PinG    |
|                         |                | sources have also been  |
|                         |                | selected, then the      |
|                         |                | stack diameters listed  |
|                         |                | in this file will be    |
|                         |                | set to the negative     |
|                         |                | value of their actual   |
|                         |                | value                   |
+-------------------------+----------------+-------------------------+
| `LOGFILE`{.envar}       | ASCII          | Log generated from      |
|                         |                | executing **Smkmerge**  |
+-------------------------+----------------+-------------------------+
| `PING[T                 | I/O API NetCDF | CMAQ PinG file,         |
| ][S][C][_S|_L]`{.envar} |                | produced if             |
|                         |                | `S                      |
|                         |                | MK_PING_METHOD`{.envar} |
|                         |                | is set to 1             |
+-------------------------+----------------+-------------------------+
| `REP[A|B|M|P|E]G[T      | ASCII          | Emission totals report  |
| ][S][C][_S|_L]`{.envar} |                | file, produced if       |
|                         |                | either                  |
|                         |                | `MRG_REPSTA_YN`{.envar} |
|                         |                | or                      |
|                         |                | `MRG_REPCNY_YN`{.envar} |
|                         |                | is set to Y             |
+-------------------------+----------------+-------------------------+
| `S                      | I/O API NetCDF | Emissions by source     |
| GINLNTS[_S|_L]`{.envar} |                | group, formatted as     |
|                         |                | CMAQ in-line emissions  |
|                         |                | data, produced if       |
|                         |                | `SMK_SRCG               |
|                         |                | ROUP_OUTPUT_YN`{.envar} |
|                         |                | is set to Y             |
+-------------------------+----------------+-------------------------+
| `SRCGROUPS_OUT`{.envar} | I/O API NetCDF | Source group            |
|                         |                | information, produced   |
|                         |                | if                      |
|                         |                | `SMK_SRCG               |
|                         |                | ROUP_OUTPUT_YN`{.envar} |
|                         |                | is set to Y             |
+-------------------------+----------------+-------------------------+
| `SRCGRP_REPORT`{.envar} | ASCII          | Source group report     |
|                         |                | file, produced if       |
|                         |                | `SMK_SRCG               |
|                         |                | ROUP_OUTPUT_YN`{.envar} |
|                         |                | is set to Y             |
+-------------------------+----------------+-------------------------+
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------
  [Prev](ch06s14s02.html)      [Up](ch06s14.html)     [Next](ch06s15.html)
  6.14.2. Processing Order     [Home](index.html)         6.15. **Spcmat**
  --------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.15. **Spcmat**
:::

[Prev](ch06s14s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s15s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_spcmat}6.15. **Spcmat** {#spcmat .title style="clear: both"}
-----------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.15.1. Description](ch06s15.html#d0e30657)]{.section}

[[6.15.2. Processing Order](ch06s15s02.html)]{.section}

[[6.15.3. Files and Environment Variables](ch06s15s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e30657}6.15.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} area, mobile, point

An emission inventory is built and reported for a variety of compounds
or chemical classes such as CO, NO~x~, VOC, PM~10~, and SO~2~. However,
AQM photochemical mechanisms (e.g., CB6, SAPRC) contain a simplified set
of equations that use representative "[model species]{.quote}" to
represent atmospheric chemistry. Therefore, factors are needed to
convert the emissions from the chemical classes in the emission
inventory to the species in the intended photochemical mechanism. The
**Spcmat** program produces matrices that contain the factors for
performing this conversion.

The speciation factors are provided to **Spcmat** using \"speciation
profiles\", which are applied to the inventory\'s sources using a
\"speciation cross-reference\". For inventories that contain VOC mass,
an additional factor is needed that converts the VOC mass to Total
Organic Gases (TOG) mass, since the profiles used for VOC are actually
computed based on TOG. The TOG profiles are used (instead of VOC
profiles) since some of the TOG mass gets assigned to model species.
Using VOC-only profiles would underestimate the volatile mass being
emitted. Historically in SMOKE, the VOC-to-TOG conversion factors have
been assigned by SCC or FIPS and SCC. Starting with SMOKE version 2.3,
however, these factors can optionally be assigned by speciation profile
ID codes. In fact, since the VOC-to-TOG factors come directly from the
raw data used to create speciation profiles factors (such as the
SPECIATE4.0 database), the most consistent way to assign these factors
is actually by speciation profile ID. SMOKE version 2.3 is backward
compatible with existing GSCNV file formats.

**Spcmat** outputs both mass-based and mole-based speciation factors for
all sources. Previous systems have assumed that the average molecular
weight of the model species was sufficient to represent the molecular
weight of a species emitted by a specific source. In fact, the actual
molecular weight of a model species is different for different types of
emission processes. To represent the mass values more accurately, the
mass and mole factors are input, applied, and output separately by
Spcmat.

The speciation cross-reference file input to **Spcmat** specifies the
speciation profile to be used for transforming the inventory pollutants
to the model species for each source or type of source. **Spcmat**
permits profiles to be assigned based on the country, state, and county
code, the SCC, and other source characteristics. In the hierarchical
system used to apply the profiles, the most specific assignments are
applied first, followed by the next most specific, and so on. This
system ensures that the most-specific matches override the less-specific
ones.

For stationary area/nonpoint sources, the available combinations and
their order are the following, starting with the most specific. "[Left
[*x*]{.emphasis} of SCC]{.quote}" refers to an 8- or 10-digit SCC with
all digits except the first [*x*]{.emphasis} set to 0. "[Left 2 of SIC
code]{.quote}" refers to a 4-digit SIC code with the third and fourth
digits set to 0.The maximum field width in SMOKE and its input files for
SCC is 20 characters as of SMOKE v4.0. The 8 or 10 digit SCC are still
supported, but if the SCC is greater than 10 digits the SCC hierarchial
approach will not be supported. The SIC may also be up to 20 characters
in length, but if the SIC is larger than 4 characters then the
hierarchial approach will not be used. (NOTE: only for SCC less than or
equal to 10 characters and SIC less than or equal to 4 characters)

::: {.orderedlist}
1.  Country/state/county code, MACT code, and 8- or 10-digit SCC

2.  Country/state/county code and MACT code

3.  Country/state code, MACT code, and 8- or 10-digit SCC

4.  Country/state code and MACT code

5.  MACT code and 8- or 10-digit SCC

6.  MACT code

7.  Country/state/county code and 4-digit SIC code

8.  Country/state/county code and left 2 of SIC code

9.  Country/state code and 4-digit SIC code

10. Country/state code and left 2 of SIC code

11. 4-digit SIC code

12. Left 2 of SIC code

13. Country/state/county code and 8- or 10-digit SCC

14. Country/state/county code and left 6 or left 7 of SCC

15. Country/state code and 8- or 10-digit SCC

16. Country/state code and left 6 or left 7 of SCC

17. 8- or 10-digit SCC

18. Left 6 or left 7 of SCC

19. Country/state/county code

20. Country/state code

21. Ultimate default (country/state/county code = 0, SCC = 0)
:::

For nonroad sources, the available combinations and their order are:

::: {.orderedlist}
1.  Country/state/county code and 10-digit SCC

2.  Country/state/county code and left 7 of SCC

3.  Country/state code and 10-digit SCC

4.  Country/state code and left 7 of SCC

5.  10-digit SCC

6.  Left 7 of SCC

7.  Country/state/county code

8.  Country/state code

9.  Ultimate default (country/state/county code = 0, SCC = 0)
:::

For point sources, the available combinations depend on the source
definition. A header in the speciation cross-reference file format
allows you to indicate the source definition. For inventories, a source
is defined as the unique combination of country/state/county code, plant
ID, point ID, stack ID, segment, and SCC. For point sources, the
available combinations and their order are:

::: {.orderedlist}
1.  Country/state/county code, plant ID, point ID, stack ID, segment ID,
    SCC, and pollutant

2.  Country/state/county code, plant ID, point ID, stack ID, segment ID,
    and pollutant

3.  Country/state/county code, plant ID, point ID, stack ID, and
    pollutant

4.  Country/state/county code, plant ID, point ID, and pollutant

5.  Country/state/county code, plant ID, SCC, and pollutant

6.  Country/state/county code and plant ID

7.  Country/state/county code, MACT code, and SCC

8.  Country/state/county code and MACT code

9.  Country/state code, MACT code, and SCC

10. Country/state code and MACT code

11. MACT code and SCC

12. MACT code

13. Country/state/county code and 4-digit SIC code

14. Country/state/county code and left 2 of SIC code

15. Country/state code and 4-digit SIC code

16. Country/state code and left 2 of SIC code

17. 4-digit SIC code

18. Left 2 of SIC code

19. Country/state/county code and SCC

20. Country/state/county code and left 6 of SCC

21. Country/state/county code and left 3 of SCC

22. Country/state/county code and left 1 of SCC

23. Country/state code and SCC

24. Country/state code and left 6 of SCC

25. Country/state code and left 3 of SCC

26. Country/state code and left 1 of SCC

27. SCC

28. Left 6 of SCC

29. Left 3 of SCC

30. Left 1 of SCC

31. Country/state/county code

32. Country/state code

33. Ultimate default (country/state/county code = 0, SCC = 0)
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------
  [Prev](ch06s14s03.html)                      [Up](ch06.html)        [Next](ch06s15s02.html)
  6.14.3. Files and Environment Variables     [Home](index.html)     6.15.2. Processing Order
  ------------------------------------------ -------------------- ---------------------------
:::
::: {.navheader}
6.15.2. Processing Order
:::

[Prev](ch06s15.html) 

6.15. **Spcmat**

 [Next](ch06s15s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e30981}6.15.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smkinven** must be run before **Spcmat**.

**Spcmat** must be executed before speciated emissions can be produced
by **Smkmerge**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s15.html)     [Up](ch06s15.html)                     [Next](ch06s15s03.html)
  6.15. **Spcmat**         [Home](index.html)     6.15.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.15.3. Files and Environment Variables
:::

[Prev](ch06s15s02.html) 

6.15. **Spcmat**

 [Next](ch06s16.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e30998}6.15.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.15.3.1. Input Files](ch06s15s03.html#d0e31089)]{.section}

[[6.15.3.2. Input Environment
Variables](ch06s15s03.html#d0e31161)]{.section}

[[6.15.3.3. Output Files](ch06s15s03.html#d0e31269)]{.section}
:::

::: {.figure}
[]{#fig_programs_spcmat}

**Figure 6.22. Spcmat input and output files**

::: {.mediaobject}
![Spcmat input and output files](images\programs\spcmat_html.jpg)
:::
:::

[Figure 6.22, "Spcmat input and output
files"](ch06s15s03.html#fig_programs_spcmat "Figure 6.22. Spcmat input and output files")
shows the input and output files for the **Spcmat** program. The input
files include the inventory file output from **Smkinven**
(`AREA`{.envar}, `MOBL`{.envar}, or `PNTS`{.envar}), the optional
pollutant conversion file (`GSCNV`{.envar}), the speciation profiles
file (`GSPRO`{.envar}), the speciation cross-reference file
(`GSREF`{.envar}), the combination speciation profiles file
(`GSPRO_COMBO`{.envar}), and the inventory data table
(`INVTABLE`{.envar}). For mobile sources only, **Spcmat** uses the
mobile emission processes file (`MEPROC`{.envar}). More informaton of
`GSPRO_COMBO`{.envar} file is available at [Section 8.5.3,
"`GSPRO_COMBO`{.envar}: Combination speciation profiles file
"](ch08s05s03.html "8.5.3. GSPRO_COMBO: Combination speciation profiles file ").

**Spcmat** outputs a mole-based speciation matrix file
(`ASMAT_L`{.envar}, `MSMAT_L`{.envar}, or `PSMAT_L`{.envar}) and a
mass-based speciation matrix file (`ASMAT_S`{.envar}, `MSMAT_S`{.envar},
or `PSMAT_S`{.envar}). The program also outputs a speciation
supplemental file (`ASSUP`{.envar}, `MSSUP`{.envar}, or `PSSUP`{.envar})
and a log file (`LOGFILE`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e31089}6.15.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                     Format      Description
  ----------------------------- ----------- -----------------------------------------------------------------------------
  `[AREA|MOBL|PNTS]`{.envar}    SMOKE map   Intermediate inventory file produced by **Smkinven**
  `GSCNV`{.envar} (optional)    ASCII       Pollutant conversion file, used only if `POLLUTANT_CONVERSION`{.envar} = Y.
  `GSPRO`{.envar}               ASCII       Speciation profiles
  `GSREF`{.envar}               ASCII       Speciation cross-reference file
  `INVTABLE`{.envar}            ASCII       Inventory data table listing activity and pollutant names
  `MEPROC`{.envar} (optional)   ASCII       Mobile emission processes file
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e31161}6.15.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `CMB_CHKFRACS`{.envar}: \[default: Y\]

    Check whether the sum of multiple speciation profile split factors
    is equal to 1.0 or not.

    ::: {.itemizedlist}
    -   Y: Gives an error if the sume of split factors is not 1.0

    -   N: Do not check the sume of split factors
    :::

-   `FULLSCC_ONLY`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables").
    In this context, this option affects cross-referencing for the
    speciation cross-reference files by preventing left-7 SCC
    assignments. The application GSCNV files are not affected by this
    option when using FIPS/SCC assignments, and will continue to use
    left-7 SCC assignments even when FULLSCC\_ONLY is set to \"Y\".

-   `NO_SPC_ZERO_EMIS`{.envar}: \[default: N\]

    Defines whether the program applies the speciation profiles to zero
    emission sources.

    ::: {.itemizedlist}
    -   Y: Skip applying speciation profile to zero emission source

    -   N: Do not skip
    :::

-   `POLLUTANT_CONVERSION`{.envar}: \[default: N\]

    Defines whether the program uses the pollutant-to-pollutant
    conversion file ([Section 8.5.1, "`GSCNV`{.envar}:
    Pollutant-to-pollutant conversion
    file"](ch08s05.html#sect_input_gscnv "8.5.1. GSCNV: Pollutant-to-pollutant conversion file")).

    ::: {.itemizedlist}
    -   Y: Use conversion file

    -   N: Do not use conversion file
    :::

-   `REPORT_DEFAULTS`{.envar}: See description in [Section 6.2.3.2,
    "Input Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

-   `SMK_SOURCE`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

-   `SPCMAT_PERIOD`{.envar}: \[default:1\]

    Defines period number which could be month. It must match to the
    period number in ([Section 8.5.3, "`GSPRO_COMBO`{.envar}:
    Combination speciation profiles file
    "](ch08s05s03.html "8.5.3. GSPRO_COMBO: Combination speciation profiles file ")).

-   `SRC_TAGGING`{.envar}: \[default: N\]

    Defines whether the program uses the speciation tagging
    cross-reference file or not ([Section 8.5.5, "`GSTAG`{.envar}:
    Speciation tagging cross-reference file
    "](ch08s05s05.html "8.5.5. GSTAG: Speciation tagging cross-reference file ")).

    ::: {.itemizedlist}
    -   Y: Use speciation tagging cross-reference file

    -   N: Do not use speciation tagging cross-reference file
    :::

-   `DEFAULT_CONV_FAC_ERROR`{.envar}: \[default: N\]

    Defines whether the program treats as an error when there is no
    matched VOC to TOG conversion factor available in the
    pollutant-to-pollutant conversion file ([Section 8.5.1,
    "`GSCNV`{.envar}: Pollutant-to-pollutant conversion
    file"](ch08s05.html#sect_input_gscnv "8.5.1. GSCNV: Pollutant-to-pollutant conversion file")).

    ::: {.itemizedlist}
    -   Y: Use speciation tagging cross-reference file

    -   N: Do not use speciation tagging cross-reference file
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e31269}6.15.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                 Format           Description
  ------------------------- ---------------- -----------------------------------------
  `[A|M|P]SMAT_L`{.envar}   I/O API NetCDF   Mole-based speciation matrix
  `[A|M|P]SMAT_S`{.envar}   I/O API NetCDF   Mass-based speciation matrix
  `[A|M|P]SSUP`{.envar}     I/O API NetCDF   Speciation supplemental file
  `LOGFILE`{.envar}         ASCII            Log generated from executing **Spcmat**
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------
  [Prev](ch06s15s02.html)      [Up](ch06s15.html)     [Next](ch06s16.html)
  6.15.2. Processing Order     [Home](index.html)       6.16. **Temporal**
  --------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.16. **Temporal**
:::

[Prev](ch06s15s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s16s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_temporal}6.16. **Temporal** {#temporal .title style="clear: both"}
---------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.16.1. Description](ch06s16.html#d0e31325)]{.section}

[[6.16.2. Processing Order](ch06s16s02.html)]{.section}

[[6.16.3. Files and Environment Variables](ch06s16s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e31325}6.16.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} area, mobile, point

The **Temporal** program produces a file with hourly inventory pollutant
emissions. Unlike the SMOKE matrices produced by **Cntlmat**,
**Grdmat**, and **Spcmat**, the output file from **Temporal** contains
the actual emissions data. For all source categories, it uses temporal
profiles, temporal cross-references, and the time zone of each source to
create the hourly emissions output file. It can also read in
day-specific and hour-specific inventory data in SMOKE format, and it
uses the most detailed data it can when multiple types of data are
available for the same source. For example, if a source had annual,
day-specific, and hour-specific data, **Temporal** would use the
hour-specific emissions. The program can also apply source-specific
hourly profiles from the hour-specific data file, and it can override
all temporal profiles and use temporally uniform profiles for all
sources.

**Temporal** treats the temporal profiles as [*local*]{.emphasis}
profiles. In other words, the profile applied to the source is adjusted
based on the difference between the time zone of the source (determined
by the `COSTCY`{.envar} file) and the output time zone (determined by
the `OUTZONE`{.envar} environment variable). SMOKE automatically
considers Daylight Saving time when converting from a region's standard
time zone to the output time zone, and SMOKE can exclude regions that
never use Daylight Saving time based on the `COSTCY`{.envar} file. Note
that **Temporal** has been tested for time zones in the Western
Hemisphere, but we have not tested it for time zones in the Eastern
Hemisphere.

Within the **Temporal** program, the processing occurs as follows:

::: {.itemizedlist}
-   Temporal profiles are assigned for all sources.

-   Monthly (year-to-month) temporal profiles can be applied.

-   Daily (month-to-day) temporal profiles can be applied.

-   Weekly (month-to-weekly) temporal profiles can be applied.

-   Day-of-week specific hourly diurnal temporal profiles
    (Monday,,,Sunday, Weekday, Weekend, or All days) are applied.

-   Date-specific hourly diurnal temporal profiles (year-to-hour,
    month-to-hour or day-to-hour) can be applied.

-   Day-specific emissions or activities are read in and used to
    overwrite daily emissions for the appropriate sources

-   Hour-specific emissions or activities are read in and used to
    overwrite hourly emissions for the appropriate sources.
:::

Hourly temporal profiles can be applied for weekdays and weekend days by
default in the system. By breaking up the processing into different
periods, you can apply different temporal profiles for different days of
the week. A future version of SMOKE will permit different hourly
profiles for every day of the week in a single run of the **Temporal**
program.

A special holidays file should be provided so that holidays can receive
special treatment. This file specifies which daily profiles should be
applied to holidays.

A many-step hierarchy is used in applying the temporal
cross-referencing. SMOKE preferentially matches each source to the most
specific line in the cross-reference file. When there are missing
entries in the cross-reference file, **Temporal** first looks for
cross-reference entries for other species at the same level in the
search hierarchy before descending to the next level in the hierarchy.
For example, if a source has a temporal cross-reference entry for CO but
not for NO~x~, **Temporal** uses the source-specific CO temporal cross
reference entry for allocating NO~x~ from that source in preference to
using a default NO~x~ temporal profile.

For area sources, the available combinations are the following, starting
with the most specific. "[7-digit SCC]{.quote}" means a 10-digit SCC
with the last three digits set to zero. The maximum field width in SMOKE
and its input files for SCC is 20 characters as of SMOKE v4.0. The 8 or
10 digit SCC are still supported, but if the SCC is greater than 10
digits the SCC hierarchial approach will not be supported. The SIC may
also be up to 20 characters in length, but if the SIC is larger than 4
characters then the hierarchial approach will not be used. (NOTE: only
for SCC less than or equal to 10 characters and SIC less than or equal
to 4 characters)

::: {.orderedlist}
1.  Country/state/county code, 10-digit SCC, and pollutant

2.  Country/state/county code, 7-digit SCC, and pollutant

3.  Country/state code, 10-digit SCC, and pollutant

4.  Country/state code, 7-digit SCC, and pollutant

5.  10-digit SCC and pollutant

6.  7-digit SCC and pollutant

7.  Country/state/county code and 10-digit SCC

8.  Country/state/county code and 7-digit SCC

9.  Country/state code and 10-digit SCC

10. Country/state code and 7-digit SCC

11. 10-digit SCC

12. 7-digit SCC

13. Country/state/county code

14. Country/state code

15. Ultimate default (no pollutant, country/state/county code = 0, SCC
    = 0)
:::

For point sources, the available combinations depend on the source
definition. A header is used in the file to indicate the source
definition. For inventories, a source is defined as the unique
combination of country/state/county code, plant ID, point ID, stack ID,
segment, and SCC. "[5-digit SCC]{.quote}" means a 10-digit SCC with the
last 5 digits set to zero. If only 8-digit SCCs are available, these can
be used and SMOKE will assume leading zeros. In this case, the "[5-digit
SCC]{.quote}" becomes a "[3-digit SCC]{.quote}". The maximum field width
in SMOKE and its input files for SCC is 20 characters as of SMOKE v4.0.
The 8 or 10 digit SCC are still supported, but if the SCC is greater
than 10 digits the SCC hierarchial approach will not be supported. The
SIC may also be up to 20 characters in length, but if the SIC is larger
than 4 characters then the hierarchial approach will not be used.

The hierarchy of cross-referencing is the following. (NOTE: only for SCC
less than or equal to 10 characters, SIC less than or equal to 4
characters)

::: {.orderedlist}
1.  Country/state/county code, 10-digit SCC, plant ID, point ID, stack
    ID, segment, and pollutant

2.  Country/state/county code, 10-digit SCC, plant ID, point ID, stack
    ID, and pollutant

3.  Country/state/county code, 10-digit SCC, plant ID, point ID, and
    pollutant

4.  Country/state/county code, 10-digit SCC, plant ID, and pollutant

5.  Country/state/county code, 10-digit SCC, plant ID, point ID, stack
    ID, and segment

6.  Country/state/county code, 10-digit SCC, plant ID, point ID, and
    stack ID

7.  Country/state/county code, 10-digit SCC, plant ID, and point ID

8.  Country/state/county code, 10-digit SCC, and plant ID

9.  Country/state/county code, and plant ID

10. Country/state/county code, 10-digit SCC, and pollutant

11. Country/state/county code, 5-digit SCC, and pollutant

12. Country/state code, 10-digit SCC, and pollutant

13. Country/state code, 5-digit SCC, and pollutant

14. 10-digit SCC and pollutant

15. 5-digit SCC and pollutant

16. Country/state/county code and 10-digit SCC

17. Country/state/county code and 5-digit SCC

18. Country/state code and 10-digit SCC

19. Country/state code and 5-digit SCC

20. 10-digit SCC

21. 5-digit SCC

22. Country/state/county code

23. Country/state code

24. Ultimate default (all values = 0)
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------
  [Prev](ch06s15s03.html)                      [Up](ch06.html)        [Next](ch06s16s02.html)
  6.15.3. Files and Environment Variables     [Home](index.html)     6.16.2. Processing Order
  ------------------------------------------ -------------------- ---------------------------
:::
::: {.navheader}
6.16.2. Processing Order
:::

[Prev](ch06s16.html) 

6.16. **Temporal**

 [Next](ch06s16s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e31632}6.16.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smkinven** must be run before **Temporal**.

**Temporal** must be run before gridded, hour-specific emissions can be
produced using the **Smkmerge** program.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s16.html)     [Up](ch06s16.html)                     [Next](ch06s16s03.html)
  6.16. **Temporal**       [Home](index.html)     6.16.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.16.3. Files and Environment Variables
:::

[Prev](ch06s16s02.html) 

6.16. **Temporal**

 [Next](ch06s17.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e31649}6.16.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.16.3.1. Input Files](ch06s16s03.html#d0e31856)]{.section}

[[6.16.3.2. Input Environment
Variables](ch06s16s03.html#sect_programs_temporal_envar)]{.section}

[[6.16.3.3. Output Files](ch06s16s03.html#d0e32207)]{.section}
:::

::: {.figure}
[]{#fig_programs_temporal_area}

**Figure 6.23. Temporal input and output files for area sources**

::: {.mediaobject}
![Temporal input and output files for area
sources](images\programs\temporal_area_html.jpg)
:::
:::

[Figure 6.23, "Temporal input and output files for area
sources"](ch06s16s03.html#fig_programs_temporal_area "Figure 6.23. Temporal input and output files for area sources")
shows the input and output files for the **Temporal** program for area
sources. The input files include the inventory file output from
**Smkinven** (`AREA`{.envar}), the temporal profiles file
(`ATPRO`{.envar}), the temporal cross-reference file (`ATREF`{.envar}),
the country, state, and county codes file (`COSTCY`{.envar}), the
holidays file `HOLIDAYS`{.envar}), and optional process date file
(`PROCDATES`{.envar}).

**Temporal** outputs an hourly emissions file (`ATMP`{.envar}), a
temporal allocation supplemental file (`ATSUP`{.envar}), and a log file
(`LOGFILE`{.envar}).

::: {.figure}
[]{#fig_programs_temporal_mobile}

**Figure 6.24. Temporal input and output files for mobile sources**

::: {.mediaobject}
![Temporal input and output files for mobile
sources](images\programs\temporal_mobile_html.jpg)
:::
:::

[Figure 6.24, "Temporal input and output files for mobile
sources"](ch06s16s03.html#fig_programs_temporal_mobile "Figure 6.24. Temporal input and output files for mobile sources")
shows the input and output files for the **Temporal** program for mobile
sources. The input files include the country, state, and county codes
file (`COSTCY`{.envar}), the holidays file (`HOLIDAYS`{.envar}), the
optional process date file (`PROCDATES`{.envar}) and, if activity data
are used, the inventory data table (`INVTABLE`{.envar}). **Temporal**
also uses the inventory file output from **Smkinven** (`MOBL`{.envar}),
the temporal profiles file (`MTPRO`{.envar}), and the temporal
cross-reference file (`MTREF`{.envar}).

**Temporal** outputs a log file (`LOGFILE`{.envar}), an hourly emissions
file (`MTMP`{.envar}), and a temporal allocation supplemental file
(`MTSUP`{.envar}).

::: {.figure}
[]{#fig_programs_temporal_point}

**Figure 6.25. Temporal input and output files for point sources**

::: {.mediaobject}
![Temporal input and output files for point
sources](images\programs\temporal_point_html.jpg)
:::
:::

[Figure 6.25, "Temporal input and output files for point
sources"](ch06s16s03.html#fig_programs_temporal_point "Figure 6.25. Temporal input and output files for point sources")
shows the input and output files for the **Temporal** program for point
sources. The input files include the country, state, and county codes
file (`COSTCY`{.envar}), the holidays file (`HOLIDAYS`{.envar}) and the
optional process date file (`PROCDATES`{.envar}). If using day-specific
data, the `PDAY`{.envar} file is read, and the `PHOUR`{.envar} file is
read when using hour-specific data. **Temporal** also uses the inventory
file output from **Smkinven** (`PNTS`{.envar}), the temporal profiles
file (`PTPRO`{.envar}), and the temporal cross-reference file
(`PTREF`{.envar}).

**Temporal** outputs a log file (`LOGFILE`{.envar}), an hourly emissions
file (`PTMP`{.envar}), and a temporal allocation supplemental file
(`PTSUP`{.envar}).

Optionally, **Temporal** may be run using `PROCDATES`{.envar}. This
enables the processing of sequential or non-sequential user specified
days. If `PROCDATES`{.envar} is not assigned, the defaults apply. When
running **Temporal** interactively, the following inputs will be
requested. The default values for these are set by the
`G_STDATE`{.envar}, `G_STTIME`{.envar}, and `G_RUNLEN`{.envar}
environment variables.

::: {.itemizedlist}
-   Start date: Starting date of simulation in Julian (YYYYDDD) or
    Gregorian (YYYYMMDD) formats

-   Start Time: Starting time of simulation in HHMMSS

-   Duration: Simulation duration in hours
:::

`PROCDATES`{.envar}: See description in [Section 8.3.4,
"`PROCDATES`{.envar}: Procdates date
list"](ch08s03s04.html "8.3.4. PROCDATES: Procdates date list").

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e31856}6.16.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                                                Format           Description
  -------------------------------------------------------------------------------------------------------- ---------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `[AREA|MOBL|PNTS]`{.envar}                                                                               SMOKE map        Intermediate inventory file produced by **Smkinven**
  `[A|M|P]TPRO_MONTHLY`{.envar}                                                                            ASCII            Monthly Temporal profiles
  `[A|M|P]TPRO_DAILY`{.envar}                                                                              ASCII            Month-to-day Temporal profiles
  `[A|M|P]TPRO_WEEKLY`{.envar}                                                                             ASCII            Weekly Temporal profiles
  `[A|M|P]TPRO_HOURLY`{.envar}                                                                             ASCII            Day-to-hour Temporal profiles
  `[A|M|P]TPRO_HOURLY_NCF`{.envar}                                                                         ASCII            Meteorological-based hourly Temporal profiles
  `[A|M|P]TREF`{.envar}                                                                                    ASCII            Temporal cross-reference file
  `COSTCY`{.envar}                                                                                         ASCII            Country/state/county codes file, used to determine counties that do not use Daylight Saving time.
  [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")   ASCII            Geographical level codes and descriptions for gridded inventories, only when USE\_EXP\_GEO\_CODES is set to Y, (COSTCY is ignored when [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files") files are used)
  `HOLIDAYS`{.envar}                                                                                       ASCII            Holidays file by Gregorian date, for applying holiday temporal profiles.
  `PROCDATES`{.envar} (optional)                                                                           ASCII            Processes user specified Gregorian dates
  `INVTABLE`{.envar} (optional)                                                                            ASCII            Inventory data table listing pollutant and activity names; required only if activity data are used
  `PDAY`{.envar} (optional)                                                                                I/O API NetCDF   Day-specific intermediate inventory file created by **Smkinven** (required if `DAY_SPECIFIC_YN`{.envar} is set to Y)
  `PHOUR`{.envar} (optional)                                                                               I/O API NetCDF   Hour-specific intermediate inventory file created by **Smkinven** (required if `HOUR_SPECIFIC_YN`{.envar} is set to Y)
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_programs_temporal_envar}6.16.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `DAY_SPECIFIC_YN`{.envar}: See description in [Section 6.13.3.2,
    "Input Environment
    Variables"](ch06s13s03.html#sect_programs_smkinven_envar "6.13.3.2. Input Environment Variables")

-   `FULLSCC_ONLY`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables").
    In this context, this option affects cross-referencing for the
    temporal cross-reference files by preventing left-7 SCC assignments.

-   `USE_EXP_GEO_CODES`{.envar}: \[default: N\]

    If set to Y then use GEOCODE\_LEVEL\[1-4\] files instead of the
    COSTCY file to define expanded geographical detail such as
    country-level(GEOCODE\_LEVEL1), country/state-level
    (GEOCODE\_LEVEL2), country/state/county-level (GEOCODE\_LEVEL3) or
    country/state/county/tribal-level (GEOCODE\_LEVEL4).

-   `HOUR_SPECIFIC_YN`{.envar}: See description in [Section 6.13.3.2,
    "Input Environment
    Variables"](ch06s13s03.html#sect_programs_smkinven_envar "6.13.3.2. Input Environment Variables")

-   `HOURLY_TPROF_BASE`{.envar}: \[default: blank\]

    Defines the base of hourly temporal profiles. This flag is only
    applicable when hourly temporal profiles generated by **Gentpro** is
    available for **Temporal** to use. For a proper processing of hourly
    temporal profiles from **Gentpro**, user must let **Temporal** know
    the basis of hourly temporal profiles (i.e., hour of day, hour of
    month or hour of year). **Gentpro** outputs hourly temporal profiles
    IDs into temporal cross-reference input file
    (`[A|M|P]TREF`{.envar}). See detail information at [Section 8.3.2,
    "`[A|M|P]TREF`{.envar}: Temporal cross-reference
    file"](ch08s03s02.html "8.3.2. [A|M|P]TREF: Temporal cross-reference file").
    If `HOUR_PROFID`{.envar} column is filled by **Gentpro**, user must
    define the base of hourly profiles to correctly convert
    annual/monthly/daily inventories. If processing monthly inventory,
    user must set it to \'MONTH\'.

    ::: {.itemizedlist}
    -   YEAR: Convert raw annual inventory to hourly inventory values.

    -   MONTH: Convert calculated monthly inventory to hourly inventory
        values.
    :::

-   `OUTPUT_LOCAL_TIME`{.envar}: \[default: N\]

    Defines whether the program processes daily/hourly inventories in
    local time or not.

    ::: {.itemizedlist}
    -   Y: Process daily/hourly inventories in local time. No time zone
        shift.

    -   N: Apply time zone shift.
    :::

-   `OUTZONE`{.envar}: : \[default: 0\]

    Indicates offset from Greenwich Mean Time (GMT) for episode start
    date and time. `OUTZONE`{.envar} should be set to the standard time
    for the time zone of interest; SMOKE will adjust to Daylight Saving
    time for episodes that are during periods and in regions where
    Daylight Saving time applies.

    [Table 2.9, "Example `OUTZONE`{.envar} settings and their associated
    time
    zones"](ch02s10s04.html#tbl_concepts_outzone "Table 2.9. Example OUTZONE settings and their associated time zones")
    provides allowed values for `OUTZONE`{.envar}. The CMAQ model
    expects `OUTZONE`{.envar} to be 0, while other models such as
    UAM-IV, UAM-V and CAM~X~ often use time zone 5. All models expect
    that the emissions and the meteorology data provided to the model
    will have a consistent time zone. SMOKE expects that the meteorology
    data will be in GMT.

    Note that SMOKE expects `OUTZONE`{.envar} to be set as a positive
    number for time zones in the Western Hemisphere, although standard
    notation would list these as negative values. For example, Eastern
    Standard Time is -5:00 hours from GMT, but `OUTZONE`{.envar} for EST
    in SMOKE is 5.

-   `RENORM_TPROF`{.envar}: \[default: Y\]

    Defines whether **Temporal** normalizes the temporal profiles or
    uses them as they exist in the data file. If the profiles are
    specified as decimal values and sum to 1, then specify N. Otherwise,
    specify Y and the program will sum the values associated with each
    profile and then divide each value by the sum, thereby creating a
    normalized profile.

    ::: {.itemizedlist}
    -   Y: Normalize the temporal profiles

    -   N: Use the temporal profile values as they exist in the data
        file
    :::

-   `REPORT_DEFAULTS`{.envar}: See description in [Section 6.2.3.2,
    "Input Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

-   `SMK_AVEDAY_YN`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

-   `SMK_EF_MODEL`{.envar}: \[default:blank\]

    Name of the emission factor model to use. NOTE: User must set it to
    MOVES when processing activity inventory data (i.e., VMT, VPOP and
    SPEED).

-   `SMK_MAXERROR`{.envar}: See description in [Section 6.13.3.2, "Input
    Environment
    Variables"](ch06s13s03.html#sect_programs_smkinven_envar "6.13.3.2. Input Environment Variables")

-   `SMK_MAXWARNING`{.envar}: See description in [Section 6.13.3.2,
    "Input Environment
    Variables"](ch06s13s03.html#sect_programs_smkinven_envar "6.13.3.2. Input Environment Variables")

-   `SMK_SOURCE`{.envar}: See description in [Section 6.2.3.2, "Input
    Environment
    Variables"](ch06s02s03.html#sect_programs_cntlmat_envar "6.2.3.2. Input Environment Variables")

-   `UNIFORM_TPROF_YN`{.envar}: \[default: N\]

    Defines whether to use uniform temporal profiles for all sources.

    ::: {.itemizedlist}
    -   Y: Use uniform temporal profiles

    -   N: Use temporal profiles file and temporal cross-reference file
    :::

-   `ZONE4WM`{.envar}: \[default: Y\]

    Defines whether **Temporal** applies weekly and monthly temporal
    profiles using time zones. If SMOKE does not apply the profiles
    using the sources' time zones, then all sources change from one day
    to the next or one month to the next at the same hour. This is what
    other emission processing systems have typically done, and it is a
    minor distinction in most cases.

    ::: {.itemizedlist}
    -   Y: Use time zones

    -   N: Do not use time zones
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e32207}6.16.3.3. Output Files {#output-files .title}

</div>

</div>
:::

As of SMOKE version 2.3, two new environmental variables
`[A|M|P]TMPNAME`{.envar} and `[A|M|P]TSUPNAME`{.envar} are required to
set the directory and file prefix used to dynamically name the output
files `[A|M|P]TMP`{.envar} and `[A|M|P]TSUP`{.envar}.

::: {.informaltable}
  File Name               Format           Description
  ----------------------- ---------------- -----------------------------------------------------------------------------------------------------------------------------------------------
  `[A|M|P]TMP`{.envar}    I/O API NetCDF   Hourly emissions by source; if using elevated point sources as part of point-source processing, this file contains only the layer-1 emissions
  `[A|M|P]TSUP`{.envar}   ASCII            Temporal allocation supplemental file
  `LOGFILE`{.envar}       ASCII            Log generated from executing **Temporal**
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------
  [Prev](ch06s16s02.html)      [Up](ch06s16.html)     [Next](ch06s17.html)
  6.16.2. Processing Order     [Home](index.html)       6.17. **Tmpbeis3**
  --------------------------- -------------------- -----------------------
:::
::: {.navheader}
6.17. **Tmpbeis3**
:::

[Prev](ch06s16s03.html) 

Chapter 6. SMOKE Core Programs

 [Next](ch06s17s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_programs_tmpbeis3}6.17. **Tmpbeis3** {#tmpbeis3 .title style="clear: both"}
---------------------------------------------

</div>

</div>
:::

::: {.toc}
[[6.17.1. Description](ch06s17.html#d0e32269)]{.section}

[[6.17.2. Processing Order](ch06s17s02.html)]{.section}

[[6.17.3. Files and Environment Variables](ch06s17s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e32269}6.17.1. Description {#description .title}

</div>

</div>
:::

[*Processing categories:*]{.emphasis} biogenic

**Tmpbeis3** uses version 3.14 or version 3.60 of the BEIS3 model.
**Tmpbeis3** reads the gridded, normalized emissions file
`B3GRD`{.envar} and meteorological data from `MET_FILE1`{.envar} and
optionally `MET_FILE2`{.envar} (these files may be either
`MET_CRO_2D`{.envar} or `MET_CRO_3D`{.envar}). Note that **Tmpbeis3**
uses temperature and surface pressure data that must be in
`MET_FILE1`{.envar}, and radiation/cloud data that may be in
`MET_FILE1`{.envar} or `MET_FILE2`{.envar}. Within **Tmpbeis3**,
speciation profiles are used to speciate biogenic pollutants for
appropriate chemical mechanisms. Various speciation profiles for the
CB6, and SAPRC mechanisms are available for BEIS3 modeling. The
normalized emissions and meteorological data are used to produce
gridded, speciated, hourly biogenic emissions. Additionally, an optional
seasonal switch file, `BIOSEASON`{.envar}, can be used to determine when
and where to use summer or winter normalized emissions data on a daily
basis.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------
  [Prev](ch06s16s03.html)                      [Up](ch06.html)        [Next](ch06s17s02.html)
  6.16.3. Files and Environment Variables     [Home](index.html)     6.17.2. Processing Order
  ------------------------------------------ -------------------- ---------------------------
:::
::: {.navheader}
6.17.2. Processing Order
:::

[Prev](ch06s17.html) 

6.17. **Tmpbeis3**

 [Next](ch06s17s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e32316}6.17.2. Processing Order {#processing-order .title}

</div>

</div>
:::

The **Normbeis3** program must be executed before **Tmpbeis3**.

If you are using the seasonal switch option, the seasonal switch file
(`BIOSEASON`{.envar}) must be created using the utility program
**Metscan** before running **Tmpbeis3**.

**Tmpbeis3** must be executed before biogenic emissions can be used in
**Smkmerge**.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------- -------------------- ------------------------------------------
  [Prev](ch06s17.html)     [Up](ch06s17.html)                     [Next](ch06s17s03.html)
  6.17. **Tmpbeis3**       [Home](index.html)     6.17.3. Files and Environment Variables
  ----------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
6.17.3. Files and Environment Variables
:::

[Prev](ch06s17s02.html) 

6.17. **Tmpbeis3**

 [Next](ch07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e32345}6.17.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[6.17.3.1. Input Files](ch06s17s03.html#d0e32410)]{.section}

[[6.17.3.2. Input Environment
Variables](ch06s17s03.html#d0e32513)]{.section}

[[6.17.3.3. Output Files](ch06s17s03.html#d0e32804)]{.section}

[[6.17.3.4. Processing Multiple Days with
BEIS3](ch06s17s03.html#d0e32855)]{.section}
:::

::: {.figure}
[]{#fig_programs_tmpbeis3}

**Figure 6.26. Tmpbeis3 input and output files**

::: {.mediaobject}
![Tmpbeis3 input and output files](images\programs\tmpbeis3_html.jpg)
:::
:::

[Figure 6.26, "Tmpbeis3 input and output
files"](ch06s17s03.html#fig_programs_tmpbeis3 "Figure 6.26. Tmpbeis3 input and output files")
shows the input and output files for the **Tmpbeis3** program. The input
files include the gridded, normalized biogenic emissions from
**Normbeis3** (`B3GRD`{.envar}) and, if `BIOSW_YN`{.envar} = Y, then a
gridded, seasonal switch file output from **Metscan** is required
(`BIOSEASON`{.envar}). The biogenic speciation profiles are read from
the `GSPRO`{.envar} file and the `GRID_CRO_2D`{.envar} contains the
latitude and longitute for each grid cell. **Tmpbeis3** reads surface
pressure and radiation/cloud data from `MET_FILE1`{.envar} and
optionally from `MET_FILE2`{.envar} if `BIOMET_SAME`{.envar} = N.

**Tmpbeis3** outputs gridded, speciated, hourly biogenic emissions files
in moles/hour (`B3GTS_L`{.envar}) and tons/hour (`B3GTS_S`{.envar}). The
program also outputs an execution log file (`LOGFILE`{.envar}).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e32410}6.17.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                        Format           Description
  -------------------------------- ---------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `B3GRD`{.envar}                  I/O API NetCDF   Gridded, normalized biogenic emissions, output from **Normbeis3**
  `BIOSEASON`{.envar} (optional)   I/O API NetCDF   Gridded seasonal switch file containing daily data, with "[0]{.quote}" meaning use winter normalized emissions and "[1]{.quote}" meaning use the summer normalized emissions, produced by **Metscan**
  `GSPRO`{.envar}                  ASCII            Speciation profiles file ([**use "[BV309]{.quote}" for CB04 speciation profile or "[B10C5]{.quote}" for CB05 speciation profile.**]{.bold})
  `GRID_CRO_2D`{.envar}            I/O API NetCDF   Meteorology file containing latitude and longitude coordinates for each grid cell
  `MET_FILE1`{.envar}              I/O API NetCDF   Meteorology file containing temperature and surface pressure data and possibly radiation/cloud data as well (see `BIOMET_SAME`{.envar} environment variable)
  `MET_FILE2`{.envar} (optional)   I/O API NetCDF   Meteorology file containing radiation/cloud data if not in `MET_FILE1`{.envar}
  `SOILINP`{.envar} (optional)     I/O API NetCDF   Gridded soil restart file ( use if `INITIAL_RUN = N`{.envar})
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e32513}6.17.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `BEIS_VERSION`{.envar}: \[default: 3.60\]

    Specifies which version of BEIS3 to use.

    ::: {.itemizedlist}
    -   3.60: Use BEIS version 3.60.

    -   3.14: Use BEIS version 3.14.
    :::

-   `BG_CLOUD_TYPE`{.envar}: \[default: 1\]

    Specifies which meteorological data to use.

    ::: {.itemizedlist}
    -   1: Use RGND or RSD (solar radiation reaching the ground) from
        MM5 to calculate PAR. No other options are supported at this
        time.
    :::

-   `BIOG_SPRO`{.envar}: \[default: BV310\]

    Specifies the speciation profile for biogenic emissions from GSPRO.

    ::: {.itemizedlist}
    -   B3V10: Use BEIS version 3.60.

    -   BV313: Use BEIS version 3.14.
    :::

-   `BIOMET_SAME`{.envar}: \[default: N\]

    Defines whether the radiation/cloud data are in the same file as the
    temperature data (`MET_FILE1`{.envar}) or in a different file
    (`MET_FILE2`{.envar}).

-   `BIOSW_YN`{.envar}: \[default: Y\]

    Indicates whether to use a gridded seasonal switch file.

    ::: {.itemizedlist}
    -   Y: Use gridded seasonal switch file `BIOSEASON`{.envar}

    -   N: Use environment variable `SUMMER_YN`{.envar} to determine
        season
    :::

-   `INITIAL_RUN`{.envar}: \[default: N\]

    Indicates whether a particular day is the first day in a sequence of
    simulations.

    ::: {.itemizedlist}
    -   Y: Use for the first day in a sequence of simulations. Use if
        the `SOILINP`{.envar} file does not yet exist (i.e., the soil NO
        calculations will not depend on the previous day's rainfall).

    -   N: Use for subsequent days in a sequence of simulations. Use if
        the `SOILINP`{.envar} file exists.
    :::

    Note that BEIS3 will create a `SOILINP`{.envar} file for days
    subsequent to the first day in a sequence of simulations.

-   `ISLTYP_VAR`{.envar}: \[default: SLTYP\]

    Specifies the soil type variable name used if
    `PX_VERSION = Y.`{.envar}

-   `LAI_VAR`{.envar}: \[default: LAI\]

    Specifies the variable name for the leaf area index from the me
    model (e.g. WRF) used for the leaf temperature algorithm (Only for
    BEIS version 3.60)

-   `OUTZONE`{.envar}: See description in [Section 6.16.3.2, "Input
    Environment
    Variables"](ch06s16s03.html#sect_programs_temporal_envar "6.16.3.2. Input Environment Variables")

-   `OUT_UNITS`{.envar}: \[default: 1\]

    Specifies units for the output variables.

    ::: {.itemizedlist}
    -   1: moles per hour.

    -   2: moles per second.
    :::

-   `PRES_VAR`{.envar}: \[default: PRSFC\]

    Specifies the variable name for surface pressure data to extract
    from `MET_FILE1`{.envar}.

-   `PX_VERSION`{.envar}: \[default: N\]

    Indicates whether the Pleim-Xiu land surface model was used in the
    MM5 simulations.

    ::: {.itemizedlist}
    -   Y: Use if the Pleim-Xiu land surface model was used in the MM5
        simulations. Indicates that `MET_FILE1`{.envar} contains soil
        temperature, soil moisture and soil type fields that can be
        used, along with rainfall data, for NO soil emission
        calculations in **Tmpbeis3**.

    -   N: Use if the Pleim-Xiu land surface model was not used in the
        MM5 simulations. Indicates that **Tmpbeis3** will calculate NO
        soil emissions using only rainfall data.
    :::

-   `Q2_VAR`{.envar}: \[default: Q2\]

    Specifies the variable name for the two meter water vapor mixing
    ratio (kg/kg) used for the leaf temperature algorithm (Only for BEIS
    version 3.60).

-   `RAD_VAR`{.envar}: \[default: RGRND\]

    Specifies the variable name for radiation/cloud data to extract from
    either `MET_FILE1`{.envar} or optional `MET_FILE2`{.envar}.

-   `RADYNI_VAR`{.envar}: \[default: RADYNI\]

    Specifies the variable name for the aerodynamic resistance variable
    (s/m) used for the leaf temperature algorithm (Only for BEIS version
    3.60).

-   `RGRND_VAR`{.envar}: \[default: RGRND\]

    Specifies the variable name for the solar radiation reaching the
    ground used for the leaf temperature algorithm (Only for BEIS
    version 3.60).

-   `RSTOMI_VAR`{.envar}: \[default: RSTOMI\]

    Specifies the variable name for the inverse of the stomatal
    resistance variable (m/s) used for the leaf temperature algorithm
    (Only for BEIS version 3.60).

-   `RC_VAR`{.envar}: \[default: RC\]

    Specifies the convective rainfall variable name used in
    `MET_FILE1`{.envar}.

-   `RN_VAR`{.envar}: \[default: RN\]

    Specifies the non-convective rainfall variable name used in
    `MET_FILE1`{.envar}.

-   `SOILM_VAR`{.envar}: \[default: SOIM1\]

    Specifies the soil moisture variable name used if
    `PX_VERSION = Y`{.envar}.

-   `SOILT_VAR`{.envar}: \[default: SOIT1\]

    Specifies the soil temperature variable name used if
    `PX_VERSION = Y`{.envar}.

-   `SUMMER_YN`{.envar}: \[default: Y\]

    Indicates whether summer or winter normalized emissions should be
    used; only used when `BIOSW_YN`{.envar} is N.

    ::: {.itemizedlist}
    -   Y: Use summer normalized emissions

    -   N: Use winter normalized emissions
    :::

-   `TEMPG_VAR`{.envar}: \[default: TEMPG\]

    Specifies the skin temperature at the ground level (K) used for the
    leaf temperature algorithm (Only for BEIS version 3.60).

-   `TMPR_VAR`{.envar}: \[default: TA\]

    Specifies the variable name for temperature to extract from
    `MET_FILE1`{.envar}.

-   `USTAR_VAR`{.envar}: \[default: USTAR\]

    Specifies the variable name for the surface friction velocity (m/s)
    used for the leaf temperature algorithm (Only for BEIS version
    3.60).
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e32804}6.17.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- --------------------------------------------------------------
  `B3GTS_L`{.envar}   I/O API NetCDF   Gridded, speciated, hourly biogenic emissions, in moles/hour
  `B3GTS_S`{.envar}   I/O API NetCDF   Gridded, speciated, hourly biogenic emissions, in tons/hour
  `SOILOUT`{.envar}   I/O API NetCDF   Gridded soil restart file
  `LOGFILE`{.envar}   ASCII            Log generated from executing **Tmpbeis3**
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e32855}6.17.3.4. Processing Multiple Days with BEIS3 {#processing-multiple-days-with-beis3 .title}

</div>

</div>
:::

The user must point to the `SOILOUT`{.envar} file from one day's
simulation as the `SOILINP`{.envar} file for the next day. The user must
also decide whether to write over `SOILOUT`{.envar} files from previous
days or create a uniquely named `SOILOUT`{.envar} file for each day. The
latter approach is recommended if the user wishes to retain the
capability to restart simulations in the middle of a sequence of
simulations.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -------------------------------------
  [Prev](ch06s17s02.html)      [Up](ch06s17.html)                      [Next](ch07.html)
  6.17.2. Processing Order     [Home](index.html)     Chapter 7. SMOKE Quality Assurance
  --------------------------- -------------------- -------------------------------------
:::
