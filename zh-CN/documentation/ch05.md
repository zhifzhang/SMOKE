::: {.navheader}
Chapter 5. SMOKE Utility Tools
:::

[Prev](ch04s04s24.html) 

 

 [Next](ch05s02.html)

------------------------------------------------------------------------

::: {.chapter lang="en"}
::: {.titlepage}
<div>

<div>

[]{#ch_utilities}Chapter 5. SMOKE Utility Tools {#chapter-5.-smoke-utility-tools .title}
-----------------------------------------------

</div>

</div>
:::

::: {.toc}
[[5.1. Overview](ch05.html#d0e17421)]{.section}

[[5.2. MOVES Utility Scripts](ch05s02.html)]{.section}

[[5.3. SMOKE Utility Programs](ch05s03.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#d0e17421}5.1. Overview {#overview .title style="clear: both"}
--------------------------

</div>

</div>
:::

The utility tools are divided into two sections: MOVES Utility Scripts
and SMOKE Utility Programs
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------------------- -------------------- -----------------------------
  [Prev](ch04s04s24.html)                                                                           [Next](ch05s02.html)
  4.4.24. Generating AERMOD-ready Input Data Files \[SMOKE4AERMOD)     [Home](index.html)     5.2. MOVES Utility Scripts
  ------------------------------------------------------------------- -------------------- -----------------------------
:::
::: {.navheader}
5.2. MOVES Utility Scripts
:::

[Prev](ch05.html) 

Chapter 5. SMOKE Utility Tools

 [Next](ch05s02s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#section_moves_utilities}5.2. MOVES Utility Scripts {#moves-utility-scripts .title style="clear: both"}
------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[5.2.1. Overview](ch05s02.html#d0e17429)]{.section}

[[5.2.2. MOVES Driver Scripts](ch05s02s02.html)]{.section}

[[5.2.3. Run MOVES Model](ch05s02s03.html)]{.section}

[[5.2.4. MOVES Post-processing scripts](ch05s02s04.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e17429}5.2.1. Overview {#overview .title}

</div>

</div>
:::

The MOVES utility scripts are designed to assist the user by automating
the proper use of using MOVES emission rate calculations for the purpose
of estimating mobile-source emissions for air quality modeling. The
MOVES default database has over 100 different tables that store
lookup/reference information, conversions/adjustment factors, emissions
data, and activity data. MOVES uses MySQL databases to store user
inputs, intermediate results and final outputs. The MOVES utility
scripts consist of 1) MOVES Driver script and 2) MOVES Post-processing
scripts. These scripts are run after the meteorological data processor
program (**Met4moves**) which prepares the spatially and temporally
averaged temperatures and relative humidity data used as meteorological
input conditions for MOVES and SMOKE using the Meteorology-Chemistry
Interface Processor (MCIP) output files.

The MOVES Driver script (**Runspec\_generator.pl**) creates data
importer files and importer script and the MOVES batch run script which
specifies the characteristic of the particular scenario to be modeled.

The MOVES Post-processing script (**Moves2smkEF.pl**) formats the MOVES
emission rate lookup tables for SMOKE. The second MOVES Post-processing
script (**gen\_8digit\_scc.pl**) generates an SCC mapping file used when
importing activity data in **Smkinven**. After the MOVES utility scripts
are completed, the SMOKE postprocessing program (**Movesmrg**) estimates
emissions from mobile sources using the SMOKE formatted MOVES lookup
tables (RPD, RPP, RPV, and RPH) output generated by the MOVES utility
scripts and meteorology data from **Met4moves**.

**Movesmrg** creates hourly, gridded, speciated air quality model-ready
input files. Information about key concepts related to the MOVES utility
scripts including Representative Counties, Fuels Months, and Emissions
Processes are covered in [Section 2.8.4.6, "Representative
Counties"](ch02s08s04.html#sect_concepts_reference_counties_moves "2.8.4.6. Representative Counties")
and [Section 2.8.4.7, "Reference Fuel
month"](ch02s08s04.html#sect_concepts_moves_reference_fuel_month "2.8.4.7. Reference Fuel month")
and [Section 2.8.4.9, " MOVES Emission Processes by Emission Rate
Tables"](ch02s08s04.html#sect_concepts_moves_emission_processes "2.8.4.9.  MOVES Emission Processes by Emission Rate Tables")
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------- -------------------- ------------------------------
  [Prev](ch05.html)                   [Up](ch05.html)           [Next](ch05s02s02.html)
  Chapter 5. SMOKE Utility Tools     [Home](index.html)     5.2.2. MOVES Driver Scripts
  --------------------------------- -------------------- ------------------------------
:::
::: {.navheader}
5.2.2. MOVES Driver Scripts
:::

[Prev](ch05s02.html) 

5.2. MOVES Utility Scripts

 [Next](ch05s02s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#section_moves_driver_script}5.2.2. MOVES Driver Scripts {#moves-driver-scripts .title}

</div>

</div>
:::

::: {.toc}
[[5.2.2.1. Processing Order](ch05s02s02.html#d0e17486)]{.section}

[[5.2.2.2. How-To-Run](ch05s02s02.html#d0e17553)]{.section}

[[5.2.2.3. Files and Environment
Variables](ch05s02s02.html#d0e17564)]{.section}
:::

The MOVES Runspec script **Runspec\_generator.pl** is written in Perl,
generates the scripts and inputs needed to run MOVES for each
representative county. The MOVES Model can be run at any of the three
domains/scales: national, county or project. The
**Runspec\_generator.pl** is only applicable to the county-level because
this level of model detail is required by EPA for SIP and conformity
analyses. For this scale, MOVES requires a MySQL input database
containing local data for a single county. The **Runspec\_generator.pl**
is designed to prepare the MOVES importer and MOVES run scripts so that
the fewest number of runs will produce all of the necessary emissions
factors. In this approach, user can specify one or more groups of
pollutants to model in the run control fil.

There are a total of four types of modeling pollutant groups: 1) Ozone
precursors, 2) Toxics, 3) Particulate Matters, and 4) GreenHouse Gases
(GHG) based on [Table 2.8, "MOVES Pollutant
Groups"](ch02s08s04.html#tbl_concepts_moves_pollutant_groups "Table 2.8. MOVES Pollutant Groups").
The choice of pollutant group(s) determines what pollutants are included
in the three emission rate lookup tables (RPD, RPV, and RPP) by MOVES.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e17486}5.2.2.1. Processing Order {#processing-order .title}

</div>

</div>
:::

**Runspec\_generator.pl** run after **Met4moves**. It assembles the
instructions for MOVES to create MySQL input databases from XML files
and creates the importer.csh scripts and assembles run specification XML
files to run MOVES for a necessary range of conditions (for each
emissions process: rate-per-distance, rate-per-vehicle, and
rate-per-profile) based on the **Met4moves** output temperature list by
county-specific runspec.csh.

The **Runspec\_generator.pl** uses following steps:

::: {.orderedlist}
1.  Reads the representative county min/max temperature and 24-hours
    temperature profiles output file from **Met4moves** for RPP mode.
    Find detail information from [Section 9.8.1,
    "`MOVES_OUTFILE`{.envar}"](ch09s08.html#sect_intmed_moves_output "9.8.1. MOVES_OUTFILE")

2.  Reads the representative county specific min/max temperatures and
    average RH output file from **Met4moves** for RPD, RPV and RPH
    modes. Find detail information from [Section 9.8.2,
    "`MOVES_RH_OUTFILE`{.envar}"](ch09s08s02.html "9.8.2. MOVES_RH_OUTFILE")

3.  Import the name of pollutant group to model from the run control
    file
    ([contorl.in](ch08s09s02.html#sect_input_runctlfile "8.9.2.2.1. Run Control File for MOVES Driver Script"))
    based on [Table 2.8, "MOVES Pollutant
    Groups"](ch02s08s04.html#tbl_concepts_moves_pollutant_groups "Table 2.8. MOVES Pollutant Groups")

4.  Reads the run control file
    ([control.in](ch08s09s02.html#sect_input_runctlfile "8.9.2.2.1. Run Control File for MOVES Driver Script"))
    and representative county file
    ([countyrep.in](ch08s09s02.html#sect_input_refcountyfile "8.9.2.2.2. Representative County File for MOVES Driver Script"))
    created by user.

5.  Assembles instructions for MOVES to create MySQL input databases
    from XML files (data importer).

6.  Assembles runspec XML files to run MOVES for a wide range of
    conditions.

7.  Generates the run-specific temperature and humidity
    comma-separated-values (CSV) format file.

8.  Assembles a batch list of data importer files, runspec files, and
    also a list of the MySQL output database names to be postprocessed.

9.  importer.csh and runspec.csh scripts are used to create the on-road
    operating rateperdistance table (RPD), off-network processes
    ratepervehicle table (RPV), and vapor venting off-network
    rateperprofile table (RPP).

10. Review log file of the MOVES, called runlog\_\*.txt.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e17553}5.2.2.2. How-To-Run {#how-to-run .title}

</div>

</div>
:::

Check out the most latest processing scripts and the "[How to
run]{.quote}" instructions are available from [the SMOKE-MOVES Github
repository](https://github.com/CEMPD/SMOKE-MOVES/).
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e17564}5.2.2.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.2.2.3.1. Input Files](ch05s02s02.html#d0e17567)]{.section}

[[5.2.2.3.2. Output
Files](ch05s02s02.html#section_moves_driver_script_output)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e17567}5.2.2.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.table}
[]{#tbl_smoke_moves_utility_script}

**Table 5.1. Input Files**

  File Name                                                                                                                                                 Format   Description
  --------------------------------------------------------------------------------------------------------------------------------------------------------- -------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  [countyrep.in](ch08s09s02.html#sect_input_refcountyfile "8.9.2.2.2. Representative County File for MOVES Driver Script")                                  ASCII    Representative county file containing the county/state/country FIPS codes and the full path and file names for the files containing MOVES data for AGE, FUELSUPPLY, FUELFORM(optional), IM, POP, SourceType, HPMSVMT, VMT for each representative county
  [control.in](ch08s09s02.html#sect_input_runctlfile "8.9.2.2.1. Run Control File for MOVES Driver Script")                                                 ASCII    Run control file that user specifies fields for the Database Host, Project Name, Model year, day type (weekday or weekend), pollutant and the met4moves MET output file for the batch run of MOVES
  [MOVES\_OUTFILE](ch09s08.html#sect_intmed_moves_output "9.8.1. MOVES_OUTFILE")                                                                            ASCII    **Met4moves** output for each fuel month for the MOVES Driver script (minimum and maximum temperatures, and 24-hour temperature profiles for all representative counties by temperature bin)
  [MOVES\_RH\_OUTFILE](ch09s08s02.html "9.8.2. MOVES_RH_OUTFILE")                                                                                           ASCII    **Met4moves** outputs fuel month-specific averaged, min, and max temperatures and averaged RH values in local time for all representative counties by temperature bin
  [sourceTypeAgeDistribution](ch08s09s02.html#sect_input_sourceTypeAgeDist "8.9.2.2.3. Age Distribution File for Representative County for MOVES model")    ASCII    Age distribution by source type over 30 vehicle model years
  [fuelSupply](ch08s09s02.html#sect_input_fuelsupply "8.9.2.2.4. Fuel Supply file for MOVES model")                                                         ASCII    list directed file used to define the fuel properties, their market shares and the months that the fuels are used for each representative county
  [fuelformulation (optional)](ch08s09s02.html#sect_input_fuelformulation "8.9.2.2.5. Fuel Formulation file for MOVES model (optional)")                    ASCII    list directed file used to define the fuel supply and the months that the fuels are used for each representative counties
  [IMCoverage](ch08s09s02.html#sect_input_IMcoverage "8.9.2.2.7. IM Coverage file for MOVES Model")                                                         ASCII    list directed file used to define the inspection and maintanance data available for each representative counties
  [sourcetypeyear](ch08s09s02.html#sect_input_sourcetypeyear "8.9.2.2.8. MOVES Vehicle Population by source type input file for MOVES model")               ASCII    Vehicle population by MOVES source type
  [HPMSVTypeYear](ch08s09s02.html#sect_input_HPMSVTypeYear "8.9.2.2.6. HPMSV Type for MOVES model")                                                         ASCII    list directed file used to define the annual VMT by Highway Performance Monitoring System (HPMS) vehicle type
  [dummy\_avgspeeddistribution](ch08s09s02.html#sect_input_dummy_avgspeeddistribution "8.9.2.2.9. Dummy Average Speed Distribution file for MOVES model")   ASCII    Speed distribution by roadway type and vehicle class. MOVES dummy inputs files provided with tool package in OUTDIR directory
  [dummy\_monthvmtfraction](ch08s09s02.html#sect_input_dummy_monthvmtfraction "8.9.2.2.12. Dummy Month VMT Fraction file for MOVES model")                  ASCII    list directed file that allocates annual VMT to the individual months
  [dummy\_dayvmtfraction](ch08s09s02.html#sect_input_dummy_dayvmtfraction "8.9.2.2.10. Dummy Day VMT Fraction file for MOVES model")                        ASCII    file that allocates month VMT day type, weekday or weekend and the decimal fraction of the proportion of vehicle miles travelled for the weekday or weekend day type
  [dummy\_hourvmtfraction](ch08s09s02.html#sect_input_dummy_hourvmtfraction "8.9.2.2.11. Dummy Hour VMT Fraction file for MOVES model")                     ASCII    list directed file that allocates the day-type VMT to individual hours of the day
  [dummy\_roadtypedistribution](ch08s09s02.html#sect_input_dummy_roadtypedistribution "8.9.2.2.13. Dummy Road Type Distribution file for MOVES model")      ASCII    list directed file that allocates annual VMT to five MOVES roadway types
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#section_moves_driver_script_output}5.2.2.3.2. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
+-----------------------------+--------+-----------------------------+
| File Name                   | Format | Description                 |
+=============================+========+=============================+
| [runspec.csh](c             | ASCII  | Batch or c-shell script to  |
| h05s02s03.html#section_move |        | run required MOVES runs.    |
| s_runspec_batch "5.2.3.3. M |        | Fine more information from  |
| OVES Runspec batch script") |        | [Section 5.2.3.3, "MOVES    |
|                             |        | Runspec batch               |
|                             |        | script"](c                  |
|                             |        | h05s02s03.html#section_move |
|                             |        | s_runspec_batch "5.2.3.3. M |
|                             |        | OVES Runspec batch script") |
+-----------------------------+--------+-----------------------------+
| [impor                      | ASCII  | Batch or c-shell Script to  |
| ter.csh](ch05s02s03.html#se |        | create MySQL MOVES          |
| ction_moves_importer "5.2.3 |        | databases and import the    |
| .2. MOVES importer script") |        | data. Fine more information |
|                             |        | from [Section 5.2.3.2,      |
|                             |        | "MOVES importer             |
|                             |        | script"](ch05s02s03.html#se |
|                             |        | ction_moves_importer "5.2.3 |
|                             |        | .2. MOVES importer script") |
+-----------------------------+--------+-----------------------------+
| InputDBlist                 | ASCII  | List of MySQL database      |
|                             |        | names to process. It will   |
|                             |        | be used as an input to      |
|                             |        | MOVES Post-processing       |
|                             |        | script. See example below:  |
|                             |        |                             |
|                             |        | ``` {.programlisting}       |
|                             |        | localhost                   |
|                             |        | /work/MOVES_Proc            |
|                             |        | essing_Scripts/post_process |
|                             |        | 13121_2008_1                |
|                             |        | ```                         |
+-----------------------------+--------+-----------------------------+
| Data importer files         | ASCII  | data importer files         |
|                             |        | (\*\_imp.xml)               |
+-----------------------------+--------+-----------------------------+
| Runspec files               | ASCII  | runspec files (\*\_mrs.xml) |
+-----------------------------+--------+-----------------------------+
| zonemonthhour files         | ASCII  | MOVES-formatted             |
|                             |        | zonemonthhour (\*\_zmh.csv) |
|                             |        | contains temperature and RH |
|                             |        | data from the Met4Moves     |
|                             |        | Meteorological processor.   |
|                             |        | Relative Humidity is a      |
|                             |        | single value averaged over  |
|                             |        | the time period selected by |
|                             |        | the user in Met4Moves and   |
|                             |        | averaged over the entire    |
|                             |        | group of inventory counties |
|                             |        | that map to a               |
|                             |        | representative county.      |
+-----------------------------+--------+-----------------------------+
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------- -------------------- --------------------------
  [Prev](ch05s02.html)           [Up](ch05s02.html)     [Next](ch05s02s03.html)
  5.2. MOVES Utility Scripts     [Home](index.html)      5.2.3. Run MOVES Model
  ----------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.2.3. Run MOVES Model
:::

[Prev](ch05s02s02.html) 

5.2. MOVES Utility Scripts

 [Next](ch05s02s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#section_moves_runs}5.2.3. Run MOVES Model {#run-moves-model .title}

</div>

</div>
:::

::: {.toc}
[[5.2.3.1. Overview](ch05s02s03.html#d0e17782)]{.section}

[[5.2.3.2. MOVES importer
script](ch05s02s03.html#section_moves_importer)]{.section}

[[5.2.3.3. MOVES Runspec batch
script](ch05s02s03.html#section_moves_runspec_batch)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e17782}5.2.3.1. Overview {#overview .title}

</div>

</div>
:::

Automatically execute multiple MOVES runs based on automatically
generated county-specific data importer script and the MOVES run script
file by **Runspec\_generator.pl**, which specifies the characteristic of
the particular scenario to be modeled.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#section_moves_importer}5.2.3.2. MOVES importer script {#moves-importer-script .title}

</div>

</div>
:::

::: {.toc}
[[5.2.3.2.1. Description](ch05s02s03.html#d0e17793)]{.section}

[[5.2.3.2.2. Processing Order](ch05s02s03.html#d0e17810)]{.section}

[[5.2.3.2.3. Files, Environment Variables, and Run
Syntax](ch05s02s03.html#d0e17827)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e17793}5.2.3.2.1. Description {#description .title}

</div>

</div>
:::

The MOVES importer script "[importer.\[bat\|csh\]]{.quote}" can be
written in Linux C-shell or Windows Batch script format depending on
which option is chosen by the user in the **Runspec\_generator.pl**. The
importer script loads the county-specific data in the file and creates
the MySQL input database containing local data for the representative
county.

The output of the MOVES batch importer script includes:

::: {.itemizedlist}
-   MySQL databases (\*\_in).
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e17810}5.2.3.2.2. Processing Order {#processing-order .title}

</div>

</div>
:::

importer.csh should be run before runspec.csh. The importer.csh is
written in Linux c-shell script format.

The importer.csh uses following steps:

::: {.orderedlist}
1.  The importer.csh contains all of the user selections needed to
    import data from the files into a MySQL MOVES database

2.  Imports the data for each of the three different emissions
    processes: RPD, RPV, RPP.

3.  Review log file of the MOVES, called importlog\_\*.txt.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e17827}5.2.3.2.3. Files, Environment Variables, and Run Syntax {#files-environment-variables-and-run-syntax .title}

</div>

</div>
:::

::: {.toc}
[[5.2.3.2.3.1. Input Files](ch05s02s03.html#d0e17830)]{.section}

[[5.2.3.2.3.2. Output Files](ch05s02s03.html#d0e17868)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e17830}5.2.3.2.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                            Format   Description
  -------------------------------------------------------------------- -------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  RV\_\[CountyRep\]\_\[yearID\]\_\[monthID\]\_\[TempBin\]\_imp.xml     XML      file specifies the zonemonthhour (\*zmh.csv) files and other files that will be imported to MOVES for the Rate Per Vehicle Mode, note: TempBin varies, in 5 degree increments to cover the Temperature Range ie. \[TempBin\] = T10, T15,.. T105 for the temperature range \[TempRange\]= T10\_105
  RP\_\[CountyRep\]\_\[yearID\]\_\[monthID\]\_\[MetProfID\]\_imp.xml   XML      file specifies the zonemonthhour (\*zmh.csv) files that will be imported to MOVES for the Rate Per Process Mode
  RD\_\[CountyRep\]\_\[yearID\]\_\[monthID\]\_\[TempRange\]\_imp.xml   XML      importer file specifies the zonemonthhour (\*zmh.csv) files that will be imported to MOVES for Rate Per Distance Mode
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e17868}5.2.3.2.3.2. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                       Format   Description
  --------------------------------------------------------------- -------- ------------------------------------------------------
  RD\_\[CountyRep\]\_\[yearID\]\_\[monthID\]\_\[TempRange\]\_in   MySQL    MOVES MySQL Database RPD Table (\*\_in)
  RP\_\[CountyRep\]\_\[yearID\]\_\[monthID\]\_\[MetProfID\]\_in   MySQL    MOVES MySQL Database RPP SMOKE format Table (\*\_in)
  RV\_\[CountyRep\]\_\[yearID\]\_\[monthID\]\_\[TempBin\]\_in     MySQL    MOVES MySQL Database RPV Table(\*\_in)
:::
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#section_moves_runspec_batch}5.2.3.3. MOVES Runspec batch script {#moves-runspec-batch-script .title}

</div>

</div>
:::

::: {.toc}
[[5.2.3.3.1. Description](ch05s02s03.html#d0e17909)]{.section}

[[5.2.3.3.2. Processing Order](ch05s02s03.html#d0e17931)]{.section}

[[5.2.3.3.3. Files, Environment Variables, and Run
Syntax](ch05s02s03.html#d0e17954)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e17909}5.2.3.3.1. Description {#description-1 .title}

</div>

</div>
:::

The MOVES Runspec batch script file "[runspec.csh]{.quote}" is used to
execute the MOVES runs for the representative county and reference fuel
month.

The output directories are named according to the following naming
convention: \[CountyRep\]\_\[monthID\]\_\[YearID\]\_\[PollutantID\], ie.
13121\_Apr\_2009\_ozone

The output files include:

::: {.itemizedlist}
-   rateperdistance.\[frm\|MYD\|MYI\]

-   ratepervehicle.\[frm\|MYD\|MYI\]

-   rateperprofile.\[frm\|MYD\|MYI\]
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e17931}5.2.3.3.2. Processing Order {#processing-order-1 .title}

</div>

</div>
:::

runspec.csh is created by **Runspec\_generator.pl** and should be run
after importer.csh and before **moves2smkEF.pl**. The runspec.csh is
written in Linux c-shell script format depending on which platform is
being used (this option is specified by the user in the
Runspec\_generator.pl) the script is used to run MOVES for the
appropriate temperature bins, source types, and poluutants.

The runspec.csh uses following steps:

::: {.orderedlist}
1.  The runspec.csh contains all of the user selections needed to run
    MOVES using the imported MySQL MOVES databases that were created by
    importer.csh

2.  Creates the MOVES output in ASCII format and also provides the
    associated XML files for the three different emissions processes:
    RPD, RPV, RPP.

3.  Review log file of the MOVES, called runlog\_\*.txt.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e17954}5.2.3.3.3. Files, Environment Variables, and Run Syntax {#files-environment-variables-and-run-syntax-1 .title}

</div>

</div>
:::

::: {.toc}
[[5.2.3.3.3.1. Input Files](ch05s02s03.html#d0e17957)]{.section}

[[5.2.3.3.3.2. Output Files](ch05s02s03.html#d0e18003)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e17957}5.2.3.3.3.1. Input Files {#input-files-1 .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                                          Format   Description
  -------------------------------------------------------------------------------------------------- -------- -------------------------------------------------------------------------------------------------------------------------
  [runspec.csh](ch05s02s03.html#section_moves_runspec_batch "5.2.3.3. MOVES Runspec batch script")   ASCII    runspec script to use the MySQL MOVES databases created by importer.csh and run MOVES
  RV\_\[SCC\]\_\[YR\]\_\[M\]\_\[TempBin\]\_mrs.xml                                                   XML      importer file specifies the zonemonthhour (\*zmh.csv files that will be imported to MOVES for the Rate Per Vehicle Mode
  RP\_\[SCC\]\_\[YR\]\_\[M\]\_\[ProfMYEAR???\]\_mrs.xml                                              XML      importer file specifies the \*.csv files that will be imported to MOVES for the Rate Per Process Mode
  RD\_\[SCC\]\_\[YR\]\_\[M\]\_\[TempBin\]\_\[85 or 90?\]\_mrs.xml                                    XML      importer file specifies the \*.csv files that will be imported to MOVES for Rate Per Distance Mode
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e18003}5.2.3.3.3.2. Output Files {#output-files-1 .title}

</div>

</div>
:::

Note: these output files are placed in separate directories for each
representative county, fuel month and pollutant. Example:
\.../outputs/mysql/13121\_Jan\_2009\_ozone

::: {.informaltable}
  File Name                                          Format   Description
  -------------------------------------------------- -------- -------------------------------------------------------------------------------------------------
  rateperdistance.\[frm\|MYD\|MYI\]                  MySQL    MOVES MySQL Database RPD Table (\*.frm,\*.MYD,\*.MYI)
  ratepervehicle.\[frm\|MYD\|MYI\]                   MySQL    MOVES MySQL Database RPV Table(\*.frm,\*.MYD,\*.MYI)
  ratepervehicle\_smoke.\[frm\|MYD\|MYI\]            MySQL    MOVES MySQL Database RPV SMOKE format Table(\*.frm,\*.MYD,\*.MYI)
  rateperprofile.\[frm\|MYD\|MYI\]                   MySQL    MOVES MySQL Database RPP Table (\*.frm,\*.MYD,\*.MYI)
  rateperprofile\_smoke.\[frm\|MYD\|MYI\]            MySQL    MOVES MySQL Database RPP SMOKE format Table (\*.frm,\*.MYD,\*.MYI)
  activitytype.\[frm\|MYD\|MYI\]                     MySQL    MOVES MySQL Database activity type Table (\*.frm,\*.MYD,\*.MYI)
  agefractotals.\[frm\|MYD\|MYI\]                    MySQL    MOVES age fraction totals Table(\*.frm,\*.MYD,\*.MYI)
  movesactivityoutput.\[frm\|MYD\|MYI\]              MySQL    MOVES MySQL Database activity output Table (\*.frm,\*.MYD,\*.MYI)
  moveserror.\[frm\|MYD\|MYI\]                       MySQL    MOVES MySQL Database error Table (\*.frm,\*.MYD,\*.MYI)
  moveseventlog.\[frm\|MYD\|MYI\]                    MySQL    MOVES MySQL Database event log Table(\*.frm,\*.MYD,\*.MYI)
  movesoutput.\[frm\|MYD\|MYI\]                      MySQL    MOVES MySQL Database output Table (\*.frm,\*.MYD,\*.MYI)
  movesrun.\[frm\|MYD\|MYI\]                         MySQL    MOVES MySQL Database run Table (\*.frm,\*.MYD,\*.MYI)
  movestablesused.\[frm\|MYD\|MYI\]                  MySQL    MOVES MySQL Database tables used Table (\*.frm,\*.MYD,\*.MYI)
  movesworkersused.\[frm\|MYD\|MYI\]                 MySQL    MOVES MySQL Database workers used Table(\*.frm,\*.MYD,\*.MYI)
  moves.\[frm\|MYD\|MYI\]                            MySQL    MOVES MySQL Database output Table (\*.frm,\*.MYD,\*.MYI)
  rdprex.\[frm\|MYD\|MYI\]                           MySQL    MOVES MySQL Database RDPREX Table(\*.frm,\*.MYD,\*.MYI)
  rpprex.\[frm\|MYD\|MYI\]                           MySQL    MOVES MySQL Database RPPREX output Table (\*.frm,\*.MYD,\*.MYI)
  rvprex.\[frm\|MYD\|MYI\]                           MySQL    MOVES MySQL Database RVPREX Table(\*.frm,\*.MYD,\*.MYI)
  sccvtypeagedistribution.\[frm\|MYD\|MYI\]          MySQL    MOVES MySQL Database SCCV Type Age Distribution output Table (\*.frm,\*.MYD,\*.MYI)
  sccvtypeagedistribution\_final.\[frm\|MYD\|MYI\]   MySQL    MOVES MySQL Database SCCV Type Age Distribution Final output Table (\*.frm,\*.MYD,\*.MYI)
  tmprdscc.\[frm\|MYD\|MYI\]                         MySQL    MOVES MySQL Database temporary RD SCC output Table (\*.frm,\*.MYD,\*.MYI)
  tmprpscc.\[frm\|MYD\|MYI\]                         MySQL    MOVES MySQL Database temporary RP SCC output Table (\*.frm,\*.MYD,\*.MYI)
  tmprvscc.\[frm\|MYD\|MYI\]                         MySQL    MOVES MySQL Database temporary RV SCC output Table (\*.frm,\*.MYD,\*.MYI)
  tmp\_sccroadtypedistribution.\[frm\|MYD\|MYI\]     MySQL    MOVES MySQL Database temporary scc road type distribution output Table (\*.frm,\*.MYD,\*.MYI)
  tmp\_srcfuelagedistribution.\[frm\|MYD\|MYI\]      MySQL    MOVES MySQL Database temporary source fuel age distribution output Table (\*.frm,\*.MYD,\*.MYI)
  travelfrac\_denominator.\[frm\|MYD\|MYI\]          MySQL    MOVES MySQL Database travel fraction denominator Table (\*.frm,\*.MYD,\*.MYI)
  travelfrac\_numerator.\[frm\|MYD\|MYI\]            MySQL    MOVES MySQL Database travel fraction numerator Table (\*.frm,\*.MYD,\*.MYI)
  travelfractions.\[frm\|MYD\|MYI\]                  MySQL    MOVES MySQL Database travel fractions Table (\*.frm,\*.MYD,\*.MYI)
:::
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------ -------------------- ---------------------------------------
  [Prev](ch05s02s02.html)         [Up](ch05s02.html)                  [Next](ch05s02s04.html)
  5.2.2. MOVES Driver Scripts     [Home](index.html)     5.2.4. MOVES Post-processing scripts
  ------------------------------ -------------------- ---------------------------------------
:::
::: {.navheader}
5.2.4. MOVES Post-processing scripts
:::

[Prev](ch05s02s03.html) 

5.2. MOVES Utility Scripts

 [Next](ch05s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#section_moves_postprocessing_scripts}5.2.4. MOVES Post-processing scripts {#moves-post-processing-scripts .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.1. Overview](ch05s02s04.html#d0e18221)]{.section}

[[5.2.4.2. **Moves2smkEF.pl**](ch05s02s04.html#d0e18237)]{.section}

[[5.2.4.3.
**gen\_8digit\_scc.pl**](ch05s02s04.html#sect_moves_gen_sccxref)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18221}5.2.4.1. Overview {#overview .title}

</div>

</div>
:::

The MOVES Post-processing scripts consist of two Perl scripts. One is
called **"[Moves2smkEF.pl]{.quote}"** which extracts the emissions
factor tables from the MOVES databases and converts them into a format
that can be used as SMOKE inputs. The second script, called
**"[gen\_8digit\_scc.pl]{.quote}"**, produces a file mapping 8-digit
SCCs to 10-digit SCCs used when importing activity data in **Smkinven**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18237}5.2.4.2. **Moves2smkEF.pl** {#moves2smkef.pl .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.2.1. Description](ch05s02s04.html#d0e18241)]{.section}

[[5.2.4.2.2. Processing Order](ch05s02s04.html#d0e18293)]{.section}

[[5.2.4.2.3. Files, Environment Variables and Run
Syntax](ch05s02s04.html#d0e18310)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18241}5.2.4.2.1. Description {#description .title}

</div>

</div>
:::

The MOVES post-processor script **"[Moves2smkEF.pl]{.quote}"** extracts
the emission factor tables from the MOVES databases (RPD, RPV, RPP, and
RPH MOVES formatted Lookup tables) and converts them into a format that
can be processed using **Movesmrg**.

::: {.orderedlist}
1.  Create a new field for \'countyID\'

    None of the MOVES lookup tables contain a countyID field solely
    dedicated to a state-county FIPS code, but SMOKE needs this
    information. For this reason, **Moves2smkEF.pl** creates a county
    field by extracting it from other fields that include county codes
    as part of their value. The RPD table has a linkID field that
    contains countyID in the leading five digits followed by more
    numbers to allow for future implementation of link modeling. The RPV
    table has a zoneID field that is countyID with a trailing zero. The
    RPP table has a TemperatureProfileID field, which also leads with
    countyID and is trailed by other numbers to indicate month and other
    identification. The RPH table has a linkID field the same as the RPD
    table. The postprocessing script parses countyID from linkID, zoneID
    and TemperatureProfileID and stores it as a separate field.

2.  Map MOVES pollutantID to output pollutant/species name

    The pollutant mapping file has columns for MOVES2014 Pollutant ID,
    MOVES2014 Pollutant Name, and SMOKE Pollutant/Model Species Name.
    **Moves2smkEF.pl** reads this list to determine which MOVES
    pollutants to output in the emission factor files and what name to
    use for each pollutant. Because MOVES2014 contains emission factors
    for both inventory pollutants and model species, the sample
    pollutant mapping file included with SMOKE uses the \_INV suffix to
    distinguish inventory pollutants from model species.

3.  Cross-tab pollutantID to reduce output table size

    Each of the four MOVES lookup tables contains a pollutantID field,
    and associated emission rates for each are listed in the
    ratePerDistance, ratePerVehicle, or ratePerHour field (depending on
    lookup table). This table structure repeats the leftmost fields
    (e.g., MOVESRunID, yearID, monthID) for each pollutantID, which
    greatly increases the total number of rows. The cross-tabbing
    postprocessing step replaces the column for \'ratePerDistance\' (or
    \'ratePerVehicle\' or \'ratePerHour\') with additional
    pollutant-specific columns containing values of emission rates. For
    example, new field headings would include \'CO\_INV\', \'NOX\',
    \'BENZENE\_INV\', etc. Performing this cross-tab on the pollutant
    emission rates significantly reduces the size of the tables for use
    by SMOKE.

4.  Aggregate emission factors by fuel type, source type, road type,
    and/or process type

    To reduce the total number of sources to be processed in SMOKE,
    **Moves2smkEF.pl** supports user-specified aggregations of MOVES
    fuel types, source types, road types, and process types to SCCs.

5.  Apply formulas to calculate additional inventory pollutants or model
    species

    Formulas can be applied to augment the existing MOVES output
    pollutants. For example, speciated versions of criteria pollutants
    are not provided in the MOVES2014 output nor are speciated emission
    factors for brake and tire wear.

6.  Create final emission rate lookup tables in SMOKE format

    The four postprocessed tables named rateperdistance\_smoke,
    ratepervehicle\_smoke, rateperprofile\_smoke, and rateperhour\_smoke
    are exported from MySQL into ASCII files for their use in SMOKE.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18293}5.2.4.2.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Moves2smkEF.pl** is run after **Runspec\_generator.pl**, and before
any SMOKE processing. The **Moves2smkEF.pl** is written in Perl,
generates SMOKE-ready MOVES lookup tables (i.e., RPD, RPV, RPP, and RPH)
by each representative county and fuel month for inputs to
[**Movesmrg**](ch06s08.html "6.8. Movesmrg").
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18310}5.2.4.2.3. Files, Environment Variables and Run Syntax {#files-environment-variables-and-run-syntax .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.2.3.1. Input Files](ch05s02s04.html#d0e18313)]{.section}

[[5.2.4.2.3.2. Run Command syntax](ch05s02s04.html#d0e18415)]{.section}

[[5.2.4.2.3.3. Output Files](ch05s02s04.html#d0e18439)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e18313}5.2.4.2.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
[]{#tbl_moves_lookup_tables}

+--------------------------+--------------+--------------------------+
| File Name                | Format       | Description              |
+==========================+==============+==========================+
|   -----------------      | MOVES format | Columns in the MOVES     |
|   rateperdistance        |              | Emission Rate Lookup     |
|   ratepervehicle         |              | Table are described in   |
|   rateperprofile         |              | [Table 2.10, "MOVES      |
|   rateperhour            |              | Emission Rate Lookup     |
|   -----------------      |              | Table (MOVES             |
|                          |              | Format)"]                |
|                          |              | (ch02s16s02.html#tbl_con |
|                          |              | cepts_moves_lookup_tbl_m |
|                          |              | v_format "Table 2.10. MO |
|                          |              | VES Emission Rate Lookup |
|                          |              |  Table (MOVES Format)"). |
+--------------------------+--------------+--------------------------+
|                          |              |                          |
+--------------------------+--------------+--------------------------+
| `InputDBList`{.envar}:   | ASCII        | List of MySQL database   |
|                          |              | names to process         |
|                          |              | generated by             |
|                          |              | *                        |
|                          |              | *Runspec\_generator.pl** |
+--------------------------+--------------+--------------------------+
| `Polluta                 | ASCII        | List of formulas used to |
| ntFormulasFile`{.envar}: |              | calculate additional     |
|                          |              | emission factors         |
+--------------------------+--------------+--------------------------+
| `FuelT                   | ASCII        | List of MOVES fuel type  |
| ypeMappingFile`{.envar}: |              | IDs and corresponding    |
|                          |              | aggregated fuel type ID  |
+--------------------------+--------------+--------------------------+
| `SourceT                 | ASCII        | List of MOVES source     |
| ypeMappingFile`{.envar}: |              | type IDs and             |
|                          |              | corresponding aggregated |
|                          |              | source type ID           |
+--------------------------+--------------+--------------------------+
| `RoadT                   | ASCII        | List of MOVES road type  |
| ypeMappingFile`{.envar}: |              | IDs and corresponding    |
|                          |              | aggregated road type ID  |
+--------------------------+--------------+--------------------------+
| `ProcessT                | ASCII        | List of MOVES process    |
| ypeMappingFile`{.envar}: |              | type IDs and             |
|                          |              | corresponding aggregated |
|                          |              | process type ID          |
+--------------------------+--------------+--------------------------+
| `Pollut                  | ASCII        | List of MOVES pollutant  |
| antMappingFile`{.envar}: |              | IDs and corresponding    |
|                          |              | pollutant name; only     |
|                          |              | listed pollutants will   |
|                          |              | be included in output    |
|                          |              | emission factor tables   |
+--------------------------+--------------+--------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e18415}5.2.4.2.3.2. Run Command syntax {#run-command-syntax .title}

</div>

</div>
:::

``` {.programlisting}
moves2smkEF.pl [-r RPD|RPV|RPP|RPH] [--formulas PollutantFormulasFile] [--fuel_agg FuelTypeMappingFile] [--src_agg SourceTypeMappingFile] [--road_agg RoadTypeMappingFile] [--proc_agg ProcessTypeMappingFile] InputDBList PollutantMappingFile [OutputPath]
```

::: {.itemizedlist}
-   RPD\|RPP\|RPV\|RPH - optional type of emission factors to process
    (rate-per-distance, rate-per-vehicle, rate-per-profile, or
    rate-per-hour); if not specified, script will process all four types
-   PollutantFormulasFile - list of formulas used to calculate
    additional emission factors
-   FuelTypeMappingFile - list of MOVES fuel type IDs and corresponding
    aggregated fuel type ID
-   SourceTypeMappingFile - list of MOVES source type IDs and
    corresponding aggregated source type ID
-   RoadTypeMappingFile - list of MOVES road type IDs and corresponding
    aggregated road type ID
-   ProcessTypeMappingFile - list of MOVES process type IDs and
    corresponding aggregated process type ID
-   InputDBList - list of MySQL database names to process (generated by
    runspec\_generator.pl MOVES preprocessor)
-   PollutantMappingFile - list of MOVES pollutant IDs and corresponding
    pollutant name
-   OutputPath - optional; overrides the output path specified in
    InputDBList
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

###### []{#d0e18439}5.2.4.2.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
[]{#tbl_smoke_lookup_tables}

  File Name                                 Format   Description
  ----------------------------------------- -------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `rateperdistance_smoke*.csv`{.envar}      ASCII    RPD SMOKE formatted lookup table (fuel month specific). The format of MOVES lookup tables are described in [Table 2.11, "MOVES Emission Rate Lookup Table (SMOKE Format)"](ch02s16s02.html#tbl_concepts_moves_lookup_tbl_sm_format "Table 2.11. MOVES Emission Rate Lookup Table (SMOKE Format)").
  `ratepervehicle_smoke*.csv`{.envar}       ASCII    RPV SMOKE formatted lookup table (fuel month specific)
  `rateperprofile_smoke*.csv`{.envar}       ASCII    RPP SMOKE formatted lookup table (fuel month specific)
  `rateperhour_smoke*.csv`{.envar}          ASCII    RPH SMOKE formatted lookup table (fuel month specific)
  `mcrlist.rateperdistance*.lst`{.envar}:   ASCII    list of MOVES-based rateperdistance lookup tables
  `mcrlist.ratepervehicle*.lst`{.envar}:    ASCII    list of MOVES-based ratepervehicle lookup tables
  `mcrlist.rateperprofile*.lst`{.envar}:    ASCII    list of MOVES-based rateperprofile lookup tables
  `mcrlist.rateperhour*.lst`{.envar}:       ASCII    list of MOVES-based rateperhour lookup tables
:::
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_moves_gen_sccxref}5.2.4.3. **gen\_8digit\_scc.pl** {#gen_8digit_scc.pl .title}

</div>

</div>
:::

::: {.toc}
[[5.2.4.3.1. Description](ch05s02s04.html#d0e18530)]{.section}

[[5.2.4.3.2. Processing Order](ch05s02s04.html#d0e18541)]{.section}

[[5.2.4.3.3. Files, Environment Variables and Run
Syntax](ch05s02s04.html#d0e18559)]{.section}

[[5.2.4.3.4. Run Command syntax](ch05s02s04.html#d0e18626)]{.section}

[[5.2.4.3.5. Output Files](ch05s02s04.html#d0e18644)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18530}5.2.4.3.1. Description {#description-1 .title}

</div>

</div>
:::

The **gen\_8digit\_scc.pl** script generates a file mapping 8-digits
SCCs to aggregated SCCs produced by **Moves2smkEF.pl**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18541}5.2.4.3.2. Processing Order {#processing-order-1 .title}

</div>

</div>
:::

The Perl script performs the following steps:

::: {.itemizedlist}
-   Connect to the first database listed in the InputDBList file

-   Query the specified database table (rateperdistance, ratepervehicle,
    rateperprofile, or rateperhour) and generate a list of all SCCs in
    the MOVES2014 output

-   Apply the fuel type, source type, road type, and process type
    mappings to generate a list of 10-digit aggregated SCCs

-   Output the list of 10-digit aggregated SCCs with corresponding
    8-digit SCC (first 8 digits of 10-digit SCC)
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18559}5.2.4.3.3. Files, Environment Variables and Run Syntax {#files-environment-variables-and-run-syntax-1 .title}

</div>

<div>

##### []{#d0e18559}5.2.4.3.3. Files, Environment Variables and Run Syntax {#files-environment-variables-and-run-syntax-2 .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                           Format   Description
  ----------------------------------- -------- -----------------------------------------------------------------------------------------------------------------------------
  `FuelTypeMappingFile`{.envar}:      ASCII    List of MOVES fuel type IDs and corresponding aggregated fuel type ID
  `SourceTypeMappingFile`{.envar}:    ASCII    List of MOVES source type IDs and corresponding aggregated source type ID
  `RoadTypeMappingFile`{.envar}:      ASCII    List of MOVES road type IDs and corresponding aggregated road type ID
  `ProcessTypeMappingFile`{.envar}:   ASCII    List of MOVES process type IDs and corresponding aggregated process type ID
  `InputDBList`{.envar}:              ASCII    List of MySQL database names to process generated by **Runspec\_generator.pl**; only the first database listed will be used
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18626}5.2.4.3.4. Run Command syntax {#run-command-syntax-1 .title}

</div>

</div>
:::

``` {.programlisting}
gen_8digit_scc.pl -r RPD|RPV|RPP|RPH [--fuel_agg FuelTypeMappingFile] [--src_agg SourceTypeMappingFile] [--road_agg RoadTypeMappingFile] [--proc_agg ProcessTypeMappingFile] InputDBList
```

::: {.itemizedlist}
-   RPD\|RPP\|RPV\|RPH - emission factor table to query
    (rateperdistance, ratepervehicle, rateperprofile, or rateperhour)
-   FuelTypeMappingFile - list of MOVES fuel type IDs and corresponding
    aggregated fuel type ID
-   SourceTypeMappingFile - list of MOVES source type IDs and
    corresponding aggregated source type ID
-   RoadTypeMappingFile - list of MOVES road type IDs and corresponding
    aggregated road type ID
-   ProcessTypeMappingFile - list of MOVES process type IDs and
    corresponding aggregated process type ID
-   InputDBList - list of MySQL database names to process (generated by
    runspec\_generator.pl MOVES preprocessor); only first database
    listed will be used
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18644}5.2.4.3.5. Output Files {#output-files-1 .title}

</div>

</div>
:::

**gen\_8digit\_scc.pl** outputs a list of 10-digit SCCs and
corresponding 8-digit SCCs. Users should direct this output to the file
of their choosing.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -------------------------------
  [Prev](ch05s02s03.html)     [Up](ch05s02.html)             [Next](ch05s03.html)
  5.2.3. Run MOVES Model      [Home](index.html)     5.3.  SMOKE Utility Programs
  -------------------------- -------------------- -------------------------------
:::
::: {.navheader}
5.3.  SMOKE Utility Programs
:::

[Prev](ch05s02s04.html) 

Chapter 5. SMOKE Utility Tools

 [Next](ch05s03s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#section_sm_utilities}5.3.  SMOKE Utility Programs {#smoke-utility-programs .title style="clear: both"}
-----------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[5.3.1. Overview](ch05s03.html#d0e18654)]{.section}

[[5.3.2. **Aggwndw**](ch05s03s02.html)]{.section}

[[5.3.3. **BlueSky2Inv**](ch05s03s03.html)]{.section}

[[5.3.4. **CEMScan**](ch05s03s04.html)]{.section}

[[5.3.5. **Gentpro**](ch05s03s05.html)]{.section}

[[5.3.6. **Geofac**](ch05s03s06.html)]{.section}

[[5.3.7. **Inlineto2D**](ch05s03s07.html)]{.section}

[[5.3.8. **Invsplit**](ch05s03s08.html)]{.section}

[[5.3.9. **Layalloc**](ch05s03s09.html)]{.section}

[[5.3.10. **Metcombine**](ch05s03s10.html)]{.section}

[[5.3.11. **Metscan**](ch05s03s11.html)]{.section}

[[5.3.12. **Pktreduc**](ch05s03s12.html)]{.section}

[[5.3.13. **Smk2emis**](ch05s03s13.html)]{.section}

[[5.3.14. **Surgtool**](ch05s03s14.html)]{.section}

[[5.3.15. **Uam2ncf**](ch05s03s15.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e18654}5.3.1. Overview {#overview .title}

</div>

</div>
:::

There are thirteen programs covered in this section:

[**Aggwndw**](ch05s03s02.html "5.3.2. Aggwndw") is a utility program
that can aggregate or window emissions from an I/O API file to a new
grid.

[**BlueSky2Inv**](ch05s03s03.html "5.3.3. BlueSky2Inv") converts output
files from the BlueSky fire modeling framework into inventory files that
SMOKE can read.

The [**CEMScan**](ch05s03s04.html "5.3.4. CEMScan") program calculates
summed annual NOx emissions, SO~2~ emissions, heat input, gross load,
and steam load from a year's worth of CEM data. The output from
**CEMScan** is used by **Smkinven** to calculate hourly emissions from
annual inventory data when processing CEM data.

[**Gentpro**](ch05s03s05.html "5.3.5. Gentpro") allows the user to use
county average meteorology data to estimate temporal profiles of
emissions.

[**Geofac**](ch05s03s06.html "5.3.6. Geofac") adjusts SMOKE hourly,
gridded, speciated emissions in based on a specified geographic region

[**Invsplit**](ch05s03s08.html "5.3.8. Invsplit") splits an ORL
inventory into separate inventories by state, grouping the states as
indicated by your inputs.

[**Inlineto2D**](ch05s03s07.html "5.3.7. Inlineto2D") merge CMAQ Inline
2D emissions with stack group emissions.

[**Layalloc**](ch05s03s09.html "5.3.9. Layalloc") vertically
redistributes hourly, gridded, speciated pre-gridded emissions from
emission sources that could emit above the surface layer (e.g. Energy
and Industrial sources) based on an user-defined layer fraction input.

[**Metcombine**](ch05s03s10.html "5.3.10. Metcombine") combines 2-D
gridded meteorology data with the 1st layer of 3-D gridded meteorology
data to create input files for **Met4moves**.

[**Metscan**](ch05s03s11.html "5.3.11. Metscan") reads up to one year's
worth of first-layer I/O API meteorology data (whether 2-D or 3-D files)
and determine the first and last freeze dates of the year, for use by
**Tmpbeis3** in setting winter/summer emission factors by day and grid
cell.

[**Pktreduc**](ch05s03s12.html "5.3.12. Pktreduc") reduces the size of
/PROJECTION/ packets, but keeps the same information by identifying and
implementing state defaults where none already exist in the file.

[**Smk2emis**](ch05s03s13.html "5.3.13. Smk2emis") converts SMOKE netCDF
files into a UAM- or CAM~X~-ready emissions file.

[**Surgtool**](ch05s03s14.html "5.3.14. Surgtool") inputs
SMOKE-formatted gridding surrogates for a "[fine]{.quote}" input grid
and outputs a surrogate file for a "[coarse]{.quote}" output grid. It
produces approximate "[coarse]{.quote}" grid surrogates, the accuracy of
which depends on how fine the resolution of the input grid is relative
to that of the output grid.

[**Uam2ncf**](ch05s03s15.html "5.3.15. Uam2ncf") converts UAM-ready
emissions files into I/O API format.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------- -------------------- --------------------------
  [Prev](ch05s02s04.html)                   [Up](ch05.html)       [Next](ch05s03s02.html)
  5.2.4. MOVES Post-processing scripts     [Home](index.html)          5.3.2. **Aggwndw**
  --------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.2. **Aggwndw**
:::

[Prev](ch05s03.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_aggwndw}5.3.2. **Aggwndw** {#aggwndw .title}

</div>

</div>
:::

::: {.toc}
[[5.3.2.1. Description](ch05s03s02.html#d0e18761)]{.section}

[[5.3.2.2. Processing Order](ch05s03s02.html#d0e18771)]{.section}

[[5.3.2.3. Files and Environment
Variables](ch05s03s02.html#d0e18784)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18761}5.3.2.1. Description {#description .title}

</div>

</div>
:::

**Aggwndw** aggregates and/or windows emissions from an I/O API file to
a new grid. The program does not change grid projections or interpolate
data; the grid boundaries of the input and output grids must be aligned
and the output grid must be entirely contained within the input grid.
**Aggwndw** automatically checks that the input and output emissions do
not differ by more than 0.01% and also produces a report file containing
summed input and output data.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18771}5.3.2.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Aggwndw** can be run on any gridded I/O API file. Usually it would be
used to create coarse-grid or windowed emissions from fine-grid
model-ready output files created by **Smkmerge** or **Mrggrid**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18784}5.3.2.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.2.3.1. Input Files](ch05s03s02.html#d0e18787)]{.section}

[[5.3.2.3.2. Input Environment
Variables](ch05s03s02.html#d0e18820)]{.section}

[[5.3.2.3.3. Output Files](ch05s03s02.html#d0e18834)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18787}5.3.2.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format           Description
  -------------------- ---------------- --------------------------------------------------------------------
  `GRIDDESC`{.envar}   ASCII            Grid description file containing information about the output grid
  `INFILE`{.envar}     I/O API NetCDF   Input gridded emissions file
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18820}5.3.2.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `IOAPI_GRIDNAME_1`{.envar}: \[default: none\]

    Sets the name of the output grid whose parameters will be read from
    the `GRIDDESC`{.envar} file.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18834}5.3.2.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- -------------------------------------------------------------------------
  `OUTFILE`{.envar}   I/O API NetCDF   Gridded emissions file
  `REPFILE`{.envar}   ASCII            Report file; provides summed input and output emissions for QA purposes
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------- -------------------- --------------------------
  [Prev](ch05s03.html)             [Up](ch05s03.html)     [Next](ch05s03s03.html)
  5.3.  SMOKE Utility Programs     [Home](index.html)      5.3.3. **BlueSky2Inv**
  ------------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.3. **BlueSky2Inv**
:::

[Prev](ch05s03s02.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_bluesky2inv}5.3.3. **BlueSky2Inv** {#bluesky2inv .title}

</div>

</div>
:::

::: {.toc}
[[5.3.3.1. Description](ch05s03s03.html#d0e18871)]{.section}

[[5.3.3.2. Processing Order](ch05s03s03.html#d0e18878)]{.section}

[[5.3.3.3. Files and Environment
Variables](ch05s03s03.html#d0e18888)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18871}5.3.3.1. Description {#description .title}

</div>

</div>
:::

**BlueSky2Inv** converts output files from the BlueSky fire modeling
framework into an annual IDA-formatted inventory and an hourly emissions
inventory.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18878}5.3.3.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**BlueSky2Inv** is used to create inventories from BlueSky output for
input into **Smkinven**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18888}5.3.3.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.3.3.1. Input Files](ch05s03s03.html#d0e18891)]{.section}

[[5.3.3.3.2. Input Environment
Variables](ch05s03s03.html#d0e18924)]{.section}

[[5.3.3.3.3. Output Files](ch05s03s03.html#d0e18948)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18891}5.3.3.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format   Description
  -------------------- -------- ------------------------------------------------------------------------------------------------------------------------------
  `COSTCY`{.envar}     ASCII    Country, state, and county codes file; used to assign time zones to each source based on the source's state and county codes
  `FILELIST`{.envar}   ASCII    List of BlueSky output files including path and filename
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18924}5.3.3.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `G_STDATE`{.envar}: \[default: none\]

    Starting date of data (YYYYDDD); used to set the inventory year in
    the annual inventory. `G_STDATE`{.envar} is also used to create
    default entries in the daily inventory file for each source.

-   `VARLIST`{.envar}: \[default: none\]

    Selects the variables that will be output in the annual and daily
    inventories. Valid values are AREA, HFLUX, PM2\_5, PM10, PM, PMC,
    CO, CO2, CH4, NMHC, and TOG. The values for the variable should be
    formatted as follows:

    **`setenv VARLIST "AREA, HFLUX, PM2_5, PMC, CO, TOG"`**
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e18948}5.3.3.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name         Format   Description
  ----------------- -------- --------------------------------
  `PTDAY`{.envar}   ASCII    Daily emissions inventory
  `PTINV`{.envar}   ASCII    Annual IDA-formatted inventory
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s02.html)     [Up](ch05s03.html)     [Next](ch05s03s04.html)
  5.3.2. **Aggwndw**          [Home](index.html)          5.3.4. **CEMScan**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.4. **CEMScan**
:::

[Prev](ch05s03s03.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_cemscan}5.3.4. **CEMScan** {#cemscan .title}

</div>

</div>
:::

::: {.toc}
[[5.3.4.1. Description](ch05s03s04.html#d0e18985)]{.section}

[[5.3.4.2. Processing Order](ch05s03s04.html#d0e19003)]{.section}

[[5.3.4.3. Files and Environment
Variables](ch05s03s04.html#d0e19013)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e18985}5.3.4.1. Description {#description .title}

</div>

</div>
:::

**CEMScan** reads a year's worth of CEM data and calculates summed
annual NOx emissions, SO~2~ emissions, heat input, gross load, and steam
load for each uniquie ORIS/boiler combination in the output CEM data.
While writing the output, CEMScan will skip any ORIS/boiler combinations
where the total annual NOx emissions are zero or null or where the total
annual gross load, steam load, and heat input are zero or null. The
program will write these ORIS/boiler combinations to the report file
along with a flag indicating that the combination was not written to the
output file. The output from **CEMScan** is used by **Smkinven** to
calculate hourly emissions from annual inventory data when reading CEM
data. Detail information is described in [Section 2.9.19, "Processing
hour-specific CEM
data"](ch02s09s19.html "2.9.19. Processing hour-specific CEM data").
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19003}5.3.4.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**CEMScan** should be run before **Smkinven** when processing CEM data.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19013}5.3.4.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.4.3.1. Input Files](ch05s03s04.html#d0e19016)]{.section}

[[5.3.4.3.2. Input Environment
Variables](ch05s03s04.html#d0e19041)]{.section}

[[5.3.4.3.3. Output Files](ch05s03s04.html#d0e19052)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e19016}5.3.4.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format   Description
  -------------------- -------- ------------------------------------------------------------------------------------------------------------------------------------------------
  `FILELIST`{.envar}   ASCII    List of CEM input files including path and filename; the files must contain data for an entire year to be consistent with the annual inventory
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e19041}5.3.4.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `MAX_CEM_UNITS`{.envar}: \[default: none\]

    Maximum number of CEM units in input data; this value can usually be
    based on the number of sources in the annual inventory
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e19052}5.3.4.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format   Description
  ------------------- -------- ----------------------------
  `OUTFILE`{.envar}   ASCII    CEM summary file
  `REPFILE`{.envar}   ASCII    Report summarizes CEM data
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s03.html)     [Up](ch05s03.html)     [Next](ch05s03s05.html)
  5.3.3. **BlueSky2Inv**      [Home](index.html)          5.3.5. **Gentpro**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.5. **Gentpro**
:::

[Prev](ch05s03s04.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_gentpro}5.3.5. **Gentpro** {#gentpro .title}

</div>

</div>
:::

::: {.toc}
[[5.3.5.1. Description](ch05s03s05.html#d0e19089)]{.section}

[[5.3.5.2. Processing Order](ch05s03s05.html#d0e19516)]{.section}

[[5.3.5.3. Files and Environment
Variables](ch05s03s05.html#d0e19524)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19089}5.3.5.1. Description {#description .title}

</div>

</div>
:::

The **Gentpro** program estimates emissions temporal profiles for
residential wood combustion (RWC), agricultural ammonia (RC\_NH3),
livestock ammonia (BASH\_NH3) or generic area sources by relating
meteorology to air emission fluxes. **Gentpro** reads in hourly gridded
meteorology data from the Meteorology-Chemistry Interface Processor
(MCIP) and a gridded spatial surrogate (commonly used in SMOKE) to
produce temporal profiles and cross-reference data in a comma separated
value (CSV) format and/or a temporal data binary netCDF file. Annual
MCIP input data are required to calculate temporal profiles with
**Gentpro**. Spatial surrogate(s) are used to identify the grid cells
for computing county averaged meteorology variables.

**Gentpro** provides an option to specify a profile method
\[`PROFILE_METHOD`{.envar}\], which can be set to generate RWC,
BASH\_NH3, RC\_HNH3, or generic meteorology-based temporal profiles. the
RWC, BASH\_NH3 and RC\_NH3 temporal profiles are based on algorithms
described by Adelman (2009 and 2010), Mansell et al. (2000), and Bash et
al. (2012) respectively, while the MET profiles can ben generated from
any user-selected meteorology variable. The RWC profile method produces
county-specific daily temporal profiles to convert annual or monthly
inventories to daily emissions estimates. Diurnal profiles must then be
applied to estimate hourly RWC emissions from the daily estimates.
**Gentpro** provides the option to aggregate the daily RWC profiles to
month-of-year profiles as well, which can be used to compute monthly
inventory estimates from annual inventory data. The BASH\_NH3 and
RC\_NH3 profile methods produce county-specific hourly temporal profiles
to convert annual, monthly, or daily inventories to hourly emissions
estimates. **Gentpro** provides the option to aggregate the hourly
profiles to day-of-year or month-of-year profiles as well. The MET
profile method represents time series of a selected meteorology variable
as a temporal profile and can be used to convert annual, monthly, or
daily inventories to hourly emissions estimates. **Gentpro** also
provides the option to aggregate the hourly MET profiles to day-of-year
or month-of-year profiles. All of the **Gentpro** profile options create
temporal cross-reference files that associate county FIPS codes in a
modeling domain to the new profiles.

**\[1\] RWC**

A regression equation relating observed daily minimum temperatures and
chemical tracers of wood combustion was developed using data from sites
in the Pacific Northwest of the United States (Adelman, 2009; Adelman,
2010). The sites selected to develop the algorithm were screened to be
representative of RWC activities. Equation (1) uses estimates of daily
PM2.5 emissions to build either annual-to-daily or annual-to-monthly
emission profiles for application to RWC sources. The algorithm uses
county average daily or monthly minimum temperatures to estimate the
percentage of RWC emissions allocated to each day or month of the year.
**Gentpro** includes a temperature threshold setting to limit RWC
emissions from allocated to days too warm to have much (if any) RWC
emissions. A temperature threshold (T~t~) variable is implemented in
**Gentpro** to allow users to set a maximum temperature cutoff by either
state or county. By default, **Gentpro** estimates RWC emissions at
temperatures below 50°F. If the temperature threshold variable is set in
the Gentpro script, RWC emissions will be activated below T~t~. A
look-up table of state/county FIPs codes and temperatures (°F) can be
input to **Gentpro** to set several different temperature thresholds
across a modeling domain. The purpose of using the temperature threshold
override is to control when RWC emissions are activated in regions where
the 50°F cutoff may not be appropriate. For example, counties in
southern Florida may only experience one or two days in an entire year
when the minimum temperature dips below 50°F. Without using the
threshold override, all of the RWC emissions for these counties will be
allocated to these one or two days, producing large emissions spikes
that may not be realistic. By increasing the temperature threshold,
these spikes can be avoided by activating the RWC algorithm on other
days. The outputs from this algorithm are temporal profiles that convert
annual or monthly RWC inventories to daily emissions for every county in
the modeling domain.

Two alternative RWC temporal profile algorithms are implemented in
**Gentpro**. Equation 1 below shows the algorithm developed from the
Pacific Northwest Sites described by Adelman (2009; 2010).

The second RWC temporal algorithm is an ad hoc approximation of the
original equation that broadens its application by removing the
intercept term. By removing the intercept term, Equation 2 below will
not produce negative emissions when the temperature threshold is
increased above 53.3°F.

The alternate RWC algorithms can be selected using
`RWC_ALT_EQ_YN`{.envar} listed below. When `RWC_ALT_EQ_YN`{.envar} = N,
Equation 1 will be used to calculate RWC temporal profiles.

::: {.orderedlist}
1.  **Original RWC Algorithm developed by Adelman (2009;2010)**

    When T~[*i,d*]{.emphasis}~ is equal or less than 50°F,

    PE~[*i,d*]{.emphasis}~ = (42.12 - 0.79 x T~[*i,d*]{.emphasis}~) /
    Sum (42.12 - 0.79 x T~[*i,d*]{.emphasis}~)

    When T~[*i,d*]{.emphasis}~ is greater than T~[*t*]{.emphasis}~,

    PE~[*i,d*]{.emphasis}~ = 0.0

    When T~[*i,d*]{.emphasis}~ is greater than 50°F and
    T~[*i,d*]{.emphasis}~ is less than T~[*t*]{.emphasis}~,

    PE~[*i,d*]{.emphasis}~ = (42.12 - 0.79 x 50) / Sum (42.12 - 0.79
    x 50)

2.  **Alternative RWC Algorithm**

    When T~[*i,d*]{.emphasis}~ is equal or greater than
    T~[*t*]{.emphasis}~,

    PE~[*i,d*]{.emphasis}~ = 0.0

    When T~[*i,d*]{.emphasis}~ is less than T~[*t*]{.emphasis}~,

    PE~[*i,d*]{.emphasis}~ = \[0.79 x (T~[*i,t*]{.emphasis}~ -
    T~[*i,d*]{.emphasis}~)\] / Sum \[0.79 x (T~[*i,t*]{.emphasis}~ -
    T~[*i,d*]{.emphasis}~)\]
:::

where

::: {.itemizedlist}
-   PE~[*i,d*]{.emphasis}~ = Percentage of emissions in county
    [*i*]{.emphasis} on day [*d*]{.emphasis}
-   T~[*i,d*]{.emphasis}~ = Daily minimum ambient temperature (°F) in
    county [*i*]{.emphasis} on day [*d*]{.emphasis}
-   T~[*i,t*]{.emphasis}~ = Daily threshold ambient temperature (°F) in
    county [*i*]{.emphasis}
-   T~[*t*]{.emphasis}~ = Daily threshold ambient temperature (default =
    50°F)
-   Note: T~[*i,m*]{.emphasis}~ can be replaced by monthly minimum
    ambient temperature in county [*i*]{.emphasis} on month
    [*m*]{.emphasis}
:::

**\[2\] NH3**

Two NH3 profile methods are implemented in **Gentpro** to estimate
hourly temporal allocation factors, which are output as temporal
profiles to convert annual, monthly, or daily livestock ammonia
inventories to hourly emissions for every county in the modeling domain.
**Gentpro** can output hour-of-month and hour-of-year temporal profiles
that can be input to the **Temporal**. The recommended application of
the BASH\_NH3 and RC\_NH3 profile methods are to convert monthly
agricultural ammonia inventories to hourly emissions.

::: {.orderedlist}
1.  RC\_NH3 profile method: Russell and Cass (1986) developed a
    theoretical equation based on investigations of NH3 emissions from
    animal waste decomposition conducted by Muck and Steenhuis (1982) to
    predict diurnal NH3 emission variations as a function of daily
    meteorology. The Russell and Cass equation (a.k.a RC\_METHOD) listed
    below is adapted for this application to use county average
    meteorology and implemented in **Gentpro** to estimate hourly
    emissions from county annual, monthly, or daily agricultural
    livestock NH~3~ inventories.

    E~[*i,h*]{.emphasis}~ = \[2.36^(T~[*i,h*]{.emphasis}~-273)/10^\] x
    V~[*i,h*]{.emphasis}~

2.  BASH\_NH3 profile method: Zhu, Henze, et al. (2013) developed an
    empirical equation based on observations from the TES instrument
    with the GEOS-Chem model and its adjoint to estimate diurnal NH3
    emission variations from livestocks as a function of ambient
    temperature and aerodynamic resistance meteorological variable. The
    equation is listed below.

    E~[*i,h*]{.emphasis}~ = \[161500/T~[*i,h*]{.emphasis}~ x
    e^(-1380/T~[*i,h*]{.emphasis}~)^\] x AR~[*i,h*]{.emphasis}~
:::

::: {.itemizedlist}
-   PE~[*i,h*]{.emphasis}~ = E~[*i,h*]{.emphasis}~ /
    Sum(E~[*i,h*]{.emphasis}~)
:::

where

::: {.itemizedlist}
-   PE~[*i,h*]{.emphasis}~ = Percentage of emissions in county
    [*i*]{.emphasis} on hour [*h*]{.emphasis}
-   E~[*i,h*]{.emphasis}~ = Emission rate in county [*i*]{.emphasis} on
    hour [*h*]{.emphasis}
-   T~[*i,h*]{.emphasis}~ = Ambient temperature (Kelvin) in county
    [*i*]{.emphasis} on hour [*h*]{.emphasis}
-   V~[*i,h*]{.emphasis}~ = Wind speed (meter/sec) in county
    [*i*]{.emphasis} (minimum wind speed is 0.1 meter/sec)
-   AR~[*i,h*]{.emphasis}~ = Aerodynamic resistance in county
    [*i*]{.emphasis}
:::

**\[3\] MET: Generic Meteorology Profile Algorithm**

This is a simple algorithm that computes the percentage of emissions to
allocate to each hour based on the hourly fractional contribution of a
selected meteorology variable relative to the annual, monthly, and daily
sum of all hourly values for that variable. While the fractional
contribution of county-average wind speed for each hour of the year is
somewhat meaningless, it does provide a way to build a time series that
can be applied to an annual/monthly inventory to estimate hourly values
using monthly, daily and/or hourly MET profiles.

::: {.orderedlist}
1.  PE~[*i,h*]{.emphasis}~ = m~[*i,h*]{.emphasis}~ /
    Sum(m~[*i,h*]{.emphasis}~)
:::

where

::: {.itemizedlist}
-   PE~[*i,h*]{.emphasis}~ = Percentage of emissions in county
    [*i*]{.emphasis} on hour [*h*]{.emphasis}
-   m~[*i,h*]{.emphasis}~ = Meteorology variable in county
    [*i*]{.emphasis} on hour [*h*]{.emphasis}
:::

**\[Reference\]**

Adelman, Z. (2010) \'Proposal: Estimating Temporal Profiles for
Residential Wood Combustion Emissions\', Prepared for U.S. EPA, OAQPS,
Research Triangle Park, NC under Contract No. EP-D-07-102 Assignment No.
3-07 (M. Houyoux, WAM) by UNC, Chapel Hill, NC.

Adelman, Z. (2009) \'Technical Memo: Emissions Modeling Improvements
Task 2 -- Temporal Allocation for Residential Wood Combustion\',
Prepared for U.S. EPA, OAQPS, Research Triangle Park, NC under Contract
No. EP-D-07-102 Assignment No. 2-13 (M. Houyoux, WAM) by UNC, Chapel
Hill, NC.

Mansell, G, S. Kemball-Cook, L. Ma (2009) \'Draft Report: Temporal
Allocation of Agricultural Ammonia Emissions\', Prepared for U.S. EPA,
OAQPS, Research Triangle Park, NC under Contract No. EP-D-07-102
Assignment No. 2-13 (M. Houyoux, WAM) by ENVIRON, Novato, CA.

Muck, R.E., and T.S. Steenhuis (1982) \'Nitrogen Losses from Manure\',
Agricultural Wastes, 4: 41-54.

Russell, A.G. and G.R. Cass (1986) \'Verification of a Mathematical
Model for Aerosol Nitrate and Nitric Acid Formation and Its Use for
Control Measure Evaluation\', Atmospheric Environment, 20: 2011-2025.

Zue, Henze, et al (2013) \'Constraining U.S. Ammonia Emissions using TES
Remote Sensing Observations and the GEOS-Chem adjoint model\', Journal
of Geophysical Research: Atmospheres, 118: 1-14.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19516}5.3.5.2. Processing Order {#processing-order .title}

</div>

</div>
:::

This optional program must run prior to **Temporal**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19524}5.3.5.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.5.3.1. Input Files](ch05s03s05.html#d0e19537)]{.section}

[[5.3.5.3.2. Input Environment
Variables](ch05s03s05.html#d0e19633)]{.section}

[[5.3.5.3.3. Output Files](ch05s03s05.html#d0e19831)]{.section}
:::

::: {.figure}
[]{#fig_programs_gentpro}

**Figure 5.1. Gentpro input and output files**

::: {.mediaobject}
![Gentpro input and output files](images\programs\gentpro_html.jpg)
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e19537}5.3.5.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                                                                                                Format   Description
  -------------------------------------------------------------------------------------------------------- -------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `COSTCY`{.envar}                                                                                         ASCII    Five digit code for country, state and county
  [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")   ASCII    Geographical level codes and descriptions for gridded inventories, only when USE\_EXP\_GEO\_CODES is set to Y, (COSTCY is ignored when [Section 8.10.3, "`GEOCODE_LEVEL[1-4]: Geographical Input Files`{.envar}"](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files") files are used)
  `GRIDDESC`{.envar}                                                                                       ASCII    Grid descriptions file that defines the output grid for the output surrogates file created by the program. It must include the name of the grid set by the `IOAPI_GRIDNAME     _1`{.envar} environment variable setting.
  `METLIST`{.envar}                                                                                        ASCII    A list of meteorology files containing temperature, mixing ratio, and surface pressure data created by **Metcombine**
  `RWC_COUNTY_TEMP (optional)`{.envar}                                                                     ASCII    County-specific minimum temperature for RWC equations (see [Section 8.10.9, "`RWC_COUNTY_TEMP`{.envar}: County-specific minimum temperature for Residential Wood Combustion (RWC) Equations"](ch08s10s09.html "8.10.9. RWC_COUNTY_TEMP: County-specific minimum temperature for Residential Wood Combustion (RWC) Equations"))
  `SRGDESC`{.envar}                                                                                        ASCII    Spatial surrogate description file produced by MCIP (see [Section 8.4.1, "`SRGDESC`{.envar}: Surrogate Designation, Description and Surrogate profile filename."](ch08s04.html#sect_input_srgdesc "8.4.1. SRGDESC: Surrogate Designation, Description and Surrogate profile filename."))
  Surrogate File(s)                                                                                        ASCII    Spatial surrogate file(s) selected by `SRG_LIST`{.envar}
  `TREF_IN`{.envar}                                                                                        ASCII    Temporal cross-reference input file (see [Section 8.3.2, "`[A|M|P]TREF`{.envar}: Temporal cross-reference file"](ch08s03s02.html "8.3.2. [A|M|P]TREF: Temporal cross-reference file"))
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e19633}5.3.5.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `AERO_RESISTANCE_VAR`{.envar}: \[default: blank\]

    Define the aerodynamic resistance variable name for Bash\'s
    algorithm for livestock ammonia sources

-   `SLOPE`{.envar}: \[default: 0.79\]

    Define the value of the slope of RWC equation

-   `CONSTANT`{.envar}: \[default: 42.12\]

    Define the value of constant of RWC equation

-   `ENDDATE`{.envar}: \[default: 0\]

    Defines the last day of year (December 31st) for a proper temporal
    profile calculation. MCIP file must cover last hour of December 31st
    of all counties in modeling output time zone (i.e., GMT).

-   `PROFILE_METHOD`{.envar}: \[default: MET\]

    Indicates which of the three temporal profile types to generate by
    **Gentpro**

    ::: {.itemizedlist}
    -   RWC: use the Adelman\'s regression equation to calculate
        temporal profiles for residential wood combustion (RWC) sources
    -   BASH\_NH3: use the Bash\'s algorithm to calculate temporal
        profiles for livestock ammonia sources
    -   RC\_NH3: use the Russell and Cass algorithm to calculate
        temporal hourly profiles for agricultural ammonia sources
    -   MET: use the time series of the selected meteorology variable to
        calculate temporal profiles
    :::

-   `RWC_COUNTY_TEMP_YN`{.envar}: \[default: N\]

    Allows the user to determine county-specific minimum temperature for
    RWC estimate equations. It will override default minimum temperature
    \[`DEFAULT_TEMP_RWC`{.envar}\] listed above.

    ::: {.itemizedlist}
    -   Y: use the county-specific minimum temperature from
        [`RWC_COUNTY_TEMP`{.envar}](ch08s10s09.html "8.10.9. RWC_COUNTY_TEMP: County-specific minimum temperature for Residential Wood Combustion (RWC) Equations")
        input file.
    -   N: do not use the county-specific minimum temperature for RWC
        equations.
    :::

-   `RWC_EQ_ALT_YN`{.envar}: \[default: Y\]

    Allows the user to choose the alternative RWC equation listed above
    to avoid negative RWC emissions.

    ::: {.itemizedlist}
    -   Y: use the alternative RWC equation to compute RWC emissions.
    -   N: use the original RWC equations to compute RWC emissions.
    :::

-   `SCC_LIST`{.envar}: \[default: blank\]

    Defines a comma-separated list of SCCs that will use the temporal
    profiles generated by **Gentpro**, example: setenv SCC\_LIST
    \"2104008000,2104008001,2104008002\"

-   `SRG_LIST`{.envar}: \[default: 0\]

    Defines a comma-separated list of SCCs that will use the temporal
    profiles generated by **Gentpro**, example setenv SRG\_LIST
    \"340,100\"

-   `SRGDESC`{.envar}: \[default: none\]

    Directory path and name of the spatial surrogate file for computing
    averaged meteorology.

-   `SRGPRO_PATH`{.envar}: \[default: blank\]

    Defines the location of spatial surrogate files

-   `STDATE`{.envar}: \[default: 0\]

    Defines the first day of year (January 1st) for a proper temporal
    profile calculation. MCIP file must cover first hour of January 1st
    of all counties in modeling output time zone (i.e., GMT).

-   `TEMP_VAR`{.envar}: \[default: blank\]

    Must define the name of variable for the all PROFILE\_METHOD
    settings to use in the profile calculations. The program looks for
    the selected meteorology variables first in the METLIST file (set
    below) that contains a list of Metcombine program output files or
    MET files that contain targeted variables from the MET\_CRO\_3D
    or/and MET\_CRO\_2D files. If it doesn\'t find the variable(s) in
    either file, it stops with an error.

-   `TPRO_OUTPUT`{.envar}: \[default: ALL\]

    Specifies the type of temporal profiles to produce

    ::: {.itemizedlist}
    -   MONTHLY: generate month-of-year temporal profiles
    -   DAILY: generate both month-of-year and day-of-month temporal
        profiles
    -   HOURLY: generate hour-of-year, hour-of-month, and hour-of-day
        temporal profiles
        ::: {.itemizedlist}
        -   Not applicable when PROF\_METHOD = RWC
        :::
    -   ALL: generate all possible profiles for the selected profile
        method
        ::: {.itemizedlist}
        -   No hourly profiles will be generated when PROF\_METHOD = RWC
        :::
    :::

-   `TREF_IN`{.envar}: \[default: blank\]

    Defines an input temporal cross-reference file for supplying
    monthly, daily, weekly, and hourly profile IDs. The TREF\_IN file
    will be scanned for the FIPS/SCC combinations of sources associated
    with profiles generated by **Gentpro**. If there are no entries in
    TREF for the specific FIPS/SCC combinations being simulated with
    **Gentpro**, the program will look for default cross-reference
    entries (FIPS=0, SCC=0).

    ::: {.itemizedlist}
    -   If TPRO\_OUTPUT = DAILY, month-of-year and day-of-month temporal
        profiles will be generated by **Gentpro**. Users need to provide
        diurnal (hourly) profiles will be needed to convert from daily
        to hourly emissions.
    -   If TPRO\_OUTPUT = MONTHLY, month-of-year profiles will be
        generated by **Gentpro**. Users need to provide weekly and
        diurnal profiles will be needed to estimate hourly emissions.
    -   If PROFILE\_METHOD = BASH\_NH3 or RC\_NH3, hour-of-year profiles
        will be generated by **Gentpro** to estimate hourly emissions
        using monthly inventory
    -   If PROFILE\_METHOD = MET and TPRO\_OUTPUT = HOURLY\[or ALL\],
        hour-of-year, hour-of-month and hour-of-day temporal profiles
        will be output to netCDF TPRO\_HOUR by **Gentpro**
    :::

-   `USE_EXP_GEO_CODES`{.envar}: \[default: N\]

    If set to Y then use GEOCODE\_LEVEL\[1-4\] files instead of the
    COSTCY file to define expanded geographical detail such as
    country-level(GEOCODE\_LEVEL1), country/state-level
    (GEOCODE\_LEVEL2), country/state/county-level (GEOCODE\_LEVEL3) or
    country/state/county/tribal-level (GEOCODE\_LEVEL4).

-   `WSPEED_VAR`{.envar}: \[default: blank\]

    Defines the name of wind speed variable from MET files. It is only
    used when PROFILE\_METHOD is set to \"RC\_NH3\". example: setenv
    WSPEED\_VAR \"WSPD10\"
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e19831}5.3.5.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name             Format           Description
  --------------------- ---------------- ------------------------------------------
  `TPRO_MON`{.envar}    ASCII            Month-of-year temporal profiles
  `TPRO_DAY`{.envar}    ASCII            Day-of-month temporal profiles
  `TPRO_HOUR`{.envar}   I/O API netCDF   Hourly temporal profiles
  `TREF_OUT`{.envar}    ASCII            Temporal cross-references input file.
  `LOGFILE`{.envar}     ASCII            Log generated from executing **Gentpro**
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s04.html)     [Up](ch05s03.html)     [Next](ch05s03s06.html)
  5.3.4. **CEMScan**          [Home](index.html)           5.3.6. **Geofac**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.6. **Geofac**
:::

[Prev](ch05s03s05.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_geofac}5.3.6. **Geofac** {#geofac .title}

</div>

</div>
:::

::: {.toc}
[[5.3.6.1. Description](ch05s03s06.html#d0e19894)]{.section}

[[5.3.6.2. Processing Order](ch05s03s06.html#d0e19918)]{.section}

[[5.3.6.3. Files and Environment
Variables](ch05s03s06.html#d0e19932)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19894}5.3.6.1. Description {#description .title}

</div>

</div>
:::

The **Geofac** program provides a means for adjusting emissions by grid
cell after SMOKE has already created model-ready inputs. For example,
the program could be used to zero emissions from all grid cells that
intersect a certain state, which would be a rough approximation of
removing that state's inventory from the model-ready files. Although it
is more accurate to modify the emissions using the **Cntlmat** program,
that approach takes longer and is possible only if the SMOKE input files
used to create the model ready emissions are still available. **Geofac**
is useful in situations where speed and simplicity are more important
than the accuracy of the emissions, or when only the gridded model-ready
inputs are available and the inventories used to create them are not.

**Geofac** reads in a gridded 2-D or 3-D SMOKE emissions file (output
from the **Smkmerge** program) and multiplies the emissions with a
user-supplied adjustment factor for each individual species in the
emissions file. The factors are assigned by grid-cell regions, which are
defined by the input "[mask]{.quote}" file. Each grid cell either
receives the factors or it does not (the mask is simply an on-off
switch). The resulting hourly, gridded, speciated emissions data are
output to a new I/O API file with the same spatial and temporal
resolution and the same model species with different values.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19918}5.3.6.2. Processing Order {#processing-order .title}

</div>

</div>
:::

This optional program can be run after **Smkmerge** and before either
**Mrggrid** (if it is being used to merge several **Smkmerge** output
files together) or the AQM of interest.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e19932}5.3.6.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.6.3.1. Input Files](ch05s03s06.html#d0e19935)]{.section}

[[5.3.6.3.2. Input Environment
Variables](ch05s03s06.html#d0e20032)]{.section}

[[5.3.6.3.3. Output Files](ch05s03s06.html#d0e20037)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e19935}5.3.6.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
+--------------------+----------------+------------------------------+
| File Name          | Format         | Description                  |
+====================+================+==============================+
| `GEOMASK`{.envar}  | I/O API NetCDF | Gridded, time-independent    |
|                    |                | file that assigns a 1 to any |
|                    |                | grid cell whose emissions    |
|                    |                | you want to adjust. The      |
|                    |                | emissions from               |
|                    |                | `INFILE`{.envar} in grid     |
|                    |                | cells that have a 1 in       |
|                    |                | `GEOMASK`{.envar} are        |
|                    |                | multiplied by the factor     |
|                    |                | provided in                  |
|                    |                | `SPECFACS`{.envar}. All      |
|                    |                | other emissions and grid     |
|                    |                | cells are untouched.         |
+--------------------+----------------+------------------------------+
| `INFILE`{.envar}   | I/O API NetCDF | Hourly, gridded, speciated   |
|                    |                | inputs from **Smkmerge**.    |
|                    |                | `INFILE`{.envar} should be   |
|                    |                | set to logical file name     |
|                    |                | `AGTS_[L|S]`{.envar},        |
|                    |                | `BGTS_[L|S]`{.envar},        |
|                    |                | `MGTS_[L|S]`{.envar},        |
|                    |                | `PGTS_[L|S]`{.envar},        |
|                    |                | `PGTS3D_[L|S]`{.envar},      |
|                    |                | `EGTS_[L|S]`{.envar}, or     |
|                    |                | `EGTS3D_[L|S]`{.envar},      |
|                    |                | which are the output files   |
|                    |                | from **Smkmerge**.           |
+--------------------+----------------+------------------------------+
| `SPECFACS`{.envar} | ASCII          | File that lists the species  |
|                    |                | name and the factor to be    |
|                    |                | applied to all grid cells    |
|                    |                | with a 1 value in the        |
|                    |                | `GEOMASK`{.envar} file. The  |
|                    |                | species name must be in      |
|                    |                | columns 1-16 and the factor  |
|                    |                | in columns 17-22. For        |
|                    |                | example, the following       |
|                    |                | `SPECFACS`{.envar} file      |
|                    |                | sample would multiply NO and |
|                    |                | NO~2~ emissions by 1.3 (30%  |
|                    |                | increase) and multiply PAR   |
|                    |                | by 0.6 (40% decrease).       |
|                    |                |                              |
|                    |                | ``` {.programlisting}        |
|                    |                | NO              1.3          |
|                    |                | NO2             1.3          |
|                    |                | PAR             0.6          |
|                    |                | ```                          |
+--------------------+----------------+------------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20032}5.3.6.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

None
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20037}5.3.6.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- ---------------------------------------------------------------------------------------------------
  `LOGFILE`{.envar}   ASCII            Log generated from executing **Geofac**
  `OUTFILE`{.envar}   I/O API NetCDF   Hourly, gridded, speciated emissions, adjusted based on `GEOMASK`{.envar} and `SPECFACS`{.envar}.
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s05.html)     [Up](ch05s03.html)     [Next](ch05s03s07.html)
  5.3.5. **Gentpro**          [Home](index.html)       5.3.7. **Inlineto2D**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.7. **Inlineto2D**
:::

[Prev](ch05s03s06.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s08.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_inlineto2d}5.3.7. **Inlineto2D** {#inlineto2d .title}

</div>

</div>
:::

::: {.toc}
[[5.3.7.1. Description](ch05s03s07.html#d0e20082)]{.section}

[[5.3.7.2. Processing Order](ch05s03s07.html#d0e20089)]{.section}

[[5.3.7.3. Files and Environment
Variables](ch05s03s07.html#d0e20096)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20082}5.3.7.1. Description {#description .title}

</div>

</div>
:::

**Inlineto2D** merges the CMAQ inline-ready 2-D point sources emissions
(INLN) with the elevated source stack group (STACK\_GROUPS) files to
generate 2-D hourly emissions.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20089}5.3.7.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Inlineto2D** can be run on any gridded I/O API file.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20096}5.3.7.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.7.3.1. Input Files](ch05s03s07.html#d0e20099)]{.section}

[[5.3.7.3.2. Output Files](ch05s03s07.html#d0e20136)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20099}5.3.7.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                Format           Description
  ------------------------ ---------------- ---------------------------------------------------------------------
  `INLN`{.envar}           I/O API NetCDF   CMAQ-ready Inline 2-D ridded emissions file, output by **Smkmerge**
  `STACK_GROUPS`{.envar}   I/O API NetCDF   Elevated sources stack parameters file, output by **Elevpoint**
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20136}5.3.7.3.2. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- ---------------------------------------------
  `OUTFILE`{.envar}   I/O API NetCDF   Gridded emissions file
  `LOGFILE`{.envar}   ASCII            Log generated from executing **Inlineto2D**
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s06.html)     [Up](ch05s03.html)     [Next](ch05s03s08.html)
  5.3.6. **Geofac**           [Home](index.html)         5.3.8. **Invsplit**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.8. **Invsplit**
:::

[Prev](ch05s03s07.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s09.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_invsplit}5.3.8. **Invsplit** {#invsplit .title}

</div>

</div>
:::

::: {.toc}
[[5.3.8.1. Description](ch05s03s08.html#d0e20175)]{.section}

[[5.3.8.2. Processing Order](ch05s03s08.html#d0e20183)]{.section}

[[5.3.8.3. Files and Environment
Variables](ch05s03s08.html#d0e20191)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20175}5.3.8.1. Description {#description .title}

</div>

</div>
:::

The **Invsplit** program splits an ORL inventory file into multiple raw
inventory files, based on the state codes. The number of output files is
set at run time based on the input file that defines the splitting. Up
to 80 new files can be created from a single inventory file, which is
more than enough files to split a U.S. inventory into a separate file
for each state. The program works on area, on-road mobile, nonroad
mobile, and point inventories. Separating a single inventory file into
multiple files allows the inventory data to be recombined with other
data more easily.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20183}5.3.8.2. Processing Order {#processing-order .title}

</div>

</div>
:::

This optional program can be run prior to running the **Smkinven**
program to import the emission inventories.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20191}5.3.8.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.8.3.1. Input Files](ch05s03s08.html#d0e20194)]{.section}

[[5.3.8.3.2. Input Environment
Variables](ch05s03s08.html#d0e20260)]{.section}

[[5.3.8.3.3. Output Files](ch05s03s08.html#d0e20265)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20194}5.3.8.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
+-----------------------------+--------+-----------------------------+
| File Name                   | Format | Description                 |
+=============================+========+=============================+
| `ARINV`{.envar},            | ASCII  | Input inventory file; the   |
| `MBINV`{.envar}, or         |        | logical name used depends   |
| `PTINV`{.envar}             |        | on the `SMK_SOURCE`{.envar} |
|                             |        | setting. The                |
|                             |        | `ARINV`{.envar} file is for |
|                             |        | nonpoint (stationary area)  |
|                             |        | and nonroad mobile sources, |
|                             |        | the `MBINV`{.envar} file is |
|                             |        | for on-road mobile sources, |
|                             |        | and the `PTINV`{.envar}     |
|                             |        | file is for point sources.  |
+-----------------------------+--------+-----------------------------+
| `SPLITS`{.envar}            | ASCII  | Space-delimited file that   |
|                             |        | lists the state codes and   |
|                             |        | indicates which output file |
|                             |        | should include the          |
|                             |        | emissions for that state.   |
|                             |        | The first column is for the |
|                             |        | state codes and the second  |
|                             |        | column is the output file   |
|                             |        | number. In this example,    |
|                             |        | states 1 and 4 will be      |
|                             |        | written to the              |
|                             |        | `OUTFILE01`{.envar} output  |
|                             |        | file logical name, state 37 |
|                             |        | to `OUTFILE02`{.envar}, and |
|                             |        | state 45 to                 |
|                             |        | `OUTFILE03`{.envar}. The    |
|                             |        | numbers in the second       |
|                             |        | column need not be          |
|                             |        | sequential.                 |
|                             |        |                             |
|                             |        | ``` {.programlisting}       |
|                             |        | 01    1                     |
|                             |        | 04    1                     |
|                             |        | 37    2                     |
|                             |        | 45    3                     |
|                             |        | ```                         |
+-----------------------------+--------+-----------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20260}5.3.8.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

None
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20265}5.3.8.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name             Format   Description
  --------------------- -------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `OUTFILEnn`{.envar}   ASCII    One or more inventory files in the same inventory format input by the `ARINV`{.envar}, `MBINV`{.envar}, or `PTINV`{.envar} input file for a given program run. The actual logical file name of these files is `OUTFILE01`{.envar}, `OUTFILE02`{.envar}, `OUTFILE03`{.envar}, \... `OUTFILEnn`{.envar}, where nn = the largest number in the second column of the `SPLITS`{.envar} file. The output file names are not necessarily sequential, depending on whether or not sequential numbers are used in the second column of the splits file.
  `LOGFILE`{.envar}     ASCII    Log generated from executing **Invsplit**
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s07.html)     [Up](ch05s03.html)     [Next](ch05s03s09.html)
  5.3.7. **Inlineto2D**       [Home](index.html)         5.3.9. **Layalloc**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.9. **Layalloc**
:::

[Prev](ch05s03s08.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s10.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_layalloc}5.3.9. **Layalloc** {#layalloc .title}

</div>

</div>
:::

::: {.toc}
[[5.3.9.1. Description](ch05s03s09.html#d0e20328)]{.section}

[[5.3.9.2. Processing Order](ch05s03s09.html#d0e20349)]{.section}

[[5.3.9.3. Files and Environment
Variables](ch05s03s09.html#d0e20363)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20328}5.3.9.1. Description {#description .title}

</div>

</div>
:::

The **Layalloc** program calculates 3-D emissions from a 2-D pre-gridded
emissions file. **Layalloc** is used to reallocate single layer 2-D
surface layer emissions into multiple model layers. This approach is
useful for processing pre-gridded or industrial area source inventories
that do not contain stack information for plume rise treatment but
represent elevated sources.

**Layalloc** reads in a gridded 2-D pre-gridded emissions file (either
output from the **Smkmerge** program or from a pregridded global
emission inventory (EDGAR/RCP/HTAP)) and redistributes the emissions
into multiple model layers based on a user-defined vertical profile. The
vertical profiles that are input to **Layalloc** consist of a layer
bottom height, layer top height, and the fraction of emissions to
allocate to the layer. SMOKE willl interpolate from the layer heights
(in meters) to the model layers (in sigma-pressure). This approach
assumes that the vertical factors are uniformly applied over all
horizontal grid cells. The resulting hourly, gridded, speciated 3-D
emissions data are output to a new I/O API file with the same temporal
resolution and the same model species as the original 2-D emissions
file.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20349}5.3.9.2. Processing Order {#processing-order .title}

</div>

</div>
:::

This optional program can be run after **Smkmerge** and before either
**Mrggrid** (if it is being used to merge several **Smkmerge** output
files together) or the AQM of interest.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20363}5.3.9.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.9.3.1. Input Files](ch05s03s09.html#d0e20366)]{.section}

[[5.3.9.3.2. Input Environment
Variables](ch05s03s09.html#d0e20441)]{.section}

[[5.3.9.3.3. Output Files](ch05s03s09.html#d0e20446)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20366}5.3.9.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
+-------------------------+----------------+-------------------------+
| File Name               | Format         | Description             |
+=========================+================+=========================+
| `INFILE`{.envar}        | I/O API NetCDF | 2-D hourly, gridded,    |
|                         |                | speciated inputs from   |
|                         |                | **Smkmerge**.           |
|                         |                | `INFILE`{.envar} should |
|                         |                | be set to logical file  |
|                         |                | name                    |
|                         |                | `AGTS_[L|S]`{.envar},   |
|                         |                | `BGTS_[L|S]`{.envar},   |
|                         |                | `MGTS_[L|S]`{.envar},   |
|                         |                | `PGTS_[L|S]`{.envar},   |
|                         |                | or                      |
|                         |                | `EGTS_[L|S]`{.envar},   |
|                         |                | which are the output    |
|                         |                | files from              |
|                         |                | **Smkmerge**.           |
+-------------------------+----------------+-------------------------+
| `MET_CRO_3D`{.envar}    | I/O API NetCDF | Meteorology file        |
|                         |                | contains a variable     |
|                         |                | "[ZF]{.quote}" which is |
|                         |                | full-layer height above |
|                         |                | ground (m)              |
+-------------------------+----------------+-------------------------+
| `                       | ASCII          | File that lists the     |
| LAYER_FRACTION`{.envar} |                | layer top and bottom    |
|                         |                | heights in meter(s)     |
|                         |                | along with a percentage |
|                         |                | factor. For example,    |
|                         |                | the following           |
|                         |                | `                       |
|                         |                | LAYER_FRACTION`{.envar} |
|                         |                | file sample would       |
|                         |                | distribute 2-D          |
|                         |                | emissions into multiple |
|                         |                | model layers based upon |
|                         |                | five user-defined       |
|                         |                | layers.                 |
|                         |                |                         |
|                         |                | ``` {.programlisting}   |
|                         |                | No., Bottom Ht(         |
|                         |                | m), Top Ht(m), Fraction |
|                         |                | 1,         0,           |
|                         |                |        100,        0.60 |
|                         |                | 2,       100,           |
|                         |                |        200,        0.20 |
|                         |                | 3,       200,           |
|                         |                |        400,        0.10 |
|                         |                | 4,       400,           |
|                         |                |        600,        0.07 |
|                         |                | 5,       600,           |
|                         |                |       1000,        0.03 |
|                         |                | ```                     |
+-------------------------+----------------+-------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20441}5.3.9.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

None
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20446}5.3.9.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- ---------------------------------------------------------------------------------------
  `LOGFILE`{.envar}   ASCII            Log generated from executing **Layalloc**
  `OUTFILE`{.envar}   I/O API NetCDF   3-D hourly, gridded, speciated emissions, adjusted based on `LAYER_FRACTION`{.envar}.
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s08.html)     [Up](ch05s03.html)     [Next](ch05s03s10.html)
  5.3.8. **Invsplit**         [Home](index.html)      5.3.10. **Metcombine**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.10. **Metcombine**
:::

[Prev](ch05s03s09.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s11.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_metcombine}5.3.10. **Metcombine** {#metcombine .title}

</div>

</div>
:::

::: {.toc}
[[5.3.10.1. Description](ch05s03s10.html#d0e20488)]{.section}

[[5.3.10.2. Processing Order](ch05s03s10.html#d0e20518)]{.section}

[[5.3.10.3. Files and Environment
Variables](ch05s03s10.html#d0e20537)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20488}5.3.10.1. Description {#description .title}

</div>

</div>
:::

**Metcombine** combines 2-D gridded meteorology data with the 1st layer
of 3-D gridded meteorology data to create custom files for on-road
mobile processing with MOVES. To calculate humidity data for use in
MOVES, the program **Met4moves** needs temperature, pressure, and water
vapor mixing ratio data in the same meteorology file. Pressure and
mixing ratio data are typically found in the `MET_CRO_3D`{.envar} file
with the variable names PRES and QV, respectively. The
`MET_CRO_2D`{.envar} file usually contains ground-level temperatures
(TEMPG), 1.5 meter temperatures (TEMP1P5), 2 meter temperatures (TEMP2),
and 10 meter temperatures (TEMP10). While it is possible to use air
temperature data from the `MET_CRO_3D`{.envar} file (variable named TA),
it is generally recommended to use temperature data from closer to the
ground, i.e. ground or 1.5 meter temperatures from `MET_CRO_2D`{.envar}.
**Metcombine** is used to create custom meteorology files that contain
the variables PRES, QV, and TEMPG (or any other temperature variable).

The program takes two I/O API NetCDF gridded meteorology files as input.
The files must have identical grid paramaters, start dates and times,
time steps, and run lengths. **Metcombine** is generally used to combine
a 2-D file with a 3-D file, but the program is not restricted to that
combination; it can be used to combine two 2-D files or the 1st layers
of two 3-D files.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20518}5.3.10.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Metcombine** can optionally be run before **Met4moves**. If used,
**Metcombine** must be run for each individual meteorology file you need
to create. For example, if you have five days worth of meteorology data
as one-day files, you'll need to run **Metcombine** five times. If the
meteorology variables you wish to use are already in the same file, then
you do not need to use **Metcombine**. Example: If you decide to use
ambient air temperature (TA) from the same METCRO\_3D file that also
contains PRES and QV, then you do not need to run Metcombine.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20537}5.3.10.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.10.3.1. Input Files](ch05s03s10.html#d0e20540)]{.section}

[[5.3.10.3.2. Input Environment
Variables](ch05s03s10.html#d0e20573)]{.section}

[[5.3.10.3.3. Output Files](ch05s03s10.html#d0e20590)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20540}5.3.10.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format           Description
  -------------------- ---------------- ------------------------------------------------------------------
  `METFILE1`{.envar}   I/O API NetCDF   First gridded meteorology file; can be either a 2-D or 3-D file
  `METFILE2`{.envar}   I/O API NetCDF   Second gridded meteorology file; can be either a 2-D or 3-D file
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20573}5.3.10.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `VARLIST`{.envar}: \[default: none\]

    Sets the names of the variables that will be read from
    `METFILE1`{.envar} and `METFILE2`{.envar}. Each variable must occur
    in exactly one of the meteorology files, i.e. the same variable
    cannot be in both files.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20590}5.3.10.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `OUTFILE`{.envar}   I/O API NetCDF   2-D output meteorology file. This file contains the variables requested in `VARLIST`{.envar}; for 3-D data, `OUTFILE`{.envar} will only contain the 1st layer of data. `OUTFILE`{.envar} will have the same grid parameters, start date and time, time step, and run length as `METFILE1`{.envar} and `METFILE2`{.envar}.
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s09.html)     [Up](ch05s03.html)     [Next](ch05s03s11.html)
  5.3.9. **Layalloc**         [Home](index.html)         5.3.11. **Metscan**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.11. **Metscan**
:::

[Prev](ch05s03s10.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s12.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_metscan}5.3.11. **Metscan** {#metscan .title}

</div>

</div>
:::

::: {.toc}
[[5.3.11.1. Description](ch05s03s11.html#d0e20634)]{.section}

[[5.3.11.2. Processing Order](ch05s03s11.html#d0e20660)]{.section}

[[5.3.11.3. Files and Environment
Variables](ch05s03s11.html#d0e20679)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20634}5.3.11.1. Description {#description .title}

</div>

</div>
:::

**Metscan** reads in a single (often annual) temperature I/O API
meteorology data file (created from either the `MET_CRO_2D`{.envar} or
`MET_CRO_3D`{.envar} files) and determines the first freeze date and
last freeze date of a year, by grid cell. It outputs a gridded file with
a daily (24-hour) time step that contains a single variable. For each
grid cell, that variable has a value of 0 (zero) when the date being
modeled indicates that the cell is experiencing winter conditions;
otherwise it has a value of 1, indicating summer conditions. The program
can be set to run in the Northern Hemisphere or in the Southern
Hemisphere (it will not work on global meteorology datasets). In the
Northern Hemisphere, the first freeze date in the fall marks the start
of winter, and the last freeze date in the spring marks the end of
winter; all other days are considered summer days. The seasons are
reversed in the Southern Hemisphere, and the program accommodates this
accordingly.

The BEIS3 model operates using the assumption of either winter or summer
emission factors. There are no spring or fall factors available, which
is why this program is limited to the choice of summer or winter. The
use of the freeze date to determine summer or winter emission factors is
based on EPA's recommendation.

The program reads in the name of the temperature variable as an option,
so that the ground temperature, 1.5-meter temperature, or 10-meter
temperature can be used from the `MET_CRO_2D`{.envar} file, or the
layer-1 temperature can be used from the `MET_CRO_3D`{.envar} file. See
the `TMPR_VAR`{.envar} option below for more information on the names of
the temperature variables that are acceptable.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20660}5.3.11.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Metscan** can optionally be used before **Tmpbeis3**, which does not
require the output from **Metscan** to run. **Metscan** is needed only
when users wish to have **Tmpbeis3** automatically switch between winter
and summer emission factors by grid cell. This approach is recommended
when processing time periods and modeling domains include temperatures
below 32 °F either for a substantial number of days relative to the
number of episode days or at critical dates in the episode.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20679}5.3.11.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.11.3.1. Input Files](ch05s03s11.html#d0e20682)]{.section}

[[5.3.11.3.2. Input Environment
Variables](ch05s03s11.html#d0e20738)]{.section}

[[5.3.11.3.3. Output Files](ch05s03s11.html#d0e20772)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20682}5.3.11.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
+----------------------+----------------+-------------------------+
| File Name            | Format         | Description             |
+======================+================+=========================+
| `MET_CRO_3D`{.envar} | I/O API NetCDF | Meteorology file that   |
|                      |                | can be a 2-D or 3-D     |
|                      |                | file (though the        |
|                      |                | logical file name is    |
|                      |                | the same in both cases) |
|                      |                | and needs to include    |
|                      |                | all dates in the        |
|                      |                | modeling period. For    |
|                      |                | example, for an annual  |
|                      |                | SMOKE run this file     |
|                      |                | would need to have all  |
|                      |                | hours of the year. The  |
|                      |                | file can be created by  |
|                      |                | extracting one or more  |
|                      |                | temperature variables   |
|                      |                | (at a minimum, the one  |
|                      |                | you intend to use) out  |
|                      |                | of the                  |
|                      |                | `MET_CRO_2D`{.envar} or |
|                      |                | `MET_CRO_3D`{.envar}    |
|                      |                | files output by the     |
|                      |                | MCIP or MCPL programs   |
|                      |                | using the **m3xtract**  |
|                      |                | I/O API utility and     |
|                      |                | appending all days of   |
|                      |                | data into the same      |
|                      |                | file.                   |
|                      |                |                         |
|                      |                | The **m3xtract**        |
|                      |                | utility documentation   |
|                      |                | is provided with the    |
|                      |                | I/O API, but we provide |
|                      |                | some information here.  |
|                      |                | The utility expects     |
|                      |                | input logical file name |
|                      |                | `INFILE`{.envar} and    |
|                      |                | creates output logical  |
|                      |                | file name               |
|                      |                | `OUTFILE`{.envar}. It   |
|                      |                | prompts for the start   |
|                      |                | date, start time,       |
|                      |                | duration, and variables |
|                      |                | that you want to        |
|                      |                | extract from the        |
|                      |                | `INFILE`{.envar}. If    |
|                      |                | `OUTFILE`{.envar}       |
|                      |                | already exists,         |
|                      |                | **m3xtract** appends    |
|                      |                | additional data to the  |
|                      |                | file (assuming that the |
|                      |                | grid is the same and    |
|                      |                | the time period is      |
|                      |                | sequential).            |
+----------------------+----------------+-------------------------+
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20738}5.3.11.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `TMPR_VAR`{.envar}: \[default: TA\]

    Sets the name of the temperature variable that will be read from the
    `MET_CRO_3D`{.envar} input file. Acceptable values for MCIP and MPCL
    outputs available at the time of this writing are TA (ambient
    layer-1 temperature from the `MET_CRO_3D`{.envar} file), TEMP10
    (10-meter temperature from the `MET_CRO_2D`{.envar} file), TGD
    (ground temperature), TGRND (ground temperature), and TEMP1P5
    (1.5-meter temperature). Current guidance from EPA suggests that a
    10- to 20-meter temperature is the best choice for the temperature
    input to BEIS3, to account for the fact that these models do not
    include a canopy model.

-   `N_S_HEMI`{.envar}: \[default: NORTH\]

    Sets the program to run for the Northern or Southern Hemisphere.
    Acceptable values for this setting are:

    ::: {.itemizedlist}
    -   NORTH: Northern Hemisphere. Program starts July 1 and scans data
        in reverse chronological order to find the last freeze date and
        in chronological order to find the first freeze date.

    -   SOUTH: Southern Hemisphere. Program starts January 1 and scans
        data in chronological order to find the first freeze date. It
        also starts December 31 and scans the data in reverse
        chronological order to find the last freeze date.
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20772}5.3.11.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name             Format           Description
  --------------------- ---------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `BIOSEASON`{.envar}   I/O API NetCDF   For each grid cell, contains 0 for winter dates and 1 for summer (nonwinter) dates. The file's duration will be as long as that of the input meteorology file you provide.
  `LOGFILE`{.envar}     ASCII            Log generated from executing **Metscan**
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s10.html)     [Up](ch05s03.html)     [Next](ch05s03s12.html)
  5.3.10. **Metcombine**      [Home](index.html)        5.3.12. **Pktreduc**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.12. **Pktreduc**
:::

[Prev](ch05s03s11.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s13.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_pktreduc}5.3.12. **Pktreduc** {#pktreduc .title}

</div>

</div>
:::

::: {.toc}
[[5.3.12.1.
Description](ch05s03s12.html#sect_pktreduc_description)]{.section}

[[5.3.12.2. Processing Order](ch05s03s12.html#d0e20830)]{.section}

[[5.3.12.3. Files and Environment
Variables](ch05s03s12.html#d0e20844)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_pktreduc_description}5.3.12.1. Description {#description .title}

</div>

</div>
:::

The **Pktreduc** program reduces the size of growth packets (using the
/PROJECTION/ packet in the `GCNTL`{.envar} file), but keeps the same
information. This is done by identifying and implementing state defaults
where possible. This program works solely with growth packets that have
state/county and SCC entries only; it will not work if the packet
contains SIC, MACT, or pollutant codes.

The program identifies the most common growth factor for each state
across the many counties for each SCC, and this factor is assigned as
the default for the state/SCC combinations. The county/SCC-specific
entries are left as is. In this way, the contents of the file are the
same as far as SMOKE is concerned, but the file processes through
**Cntlmat** much faster because the growth packet is much smaller. It is
acceptable if state defaults are already in the file, and **Pktreduc**
will leave these untouched. When state defaults are found for a state
(i.e., county code is set to 000), the program skips reductions for that
state and no changes are made (even if they could be).
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20830}5.3.12.2. Processing Order {#processing-order .title}

</div>

</div>
:::

The **Pktreduc** program is an optional preprocessor for the
`GCNTL`{.envar} input file to **Cntlmat** when processing growth
packets.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20844}5.3.12.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.12.3.1. Input Files](ch05s03s12.html#d0e20847)]{.section}

[[5.3.12.3.2. Input Environment
Variables](ch05s03s12.html#d0e20880)]{.section}

[[5.3.12.3.3. Output Files](ch05s03s12.html#d0e20885)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20847}5.3.12.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name         Format   Description
  ----------------- -------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `GCNTL`{.envar}   ASCII    Growth and controls file that includes only the /PROJECTION/ packet. The other packets that are normally acceptable as input to **Cntlmat** (see [Section 8.6.1, "`GCNTL`{.envar}: Files for controls and/or past- and future-year growth"](ch08s06.html#sect_input_gcntl "8.6.1. GCNTL: Files for controls and/or past- and future-year growth")) should not be included in this file when it is an input to **Pktreduc**. In addition, the /PROJECTION/ packet entries can include only state/county/SCC combinations; no combinations that include SIC, MACT, or pollutant codes or other fields should be included.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20880}5.3.12.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

None
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20885}5.3.12.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name             Format   Description
  --------------------- -------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `GCNTL_OUT`{.envar}   ASCII    Reformatted `GCNTL`{.envar} file that includes only the /PROJECTION/ packet for inventory growth. The reformatting performed is described in [Section 5.3.12.1, "Description"](ch05s03s12.html#sect_pktreduc_description "5.3.12.1. Description").
  `LOGFILE`{.envar}     ASCII    Log generated from executing **Pktreduc**
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s11.html)     [Up](ch05s03.html)     [Next](ch05s03s13.html)
  5.3.11. **Metscan**         [Home](index.html)        5.3.13. **Smk2emis**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.13. **Smk2emis**
:::

[Prev](ch05s03s12.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s14.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_smk2emis}5.3.13. **Smk2emis** {#smk2emis .title}

</div>

</div>
:::

::: {.toc}
[[5.3.13.1. Description](ch05s03s13.html#d0e20929)]{.section}

[[5.3.13.2. Processing Order](ch05s03s13.html#d0e20946)]{.section}

[[5.3.13.3. Files and Environment
Variables](ch05s03s13.html#d0e20974)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20929}5.3.13.1. Description {#description .title}

</div>

</div>
:::

The **Smk2emis** program converts SMOKE I/O API gridded, mole-speciated,
hourly emissions into the Fortran-binary format used for 2-D emissions
by UAM and CAM~X~. Files of this format use the UAM keyword
"[EMISSIONS]{.quote}". The SMOKE user is responsible for preparing the
I/O API inputs with the appropriate chemical species, grid structures,
time steps, and units for use in whatever model will be using the
results of **Smk2emis**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20946}5.3.13.2. Processing Order {#processing-order .title}

</div>

</div>
:::

**Smk2emis** inputs the I/O API gridded, speciated, hourly emissions
files output from **Smkmerge** (`AGTS_L`{.envar}, `MGTS_L`{.envar},
`PGTS_L`{.envar}, or `EGTS_L`{.envar}) or output from **Tmpbeis3**
(`BGTS_L`{.envar}).
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e20974}5.3.13.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.13.3.1. Input Files](ch05s03s13.html#d0e20977)]{.section}

[[5.3.13.3.2. Input Environment
Variables](ch05s03s13.html#d0e21013)]{.section}

[[5.3.13.3.3. Other Inputs](ch05s03s13.html#d0e21224)]{.section}

[[5.3.13.3.4. Output Files](ch05s03s13.html#d0e21245)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e20977}5.3.13.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                    Format           Description
  ---------------------------- ---------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `[A|B|M|P|E]GTS_L`{.envar}   I/O API NetCDF   SMOKE 2-D gridded, mole-speciated, hourly emissions file.
  `VNAMMAP`{.envar}            ASCII            Optional file for renaming variables from those in the I/O API file header to those needed by the AQM. See the `SMK2EMIS_VMAP_YN`{.envar} environment variable below.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21013}5.3.13.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `FLABEL`{.envar}: \[default: EMISSIONS (currently the only working
    option)\]

    Defines what type of UAM/CAM~X~ file to output. This setting cannot
    be adjusted by the user, because the current version of **Smk2emis**
    can generate only the "[EMISSIONS]{.quote}" file.

-   `SMK2EMIS_VMAP_YN`{.envar}: \[default: N\]

    Controls whether the name remapping file will be read in, to cause
    **Smk2emis** to output different variable names than are in the
    input file. This is needed for using UAM-AERO, which requires
    symbols in the variable names (such as "[.]{.quote}", "[+]{.quote}",
    and "[-]{.quote}") that are not permitted in I/O API file variable
    names.

    ::: {.itemizedlist}
    -   Y: Use the `VNAMMAP`{.envar} file

    -   N: Do not use the `VNAMMAP`{.envar} file
    :::

-   `SMK_SOURCE`{.envar}: \[default: none\]

    Defines the type of sources to be processed. Valid values are:

    ::: {.itemizedlist}
    -   A: Area sources

    -   B: Biogenic sources

    -   M: On-road mobile sources

    -   P: Point sources

    -   E: All emissions sources (determined by how **Smkmerge** was
        run)
    :::

    In **Smk2emis**, this variable controls the name of the input NetCDF
    logical file and the name of the output binary logical file. Unlike
    in most other SMOKE programs, for this program `SMK_SOURCE`{.envar}
    can be set to "[E]{.quote}" to indicate that the "[every]{.quote}"
    source category merged file (`EGTS_L`{.envar}) should be converted
    from I/O API to Fortran-binary format.

-   `UTM_ZONE`{.envar}: \[default: -9\]

    Defines UTM zone for the header of the UAM EMISSIONS file.

    ::: {.itemizedlist}
    -   -9: Latitude-longitude projection
    :::

-   `UAM_LAYERS`{.envar}: \[default: NLAYS3D\]

    Defines number of layers in output file

    ::: {.itemizedlist}
    -   NLAYS3D: Value from SMOKE netCDF input file
    :::

-   `UAM4_LAYBELOW`{.envar}: \[default: 0\]

    Defines number of layers below diffusion break

    ::: {.itemizedlist}
    -   0: UAM-V or CAM~X~ style

    -   \>0: UAM-IV style
    :::

-   `UAM4_LAYABOVE`{.envar}: \[default: 0\]

    Defines number of layers above diffusion break

    ::: {.itemizedlist}
    -   0: UAM-V or CAM~X~ style

        \>0: UAM-IV style
    :::

-   `UAM4_HTSFC`{.envar}: \[default: 0.0\]

    Defines height of surface layer

    ::: {.itemizedlist}
    -   0.0: UAM-V or CAM~X~ style

    -   \>0.0: UAM-IV style
    :::

-   `UAM4_HTLOWR`{.envar}: \[default: 0.0\]

    Defines minimum height of cells between surface layer and diffusion
    break (meters)

    ::: {.itemizedlist}
    -   0.0: UAM-V or CAM~X~ style

    -   \>0.0: UAM-IV
    :::

-   `UAM4_HTUPPR`{.envar}: \[default: 0.0\]

    Defines minimum height of cells between diffusion break and top of
    region(meters)

    ::: {.itemizedlist}
    -   0.0: UAM-V or CAM~X~ style

    -   \>0.0: UAM-IV
    :::

-   `UAM_NOTE`{.envar}: \[default: UAM gridded emissions from SMK2EMIS\]

    Defines the note to be written to the header of the UAM or CAM~X~
    output file
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21224}5.3.13.3.3. Other Inputs {#other-inputs .title}

</div>

</div>
:::

If you are running **Smk2emis** interactively, the following inputs will
be requested. The default values for these are set by the time variables
found in the input I/O API file header. If you are not running
**Smk2emis** interactively, the values of these settings will be taken
from the input file being converted to Fortran-binary format, so no
action from you is required.

::: {.itemizedlist}
-   Start date: Starting date of simulation in Julian (DDDYYYY) or
    Gregorian (MMDDYYYY) formats

-   Start Time: Starting time of simulation in HHMMSS.

-   Duration: Simulation duration in hours.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21245}5.3.13.3.4. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name                      Format           Description
  ------------------------------ ---------------- ----------------------------------------------------------
  `UAM_[A|B|M|P|E]GTS`{.envar}   Fortran binary   UAM-IV-, UAM-V- or CAMx-ready gridded, hourly emissions.
  `LOGFILE`{.envar}              ASCII            Log generated from executing **Smk2emis**.
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s12.html)     [Up](ch05s03.html)     [Next](ch05s03s14.html)
  5.3.12. **Pktreduc**        [Home](index.html)        5.3.14. **Surgtool**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.14. **Surgtool**
:::

[Prev](ch05s03s13.html) 

5.3.  SMOKE Utility Programs

 [Next](ch05s03s15.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_surgtool}5.3.14. **Surgtool** {#surgtool .title}

</div>

</div>
:::

::: {.toc}
[[5.3.14.1. Description](ch05s03s14.html#d0e21286)]{.section}

[[5.3.14.2. Processing Order](ch05s03s14.html#d0e21311)]{.section}

[[5.3.14.3. Files and Environment
Variables](ch05s03s14.html#d0e21331)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e21286}5.3.14.1. Description {#description .title}

</div>

</div>
:::

The **Surgtool** program inputs SMOKE-formatted gridding surrogates for
a "[fine]{.quote}" input grid and a grid definition for a
"[coarse]{.quote}" output grid. It produces an approximate
"[coarse]{.quote}" grid surrogates file, the accuracy of which depends
on how fine the resolution of the input grid is relative to that of the
output grid.

The program requires that the input and output grids use a lat-lon,
Lambert Conformal, or UTM map projection. **Surgtool** can also perform
Lambert-to-Lambert and UTM zone-to-zone transformations. In addition,
the program requires that the input grid resolution be much finer than
the output grid resolution (at least three times finer is recommended,
though no specific limitation is given by the code). **Surgtool**
supports SMOKE-formatted surrogate coefficient files only.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e21311}5.3.14.2. Processing Order {#processing-order .title}

</div>

</div>
:::

Since **Surgtool** is an optional program that creates new Area and/or
Mobile `BGPRO`{.envar} spatial surrogate files from existing Area,
Mobile and/or Biogenic `BGPRO`{.envar} spatial surrogate files, it must
be run before any of the following programs that use these files:
**Grdmat**, and **Smkmerge**.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e21331}5.3.14.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.14.3.1. Input Files](ch05s03s14.html#d0e21334)]{.section}

[[5.3.14.3.2. Input Environment
Variables](ch05s03s14.html#d0e21374)]{.section}

[[5.3.14.3.3. Output Files](ch05s03s14.html#d0e21388)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21334}5.3.14.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format   Description
  -------------------- -------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `GRIDDESC`{.envar}   ASCII    Grid descriptions file that defines the output grid for the output surrogates file created by the program. It must include the name of the grid set by the `IOAPI_GRIDNAME_1`{.envar} environment variable setting.
  `INFILE`{.envar}     ASCII    Area and Mobile spatial surrogate file format (see [Section 8.4.2, "Area and Mobile Spatial Surrogates Files"](ch08s04s02.html "8.4.2. Area and Mobile Spatial Surrogates Files")) and Biogenic spatial surrogate file format (see [Section 8.4.5, "`BGPRO`{.envar}: Biogenic spatial surrogate file"](ch08s04s05.html "8.4.5. BGPRO: Biogenic spatial surrogate file")). File can be for Lambert Conformal, UTM, or lat-lon projection.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21374}5.3.14.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `IOAPI_GRIDNAME_1`{.envar}: \[default: blank\]

    This variable sets the name of the output grid definition to be read
    from the `GRIDDESC`{.envar} input file. The name can be a maximum of
    16 characters (the limitation of I/O API grid names).
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21388}5.3.14.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format   Description
  ------------------- -------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `LOGFILE`{.envar}   ASCII    Log generated from executing **Surgtool**
  `OUTFILE`{.envar}   ASCII    Estimated surrogates file for the grid defined in `GRIDDESC`{.envar} and selected by the `IOAPI_GRIDNAME_1`{.envar} setting. This surrogates file is not as accurate as creating a spatial surrogates file from the MIMS spatial allocator. However, the finer the **Surgtool** input grid is relative to the output grid, the more accurate the estimated surrogates are.
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------
  [Prev](ch05s03s13.html)     [Up](ch05s03.html)     [Next](ch05s03s15.html)
  5.3.13. **Smk2emis**        [Home](index.html)         5.3.15. **Uam2ncf**
  -------------------------- -------------------- --------------------------
:::
::: {.navheader}
5.3.15. **Uam2ncf**
:::

[Prev](ch05s03s14.html) 

5.3.  SMOKE Utility Programs

 [Next](ch06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_utilities_uam2ncf}5.3.15. **Uam2ncf** {#uam2ncf .title}

</div>

</div>
:::

::: {.toc}
[[5.3.15.1. Description](ch05s03s15.html#d0e21436)]{.section}

[[5.3.15.2. Processing Order](ch05s03s15.html#d0e21471)]{.section}

[[5.3.15.3. Files and Environment
Variables](ch05s03s15.html#d0e21476)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e21436}5.3.15.1. Description {#description .title}

</div>

</div>
:::

The **Uam2ncf** program takes UAM EMISSIONS gridded files and creates an
I/O API gridded file from them, which can then be merged with other
gridded SMOKE I/O API files. This program is useful for converting area,
nonroad mobile, on-road mobile, and biogenic UAM-ready files to the I/O
API format needed for CMAQ. **Uam2ncf** can also be used with low-level
point sources, but not with the elevated-point-source inputs for UAM and
CAM~X~.

If you wish to create CMAQ inputs from model-ready emissions for UAM or
CAM~X~, you must take the following steps:

::: {.orderedlist}
1.  Use **Uam2ncf** to convert individual source categories for area,
    biogenic, and mobile sources to I/O API format.

2.  Run SMOKE for point-source inventory to create 3-D I/O API file.

3.  Run **Mrggrid** to combine converted inventory for nonpoint sources
    with SMOKE-created inventory for point sources.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e21471}5.3.15.2. Processing Order {#processing-order .title}

</div>

</div>
:::

Because this optional program operates on model-ready files, it is run
before the CMAQ air quality model.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e21476}5.3.15.3. Files and Environment Variables {#files-and-environment-variables .title}

</div>

</div>
:::

::: {.toc}
[[5.3.15.3.1. Input Files](ch05s03s15.html#d0e21479)]{.section}

[[5.3.15.3.2. Input Environment
Variables](ch05s03s15.html#d0e21521)]{.section}

[[5.3.15.3.3. Output Files](ch05s03s15.html#d0e21535)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21479}5.3.15.3.1. Input Files {#input-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name            Format           Description
  -------------------- ---------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `GRIDDESC`{.envar}   ASCII            Grid descriptions file that defines the input grid in the `UAMEMIS`{.envar} file. This is needed because the `UAMEMIS`{.envar} file does not include enough information to describe the grid for the I/O API. The file must include the name of the grid set by the `IOAPI_GRIDNAME_1`{.envar} environment variable setting.
  `UAMEMIS`{.envar}    Fortran binary   UAM-ready, gridded, hourly, speciated emissions file.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21521}5.3.15.3.2. Input Environment Variables {#input-environment-variables .title}

</div>

</div>
:::

::: {.itemizedlist}
-   `IOAPI_GRIDNAME_1`{.envar}: \[default: blank\]

    This variable sets the name of the input (and output) grid
    definition to be read from the `GRIDDESC`{.envar} input file. The
    name can be a maximum of 16 characters long (the limitation of I/O
    API grid names).
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e21535}5.3.15.3.3. Output Files {#output-files .title}

</div>

</div>
:::

::: {.informaltable}
  File Name           Format           Description
  ------------------- ---------------- -----------------------------------------------------------------------------
  `E2DNCF`{.envar}:   I/O API NetCDF   Gridded, hourly, speciated emissions in the I/O API format needed for CMAQ.
  `LOGFILE`{.envar}   ASCII            Log generated from executing **Uam2ncf**
:::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- ---------------------------------
  [Prev](ch05s03s14.html)     [Up](ch05s03.html)                  [Next](ch06.html)
  5.3.14. **Surgtool**        [Home](index.html)     Chapter 6. SMOKE Core Programs
  -------------------------- -------------------- ---------------------------------
:::
