::: {.navheader}
Chapter 2. SMOKE Concepts
:::

[Prev](ch01s03.html) 

 

 [Next](ch02s02.html)

------------------------------------------------------------------------

::: {.chapter lang="en"}
::: {.titlepage}
<div>

<div>

[]{#ch_concepts}Chapter 2. SMOKE Concepts {#chapter-2.-smoke-concepts .title}
-----------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.1. Introduction](ch02.html#d0e500)]{.section}

[[2.2. Assigns file and environment variables](ch02s02.html)]{.section}

[[2.3. Emission inventories](ch02s03.html)]{.section}

[[2.4. Cross-referencing and profiles](ch02s04.html)]{.section}

[[2.5. Input and output file types](ch02s05.html)]{.section}

[[2.6. Modeling parameters](ch02s06.html)]{.section}

[[2.7. Sparse matrix approach to emissions
modeling](ch02s07.html)]{.section}

[[2.8. Area, biogenic, mobile, and point processing
summaries](ch02s08.html)]{.section}

[[2.9. Inventory import](ch02s09.html)]{.section}

[[2.10. Temporal processing](ch02s10.html)]{.section}

[[2.11. Chemical speciation processing](ch02s11.html)]{.section}

[[2.12. Spatial processing](ch02s12.html)]{.section}

[[2.13. Growth processing](ch02s13.html)]{.section}

[[2.14. Control processing](ch02s14.html)]{.section}

[[2.15. Elevated-source processing](ch02s15.html)]{.section}

[[2.16. Mobile-source processing with MOVES](ch02s16.html)]{.section}

[[2.17. Biogenic processing](ch02s17.html)]{.section}

[[2.18. Creating model-ready emissions](ch02s18.html)]{.section}

[[2.19. Creating model-ready emissions using MOVES lookup
tables](ch02s19.html)]{.section}

[[2.20. Quality assurance](ch02s20.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#d0e500}2.1. Introduction {#introduction .title style="clear: both"}
----------------------------

</div>

</div>
:::

The purpose of SMOKE is to convert the resolution of the data in an
emission inventory to the resolution needed by an air quality model.
Emission inventories typically have an annual-total emissions value for
each emissions source, or perhaps an average-day emissions value. The
AQMs, however, typically require emissions data on an hourly basis, for
each model grid cell (and perhaps model layer), and for each model
species. Consequently, to achieve the input requirements of the AQM,
emissions processing must (at a minimum) transform inventory data by
temporal allocation, chemical speciation, spatial allocation, and
perhaps layer assignment.

In addition to changing the resolution of the data, SMOKE must also
provide the AQM input files in the correct file format. SMOKE can create
the Input/Output Applications Programming Interface (I/O API) Network
Common Data Form (NetCDF) output format needed by the CMAQ model. It can
also create the Fortran binary format for the 2-D emissions needed by
UAM, and CAM~X~, and the ASCII elevated-point-source format used by the
Ptsrce preprocessor to these models. File format is also important for
the input files used by SMOKE, most of which are ASCII files, but some
of which are I/O API NetCDF or CF-compliant NetCDF format files.

In this chapter, we introduce you to various concepts that are critical
to understanding the technical description of emissions processing, as
well as provide more detail about the processing capabilities of SMOKE.
(Later, [Chapter 5, *SMOKE Utility
Tools*](ch05.html "Chapter 5. SMOKE Utility Tools"), [Chapter 6, *SMOKE
Core Programs*](ch06.html "Chapter 6. SMOKE Core Programs"), [Chapter 7,
*SMOKE Quality
Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance"), [Chapter 8,
*SMOKE Input Files*](ch08.html "Chapter 8. SMOKE Input Files"),
[Chapter 9, *SMOKE Intermediate
Files*](ch09.html "Chapter 9. SMOKE Intermediate Files"), and
[Chapter 10, *SMOKE Output
Files*](ch10.html "Chapter 10. SMOKE Output Files") give more specifics
about each program's capabilities and each file's format.) This chapter
provides the context and framework for the rest of the user's manual. To
assist you in reading and using this chapter, we provide [Appendix A.
Glossary](go01.html "Appendix A. Glossary") for definitions of emissions
inventory and emissions modeling terminology.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------ -------------------- ----------------------------------------------
  [Prev](ch01s03.html)                                                          [Next](ch02s02.html)
  1.3. How to Use this Manual     [Home](index.html)     2.2. Assigns file and environment variables
  ------------------------------ -------------------- ----------------------------------------------
:::
::: {.navheader}
2.2. Assigns file and environment variables
:::

[Prev](ch02.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_assigns}2.2. Assigns file and environment variables {#assigns-file-and-environment-variables .title style="clear: both"}
---------------------------------------------------------------------

</div>

</div>
:::

The Assigns file is a script used to set up the parameters of a SMOKE
run. The file configures the UNIX environment so that all of the correct
input, intermediate, and output directories and files can be identified
and used by the SMOKE programs. It also sets things like the name of the
grid and the time period that you will run SMOKE for a given case. It
does this by setting many UNIX environment variables, explained in the
next paragraph. The Assigns file also uses environment variables to
configure compiler options, so that SMOKE can be compiled on operating
system other than the ones provided with the SMOKE distribution. More
information on the Assigns file is provided in [Section 4.2.2.2,
"Assigns
files"](ch04s02s02.html#sect_scripts_assigns_files "4.2.2.2. Assigns files").

Environment variables are aliases that can be set by a UNIX operating
system. These variables are defined during a user's UNIX session,
usually defined by an **xterm** or other UNIX terminal window. The
environment variables that SMOKE uses store the input, intermediate, and
output files and directories. For example, the environment variable for
the directory that is the SMOKE root directory is `SMKROOT`{.envar}. At
the UNIX prompt, this environment variable could be defined to an actual
path such as `/home/mylogin/smoke`{.filename}. To set an environment
variable, the UNIX **setenv** command is needed. In this example, the
command to define `SMKROOT`{.envar} as the given path is:

**`setenv SMKROOT` `/home/mylogin/smoke`{.filename}**

After this command is issued, the `SMKROOT`{.envar} environment variable
stores the characters `/home/mylogin/smoke`{.filename} as its value. To
use the value of an environment variable, the dollar sign must proceed
the variable name at the UNIX prompt. In the follow example, we give the
UNIX command **echo** to print the contents of the `SMKROOT`{.envar}
environment variable at the UNIX prompt. Note the use of the dollar sign
before the `SMKROOT`{.envar} variable name.

**`echo $SMKROOT`**

When the UNIX system executes this command, the following is displayed
at the UNIX prompt:

`/home/mylogin/smoke`{.computeroutput}

The environment variables set by the Assigns file for directories are
described in [Chapter 3, *SMOKE Directory
Structure*](ch03.html "Chapter 3. SMOKE Directory Structure"). The
variables used by the SMOKE scripts for controlling SMOKE execution are
described in [Section 4.2.4, "Script
settings"](ch04s02s04.html "4.2.4. Script settings"). Finally, the
environment variables that control program behavior are described in
[Chapter 5, *SMOKE Utility
Tools*](ch05.html "Chapter 5. SMOKE Utility Tools"), [Chapter 6, *SMOKE
Core Programs*](ch06.html "Chapter 6. SMOKE Core Programs"), and
[Chapter 7, *SMOKE Quality
Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance").
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------- -------------------- ----------------------------
  [Prev](ch02.html)              [Up](ch02.html)            [Next](ch02s03.html)
  Chapter 2. SMOKE Concepts     [Home](index.html)     2.3. Emission inventories
  ---------------------------- -------------------- ----------------------------
:::
::: {.navheader}
2.3. Emission inventories
:::

[Prev](ch02s02.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s03s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_emis_inv}2.3. Emission inventories {#emission-inventories .title style="clear: both"}
----------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.3.1. Inventory data
types](ch02s03.html#sect_concepts_inv_data_types)]{.section}

[[2.3.2. Inventory source categories](ch02s03s02.html)]{.section}

[[2.3.3. Inventory file formats](ch02s03s03.html)]{.section}

[[2.3.4. Country, state, and county codes](ch02s03s04.html)]{.section}

[[2.3.5. Source Classification Codes](ch02s03s05.html)]{.section}

[[2.3.6. Standard Industrial Classification
codes](ch02s03s06.html)]{.section}

[[2.3.7. Geographical Code
(GEOCODE\_LEVEL\[1-4\]](ch02s03s07.html)]{.section}

[[2.3.8. Maximum Achievable Control Technology
codes](ch02s03s08.html)]{.section}

[[2.3.9. Source types: major and section-112 area
sources](ch02s03s09.html)]{.section}

[[2.3.10. Source types: nonroad and onroad mobile
sources](ch02s03s10.html)]{.section}
:::

Emission inventories are the key input files to SMOKE and emissions
modeling. The data types that these inventories contain are called
inventory pollutants (e.g., carbon monoxide, ammonia, mercury). By
itself, SMOKE does not require specific data types in the inventory
files it reads. However, the AQMs that SMOKE supports do require certain
input data, called model species, which in turn requires SMOKE to use
certain inventory pollutants.

In this section, we focus on the inventory files that SMOKE uses.
[Section 2.3.1, "Inventory data
types"](ch02s03.html#sect_concepts_inv_data_types "2.3.1. Inventory data types")
describes the major inventory types useable by SMOKE. In [Section 2.3.2,
"Inventory source
categories"](ch02s03s02.html "2.3.2. Inventory source categories"), we
describe the inventory source categories, and in [Section 2.3.3,
"Inventory file
formats"](ch02s03s03.html "2.3.3. Inventory file formats") we discuss
the inventory file formats. The remaining sections describe the various
codes used in specific inventory sources: [Section 2.3.4, "Country,
state, and county
codes"](ch02s03s04.html "2.3.4. Country, state, and county codes"),
[Section 2.3.5, "Source Classification
Codes"](ch02s03s05.html "2.3.5. Source Classification Codes"),
[Section 2.3.6, "Standard Industrial Classification
codes"](ch02s03s06.html "2.3.6. Standard Industrial Classification codes"),
[Section 2.3.8, "Maximum Achievable Control Technology
codes"](ch02s03s08.html "2.3.8. Maximum Achievable Control Technology codes"),
[Section 2.3.9, "Source types: major and section-112 area
sources"](ch02s03s09.html "2.3.9. Source types: major and section-112 area sources")
and [Section 2.3.10, "Source types: nonroad and onroad mobile
sources"](ch02s03s10.html "2.3.10. Source types: nonroad and onroad mobile sources").

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_inv_data_types}2.3.1. Inventory data types {#inventory-data-types .title}

</div>

</div>
:::

SMOKE processes criteria, particulate, toxics, and activity data
inventories. Activity data will be discussed along with on-road mobile
sources in the next section. By criteria inventories, we mean
inventories containing EPA's criteria pollutants: carbon monoxide (CO),
nitrogen oxides (NO~x~), and volatile organic compounds (VOC) or total
organic gases (TOG). Particulate inventories contain ammonia (NH~3~),
sulfur dioxide (SO~2~), particulate matter (PM) of size 10 microns or
less (PM~10~), and PM of size 2.5 microns or less (PM~2.5~).

Additionally, SMOKE can process inventories with pre-speciated criteria
and/or particulate emissions. For example, elemental carbon of size 2.5
microns or less can be provided as input to SMOKE directly, instead of
letting SMOKE's speciation step compute it from the PM~2.5~ total
emissions. To ensure that SMOKE correctly processes the data when you
are using pre-speciated emissions, other input files must be configured
in specific ways, as explained in [Section 4.4.10, "Use a different
speciation mechanism or change speciation
inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs").

The toxics inventories that SMOKE can process are data from the National
Emission Inventory (NEI) for Hazardous Air Pollutants (HAPs). This
inventory contains hundreds of specific compounds representing the 188
HAPs defined by the Clear Air Act. The original list of 189 HAPs and
modifications representing the current list are available from the
[EPA's web site](http://www.epa.gov/ttn/atw/orig189.html). The reason
the inventory contains many more pollutants than 188 is because several
on the list of 188 are pollutant groups, such as polycyclic organic
matter, cyanide compounds and numerous metal compounds including
chromium compounds, cadmium compounds, manganese compounds, and others.
Note that because of these groups, specific compounds in the inventory
in one inventory year may not exactly match the compounds in another
inventory year. For example, one may have lead oxide reported one year
but not in a subsequent year. However, those compounds not belonging to
compound groups are likely to be in the inventory year after year,
particularly the common gaseous HAPs emitted by mobile sources such as
benzene, 1,3-butadiene, acrolein, formaldehyde, and acetaldehyde.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------- -------------------- -------------------------------------
  [Prev](ch02s02.html)                             [Up](ch02.html)                  [Next](ch02s03s02.html)
  2.2. Assigns file and environment variables     [Home](index.html)     2.3.2. Inventory source categories
  ---------------------------------------------- -------------------- -------------------------------------
:::
::: {.navheader}
2.3.2. Inventory source categories
:::

[Prev](ch02s03.html) 

2.3. Emission inventories

 [Next](ch02s03s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_inv_source_categories}2.3.2. Inventory source categories {#inventory-source-categories .title}

</div>

</div>
:::

::: {.toc}
[[2.3.2.1. Overview](ch02s03s02.html#d0e661)]{.section}

[[2.3.2.2. Detailed source category
descriptions](ch02s03s02.html#d0e888)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e661}2.3.2.1. Overview {#overview .title}

</div>

</div>
:::

Emission inventories are divided into several source categories. These
divisions stem from both differing methods for preparing the inventories
and from different characteristics and attributes of the categories
(more on these terms later). Generally, emission inventories are divided
into the following source categories:

::: {.itemizedlist}
-   [**Stationary area/Nonpoint sources:**]{.bold} Sources that are
    treated as being spread over a spatial extent (usually a county or
    air district) and that are not moveable (as compared to nonroad
    mobile and on-road mobile sources). Because it is not possible to
    collect the emissions at each point of emission, they are estimated
    over larger regions. The EPA introduced the term
    "[nonpoint]{.quote}" to replace "[stationary area]{.quote}" in order
    to avoid confusion with the term "[area source]{.quote}", which is
    used as a regulatory term in the toxics realm. However,
    "[nonpoint]{.quote}" has not gained acceptance (thus far) by the
    criteria inventory/modeling community. Thus, in this manual we will
    use the term "[stationary area]{.quote}" to refer to these sources
    when they are in criteria inventories, while we use the term
    "[nonpoint]{.quote}" to refer to these sources when they are in
    toxics inventories. Examples of nonpoint or stationary area sources
    are residential heating and architectural coatings. Numerous
    sources, such as dry cleaning facilities, may be treated either as
    stationary area/nonpoint sources or as point sources; in particular,
    the toxics inventory contains numerous small sources (based on
    emissions) that are not inventoried as nonpoint sources because
    their locations are known and are provided.

-   [**Nonroad mobile sources:**]{.bold} Vehicular and otherwise movable
    sources that do not include vehicles that travel on roadways. These
    sources are also computed as being spread over a spatial extent
    (again, a county or air district). Examples of nonroad mobile
    sources include locomotives, lawn and garden equipment, construction
    vehicles, and boating emissions. These sources are included in both
    criteria and toxics inventories.

-   [**On-road mobile sources:**]{.bold} Vehicular sources that travel
    on roadways. These sources can be computed either as being spread
    over a spatial extent or as being assigned to a line location
    (called a link). Data in on-road inventories can be either emissions
    or activity data. Activity data consists of vehicle miles traveled
    (VMT) and, optionally, vehicle speed. Activity data are used when
    SMOKE will be computing emission factors via another model such as
    MOVES. Examples of on-road mobile sources include light-duty
    gasoline vehicles and heavy-duty diesel vehicles. On-road mobile
    sources are included in both criteria and toxics inventories.

-   [**Point sources:**]{.bold} These are sources that are identified by
    point locations, typically because they are regulated and their
    locations are available in regulatory reports. Point sources are
    often further subdivided into electric generating utilities (EGUs)
    and non-EGU sources, particularly in criteria inventories in which
    EGUs are a primary source of NO~x~ and SO~2~. Examples of non-EGU
    point sources include chemical manufacturers and furniture
    refinishers. Point sources are included in both the criteria and
    toxics inventories.

-   [**Wildfire sources:**]{.bold} Traditionally, wildfire emissions
    have been treated as stationary area sources. More recently, data
    have also been developed for point locations, with day-specific
    emissions and hour-specific plume rise (vertical distribution of
    emissions). In this case, the wildfire emissions are processed by
    SMOKE as point sources.

-   [**Biogenic land use data:**]{.bold} Biogenic land use data
    characterize the type of vegetation that exists in either county
    total or grid cell values. The biogenic land use data in North
    American is available using two different sets of land use
    categories: the Biogenic Emissions Landcover Database (BELD) version
    2 (BELD2), and the BELD version 3 (BELD3).
:::

Emission processing in SMOKE is divided into four processing categories:
area, biogenic, mobile, and point. The definitions of these categories
that SMOKE uses are different than those used for defining emission
inventories. [Table 2.1, "Inventory source categories and SMOKE
processing capabilities and
categories"](ch02s03s02.html#tbl_concepts_inv_categories "Table 2.1. Inventory source categories and SMOKE processing capabilities and categories")
lists the inventory source categories, the types of inventories
(activity data, criteria, particulates, and toxics) that SMOKE can
process, the temporal resolution that is acceptable to SMOKE, and the
SMOKE processing category that should be used for processing the
inventory.

::: {.table}
[]{#tbl_concepts_inv_categories}

**Table 2.1. Inventory source categories and SMOKE processing
capabilities and categories**

Inventory source category
:::
:::
:::

Temporal resolution that SMOKE can process\*

SMOKE processing category

Activity data

Criteria

Particulates

Toxics

Nonpoint or stationary area

N/A

A, S, D, H

A, S, D, H

A, S, D, H

Area

Nonroad mobile

N/A

A, S, D, H

A, S, D, H

A, S, D, H

Area

On-road mobile (MOBILE 6)

A

A, S, D, H

A, S, D, H

A, S, D, H

Mobile

On-road mobile (MOVES)

A

H

H

H

Mobile

EGU

N/A

A, S, D, H

A, S, D, H

A, S, D, H

Point

Non-EGU

N/A

A, S, D, H

A, S, D, H

A, S, D, H

Point

Wildfire with precomputed plume rise

N/A

D, H

D, H

N/A

Point

Wildfire with internal plume rise calculation

N/A

D

D

N/A

Point

Biogenic land use

N/A

X

N/A

N/A

Biogenic

\* [**A**]{.bold} = Supports annual data; [**S**]{.bold} = Supports
average-day data; [**D**]{.bold} = Supports day-specific data;
[**H**]{.bold} = Supports hourly data; [**X**]{.bold} = Supports
available data

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e888}2.3.2.2. Detailed source category descriptions {#detailed-source-category-descriptions .title}

</div>

</div>
:::

::: {.toc}
[[2.3.2.2.1. Nonpoint/stationary area and nonroad mobile (SMOKE
category: area)](ch02s03s02.html#d0e905)]{.section}

[[2.3.2.2.2. On-road mobile (SMOKE category:
mobile)](ch02s03s02.html#d0e965)]{.section}

[[2.3.2.2.3. Point sources (SMOKE category:
point)](ch02s03s02.html#d0e1007)]{.section}

[[2.3.2.2.4. Wildfire with precomputed plume rise (SMOKE category:
point)](ch02s03s02.html#d0e1056)]{.section}

[[2.3.2.2.5. Wildfires with internal plume rise calculation (SMOKE
category: point)](ch02s03s02.html#d0e1100)]{.section}

[[2.3.2.2.6. Biogenic land use (SMOKE category:
biogenic)](ch02s03s02.html#d0e1139)]{.section}
:::

Each inventory source category has source characteristics, source
attributes, data values, and data attributes. [*Source
characteristics*]{.emphasis} are unique to each inventory source
category and also distinguish one source in the inventory from another.
[*Source attributes*]{.emphasis} further describe the sources with other
information that is useful for emissions processing, such as
point-source flue gas exit height and temperature. The [*data
values*]{.emphasis} are either emissions values or activity values. The
[*data attributes*]{.emphasis} are additional information about the data
values, such as the percentage reduction in emission from controls
already applied to the source. In the following subsections, we
summarize the source characteristics and attributes and the data values
and attributes that are used by SMOKE for each of the inventory
categories.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e905}2.3.2.2.1. Nonpoint/stationary area and nonroad mobile (SMOKE category: area) {#nonpointstationary-area-and-nonroad-mobile-smoke-category-area .title}

</div>

</div>
:::

::: {.itemizedlist}
-   [**Source characteristics:**]{.bold} For all typical inventories,
    the source characteristics that identify these sources are
    country/state/county code, SCC and/or GEOCODE\_LEVEL\[1-4\]. See
    [Section 2.3.4, "Country, state, and county
    codes"](ch02s03s04.html "2.3.4. Country, state, and county codes")
    and [Section 2.3.5, "Source Classification
    Codes"](ch02s03s05.html "2.3.5. Source Classification Codes") and
    [Section 2.3.7, "Geographical Code
    (GEOCODE\_LEVEL\[1-4\]"](ch02s03s07.html "2.3.7. Geographical Code (GEOCODE_LEVEL[1-4]")
    for further information.

-   [**Optional source characteristics:**]{.bold} SMOKE can also use
    pregridded data from the same modeling domain as a SMOKE area
    source; this is described in more detail in [Section 2.8.2.2,
    "Pre-gridded
    Emissions"](ch02s08s02.html#sect_concepts_pregridded_data "2.8.2.2. Pre-gridded Emissions").
    In this case, the source characteristics and attributes,
    (country/state/county code and SCC) are [*not*]{.emphasis} used in
    SMOKE. SMOKE can also use pregridded data from a different modeling
    domain along with geographical codes (GEOCODE\_LEVEL\[1-4\]) and
    source information from the ARINV file to specify the source
    characteristics and associated source attributes for each grid cell.

-   [**Source attributes:**]{.bold} The inventory year is associated
    with all sources in the inventory input files. In addition, SMOKE
    assigns a time zone (see [Section 2.9.14, "Assign country codes,
    years, and time
    zones"](ch02s09s14.html "2.9.14. Assign country codes, years, and time zones"))
    and an approach for normalization of temporal profiles (see
    [Section 2.9.13, "Set the weekday averaging
    approach"](ch02s09s13.html "2.9.13. Set the weekday averaging approach")).
    In the nonpoint toxics inventory only, Standard Industrial
    Classification (SIC) codes, Maximum Achievable Control Technology
    (MACT) codes, and North American Industrial Classification System
    (NAICS) codes are optional source attributes; the NAICS code is read
    by SMOKE but not otherwise used at this time. Additionally, a
    "[source type]{.quote}" field is available in the nonpoint inventory
    to identify major and Clean Air Act (CAA) section 112 area sources.
    See [Section 2.3.6, "Standard Industrial Classification
    codes"](ch02s03s06.html "2.3.6. Standard Industrial Classification codes")
    for a description of SIC codes, [Section 2.3.8, "Maximum Achievable
    Control Technology
    codes"](ch02s03s08.html "2.3.8. Maximum Achievable Control Technology codes")
    for more about MACT codes, and [Section 2.3.9, "Source types: major
    and section-112 area
    sources"](ch02s03s09.html "2.3.9. Source types: major and section-112 area sources")
    for more about source types. We will refer to the CAA section 112
    area sources as simply "[section-112 area sources]{.quote}".

-   [**Data:**]{.bold} SMOKE can read emissions data for criteria,
    particulate, and toxics pollutants for nonpoint/stationary area and
    nonroad inventories. The SMOKE system is not constrained with regard
    to the pollutants read (although typical examples were given in
    [Section 2.3.1, "Inventory data
    types"](ch02s03.html#sect_concepts_inv_data_types "2.3.1. Inventory data types")).
    SMOKE accepts annual emissions data, average-day emissions data, or
    both (though not all input formats support all types). An emission
    factor value can also be read by SMOKE, but SMOKE does nothing with
    it.

-   [**Data attributes:**]{.bold} Inventories for nonpoint/stationary
    area and nonroad mobile sources can contain control efficiency, rule
    penetration, and rule effectiveness information for each pollutant.
    SMOKE will use these data if provided; otherwise it will set default
    values that indicate that no control-based adjustments have been
    applied to the inventory pollutant data. The defaults are listed in
    the file formats in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files").
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e965}2.3.2.2.2. On-road mobile (SMOKE category: mobile) {#on-road-mobile-smoke-category-mobile .title}

</div>

</div>
:::

::: {.itemizedlist}
-   [**Source characteristics:**]{.bold} For on-road mobile inventories,
    the minimum source characteristics that identify these sources are
    country/state/county code and either SCC [*or*]{.emphasis} road
    class and vehicle type codes. When the SCC is provided, it must
    follow a specific pattern in order to contain the road class and
    vehicle type codes (see [Section 2.8.4.1, "Special approach for
    on-road mobile MOVES
    SCCs"](ch02s08s04.html#sect_concepts_onroad_sccs "2.8.4.1. Special approach for on-road mobile MOVES SCCs")).
    When road class and vehicle type codes are provided to SMOKE
    directly, SMOKE translates these to SCC values.

-   [**Optional source characteristics:**]{.bold} A link code may also
    identify on-road sources. This code must be unique within each
    county and SCC (or road class/vehicle type combination).

-   [**Source attributes:**]{.bold} The inventory year is associated
    with all sources in the inventory input files. In addition, SMOKE
    assigns a time zone (see [Section 2.9.14, "Assign country codes,
    years, and time
    zones"](ch02s09s14.html "2.9.14. Assign country codes, years, and time zones"))
    and an approach for normalization of temporal profiles (see
    [Section 2.9.13, "Set the weekday averaging
    approach"](ch02s09s13.html "2.9.13. Set the weekday averaging approach")).
    For sources with link codes, SMOKE will use the starting and ending
    coordinates of the link, using either latitude-longitude (lat-lon)
    values or coordinates in the Universal Transverse Mercator (UTM)
    coordinate system.

-   [**Data:**]{.bold} Emissions data for criteria, particulate, and
    toxics pollutants can be read for on-road mobile inventories. SMOKE
    is not constrained with regard to the pollutants read (although
    typical examples were given in [Section 2.3.1, "Inventory data
    types"](ch02s03.html#sect_concepts_inv_data_types "2.3.1. Inventory data types")).
    SMOKE accepts annual emissions data, average-day emissions data, or
    both (though not all input formats support all types).

    Additionally, on-road mobile inventories can contain VMT and average
    speed activity data, which are needed when users would like SMOKE to
    run MOVES to compute emissions. A combination of precomputed
    emissions and VMT data is also acceptable for input to SMOKE, but
    you are responsible for preventing duplication of emissions.
    Duplication could occur if you input precomputed emissions for the
    same sources that you use SMOKE to compute the emissions on the fly,
    by multiplying the on-road emissions factors from MOVES by hourly
    VMT, and the off-network emission factors from MOVES by annual
    vehicle populations.

-   [**Data attributes:**]{.bold} No data attributes are associated with
    on-road mobile sources.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e1007}2.3.2.2.3. Point sources (SMOKE category: point) {#point-sources-smoke-category-point .title}

</div>

</div>
:::

::: {.itemizedlist}
-   [**Source characteristics:**]{.bold} The source characteristics for
    point sources depend on the inventory input format. The SMOKE
    one-record-per-line (ORL) and Flat File 10 Format (FF10) formats
    identify sources by country/state/county code, plant code, point
    code, stack code, segment code, and SCC. 95.

-   [**Optional source characteristics:**]{.bold} SMOKE can support up
    to five location identifiers within a plant, although the most used
    in any currently implemented input file format is four.

-   [**Source attributes:**]{.bold} As with other source categories,
    inventory year is associated with all sources in the inventory input
    files. SMOKE also assigns a time zone (see [Section 2.9.14, "Assign
    country codes, years, and time
    zones"](ch02s09s14.html "2.9.14. Assign country codes, years, and time zones"))
    and an approach for normalization of temporal profiles (see
    [Section 2.9.13, "Set the weekday averaging
    approach"](ch02s09s13.html "2.9.13. Set the weekday averaging approach")).
    In addition, point sources have the following required source
    attributes not associated with other source categories: latitude,
    longitude, stack height, stack diameter (at the exit location), flue
    gas exit velocity, and flue gas exit temperature. Finally, the
    following optional source attributes are also used by SMOKE: SIC
    codes, MACT codes, plant descriptions, emissions release type point
    (e.g., horizontal stack, fugitive), source type (major or
    section-112 area), Office of Regulatory Information Systems (ORIS)
    identification codes, and boiler identification codes. Also, the
    MACT code and source types are supported only by the ORL format. See
    [Section 2.3.6, "Standard Industrial Classification
    codes"](ch02s03s06.html "2.3.6. Standard Industrial Classification codes"),
    [Section 2.3.8, "Maximum Achievable Control Technology
    codes"](ch02s03s08.html "2.3.8. Maximum Achievable Control Technology codes"),
    and [Section 2.3.9, "Source types: major and section-112 area
    sources"](ch02s03s09.html "2.3.9. Source types: major and section-112 area sources")
    for more information.

-   [**Data:**]{.bold} Emissions data for criteria, particulate, and
    toxics pollutants can be read for point inventories. SMOKE is not
    constrained with regard to the pollutants read (although typical
    examples were given in [Section 2.3.1, "Inventory data
    types"](ch02s03.html#sect_concepts_inv_data_types "2.3.1. Inventory data types")).
    SMOKE accepts annual emissions data, average-day emissions data, or
    both.

    Optionally, point-source emissions data can be provided using
    day-specific or hour-specific records. The formats for these data
    are described in [Section 8.2.6, "`PTDAY`{.envar}: Point source
    day-specific
    emissions"](ch08s02s06.html "8.2.6. PTDAY: Point source day-specific emissions")
    and [Section 8.2.7, "`PTHOUR`{.envar}: Point source hour-specific
    emissions"](ch08s02s07.html "8.2.7. PTHOUR: Point source hour-specific emissions").

-   [**Data attributes:**]{.bold} EGU and non-EGU point sources can
    contain control efficiency and rule effectiveness information for
    each pollutant. SMOKE will use these data if provided; otherwise it
    will set default values that indicate that no control-based
    adjustments have been applied to the inventory pollutant data. The
    defaults are listed in the file formats in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files").
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e1056}2.3.2.2.4. Wildfire with precomputed plume rise (SMOKE category: point) {#wildfire-with-precomputed-plume-rise-smoke-category-point .title}

</div>

</div>
:::

::: {.itemizedlist}
-   [**Source characteristics:**]{.bold} Wildfires with precomputed
    plumes are identified by the country/state/county code and the fire
    name.

-   [**Optional source characteristics:**]{.bold} There are no optional
    source characteristics for wildfire sources.

-   [**Source attributes:**]{.bold} Like other source categories,
    inventory year is associated with all sources in the inventory input
    files. SMOKE also assigns a time zone (see [Section 2.9.14, "Assign
    country codes, years, and time
    zones"](ch02s09s14.html "2.9.14. Assign country codes, years, and time zones"))
    and an approach for normalization of temporal profiles (see
    [Section 2.9.13, "Set the weekday averaging
    approach"](ch02s09s13.html "2.9.13. Set the weekday averaging approach")).
    In addition, wildfire sources require the latitude and longitude
    source attributes. Finally, additional hour-specific source
    attributes for wildfire sources [*must*]{.emphasis} be provided for
    the fraction of emissions in the surface layer, the height of the
    bottom of the plume, and the height of the top of the plume. These
    hour-specific attributes are provided to SMOKE using the point
    source hour-specific formats described in [Section 8.2.7,
    "`PTHOUR`{.envar}: Point source hour-specific
    emissions"](ch08s02s07.html "8.2.7. PTHOUR: Point source hour-specific emissions").

-   [**Data:**]{.bold} Wildfire source inventories can contain criteria
    and particulate pollutants. SMOKE is not constrained with regard to
    the pollutants read (although typical examples were given in
    [Section 2.3.1, "Inventory data
    types"](ch02s03.html#sect_concepts_inv_data_types "2.3.1. Inventory data types")).
    These data must be provided as day-specific or hour-specific
    emissions values using point source formats specified in
    [Section 8.2.6, "`PTDAY`{.envar}: Point source day-specific
    emissions"](ch08s02s06.html "8.2.6. PTDAY: Point source day-specific emissions")
    and [Section 8.2.7, "`PTHOUR`{.envar}: Point source hour-specific
    emissions"](ch08s02s07.html "8.2.7. PTHOUR: Point source hour-specific emissions").

-   [**Data attributes:**]{.bold} No data attributes are associated with
    wildfire sources.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e1100}2.3.2.2.5. Wildfires with internal plume rise calculation (SMOKE category: point) {#wildfires-with-internal-plume-rise-calculation-smoke-category-point .title}

</div>

</div>
:::

::: {.itemizedlist}
-   [**Source characteristics:**]{.bold} Wildfires with internal plume
    rise calculation are identified by the country/state/county code,
    fire identification, fire name, location identification, and SCC.

-   [**Optional source characteristics:**]{.bold} There are optional
    source characteristics for fire sources, such as material burned,
    vegetation types, size of area burned, fuel loading, and fire
    start/end hour. The size of area burned and fuel loading are used
    for computing the fire-specific plume rise. Fire starting and ending
    hours are needed to adjust the hourly temporal profiles for the
    emissions.

-   [**Source attributes:**]{.bold} Like other source categories,
    inventory year is associated with all sources in the inventory input
    files. SMOKE also assigns a time zone (see [Section 2.9.14, "Assign
    country codes, years, and time
    zones"](ch02s09s14.html "2.9.14. Assign country codes, years, and time zones"))
    and will re-normalize temporal profiles based on the starting and
    ending hours of the fire. In addition, wildfire sources require the
    latitude and longitude source attributes to locate the fire. Note
    that all emissions for a fire will be assumed to come from the
    single grid cell that contains the latititude and longitude of the
    fire. Finally, additional day-specific source attributes listed
    above for fire sources [*must*]{.emphasis} be provided for
    calculating the heat flux of each fire, which is used to estimate
    the fraction of emissions in the surface layer, the height of the
    bottom of the plume, and the height of the top of the plume. See
    more information about how to process at [Section 4.4.17, "Plume
    Rise Calculation for
    Fires"](ch04s04s17.html "4.4.17. Plume Rise Calculation for Fires")

-   [**Data:**]{.bold} Fire source inventories can contain criteria and
    particulate pollutants. SMOKE is not constrained with regard to the
    pollutants read (although typical examples were given in
    [Section 8.2.8.3, "ORL FIRE
    Format"](ch08s02s08.html#sect_input_ptinv_fire "8.2.8.3. ORL FIRE Format")).
    These data must be provided as day-specific emissions values using
    point source formats specified in [Section 8.2.6.2, "ORL FIREEMIS
    Emission
    Format"](ch08s02s06.html#sect_input_ptday_fireemis "8.2.6.2. ORL FIREEMIS Emission Format").

-   [**Data attributes:**]{.bold} No data attributes are associated with
    wildfire sources.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e1139}2.3.2.2.6. Biogenic land use (SMOKE category: biogenic) {#biogenic-land-use-smoke-category-biogenic .title}

</div>

</div>
:::

::: {.itemizedlist}
-   [**Source characteristics:**]{.bold} Biogenic emission data does not
    fit as neatly into the source-characteristic paradigm as the
    previously described source types. Emissions for biogenic sources
    are estimated starting with land use data, which are available for
    both BELD2 and BELD3 processing. The BELD2 data are available either
    by U.S. state/county and BELD2 land use category or by grid cell and
    BELD2 land use category. BELD3 land use data are available by 1-km
    grid cell over North and Central America and by BELD3 land use
    category.

-   [**Optional source characteristics:**]{.bold} Biogenic land use data
    do not include optional source characteristics. The data are either
    by state/county or by grid cell.

-   [**Source attributes:**]{.bold} There are no source attributes for
    biogenic land use data.

-   [**Data:**]{.bold} The biogenic land use data consist of fractions
    associated with each land use type within a county or grid cell.

-   [**Data attributes:**]{.bold} There are no data attributes for
    biogenic land use data.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------- -------------------- --------------------------------
  [Prev](ch02s03.html)          [Up](ch02s03.html)           [Next](ch02s03s03.html)
  2.3. Emission inventories     [Home](index.html)     2.3.3. Inventory file formats
  ---------------------------- -------------------- --------------------------------
:::
::: {.navheader}
2.3.3. Inventory file formats
:::

[Prev](ch02s03s02.html) 

2.3. Emission inventories

 [Next](ch02s03s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_inv_file_formats}2.3.3. Inventory file formats {#inventory-file-formats .title}

</div>

</div>
:::

SMOKE supports a variety of inventory formats for criteria, particulate,
toxics, and activity data inventories, which are described in detail in
[Section 8.2, "Inventory Files"](ch08s02.html "8.2. Inventory Files").
Here, we provide a brief introduction to these formats, which will be
helpful as you read more about SMOKE in the remainder of this chapter
and the chapters before [Chapter 8, *SMOKE Input
Files*](ch08.html "Chapter 8. SMOKE Input Files"). All formats described
here are text files. To convert your data to these formats, the best
approach is to use a database or spreadsheet program to reformat and
output the data in the requested format. There is not a standard
format-conversion method that comes with SMOKE.

In the following paragraphs, we describe the formats available for
nonpoint/stationary area, nonroad mobile, on-road mobile, point, and
point-wildfire sources.

::: {.itemizedlist}
-   [**Nonpoint/stationary area sources:**]{.bold} SMOKE supports two
    formats for nonpoint/stationary area sources. The ORL and FF10 (Flat
    File 10) format are list directed (comma or semicolon delimited) and
    these file formats may be used to represent many different sources.
    The header of the file indicates what source data are in the file.

-   [**Nonroad mobile sources:**]{.bold} There are three available
    inventory formats for nonroad mobile sources. The FF10 (Flat
    File 10) format is list directed (comma or semicolon delimeted) and
    the header of the file is used to indicate the nonroad mobile source
    data is within the file.

-   [**On-road mobile sources:**]{.bold} The Flat File 10 (FF10) format
    is list directed (comma or semicolon delimited) and contains
    activity inventory such as VMT, speed, and vehicle population data.
    This format requires VMT, SPEED, and VPOP inventory data.

-   [**Point sources:**]{.bold} SMOKE has formats for annual or
    average-day inventories, for day-specific inventories, and for
    hour-specific inventories. For annual or average-day inventories,
    the ORL and FF10 formats can be used for criteria, particulate, and
    toxics inventories. Finally, the CEM data format can be used for
    day-specific or hour-specific data : SMOKE uses the ORIS codes and
    boiler codes in the annual inventory files to match sources from the
    CEM data files.

-   [**Wildfire sources:**]{.bold} There are two approches available
    that you can provide wildfire data that are being treated as point
    sources to SMOKE using the ORL and FF10 point-source formats.

    ::: {.itemizedlist}
    -   [**Precomputed plume rise approach:**]{.bold} Certain fields
        must be left blank (such as stack parameters) because they do
        not apply to wildfire sources. When using wildfire data provided
        as point sources, you must also provide day-specific or
        hour-specific wildfire emissions and hour-specific precomputed
        plume rise using the FF10 day-specific and hour-specific
        formats.
    -   [**Internal plume rise calculation approach:**]{.bold} Requires
        two separate inventory files that are provided in a modified ORL
        format: (1) a list of fires with fire-specific characteristics
        including county/state/county, fire identification, location
        coordinate, fire name, SCC and others, as described in
        [Section 8.2.8.3, "ORL FIRE
        Format"](ch08s02s08.html#sect_input_ptinv_fire "8.2.8.3. ORL FIRE Format"),
        and (2) a day-specific fire data including size of area burned,
        fuel loading, and star/end hour of fire ([Section 8.2.6.2, "ORL
        FIREEMIS Emission
        Format"](ch08s02s06.html#sect_input_ptday_fireemis "8.2.6.2. ORL FIREEMIS Emission Format")).
        Unlike the approach listed above, this approach internally
        estimates the plume rise using the size of the area burned and
        fuel loading, and it adjusts temporal profiles using the start
        and end hours of the fire. See detail at [Section 4.4.17, "Plume
        Rise Calculation for
        Fires"](ch04s04s17.html "4.4.17. Plume Rise Calculation for Fires")
    :::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------- -------------------- ------------------------------------------
  [Prev](ch02s03s02.html)                [Up](ch02s03.html)                     [Next](ch02s03s04.html)
  2.3.2. Inventory source categories     [Home](index.html)     2.3.4. Country, state, and county codes
  ------------------------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
2.3.4. Country, state, and county codes
:::

[Prev](ch02s03s03.html) 

2.3. Emission inventories

 [Next](ch02s03s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_costcy_codes}2.3.4. Country, state, and county codes {#country-state-and-county-codes .title}

</div>

</div>
:::

SMOKE uses a 6-digit integer code to identify a country, state (or
province), and county (or other region) for a particular source. Most
U.S. inventories input to SMOKE have the 5-digit U.S. Federal
Implementation Planning Standards (FIPS) state and county codes. All
inventory input formats have been adapted to include a special header
record with which you can specify the country, effectively allowing the
inventories to be provided with the 6-digit code that SMOKE uses. The
6-digit system was designed for use in the United States with states and
counties, as well as Canada and Mexico, but it can be adapted for other
uses. The format used by SMOKE for the codes is:

::: {.informalfigure}
::: {.mediaobject}
![](images\concepts\costcy_html.jpg)
:::
:::

The SMOKE installation is set up to use U.S.-centered codes as defined
in the `COSTCY`{.envar} or the `GEOCODE_LEVEL4`{.envar} (if
USE\_EXP\_GEOCODES Y) file, which contains the codes and their
associated names and time zone settings. In this file, the U.S. country
code is zero, which allows the U.S. country/state/county codes to be the
same as the FIPS state/county codes that appear in U.S. inventories. See
[Section 8.10.2, "`COSTCY`{.envar}: Country, state, and county names and
data"](ch08s10s02.html "8.10.2. COSTCY: Country, state, and county names and data")
for more information on the `COSTCY`{.envar} file format.

To change the meaning of the country, state, or county codes in SMOKE,
the `COSTCY`{.envar} or the `GEOCODE_LEVEL4`{.envar} (if
USE\_EXP\_GEOCODES Y) file must be modified to use different names
associated with each country, state, county or tribal number. All SMOKE
input files must also use this new numbering scheme, including inventory
files and cross-reference files.

Acceptable values in SMOKE for the country code are 0 through 9.
Acceptable values of the state code are 1 through 99. Acceptable values
of the county code are 1 through 999. No alphabetic codes are accepted,
since SMOKE stores these values as integers.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------- -------------------- -------------------------------------
  [Prev](ch02s03s03.html)           [Up](ch02s03.html)                [Next](ch02s03s05.html)
  2.3.3. Inventory file formats     [Home](index.html)     2.3.5. Source Classification Codes
  -------------------------------- -------------------- -------------------------------------
:::
::: {.navheader}
2.3.5. Source Classification Codes
:::

[Prev](ch02s03s04.html) 

2.3. Emission inventories

 [Next](ch02s03s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_scc_codes}2.3.5. Source Classification Codes {#source-classification-codes .title}

</div>

</div>
:::

EPA uses Source Classification Codes (SCCs) and area and mobile source
(AMS) codes to classify different types of anthropogenic emission
activities. SCCs have 8 digits for point sources, while AMS codes have
10 digits, and sometimes include a leading "[A]{.quote}" as an eleventh
character. In SMOKE, we refer to both kinds of codes as
"[SCCs]{.quote}", and we ignore the leading "[A]{.quote}" in the area
and mobile codes. Additionally, SMOKE permits the nonpoint and point
toxics inventories to use both 8-digit and 10-digit SCCs in the same
inventory input file, because both 8- and 10-digit codes are contained
in the nonpoint and point inventories in the 1999 NEI for HAPs. The
maximum field width in SMOKE and its input files for SCCs is 20
characters as of SMOKE v4.0. The 8 or 10 digit SCC are still supported,
but if the SCC is greater than 10 digits the SCC hierarchial approach
will not be supported.

For SCC\'s of size 10 characters or less, the codes use a hierarchical
system in which the definition of the code gets increasingly more
specific as you move from left to right. (NOTE: if the SCC is greater
than 10 characters in length the hierarchial system is not used). For
SCC\'s of 10 characters or less, it is important to understand the
hierarchy of the codes, because you can take advantage of the hierarchy
in building cross-reference files for assigning emissions processing
factors to inventory emission sources. In the diagrams below, level 1 is
the least specific and level 4 is the most specific.

The code structure for the 8-digit point-source codes is:

::: {.informalfigure}
::: {.mediaobject}
![](images\concepts\scc_point_html.jpg)
:::
:::

An example point-source activity and corresponding SCC can be taken
directly from SMOKE's SCC description file (`SCCDESC`{.envar}):
"[External Combustion Boilers; Electric Generation; Lignite; Spreader
Stoker]{.quote}" is represented by 10100306. Below we have mapped the
levels of this description with the levels of the SCC:

::: {.informalfigure}
::: {.mediaobject}
![](images\concepts\scc_example_html.jpg)
:::
:::

Similarly, the code structure for the 10-digit area- and mobile-source
codes is:

::: {.informalfigure}
::: {.mediaobject}
![](images\concepts\scc_nonpoint_html.jpg)
:::
:::

SMOKE treats SCCs as character strings, though in practice the values in
the inventories and cross-reference files are usually numeric. In
[Section 2.4, "Cross-referencing and
profiles"](ch02s04.html "2.4. Cross-referencing and profiles") on
cross-references and profiles, we explain how these hierarchies are used
by SMOKE and how you should use them in preparing SMOKE input files.

For on-road mobile sources, SCCs are treated somewhat differently than
for other source categories. We explain more about this in
[Section 2.8.4.1, "Special approach for on-road mobile MOVES
SCCs"](ch02s08s04.html#sect_concepts_onroad_sccs "2.8.4.1. Special approach for on-road mobile MOVES SCCs").
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- --------------------------------------------------
  [Prev](ch02s03s04.html)                     [Up](ch02s03.html)                             [Next](ch02s03s06.html)
  2.3.4. Country, state, and county codes     [Home](index.html)     2.3.6. Standard Industrial Classification codes
  ------------------------------------------ -------------------- --------------------------------------------------
:::
::: {.navheader}
2.3.6. Standard Industrial Classification codes
:::

[Prev](ch02s03s05.html) 

2.3. Emission inventories

 [Next](ch02s03s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_sic_codes}2.3.6. Standard Industrial Classification codes {#standard-industrial-classification-codes .title}

</div>

</div>
:::

Although SIC codes are being replaced by NAICS codes in building
emission inventories at EPA, SIC codes are still used in emissions
processing. As of SMOKE v4.0, the SIC codes may be up to 20 characters
in length, but for SIC codes greater than 4-digits, the hierarchial
system is not used. For SICs of size 4-digits, a 2-level hierarchial
system is recognized by SMOKE for application of growth, control, and
chemical speciation factors. The two code levels are illustrated below.

::: {.informalfigure}
::: {.mediaobject}
![](images\concepts\sic_html.jpg)
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------- -------------------- --------------------------------------------------
  [Prev](ch02s03s05.html)                [Up](ch02s03.html)                             [Next](ch02s03s07.html)
  2.3.5. Source Classification Codes     [Home](index.html)     2.3.7. Geographical Code (GEOCODE\_LEVEL\[1-4\]
  ------------------------------------- -------------------- --------------------------------------------------
:::
::: {.navheader}
2.3.7. Geographical Code (GEOCODE\_LEVEL\[1-4\]
:::

[Prev](ch02s03s06.html) 

2.3. Emission inventories

 [Next](ch02s03s08.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_geocodes}2.3.7. Geographical Code (GEOCODE\_LEVEL\[1-4\] {#geographical-code-geocode_level1-4 .title}

</div>

</div>
:::

Geographical codes may be specified to the user\'s desired level of
detail using the GEOCODE\_LEVEL\[1-4\] files. GEOCODE\_LEVEL1 contains
three character codes for each country in the inventory (CCC).
GEOCODE\_LEVEL2 contains six character codes for each state that the
user would like to track in the inventory (CCCSSS). GEOCODE\_LEVEL3
contains nine character codes for each county that the user would like
to track in the inventory (CCCSSSYYY). GEOCODE\_LEVEL4 contains twelve
character codes for each tribal region that the user would like to track
in the inventory (CCCSSSYYYTTT).

::: {.informalfigure}
::: {.mediaobject}
![](images\concepts\geocode_html.jpg)
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------- -------------------- -----------------------------------------------------
  [Prev](ch02s03s06.html)                             [Up](ch02s03.html)                                [Next](ch02s03s08.html)
  2.3.6. Standard Industrial Classification codes     [Home](index.html)     2.3.8. Maximum Achievable Control Technology codes
  -------------------------------------------------- -------------------- -----------------------------------------------------
:::
::: {.navheader}
2.3.8. Maximum Achievable Control Technology codes
:::

[Prev](ch02s03s07.html) 

2.3. Emission inventories

 [Next](ch02s03s09.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_mact_codes}2.3.8. Maximum Achievable Control Technology codes {#maximum-achievable-control-technology-codes .title}

</div>

</div>
:::

The following quote explaining MACT codes was taken from EPA to explain
what MACT codes are and why they are used in some inventories and not
others:

::: {.blockquote}
> To evaluate EPA's progress in reducing air toxic emissions through the
> Maximum Achievable Control Technology (MACT) standards and to identify
> sources that may be modeled as part of residual risk assessments,
> operations within facilities that are subject to MACT standards are
> identified in the NTI by 4-digit MACT codes. [*\[note that the term
> NTI (National Toxics Inventory) has since been replaced with NEI and
> that the codes are now 6 digits\]*]{.emphasis}
>
> A MACT category is one for which emissions limitations have been or
> are being developed under section 112(d) of the Clean Air Act
> (National Emissions Standards for Hazardous Air Pollutants). EPA sets
> source category, technology based standards through its MACT program
> that sharply reduce emissions of HAPs. EPA's ATW web site includes
> information on the MACT source categories and the MACT program
> (www.epa.gov/ttn/atw/eparules.html). The tagging of data with MACT
> codes allows EPA to determine reductions attributable to the MACT
> program. The NTI associates MACT codes corresponding to MACT source
> categories with stationary major and \[section-112\] area source data.
> MACT codes are assigned at the process level or at the site level in
> the point source data, e.g., the MACT code for municipal waste
> combustors (MWCs) is assigned at the site level whereas the MACT code
> for petroleum refinery catalytic cracking is assigned at the process
> level. MACT codes are also assigned to source categories in the
> nonpoint source file.
:::

In SMOKE, MACT codes are treated as 6-character strings, with no
internal hierarchy associated with the number.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------- -------------------- ----------------------------------------------------------
  [Prev](ch02s03s07.html)                             [Up](ch02s03.html)                                     [Next](ch02s03s09.html)
  2.3.7. Geographical Code (GEOCODE\_LEVEL\[1-4\]     [Home](index.html)     2.3.9. Source types: major and section-112 area sources
  -------------------------------------------------- -------------------- ----------------------------------------------------------
:::
::: {.navheader}
2.3.9. Source types: major and section-112 area sources
:::

[Prev](ch02s03s08.html) 

2.3. Emission inventories

 [Next](ch02s03s10.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_section_112}2.3.9. Source types: major and section-112 area sources {#source-types-major-and-section-112-area-sources .title}

</div>

</div>
:::

For point and nonpoint toxics inventories, each source can be labeled as
"[major]{.quote}" or "[section-112 area]{.quote}" for input to SMOKE
(the following paragraph explains how the term "[area]{.quote}" can be
applied to a point-source inventory). The Clean Air Act defines major
sources as those stationary facilities that emit or have the potential
to emit 10 tons per year or more of any one toxic air pollutant or 25
tons per year or more of any combination of toxic air pollutants.
section-112 area sources include facilities that have air toxics
emissions below the major source threshold as defined in section 112 of
the Clean Air Act and thus emit less than 10 tons per year of a single
toxics air pollutant or less than 25 tons per year combined of multiple
toxics air pollutants. Another source type exists in principle for
nonpoint sources: the "[other]{.quote}" source type; an example of this
source type is wildfires. However, these source types are not labeled
differently from the section-112 area sources in the nonpoint toxics
inventories, so the "[other]{.quote}" source type has not been included
in SMOKE to date.

A note about the confusing use of "[area]{.quote}" terminology to
describe point sources: The designation of sources in the point
inventories as section-112 area sources has no relationship whatsoever
to SMOKE's area processing category. The point sources that are
section-112 area sources are still processed by SMOKE as point sources
using a lat-lon location and stack parameters.

In practice, all "[major]{.quote}" sources should appear only in the
point toxics inventory, but in some cases, "[major]{.quote}" sources
have shown up in the nonpoint inventory (specifically in inventory year
1996, in the July 2001 version of that inventory). Thus, the source type
designation is provided in both the point and nonpoint toxics input
formats.

The major and section-112 area designations are used when applying
MACT-based control factors. These control factors are assigned based on
a source's MACT code and may be applied to major sources only, to
section-112 area sources only, or to both types of sources regardless of
designation.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------- -------------------- ----------------------------------------------------------
  [Prev](ch02s03s08.html)                                [Up](ch02s03.html)                                     [Next](ch02s03s10.html)
  2.3.8. Maximum Achievable Control Technology codes     [Home](index.html)     2.3.10. Source types: nonroad and onroad mobile sources
  ----------------------------------------------------- -------------------- ----------------------------------------------------------
:::
::: {.navheader}
2.3.10. Source types: nonroad and onroad mobile sources
:::

[Prev](ch02s03s09.html) 

2.3. Emission inventories

 [Next](ch02s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_source_type_codes}2.3.10. Source types: nonroad and onroad mobile sources {#source-types-nonroad-and-onroad-mobile-sources .title}

</div>

</div>
:::

The nonroad and onroad mobile source type designations are used when
applying MACT-based control factors. These control factors are assigned
based on a source's MACT code.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------------- -------------------- --------------------------------------
  [Prev](ch02s03s09.html)                                     [Up](ch02s03.html)                    [Next](ch02s04.html)
  2.3.9. Source types: major and section-112 area sources     [Home](index.html)     2.4. Cross-referencing and profiles
  ---------------------------------------------------------- -------------------- --------------------------------------
:::
::: {.navheader}
2.4. Cross-referencing and profiles
:::

[Prev](ch02s03s10.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_cross_referencing}2.4. Cross-referencing and profiles {#cross-referencing-and-profiles .title style="clear: both"}
-----------------------------------------------------------------------

</div>

</div>
:::

The emission inventories described in [Section 2.3, "Emission
inventories"](ch02s03.html "2.3. Emission inventories") can contain
hundreds of thousands or even millions of sources. Collecting specific
information for each source about its temporal allocation, chemical
speciation, and spatial allocation is not practical. Therefore, a part
of emissions processing involves assuming that many sources share the
same factors for these major processing steps. For example, we apply
monthly, day-of-week, and hourly temporal factors (called profiles) to
convert from an annual emissions value to an hour-specific emissions
value. A limited set of monthly, day-of-week, and hourly diurnal
profiles are available from various studies, and these profiles each
have their own unique profile number (also called profile code or
profile ID). This limited set of profiles is assigned to the much more
numerous inventory sources using an approach called cross-referencing,
which is implemented using cross-reference files.

The cross-reference files assign the profiles based on source
characteristics such as country, state, and county codes and/or SCCs,
using the profile numbers to associate source characteristics with the
profiles. While the profile numbers are unique in the profile files,
they will appear many times in the cross-reference; this is how SMOKE is
able to group the sources to treat them in the same manner. This
approach is used for temporal allocation profiles, chemical speciation
profiles and the spatial "[profiles]{.quote}", which are called spatial
(or gridding) surrogates.

The cross-reference tables are applied to the sources in a stepwise
manner, such that the most specific entry available is always applied.
For example, if a cross-reference entry were available that matched a
source by state, county, and SCC, SMOKE would apply that entry instead
of a different cross-reference entry that matched that source only by
SCC. The hierarchy that describes how each cross-reference file is
applied to the inventory is described for each program in [Chapter 6,
*SMOKE Core Programs*](ch06.html "Chapter 6. SMOKE Core Programs").

[Figure 2.1, "Generic example of how cross-reference files and profiles
work
together"](ch02s04.html#fig_concepts_xref "Figure 2.1. Generic example of how cross-reference files and profiles work together")
provides a generic example of how cross-reference files and profile
files work together. In the example, the profile to be used for most of
North Carolina is profile ID 16. Durham and Orange counties, however,
are assigned profile 15, which would be preferentially applied to all
sources in Durham and Orange counties, instead of using the general
North Carolina profile. South Carolina sources would be assigned profile
17.

::: {.figure}
[]{#fig_concepts_xref}

**Figure 2.1. Generic example of how cross-reference files and profiles
work together**

::: {.mediaobject}
![Generic example of how cross-reference files and profiles work
together](images\concepts\xref_html.jpg)
:::
:::

This example does not correspond to a particular processing step (i.e.,
temporal allocation, chemical speciation, or spatial allocation), but
rather assigns generic "[factors]{.quote}" from profiles 15, 16, and 17
based on the state and county information in the cross-reference file.
(Note that we have used the state and county names in this example,
whereas real cross-reference files would use the country, state, and
county codes according to the file format of the actual cross-reference
files.)

SMOKE handles cross-references and profile application in a very
efficient manner. In reading a cross-reference file, SMOKE first sorts
the cross-reference entries using the same sort criteria as are used for
the inventory sources (e.g. by country/state/county code, then by SCC,
then by remaining source characteristics if any). Next, the
cross-reference entries are grouped according to the "[level]{.quote}"
of matching of each of the entries. For example, all entries that could
match to the inventory using only state and county codes would be in one
group, while entries that could match to the inventory using only SCCs
would be in another group. Once the cross-reference entries are grouped,
SMOKE processes each sources in the inventory, and attempts to find a
matching entry in one of the cross-reference groups. The most specific
groups are searched first, and when a match is found for a particular
source, the other groups are not searched. This helps increase
efficiency. In addition, because the cross-reference entries are sorted
within each group, an efficient searching algorithm can be used for each
individual search. When a match to one of the cross-reference groups has
been found, SMOKE continues to the next source in the inventory until
all sources have been processed.

Cross-references and profiles are used in the following SMOKE processing
steps. These steps and their associated programs (listed in parentheses)
will be described in the sections to come.

::: {.itemizedlist}
-   Inventory import (**Smkinven**)
    ::: {.itemizedlist}
    -   cross-references: `NHAPEXCLUDE`{.envar}, `VMTMIX`{.envar},
        `PSTK`{.envar}, `ARTOPNT`{.envar}
    -   profiles: none (factors are included in the cross-reference
        files when needed)
    :::
-   Temporal allocation (**Temporal**)
    ::: {.itemizedlist}
    -   cross-references: `ATREF`{.envar}, `MTREF`{.envar},
        `PTREF`{.envar}
    -   profiles: `ATPRO`{.envar}, `MTPRO`{.envar}, `PTPRO`{.envar}
    :::
-   Chemical speciation (**Spcmat**)
    ::: {.itemizedlist}
    -   cross-references: `GSREF`{.envar}, `GSCNV`{.envar}
    -   profiles: `GSPRO`{.envar}
    :::
-   Spatial allocation (**Grdmat**)
    ::: {.itemizedlist}
    -   cross-references: `AGREF`{.envar}, `MGREF`{.envar}
    -   profiles: `AGPRO`{.envar}, `MGPRO`{.envar} (**\* Note**)
    :::
-   Growth and controls (**Cntlmat**)
    ::: {.itemizedlist}
    -   cross-references: `GCNTL`{.envar}
    -   profiles: none (factors are included in the cross-reference
        files)
    :::
-   Mobile-source speed assignment (**Movesmrg**)
    ::: {.itemizedlist}
    -   cross-references: `MCXREF`{.envar}, `MFMREF`{.envar}
    -   profiles: `SPDPRO`{.envar}
    :::
:::

The hierarchies that each SMOKE program uses to assign cross-reference
entries to sources are provided in [Chapter 6, *SMOKE Core
Programs*](ch06.html "Chapter 6. SMOKE Core Programs"), where the
programs are described at length. The file contents and formats are
described in more detail in [Chapter 8, *SMOKE Input
Files*](ch08.html "Chapter 8. SMOKE Input Files").

**Note**: The use of the Environment variable `AGPRO`{.envar} (Area
spatial surrogate file)and `MGPRO`{.envar} (Mobile spatial surrogate
file) have been discontinued. Two new Environment variables have been
introduced to SMOKE; `SRGPRO_PATH`{.envar} (spatial surrogate profile
file location) and `SRGDESC`{.envar} (description file with the specific
list of available surrogates located in `SRGPRO_PATH`{.envar}) See
[Figure 6.4, "Grdmat input and output
files"](ch06s04s03.html#fig_programs_grdmat "Figure 6.4. Grdmat input and output files").
The surrogate files located in `SRGPRO_PATH`{.envar} are refinements of
the old \[A\|M\]GPRO files. They are of the same format as the old
files, however, there now may be one or more surrogate files. **Grdmat**
now process each surrogate separately. On domains with large cell
counts, this approach limits the memory usage at the expense of slightly
longer run times.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------------- -------------------- -----------------------------------
  [Prev](ch02s03s10.html)                                      [Up](ch02.html)                   [Next](ch02s05.html)
  2.3.10. Source types: nonroad and onroad mobile sources     [Home](index.html)     2.5. Input and output file types
  ---------------------------------------------------------- -------------------- -----------------------------------
:::
::: {.navheader}
2.5. Input and output file types
:::

[Prev](ch02s04.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s05s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_basic_formats}2.5. Input and output file types {#input-and-output-file-types .title style="clear: both"}
----------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.5.1. ASCII files](ch02s05.html#d0e1593)]{.section}

[[2.5.2. I/O API files](ch02s05s02.html)]{.section}

[[2.5.3. Model-ready files](ch02s05s03.html)]{.section}
:::

Before we describe more about the SMOKE processing, we first need to
explain the types of files you will encounter in this documentation.
SMOKE primarily uses two types of file formats: ASCII files and I/O API
files. In addition, the output file format for the UAM-based air quality
model is a Fortran binary file format. [Chapter 8, *SMOKE Input
Files*](ch08.html "Chapter 8. SMOKE Input Files"), [Chapter 9, *SMOKE
Intermediate Files*](ch09.html "Chapter 9. SMOKE Intermediate Files"),
and [Chapter 10, *SMOKE Output
Files*](ch10.html "Chapter 10. SMOKE Output Files") describe all input,
intermediate, and output files, including the file format for each one.
Input files are files that are read by at least one core SMOKE program
(listed in [Chapter 6, *SMOKE Core
Programs*](ch06.html "Chapter 6. SMOKE Core Programs")), but are not
written by a core program. Intermediate files are files that are written
by a core program and read by at least one other core program. Output
files are files output by a SMOKE core program but not read by any of
them; these files include reports, log files, and the model-ready files
to be input to an air quality model. (Exception: one intermediate file
\[used by a core program\] is also an output file \[used by an AQM\]:
the `STACK_GROUPS`{.envar} file, described in [Section 9.3.2,
"`STACK_GROUPS`{.envar}"](ch09s03s02.html "9.3.2. STACK_GROUPS").) In
this section, we further describe the ASCII and I/O API files, and then
provide information about the two approaches for formatting the
model-ready output files produced by SMOKE (the CMAQ/Models-3 approach
and the UAM-based approach).

SMOKE's input files are primarily ASCII files, although a few I/O API
files are used. The intermediate files in SMOKE are primarily I/O API
files, although there are several important ACSII files as well. The
output files from SMOKE are primarily I/O API files and Fortran binary
files for model-ready emissions files, and ASCII files for reports and
logs.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e1593}2.5.1. ASCII files {#ascii-files .title}

</div>

</div>
:::

::: {.toc}
[[2.5.1.1. Column-specific ASCII
files](ch02s05.html#sect_concepts_column_specific)]{.section}

[[2.5.1.2. List-directed ASCII
files](ch02s05.html#sect_concepts_list_directed)]{.section}
:::

ASCII files are simply the text files with which most computer users are
familiar. The ASCII files input by SMOKE come in two structures:
[*column-specific*]{.emphasis} and [*list-directed*]{.emphasis}.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_column_specific}2.5.1.1. Column-specific ASCII files {#column-specific-ascii-files .title}

</div>

</div>
:::

In column-specific files, the fields in the files must appear in certain
columns in the file. Each character on a line represents a single
column. The lines below represent a column-specific ASCII data file:

``` {.programlisting}
TEST 1 2 3

Additional data
```

The letters `TEST`{.literal} are in columns 1 through 4 of the file and
the numbers 1, 2, and 3 are in columns 6, 8, and 10 respectively:

``` {.programlisting}
123456789012345
TEST 1 2 3

Additional data
```
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_list_directed}2.5.1.2. List-directed ASCII files {#list-directed-ascii-files .title}

</div>

</div>
:::

In list-directed files, the exact positioning of the fields on a line is
not important, but the order of the fields on that line is crucial. The
fields must be delimited (separated) by special characters called
delimiters; in SMOKE, valid delimiters are [**spaces**]{.bold},
[**commas**]{.bold}, or [**semicolons**]{.bold}. If a particular field
happens to contain any of these delimiters within it, then that field
must be surrounded by single or double quotes in the input file.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------- -------------------- --------------------------
  [Prev](ch02s04.html)                     [Up](ch02.html)       [Next](ch02s05s02.html)
  2.4. Cross-referencing and profiles     [Home](index.html)        2.5.2. I/O API files
  -------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
2.5.2. I/O API files
:::

[Prev](ch02s05.html) 

2.5. Input and output file types

 [Next](ch02s05s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e1632}2.5.2. I/O API files {#io-api-files .title}

</div>

</div>
:::

I/O API files are read and written by the I/O API library used by SMOKE
and other Models-3 programs. A library is a set of routines that have
been created and compiled for use by multiple programs. The I/O API
library, in turn, is built upon yet another library called the NetCDF
library. For this reason, I/O API files are also referred to as I/O API
NetCDF files. More information on both of these libraries is available
at the [I/O API web site](http://www.baronams.com/products/ioapi/).
[Section 12.4, "Compiling SMOKE for
UNIX"](ch12s04.html "12.4. Compiling SMOKE for UNIX") contains
instructions for obtaining the I/O API and NetCDF libraries.

The I/O API files cannot be viewed with a text editor because they are
binary files. These binary files use less disk space than ASCII files
containing the same data. They also allow much more efficient input and
output of the data, and the I/O API library provides many quality
assurance (QA) features useful for all input and output (I/O), including
I/O for emissions processing.

The basic I/O API file has a limitation of 120 variables per file. To
overcome this, SMOKE uses a wrapper called the FileSetAPI that creates
and manages multiple I/O API files when more than 120 variables are
needed in a single I/O API dataset in SMOKE. For example, if the SMOKE
speciation matrix requires 140 pollutant-to-species variables, SMOKE
will open by default two standard I/O API files: one with 120 variables
and one with 20 variables. This resulting "[file set]{.quote}" will be
treated by other SMOKE programs as a single file, which enables
processing of any number of pollutants and species in a single run,
despite the I/O API variable limitation.

Some I/O API files can be viewed by the [Visualization Environment for
Rich Data Interpretation](http://www.verdi-tool.org) (VERDI). In SMOKE,
any gridded output file from the **Smkmerge**, **Mrggrid**, or
**Smk2emis** programs can be viewed by VERDI.

In some cases, it can be helpful to directly view the contents of the
I/O API files in text form. This provides a quick way to check grid
settings, time period, or species names in the model-ready output files.
By viewing the text version of the model-ready output files produced by
SMOKE, you can easily confirm that the correct species have been created
or that the emission units are correct. To convert the I/O API files to
text, one can use a combination of the NetCDF-provided **ncdump**
utility and UNIX commands. The **ncdump** utility is created when you
compile the NetCDF library, or you can download it from the [NetCDF web
site](http://www.unidata.ucar.edu/packages/netcdf/). The command to
convert the files to text format is:

**`ncdump <infile>` \| **cut -c1-80** \> *`<outfile>`***

Replace *`<infile>`* in the command above with your input I/O API file
name, and *`<outfile>`* with your desired ACSII output file name. The
output file contains all the applicable data stored in the I/O API file
including grid information, time period, variable names, etc.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------- -------------------- ---------------------------
  [Prev](ch02s05.html)                 [Up](ch02s05.html)      [Next](ch02s05s03.html)
  2.5. Input and output file types     [Home](index.html)     2.5.3. Model-ready files
  ----------------------------------- -------------------- ---------------------------
:::
::: {.navheader}
2.5.3. Model-ready files
:::

[Prev](ch02s05s02.html) 

2.5. Input and output file types

 [Next](ch02s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_model_ready_files}2.5.3. Model-ready files {#model-ready-files .title}

</div>

</div>
:::

SMOKE supports two major approaches for formatting its output files that
are used as inputs to air quality models (i.e., model-ready files): the
CMAQ/Models-3 approach and the UAM-based approach. The CMAQ/Models-3
approach is used for the CMAQ model, and the UAM-based approach is used
for the UAM models, and CAM~X~.

The CMAQ/Models-3 approach uses one required 3-D I/O API file that
contains the gridded, hourly, speciated, and vertically distributed
emissions. In SMOKE, it is called the `EGTS3D_L`{.envar} file. To create
the 3-D model-ready emissions file, SMOKE computes plume rise for some
or all point sources. For CMAQ, two additional optional files can be
provided for plume-in-grid (PinG) processing. The first must contain
locations and stack parameters for PinG sources and is called the
`STACK_GROUPS`{.envar} file. The second must contain the hourly,
speciated emissions for the same PinG sources in a file called the
`PINGTS_L`{.envar} file.

The UAM-based approach has two required files: (1) a 2-D emissions
Fortran binary file with all sources other than point sources and all
low-level point sources, and (2) an elevated-point-source Fortran binary
file. The SMOKE program **Smk2emis** can create the 2-D emissions
Fortran binary file (called the `UAM_EGTS`{.envar} file) by converting a
2-D `EGTS_L`{.envar} file from an I/O API format. To obtain the
elevated-point-source Fortran binary file, the SMOKE program
**Smkmerge** can create an ASCII elevated-point-source file, which can
then be converted to the required binary format using the UAM
preprocessor [Ptsrce](http://www.remsad.com/ptsrce.htm).
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- ---------------------------
  [Prev](ch02s05s02.html)     [Up](ch02s05.html)         [Next](ch02s06.html)
  2.5.2. I/O API files        [Home](index.html)     2.6. Modeling parameters
  -------------------------- -------------------- ---------------------------
:::
::: {.navheader}
2.6. Modeling parameters
:::

[Prev](ch02s05s03.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s06s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#d0e1731}2.6. Modeling parameters {#modeling-parameters .title style="clear: both"}
------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.6.1. Map projections and model
grids](ch02s06.html#d0e1747)]{.section}

[[2.6.2. Base year and past/future years](ch02s06s02.html)]{.section}

[[2.6.3. Modeling episodes](ch02s06s03.html)]{.section}

[[2.6.4. Chemical mechanisms](ch02s06s04.html)]{.section}

[[2.6.5. Layer structures](ch02s06s05.html)]{.section}
:::

Emissions modeling requires information about the subsequent air quality
modeling that will be done. For example, to produce appropriate
model-ready files using SMOKE, you must know which AQM will be used, the
model grid and map projection, the episode dates, and the chemical
mechanism to be used. In this manual, we refer to these settings
collectively as "[modeling parameters]{.quote}". In this section, we
provide information on what these modeling parameters are and SMOKE's
capabilities to support them.

SMOKE reads in the modeling parameters from both script settings
(environment variables) and input files. In the subsections below, we
provide the relevant settings and files that control the modeling
parameters. More information about how to configure your scripts and
files to change these parameters can be found in [Section 4.4, "How to
use SMOKE"](ch04s04.html "4.4. How to use SMOKE"); how the settings
affect the programs is described in [Chapter 5, *SMOKE Utility
Tools*](ch05.html "Chapter 5. SMOKE Utility Tools") and [Chapter 6,
*SMOKE Core Programs*](ch06.html "Chapter 6. SMOKE Core Programs").

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e1747}2.6.1. Map projections and model grids {#map-projections-and-model-grids .title}

</div>

</div>
:::

A map projection is the mathematical representation of the spherical
surface of the earth on a 2-D plane. SMOKE supports Lambert conformal,
lat-lon, UTM, and polar stereographic map projections. There are many
different settings that you may use to define your Lambert conformal,
UTM, and polar stereographic projections, to make these projections
match the one being used by your meteorology model and AQM. (Lat-lon is
a fixed projection and cannot be changed.)

A model grid is a two-dimensional region overlaid on a map projection.
It is defined by the starting [*x-y*]{.emphasis} coordinates, the number
of grid cells in each direction, and the physical size of the grid
cells. [Figure 2.2, "Example model
grid"](ch02s06.html#fig_concepts_grid "Figure 2.2. Example model grid")
shows an example of a model grid that includes most of the eastern U.S.
This example has 81 grid cells in the [*x*]{.emphasis}-direction, 75
grid cells in the [*y*]{.emphasis}-direction, and each grid cell is 36
by 36 kilometers. Each set of 10 cells by 10 cells (counting from the
starting coordinates) is enclosed in black grid lines.

::: {.figure}
[]{#fig_concepts_grid}

**Figure 2.2. Example model grid**

::: {.mediaobject}
![Example model grid](images\concepts\grid_html.jpg)
:::
:::

The model grid is set in SMOKE using the `IOAPI_GRIDNAME_1`{.envar}
setting to select a grid and map projection from among those defined in
the `GRIDDESC`{.envar} input file. The name of the grid set with the
`IOAPI_GRIDNAME_1`{.envar} setting must match a grid name in the
`GRIDDESC`{.envar} file to allow SMOKE to obtain the grid and map
projection parameters from the `GRIDDESC`{.envar} file.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -----------------------------------------
  [Prev](ch02s05s03.html)       [Up](ch02.html)                      [Next](ch02s06s02.html)
  2.5.3. Model-ready files     [Home](index.html)     2.6.2. Base year and past/future years
  --------------------------- -------------------- -----------------------------------------
:::
::: {.navheader}
2.6.2. Base year and past/future years
:::

[Prev](ch02s06.html) 

2.6. Modeling parameters

 [Next](ch02s06s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e1793}2.6.2. Base year and past/future years {#base-year-and-pastfuture-years .title}

</div>

</div>
:::

For any modeling effort, the emissions base year and future year are key
modeling parameters needed for performing emissions processing. The base
year is usually the year for which the air quality model is being run in
order to compare modeling results with observed air quality data. Such
comparisons allow modelers to tune the emissions data and air quality
model, to ensure that the AQM is performing adequately during the
modeling episode.

The base year is most often a year for which an emission inventory is
available. This is usually the same year for which the meteorology model
has been run to prepare input to SMOKE and an AQM and for which air
quality observations are available. Of course there are exceptions to
this principle, but generally that is how one establishes a base year.

Several different files and settings are used to set the base year in
SMOKE, each of which should be consistent with each other for ideal
results.

::: {.itemizedlist}
-   The `YEAR`{.envar} setting in the SMOKE Assigns file is the
    reference point used by the scripts to determine the base year and
    set the names of various year-specific input files.

-   The episode and run settings (see [Section 2.6.3, "Modeling
    episodes"](ch02s06s03.html "2.6.3. Modeling episodes")) determine
    the base year that will be used in the model-ready output files.
    This base year must match the `YEAR`{.envar} setting so that the
    correct input files are used.

-   The input emissions files should ideally contain data for the same
    base year, and the \#YEAR header setting in those files should be
    consistent with the `YEAR`{.envar} environment variable in the
    Assigns file. If the years in the annual inventory files are not
    consistent with each other, SMOKE will determine the year used by
    the most sources and set that as the base year. If day-specific or
    hour-specific data are used, all years in those files must be
    consistent with the base year of the annual emissions.

-   The MOVES input data, if they are being used, should also be
    consistent with the base year. SMOKE is capable of running MOVES
    with inputs from a different year, but certain inputs may not be
    correct.

-   Finally, the dates in the I/O API meteorology data from the
    Meteorology-Chemistry Interface Processor (MCIP) must be consistent
    with both the base year and the episode and run settings.
:::

The future (or past) year is a chosen year in the future (or past) for
which a modeler needs to run an air quality model; for example, to model
the future effects of particular emission control strategies. To model a
future year with SMOKE, you must have either an inventory that has been
computed for a future year, or growth and control factors to project the
base-year inventory to the future year. The settings and files that must
be considered are as follows:

::: {.itemizedlist}
-   The setting `FYEAR`{.envar} is set in the run script and is used by
    the script to automatically assign the name of the **Cntlmat** input
    file `GCNTL`{.envar}, which contains the growth factors.
    `FYEAR`{.envar} must be set to the future year even if a future-year
    inventory is not being created because it has already been provided
    to you.

-   If you already have a future-year inventory and so do not need to
    use SMOKE to project one from the base year inventory, then the
    emissions data year must match the future year, and the \#YEAR
    header in the inventory file must match that year as well. In this
    case, the `SMK_BASEYR_OVERRIDE`{.envar} setting must also be used to
    indicate what the base year is (which will be the same as the year
    of the meteorology data).

-   The MOVES input data, if they are being used, must also include the
    correct settings for the future year of interest.

-   The episode and run settings, meteorology files, and day- or
    hour-specific inventories should [*not*]{.emphasis} match the future
    year, but rather should use the base-year episode dates.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- ---------------------------
  [Prev](ch02s06.html)         [Up](ch02s06.html)      [Next](ch02s06s03.html)
  2.6. Modeling parameters     [Home](index.html)     2.6.3. Modeling episodes
  --------------------------- -------------------- ---------------------------
:::
::: {.navheader}
2.6.3. Modeling episodes
:::

[Prev](ch02s06s02.html) 

2.6. Modeling parameters

 [Next](ch02s06s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_modeling_episodes}2.6.3. Modeling episodes {#modeling-episodes .title}

</div>

</div>
:::

The modeling episode is the total time period for which you will run
SMOKE and your AQM. Unless the episode is just a few days long, users
typically set up SMOKE to create emissions files of a shorter duration
than their modeling episode, often creating one-day files for each day
of their episode. Though SMOKE can create a single file for an entire
episode, the file often becomes too large for some computers to handle
(the limit for 32-bit operating systems is 2 GB files), so necessity
rather than preference dictates that smaller files (usually one-day
files) be created by SMOKE. We use the term "[run period]{.quote}" to
distinguish between these shorter durations and the full modeling
episode; unless otherwise noted, we will assume that the run period is
one day. For example, a typical SMOKE episode might cover July 1, 1996
through July 31, 1996. There will be 31 run periods (days) within this
episode, the first starting on July 1, 1996 and the last starting on
July 31, 1996.

In the SMOKE Assigns file, there are several settings that you need to
change to cause SMOKE to create emissions for the episode of interest.
[Section 4.4, "How to use SMOKE"](ch04s04.html "4.4. How to use SMOKE")
provides more guidance on the particular form and approaches needed for
using these settings.

::: {.itemizedlist}
-   The episode start date (`EPI_STDATE`{.envar}), episode start time
    (`EPI_STTIME`{.envar}), episode duration in hours
    (`EPI_RUNLEN`{.envar}), and the episode number of days
    (`EPI_NDAY`{.envar}) all must be set to cover the modeling episode.
    Note that SMOKE can only be run for periods contained within a
    single calendar year. It cannot, for example, start in December of
    1996 and run through January of 1997. Two separate episodes would
    need to be set up in this case, with the first ending on December
    31, 1996, and the second starting on January 1, 1997.

-   The start date of the first run period needs to be set using the
    `G_STDATE`{.envar} and `ESDATE`{.envar} settings. The
    `G_STDATE`{.envar} is the year and Julian day setting used by the
    SMOKE programs; in our example above, `G_STDATE`{.envar} would be
    set to 1996183, since July 1 is the 183rd day of 1996. The
    `ESDATE`{.envar} is the Gregorian date used in naming the SMOKE
    intermediate and output files; for our example, `ESDATE`{.envar}
    would be 19960701. The SMOKE scripts will use the `EPI_NDAY`{.envar}
    setting to automatically loop through the number of run periods in
    the episode, starting with the first `G_STDATE`{.envar} value in the
    Assigns file. The `G_STDATE`{.envar} and `ESDATE`{.envar} settings
    are changed for each run period.

-   The run period start time (`G_STTIME`{.envar}) and duration
    (`G_RUNLEN`{.envar}) must also be set to indicate the start time and
    length of each run period. Both values are provided as a number of
    hours, using a HHMMSS (hours, minutes, seconds) format.

    The run period duration (`G_RUNLEN`{.envar}) is usually not the same
    as the episode duration (`EPI_RUNLEN`{.envar}). For example, if the
    episode length is 30 days (720 hours), the run period duration
    setting could be just 1 day (25 hours), 2 days (49 hours), or three
    days (73 hours) (the reason for the extra hour in each case is
    explained below). In the first case, SMOKE would create thirty
    25-hourfiles; in the second case, fifteen 49-hour files; and in the
    third case, SMOKE would create ten 73-hour files.

-   The `NDAYS`{.envar}, `MSDATE`{.envar}, and `MDAYS`{.envar} settings
    are used for naming files. The `NDAYS`{.envar} setting should be set
    to the number of days in each run period, and is used by default for
    naming time-based files. The `NDAYS`{.envar} setting is also used
    along with the `EPI_NDAY`{.envar} setting to loop through the run
    periods in the episode. The `MSDATE`{.envar} and `MDAYS`{.envar}
    settings can be used for naming the meteorology input files, but are
    not being used by the default Assigns file provided with SMOKE.
:::

There are a few key things to remember when you are verifying that you
have the correct episode settings:

::: {.itemizedlist}
-   SMOKE cannot process emissions over a calendar-year break. Thus, the
    longest run that can be done is for 365 days, with the episode start
    date being January 1. If a modeling episode spans multiple years,
    then a different Assigns file, script, and sets of input files must
    be created for each year.

-   The AQMs supported by SMOKE always need one extra hour in each
    emissions input file due to how they calculate boundary conditions.
    Therefore, if you are inputting emissions to run a 24-hour period,
    the `G_RUNLEN`{.envar} setting should be 250000 for 25 hours.

-   The CMAQ and CAM~X~ models can accept emissions files for multiple
    days, but the UAM must have 25-hour files only. As stated earlier,
    however, all of these models are often run using 25-hour files, with
    one file for each day of the episode.

-   All times are associated with a time zone, including the episode and
    run period start time settings. These settings must be consistent
    with the time zone of the meteorology files. If the meteorology data
    were created using MM5, the time zone is most likely Greenwich Mean
    Time (GMT); therefore, the `EPI_STDATE`{.envar},
    `EPI_STTIME`{.envar}, `G_STDATE`{.envar}, and `G_STTIME`{.envar}
    settings would have to be provided in that same time zone. Whatever
    time zone is inherent in the meteorology files and these date
    settings will also be the time zone of the dates and times in the
    output emissions files from SMOKE. This ensures that the dates and
    times of the emissions and meteorology files are consistent for
    input to the AQM.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------- -------------------- -----------------------------
  [Prev](ch02s06s02.html)                    [Up](ch02s06.html)        [Next](ch02s06s04.html)
  2.6.2. Base year and past/future years     [Home](index.html)     2.6.4. Chemical mechanisms
  ----------------------------------------- -------------------- -----------------------------
:::
::: {.navheader}
2.6.4. Chemical mechanisms
:::

[Prev](ch02s06s03.html) 

2.6. Modeling parameters

 [Next](ch02s06s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e2002}2.6.4. Chemical mechanisms {#chemical-mechanisms .title}

</div>

</div>
:::

SMOKE can accommodate a variety of chemical mechanisms for the models it
supports. From the emissions processing perspective, the chemical
mechanism is the mapping of the pollutants provided in the emissions
inventory to the species needed by the AQM of interest. For example, the
input files for five chemical mechanisms for the CMAQ model are
available for download from the EPA; these mechanisms are Carbon Bond 6
(CB6), CB6 with particulates, Regional Acid Deposition Model, 2 (RADM2),
RADM2 with particulates, and a research version of CB6 with toxics.

In [Section 4.4.10, "Use a different speciation mechanism or change
speciation
inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs"),
we provide the settings needed in the Assigns file to use a different
chemical mechanisms with SMOKE. SMOKE is not constrained to the files
available for download. If you need to process other data (e.g., a
tracer species) with SMOKE, they can be added to several input files,
including the chemical mechanism file, to be output to the AQM. Some
additions to chemical mechanisms are easier than others, and we explain
how to determine whether you can create the files you need for your
situation. We also give instructions on how to add species to the
chemical mechanism files and how to make sure that the inventory
pollutants are mapped to the correct chemical species.

SMOKE users must know what chemical mechanism will be used in the AQM
for which the SMOKE output emissions are intended. Once that has been
determined, the following files must be configured to be consistent with
the inventory being used and the chemical mechanism: the inventory table
(`INVTABLE`{.envar}), speciation profiles (`GSPRO`{.envar}), speciation
cross-reference (`GSREF`{.envar}), and the mobile processes file
(`MEPROC`{.envar}) when creating on-road mobile emissions with MOVES
through SMOKE.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- --------------------------
  [Prev](ch02s06s03.html)      [Up](ch02s06.html)     [Next](ch02s06s05.html)
  2.6.3. Modeling episodes     [Home](index.html)     2.6.5. Layer structures
  --------------------------- -------------------- --------------------------
:::
::: {.navheader}
2.6.5. Layer structures
:::

[Prev](ch02s06s04.html) 

2.6. Modeling parameters

 [Next](ch02s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e2025}2.6.5. Layer structures {#layer-structures .title}

</div>

</div>
:::

SMOKE needs information on layer structures for processing elevated
point sources' plume rise in the **Laypoint** program and creating the
ASCII elevated-point-source file (`ELEVTS_L`{.envar} or
`ELEVTS_S`{.envar}) with the **Smkmerge** program. The way SMOKE obtains
the layer information differs depending on whether you are creating
emissions using a CMAQ-based or UAM-based approach (see [Section 2.5.3,
"Model-ready files"](ch02s05s03.html "2.5.3. Model-ready files")). For
the CMAQ-based approach, SMOKE determines the layer structure from the
structure included in the header of the `GRID_CRO_3D`{.envar}
meteorology file. For the UAM-based approach, SMOKE does not really need
to know the layer structure, except to output it to the ASCII
elevated-point-source file. In this case, there are many settings
obtained by **Smkmerge** from environment variable names starting with
`UAM_`{.envar}.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------- -------------------- ----------------------------------------------------
  [Prev](ch02s06s04.html)        [Up](ch02s06.html)                                  [Next](ch02s07.html)
  2.6.4. Chemical mechanisms     [Home](index.html)     2.7. Sparse matrix approach to emissions modeling
  ----------------------------- -------------------- ----------------------------------------------------
:::
::: {.navheader}
2.7. Sparse matrix approach to emissions modeling
:::

[Prev](ch02s06s05.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s08.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_sparse_matrix}2.7. Sparse matrix approach to emissions modeling {#sparse-matrix-approach-to-emissions-modeling .title style="clear: both"}
---------------------------------------------------------------------------------

</div>

</div>
:::

The paradigm for atmospheric emissions models prior to SMOKE was a
network of pipes and filters. This means that at any given stage in the
processing, an emissions file includes self-contained records describing
each source and [*all*]{.emphasis} of the attributes acquired from
previous processing stages. Each processing stage acts as a filter that
inputs a stream of these fully-defined records, combines it with data
from one or more support files, and produces a new stream of these
records. Redundant data are passed down the pipe at the cost of extra
I/O, storage, data processing, and program complexity. Using this
method, all processing is performed one record at a time, without
necessarily a structure or order to the records.

This old paradigm came about as a way to avoid repeatedly searching
through data files for needed information, which would be very
inefficient. It is admirably suited to older computer architectures with
very small available memories and tape-only storage, but is not suitable
for current desktop machines or high-performance computers. SMOKE
developers demonstrated this when the Emissions Preprocessor System
(EPS) 2.0 was run on a Cray Y-MP. It ran four times slower on the Cray
machine (a much faster computer) than on a desktop 150 MHz DEC
Alphastation 3000/300. This paradigm also fostered a serial approach to
the emissions processing steps, as shown in [Figure 2.3, "Serial
approach to emissions
processing"](ch02s07.html#fig_concepts_serial_approach "Figure 2.3. Serial approach to emissions processing").

::: {.figure}
[]{#fig_concepts_serial_approach}

**Figure 2.3. Serial approach to emissions processing**

::: {.mediaobject}
![Serial approach to emissions
processing](images\concepts\serial_approach_html.jpg)
:::
:::

The new paradigm implemented in SMOKE came about from analyses
indicating that emissions computations should be quite adaptable to
high-performance computing if the paradigm were appropriately changed.
For each SMOKE processing category (i.e., area, biogenic, mobile, and
point sources), the following tasks are performed:

::: {.itemizedlist}
-   read emissions inventory data files

-   optionally grow emissions from the base year to the (future or past)
    modeled year (except biogenic sources)

-   transform inventory species into chemical mechanism species defined
    by an AQM

-   optionally apply emissions controls (except for biogenic sources)

-   model the temporal distribution of the emissions, including any
    meteorology effects

-   model the spatial distribution of the emissions;

-   merge the various source categories of emissions to form input files
    for the AQM

-   at every step of the processing, perform quality assurance on the
    input data and the results
:::

Each processing category has its particular complexities and deviations
from the above list; these are described in [Section 2.8, "Area,
biogenic, mobile, and point processing
summaries"](ch02s08.html "2.8. Area, biogenic, mobile, and point processing summaries").
For all categories, however, most of the needed processing steps are
[*factor-based*]{.emphasis}; they are linear operations that can be
represented as multiplication by matrices. Further, some of the matrices
are [*sparse*]{.emphasis} matrices (i.e., most of their entries are
zeros).

SMOKE is designed to take advantage of these facts by formulating
emissions modeling in terms of sparse matrix operations, which can be
performed by optimized sparse matrix libraries. Specifically, the
inventory emissions are arranged as a vector of emissions sorted in a
particular order, with associated vectors that include characteristics
about the sources such as the state/county and SCCs. SMOKE then creates
matrices that apply the control, gridding, and speciation factors to the
vector of emissions. In many cases, these matrices are independent from
one another, and can therefore be generated in parallel and applied to
the inventory in a final "[merge]{.quote}" step, which combines the
inventory emissions vector (now an hourly inventory file) with the
control, speciation, and gridding matrices to create model-ready
emissions. [Figure 2.4, "Parallel approach to emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing")
shows how the matrix approach allows for a more parallel approach to
emissions processing, in which fewer steps depend on other needed steps.

Note that in [Figure 2.4, "Parallel approach to emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing"),
temporal allocation outputs hourly emissions instead of a temporal
matrix. This is because of some peculiarities with temporal modeling for
point sources, which can use hourly emissions as input data. To be able
to overwrite the inventory emissions with these hourly emissions, the
temporal allocation step must output the emissions data. The matrix
approach is used internally in the temporal allocation step.

The growth and controls steps shown in [Figure 2.4, "Parallel approach
to emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing")
are optional. If the inventory is not grown to a future or past year,
then the temporal allocation step uses the original inventory vectors to
calculate the hourly emissions.

::: {.figure}
[]{#fig_concepts_parallel_approach}

**Figure 2.4. Parallel approach to emissions processing**

::: {.mediaobject}
![Parallel approach to emissions
processing](images\concepts\parallel_approach_html.jpg)
:::
:::

Several benefits can be realized from this more parallel approach. For
example, given a single emissions inventory, temporal modeling is
performed only once per inventory and episode (though in practice, this
step is often performed once per episode day). Also, gridding matrices
typically need only be calculated once per inventory and model grid
definition, without having to reprocess other steps. As shown in
[Figure 2.5, "Processing steps for running an additional grid in
SMOKE"](ch02s07.html#fig_concepts_additional_grid "Figure 2.5. Processing steps for running an additional grid in SMOKE"),
SMOKE usually needs to rerun only the gridding and merge steps to
process a different grid for the same inventory. The merge step in the
figure will read the previously created results from the temporal
allocation, chemical speciation, and control processing steps.

::: {.figure}
[]{#fig_concepts_additional_grid}

**Figure 2.5. Processing steps for running an additional grid in SMOKE**

::: {.mediaobject}
![Processing steps for running an additional grid in
SMOKE](images\concepts\additional_grid_html.jpg)
:::
:::

In addition, speciation matrices need only be calculated once per
inventory and chemical mechanism. Similar to the gridding example,
[Figure 2.6, "Processing steps for running an additional chemical
mechanism in
SMOKE"](ch02s07.html#fig_concepts_additional_chemical "Figure 2.6. Processing steps for running an additional chemical mechanism in SMOKE")
shows the SMOKE steps that generally need to be rerun for running an
additional chemical mechanism.

::: {.figure}
[]{#fig_concepts_additional_chemical}

**Figure 2.6. Processing steps for running an additional chemical
mechanism in SMOKE**

::: {.mediaobject}
![Processing steps for running an additional chemical mechanism in
SMOKE](images\concepts\additional_chemical_html.jpg)
:::
:::

A final example of how this approach is beneficial is processing with a
control strategy. Because of SMOKE's parallel processing, changing a
control strategy requires only the control and merge steps to be
processed again ([Figure 2.7, "Processing steps for running a control
scenario in
SMOKE"](ch02s07.html#fig_concepts_running_control "Figure 2.7. Processing steps for running a control scenario in SMOKE")).
In serial processing, on the other hand, the growth and controls step
occurs as the second processing step, which requires that all downstream
steps be redone. In [Figure 2.7, "Processing steps for running a control
scenario in
SMOKE"](ch02s07.html#fig_concepts_running_control "Figure 2.7. Processing steps for running a control scenario in SMOKE"),
the speciation, temporal allocation, and gridding steps have already
been run, and can be fed to the merge step without being altered or
regenerated.

::: {.figure}
[]{#fig_concepts_running_control}

**Figure 2.7. Processing steps for running a control scenario in SMOKE**

::: {.mediaobject}
![Processing steps for running a control scenario in
SMOKE](images\concepts\running_control_html.jpg)
:::
:::

Although SMOKE processing generally follows the structure shown in
[Figure 2.4, "Parallel approach to emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing"),
there are some exceptions. In the list below, we summarize these
exceptions and provide references to the sections of this chapter where
these exceptions are explained and shown through diagrams. These
exceptions are also described in more detail in [Section 2.8.2,
"Area-source
processing"](ch02s08s02.html "2.8.2. Area-source processing"),
[Section 2.8.3, "Biogenic-source
processing"](ch02s08s03.html "2.8.3. Biogenic-source processing"),
[Section 2.8.4, "Mobile-source processing using
MOVES"](ch02s08s04.html "2.8.4. Mobile-source processing using MOVES"),
and [Section 2.8.5, "Point-source
processing"](ch02s08s05.html "2.8.5. Point-source processing").

::: {.itemizedlist}
-   [**On-road mobile processing with MOVES:**]{.bold} One way of
    processing on-road mobile-source emissions is to have SMOKE run the
    MOVES model based on hourly, gridded meteorology data. To run a
    different grid or control strategy using this approach, users
    usually need to run a number of additional processing steps that we
    have not yet discussed. These differences from the standard
    processing approach are described in [Section 2.8.4, "Mobile-source
    processing using
    MOVES"](ch02s08s04.html "2.8.4. Mobile-source processing using MOVES").

-   [**Biogenics processing:**]{.bold} Biogenics processing uses
    different processors than those for anthropogenic sources. The
    emissions from biogenic sources are based on land use data and
    meteorology data instead of on actual emission inventories. For more
    information, please see [Section 2.8.3, "Biogenic-source
    processing"](ch02s08s03.html "2.8.3. Biogenic-source processing").

-   [**Toxics processing for different chemical speciation
    mechanisms:**]{.bold} Toxics processing may require some special
    processing steps during import of the inventory data when
    integrating the criteria and toxics inventories. This step depends
    on which chemical speciation approach is going to be used.
    Therefore, when changing the toxics speciation mechanism, it is
    sometimes necessary to rerun the data import step. See
    [Section 2.9.5, "Combine toxics and criteria
    inventories"](ch02s09s05.html "2.9.5. Combine toxics and criteria inventories")
    for more information.

-   [**Point-source processing for CMAQ versus UAM, or CAM~X~:**]{.bold}
    Point-source processing for CMAQ uses some different programs than
    processing for UAM or CAM~X~. In some cases, it may be necessary to
    rerun several programs in order to run for one model rather than
    another. Further details on this additional processing can be found
    in [Section 2.8.5, "Point-source
    processing"](ch02s08s05.html "2.8.5. Point-source processing").

-   [**Adding hour-specific or day-specific point-source data:**]{.bold}
    If you want to add hour-specific or day-specific point-source data
    after a point source run has already been performed, several
    processing steps must be rerun. Further details on this additional
    processing can be found in [Section 2.8.5, "Point-source
    processing"](ch02s08s05.html "2.8.5. Point-source processing").
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- --------------------------------------------------------------
  [Prev](ch02s06s05.html)      [Up](ch02.html)                                              [Next](ch02s08.html)
  2.6.5. Layer structures     [Home](index.html)     2.8. Area, biogenic, mobile, and point processing summaries
  -------------------------- -------------------- --------------------------------------------------------------
:::
::: {.navheader}
2.8. Area, biogenic, mobile, and point processing summaries
:::

[Prev](ch02s07.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s08s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_processing_summaries}2.8. Area, biogenic, mobile, and point processing summaries {#area-biogenic-mobile-and-point-processing-summaries .title style="clear: both"}
--------------------------------------------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.8.1. Summary of SMOKE processing
categories](ch02s08.html#sect_concepts_summary_source_processing)]{.section}

[[2.8.2. Area-source processing](ch02s08s02.html)]{.section}

[[2.8.3. Biogenic-source processing](ch02s08s03.html)]{.section}

[[2.8.4. Mobile-source processing using
MOVES](ch02s08s04.html)]{.section}

[[2.8.5. Point-source processing](ch02s08s05.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_summary_source_processing}2.8.1. Summary of SMOKE processing categories {#summary-of-smoke-processing-categories .title}

</div>

</div>
:::

Each SMOKE processing category is defined by its source
[*characteristics*]{.emphasis}, which correspond to the identifiers used
in creating the emission inventory (e.g., state/county FIPS code and
SCC). The processing categories also have source
[*attributes*]{.emphasis}, which are the other useful data in the
emission inventories that SMOKE uses; examples are point-source flue gas
exit height and temperature. Source characteristics
[*define*]{.emphasis} the sources as area, biogenic, mobile, or point
sources and also distinguish one source in the inventory from another.
Source attributes are additional data about the source that do not
contribute to the source's uniqueness in SMOKE. We have previously
described in [Section 2.3.1, "Inventory data
types"](ch02s03.html#sect_concepts_inv_data_types "2.3.1. Inventory data types")
the data types and the data attributes that are contained in the
inventories that SMOKE uses. In the subsections below, we summarize the
source characteristics of area, biogenics, mobile, and point sources.
Please refer to [Table 2.1, "Inventory source categories and SMOKE
processing capabilities and
categories"](ch02s03s02.html#tbl_concepts_inv_categories "Table 2.1. Inventory source categories and SMOKE processing capabilities and categories")
for more information about how SMOKE processing categories map to the
inventory source categories.

In SMOKE, each processing category is defined by source characteristics
as follows:

::: {.itemizedlist}
-   [**Area sources**]{.bold} are defined by (1) [country, state, and
    county
    codes](ch02s03s04.html "2.3.4. Country, state, and county codes"), (2)
    [SCCs](ch02s03s05.html "2.3.5. Source Classification Codes"),
    and (3) optionally, grid cell.

-   [**Biogenic sources**]{.bold} are defined differently depending on
    the type of processing you are using. They can be defined either
    by (1) [country, state, and county
    codes](ch02s03s04.html "2.3.4. Country, state, and county codes")
    and (2) land use code, or by (1) grid cell and (2) land use code.

-   [**Mobile sources**]{.bold} are defined by (1) [country, state, and
    county
    codes](ch02s03s04.html "2.3.4. Country, state, and county codes"), (2)
    [SCCs](ch02s03s05.html "2.3.5. Source Classification Codes"),
    and (3) optionally link codes.

-   [**Point sources**]{.bold} are defined by (1) [country, state, and
    county
    codes](ch02s03s04.html "2.3.4. Country, state, and county codes"), (2)
    plant/facility codes, and (3) characteristics 1 through 5, one of
    which must be the
    [SCC](ch02s03s05.html "2.3.5. Source Classification Codes").
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------- -------------------- --------------------------------
  [Prev](ch02s07.html)                                   [Up](ch02.html)             [Next](ch02s08s02.html)
  2.7. Sparse matrix approach to emissions modeling     [Home](index.html)     2.8.2. Area-source processing
  ---------------------------------------------------- -------------------- --------------------------------
:::
::: {.navheader}
2.8.2. Area-source processing
:::

[Prev](ch02s08.html) 

2.8. Area, biogenic, mobile, and point processing summaries

 [Next](ch02s08s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_area_source_processing}2.8.2. Area-source processing {#area-source-processing .title}

</div>

</div>
:::

::: {.toc}
[[2.8.2.1. Typical route](ch02s08s02.html#d0e2298)]{.section}

[[2.8.2.2. Pre-gridded
Emissions](ch02s08s02.html#sect_concepts_pregridded_data)]{.section}

[[2.8.2.3. Day-specific and Hour-specific
Emissions](ch02s08s02.html#d0e2402)]{.section}
:::

In SMOKE, there are two major processing routes that you can take for
area sources: the typical route and the pregridded data route. (Recall
that by "[area sources]{.quote}" in SMOKE we mean stationary
area/nonpoint sources and nonroad mobile sources.)

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e2298}2.8.2.1. Typical route {#typical-route .title}

</div>

</div>
:::

The typical route involves processing data identified by
country/state/county codes and SCCs. The processing steps vary depending
on whether you are doing base-case processing or future- or past-year
processing. The steps for base-year processing are shown in [Figure 2.8,
"Base case area-source processing
steps"](ch02s08s02.html#fig_concepts_area_base "Figure 2.8. Base case area-source processing steps").
In [Figure 2.4, "Parallel approach to emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing"),
we also included the major intermediate vectors and matrices; please
refer to that diagram for those details. The inventory import step reads
the raw emissions data, screens them, processes them, and converts the
raw data to the SMOKE intermediate inventory file (inventory vectors in
[Figure 2.4, "Parallel approach to emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing")).
The emissions in the inventory file are subdivided to hourly emissions
during temporal allocation; assigned chemical speciation factors during
speciation, and assigned spatial allocation factors during gridding. The
merge step combines the hourly emissions, speciation matrix, and
gridding matrix to create model-ready emissions.

::: {.figure}
[]{#fig_concepts_area_base}

**Figure 2.8. Base case area-source processing steps**

::: {.mediaobject}
![Base case area-source processing
steps](images\concepts\area_base_html.jpg)
:::
:::

In [Figure 2.9, "Future- or past-year growth and optional control
area-processing
steps"](ch02s08s02.html#fig_concepts_area_growth "Figure 2.9. Future- or past-year growth and optional control area-processing steps"),
we show the area-source processing steps for future- or past-year
processing. This processing is similar to the base-year processing flow,
except the growth and controls step is added to create the growth matrix
and optionally one or more control matrices. The grow inventory step
applies the growth matrix to convert the base-year inventory to a future
or past year. Also, the control matrix can optionally be used in the
merge step to apply control factors to the future- or past-year
emissions. The steps shown with dotted lines represent steps that can be
reused from the base-year processing because they do not depend on any
of the new steps.

::: {.figure}
[]{#fig_concepts_area_growth}

**Figure 2.9. Future- or past-year growth and optional control
area-processing steps**

::: {.mediaobject}
![Future- or past-year growth and optional control area-processing
steps](images\concepts\area_growth_html.jpg)
:::
:::

Finally, inventory controls as well as growth can be applied at the
front end of processing if such a scheme is needed ([Figure 2.10,
"Alternative future- or past-year growth and control area-processing
steps"](ch02s08s02.html#fig_concepts_area_projection "Figure 2.10. Alternative future- or past-year growth and control area-processing steps")).
This method permits up to 80 growth and/or control matrices to be
applied to an inventory, whereas the method shown in [Figure 2.9,
"Future- or past-year growth and optional control area-processing
steps"](ch02s08s02.html#fig_concepts_area_growth "Figure 2.9. Future- or past-year growth and optional control area-processing steps")
allows only one control matrix in the merge step, although any number of
growth matrices on the front end. The processing scheme shown in
[Figure 2.10, "Alternative future- or past-year growth and control
area-processing
steps"](ch02s08s02.html#fig_concepts_area_projection "Figure 2.10. Alternative future- or past-year growth and control area-processing steps")
can therefore be useful when mixing and matching many control strategies
for simulations.

::: {.figure}
[]{#fig_concepts_area_projection}

**Figure 2.10. Alternative future- or past-year growth and control
area-processing steps**

::: {.mediaobject}
![Alternative future- or past-year growth and control area-processing
steps](images\concepts\area_projection_html.jpg)
:::
:::

In sections later in this chapter, we describe the SMOKE programs that
are needed for each of these processing steps and additional details
about what activities are accomplished during each step. These sections
are:

::: {.itemizedlist}
-   [Section 2.9, "Inventory
    import"](ch02s09.html "2.9. Inventory import")
-   [Section 2.10, "Temporal
    processing"](ch02s10.html "2.10. Temporal processing")
-   [Section 2.11, "Chemical speciation
    processing"](ch02s11.html "2.11. Chemical speciation processing")
-   [Section 2.12, "Spatial
    processing"](ch02s12.html "2.12. Spatial processing")
-   [Section 2.13, "Growth
    processing"](ch02s13.html "2.13. Growth processing")
-   [Section 2.14, "Control
    processing"](ch02s14.html "2.14. Control processing")
-   [Section 2.18, "Creating model-ready
    emissions"](ch02s18.html "2.18. Creating model-ready emissions")
-   [Section 2.20, "Quality
    assurance"](ch02s20.html "2.20. Quality assurance")
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_pregridded_data}2.8.2.2. Pre-gridded Emissions {#pre-gridded-emissions .title}

</div>

</div>
:::

::: {.toc}
[[2.8.2.2.1. Pregridded data route for same modeling
domain](ch02s08s02.html#d0e2367)]{.section}

[[2.8.2.2.2. Pregridded data route for a different modeling
domain](ch02s08s02.html#d0e2390)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e2367}2.8.2.2.1. Pregridded data route for same modeling domain {#pregridded-data-route-for-same-modeling-domain .title}

</div>

</div>
:::

The second processing approach for area sources involves using
pregridded data. As indicated in [Section 2.8.1, "Summary of SMOKE
processing
categories"](ch02s08.html#sect_concepts_summary_source_processing "2.8.1. Summary of SMOKE processing categories"),
area sources can be specified by grid cell instead of by
country/state/county code and SCC. This optional approach to modeling
area sources requires the inventory emissions data to be gridded prior
to inventory import. The gridded area sources do [*not*]{.emphasis} have
country/state/county codes or SCCs, and can be provided via an I/O API
time-independent gridded data file. The flow diagrams that describe this
type of processing are identical to those in [Figure 2.8, "Base case
area-source processing
steps"](ch02s08s02.html#fig_concepts_area_base "Figure 2.8. Base case area-source processing steps"),
[Figure 2.9, "Future- or past-year growth and optional control
area-processing
steps"](ch02s08s02.html#fig_concepts_area_growth "Figure 2.9. Future- or past-year growth and optional control area-processing steps"),
and [Figure 2.10, "Alternative future- or past-year growth and control
area-processing
steps"](ch02s08s02.html#fig_concepts_area_projection "Figure 2.10. Alternative future- or past-year growth and control area-processing steps").
Although the gridding step is quite trivial when the grid cell numbers
are already specified, the gridding step must still be run to create a
gridding matrix required for the merge step.

The disadvantage of using pregridded emissions for area-source
processing is that there are no country/state/county codes and SCCs to
use in the cross-referencing of any processing step. Therefore, temporal
profiles, speciation profiles, growth factors, and control factors must
be applied uniformly across the model grid by pollutant.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e2390}2.8.2.2.2. Pregridded data route for a different modeling domain {#pregridded-data-route-for-a-different-modeling-domain .title}

</div>

</div>
:::

The sequence for processing global emissions data (e.g., EDGAR, RCP and
HTAP) for hemispheric CMAQ involves projecting the data from
latitude-longitude projection to polar stereographic projection,
converting the inventory species to the terms required by the CMAQ
chemical mechanism, and extrapolating the annual emissions to hourly
estimates.

[Detail
information](https://docs.google.com/document/d/1veqEjaTPbDpkqHAIcyReokvv6MaENz0TrwOcFl1ewac/edit#heading=h.xo1iz1nkhapd)
on how to process pregridded global emissions data for CMAQ Hemispheric
Modeling in SMOKE is available at [this
link](https://docs.google.com/document/d/1veqEjaTPbDpkqHAIcyReokvv6MaENz0TrwOcFl1ewac/edit#heading=h.xo1iz1nkhapd).
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e2402}2.8.2.3. Day-specific and Hour-specific Emissions {#day-specific-and-hour-specific-emissions .title}

</div>

</div>
:::

Emissions from area sources are sometimes available as day- or
hour-specific values. **Smkinven** can import the day- and hour-specific
data, and it can also convert the hour-specific data to hour-specific
temporal profiles. When these data are available, the **Temporal**
program overrides the annual or daily emissions with the most specific
data available. If day-specific data are available, **Temporal** uses
them to overwrite the annual or average-day emissions during the time
periods that these data are available. If hour-specific data are
available, **Temporal** uses them to overwrite the annual, average-day
emissions, or day-specific emissions data.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------------------- -------------------- ------------------------------------
  [Prev](ch02s08.html)                                            [Up](ch02s08.html)               [Next](ch02s08s03.html)
  2.8. Area, biogenic, mobile, and point processing summaries     [Home](index.html)     2.8.3. Biogenic-source processing
  -------------------------------------------------------------- -------------------- ------------------------------------
:::
::: {.navheader}
2.8.3. Biogenic-source processing
:::

[Prev](ch02s08s02.html) 

2.8. Area, biogenic, mobile, and point processing summaries

 [Next](ch02s08s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_biogenic_source_processing}2.8.3. Biogenic-source processing {#biogenic-source-processing .title}

</div>

</div>
:::

SMOKE biogenic emissions modeling can be accomplished with the Biogenic
Emissions Inventory System, version 3 (BEIS3) approach using the
processing scheme ([Figure 2.11, "Biogenic-source processing steps and
intermediate
files"](ch02s08s03.html#fig_concepts_biogenic_base "Figure 2.11. Biogenic-source processing steps and intermediate files")).
The raw land use inventory data are imported and output as normalized
emissions. Meteorology adjustments are then applied to the normalized
emissions to create hourly model-ready emissions estimates.

::: {.figure}
[]{#fig_concepts_biogenic_base}

**Figure 2.11. Biogenic-source processing steps and intermediate files**

::: {.mediaobject}
![Biogenic-source processing steps and intermediate
files](images\concepts\biogenic_base_html.jpg)
:::
:::

The land use import can start with gridded BELD3 or BELD4 land use data
and uses BEIS3 summer and winter emission factors. In [Section 2.17,
"Biogenic processing"](ch02s17.html "2.17. Biogenic processing"), we
provide additional details about the SMOKE programs used for BEIS3
processing and its capabilities.

A variation can be run on the processing steps shown in [Figure 2.11,
"Biogenic-source processing steps and intermediate
files"](ch02s08s03.html#fig_concepts_biogenic_base "Figure 2.11. Biogenic-source processing steps and intermediate files")
(see [Figure 2.12, "Biogenic-source processing steps and intermediate
files using both winter and summer emission
factors"](ch02s08s03.html#fig_concepts_biogenic_seasons "Figure 2.12. Biogenic-source processing steps and intermediate files using both winter and summer emission factors")).
In this variation, some grid cells use summer emission factors and some
use winter emission factors. This is useful during the changes of
seasons. Based on guidance from EPA, the summer emissions factors should
be used for time periods after the last frost of the spring until the
first frost of the fall, and winter emission factors should be used at
other times of the year. To make such assignments by grid cell, the
SMOKE utility **Metscan** analyzes the meteorology data for the entire
year (or the period of interest) to establish which days each grid cell
should use winter and summer emission factors. **Metscan** creates a
winter/summer switch file that indicates the appropriate season for each
grid cell for each day. More information on **Metscan** is available in
[Section 5.3.11, "**Metscan**"](ch05s03s11.html "5.3.11. Metscan"). The
results of the meteorology analysis can then be used in the
[Figure 2.12, "Biogenic-source processing steps and intermediate files
using both winter and summer emission
factors"](ch02s08s03.html#fig_concepts_biogenic_seasons "Figure 2.12. Biogenic-source processing steps and intermediate files using both winter and summer emission factors")
processing approach, in which both the summer and winter normalized
emissions are provided to the meteorology adjustments step, along with
the winter/summer switch file. The resulting model-ready emissions data
have used the winter emission factors for all grid cells of the domain
that have experienced the first freeze date of the year but not the last
(within a calendar year, this is the time periods January through March
and November through December in many regions), and the summer emission
factors for all grid cells between the last and first freeze dates.

::: {.figure}
[]{#fig_concepts_biogenic_seasons}

**Figure 2.12. Biogenic-source processing steps and intermediate files
using both winter and summer emission factors**

::: {.mediaobject}
![Biogenic-source processing steps and intermediate files using both
winter and summer emission
factors](images\concepts\biogenic_seasons_html.jpg)
:::
:::

In [Section 2.17, "Biogenic
processing"](ch02s17.html "2.17. Biogenic processing") we describe the
SMOKE programs that are needed for each of these processing types for
BEIS3 processing, and additional details about what activities are
accomplished during each step.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------- -------------------- ----------------------------------------------
  [Prev](ch02s08s02.html)           [Up](ch02s08.html)                         [Next](ch02s08s04.html)
  2.8.2. Area-source processing     [Home](index.html)     2.8.4. Mobile-source processing using MOVES
  -------------------------------- -------------------- ----------------------------------------------
:::
::: {.navheader}
2.8.4. Mobile-source processing using MOVES
:::

[Prev](ch02s08s03.html) 

2.8. Area, biogenic, mobile, and point processing summaries

 [Next](ch02s08s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_mobile_source_processing_moves}2.8.4. Mobile-source processing using MOVES {#mobile-source-processing-using-moves .title}

</div>

</div>
:::

::: {.toc}
[[2.8.4.1. Special approach for on-road mobile MOVES
SCCs](ch02s08s04.html#sect_concepts_onroad_sccs)]{.section}

[[2.8.4.2. Fuel types in MOVES](ch02s08s04.html#d0e2551)]{.section}

[[2.8.4.3. MOVES Vehicle Types](ch02s08s04.html#d0e2604)]{.section}

[[2.8.4.4. MOVES Road Types](ch02s08s04.html#d0e2692)]{.section}

[[2.8.4.5. MOVES Process Types](ch02s08s04.html#d0e2760)]{.section}

[[2.8.4.6. Representative
Counties](ch02s08s04.html#sect_concepts_reference_counties_moves)]{.section}

[[2.8.4.7. Reference Fuel
month](ch02s08s04.html#sect_concepts_moves_reference_fuel_month)]{.section}

[[2.8.4.8. Meteorological Data
Processing](ch02s08s04.html#sect_concepts_moves_met_processing)]{.section}

[[2.8.4.9. MOVES Emission Processes by Emission Rate
Tables](ch02s08s04.html#sect_concepts_moves_emission_processes)]{.section}

[[2.8.4.10. MOVES Pollutant Groups](ch02s08s04.html#d0e3201)]{.section}
:::

SMOKE provides two ways of processing mobile sources using MOVES.
(Recall that by "[mobile sources]{.quote}" in SMOKE we mean on-road
mobile sources.) The first approach is to compute mobile emissions
values prior to running SMOKE and provide them to SMOKE as input; we
call this the precomputed-emissions approach. The second approach is to
provide SMOKE with VMT data, Vehicle population (VPOP) data, meteorology
data, and MOVES outputs, and have SMOKE compute the mobile emissions
based on these data; this is called the MOVES approach. These approaches
are not mutually exclusive, so it is possible to provide both
precomputed emissions and VMT and VPOP data to SMOKE and have the system
compute only some of the emissions using MOVES outputs. Both processing
approaches can produce criteria, particulate, and toxics emissions
results.

The precomputed-emissions approach is quite similar to the processing
method for area sources. In fact, [Figure 2.8, "Base case area-source
processing
steps"](ch02s08s02.html#fig_concepts_area_base "Figure 2.8. Base case area-source processing steps"),
[Figure 2.9, "Future- or past-year growth and optional control
area-processing
steps"](ch02s08s02.html#fig_concepts_area_growth "Figure 2.9. Future- or past-year growth and optional control area-processing steps"),
and [Figure 2.10, "Alternative future- or past-year growth and control
area-processing
steps"](ch02s08s02.html#fig_concepts_area_projection "Figure 2.10. Alternative future- or past-year growth and control area-processing steps")
from [Section 2.8.2, "Area-source
processing"](ch02s08s02.html "2.8.2. Area-source processing") show
exactly the processing steps needed for processing mobile sources using
SMOKE and the precomputed-emissions approach. As in base-case processing
for area sources, emissions in the inventory file are subdivided to
hourly emissions during temporal allocation, assigned chemical
speciation factors during speciation, and assigned spatial allocation
factors during gridding. The merge step combines the hourly emissions,
speciation matrix, and gridding matrix to create model-ready emissions.
For future- or past-year processing, the growth and controls step is
added to create the growth and control matrices, while the grow
inventory step converts the inventory from the base year to a future or
past year. The control matrix can be optionally used in the merge step
to apply control factors to the future- or past-year emissions. Note
that, unlike the VMT approach, in the precomputed-emissions approach
SMOKE will not model the variations in emissions caused by temperature,
humidity, or other meteorological settings.

The MOVES approach is much different from the precomputed-emissions
approach. [Figure 2.13, "MOVES mobile RatePerDistance processing
steps"](ch02s08s04.html#fig_concepts_mobile_moves_onroad "Figure 2.13. MOVES mobile RatePerDistance processing steps")
and [Figure 2.14, "MOVES mobile RatePerVehicle and RatPereProfile
(off-network) processing
steps"](ch02s08s04.html#fig_concepts_mobile_moves_offroad "Figure 2.14. MOVES mobile RatePerVehicle and RatPereProfile (off-network) processing steps")
summarize the MOVES approach. First, county total activity inventory VMT
data by road class and vehicle type or county total activity inventory
VPOP by vehicle type are input to SMOKE. The chemical speciation step
computes the chemical speciation factors for each county, road class,
vehicle type, emissions process (e.g., exhaust start, exhaust running,
evaporative processes, extended idle, and crankcase), and pollutant and
stores the necessary factors for this transformation. The gridding step
allocates the sources to grid cells and uses spatial surrogates to
allocate county-total emissions to grid cells, storing the emission
rates needed for these allocations based on hourly gridded ambient
temperature meteorology.

The approach for running MOVES for SMOKE relies on the concept of
representative counties and fuel months. The concept of representative
county refers to running MOVES for a single county, which is the
representative county, to represent itself and other counties that share
the same MOVES input parameters and thus have the same emission rates
for any given speed, temperature and humidity. A reference fuel month
similarly refers to a reference fuel month\'s MOVES run that contains
the temperatures that occur in neighboring months as well as the
representative month. The mapping of calendar months to a representative
month should be assigned on the basis of shared fuel parameters, because
it is the interaction of fuel and temperature that is important. For
example, an average-hourly temperature of 70°F may occur in some hour of
any day in each of four months: May, June, July and August. If those
four months share the same fuel properties (i.e. summer fuel) then an
emission factor will be determined for just the representative month,
reducing by a factor of four the number of calculations that MOVES needs
to perform.

Unlike MOBILE6, MOVES differentiates between on-roadway emission
processes and off-network emission processes. [Figure 2.13, "MOVES
mobile RatePerDistance processing
steps"](ch02s08s04.html#fig_concepts_mobile_moves_onroad "Figure 2.13. MOVES mobile RatePerDistance processing steps")
summarizes the approach used by MOVES for on-roadway mobile sources. The
on-roadway emission process includes county-total VMT and average speed
inventory as input. The off-network emission processes use the
county-total vehicle population by vehicle type as input. [Figure 2.14,
"MOVES mobile RatePerVehicle and RatPereProfile (off-network) processing
steps"](ch02s08s04.html#fig_concepts_mobile_moves_offroad "Figure 2.14. MOVES mobile RatePerVehicle and RatPereProfile (off-network) processing steps")
summarizes the approach used by MOVES for off-network mobile sources.
Both on-roadway and off-network emission processes do require real
gridded meteorology data from MCIP files to estimate
temperature-dependent emission rates.

::: {.figure}
[]{#fig_concepts_mobile_moves_onroad}

**Figure 2.13. MOVES mobile RatePerDistance processing steps**

::: {.mediaobject}
![MOVES mobile RatePerDistance processing
steps](images\concepts\mobile_moves_onroad_base_html.jpg)
:::
:::

::: {.figure}
[]{#fig_concepts_mobile_moves_offroad}

**Figure 2.14. MOVES mobile RatePerVehicle and RatPereProfile
(off-network) processing steps**

::: {.mediaobject}
![MOVES mobile RatePerVehicle and RatPereProfile (off-network)
processing steps](images\concepts\mobile_moves_offroad_base_html.jpg)
:::
:::

In sections later in this chapter, we describe the SMOKE programs that
are needed for each of the processing steps just described for MOVES
processed mobile sources, and additional details about what activities
are accomplished during each step. These sections are:

::: {.itemizedlist}
-   [Section 2.9, "Inventory
    import"](ch02s09.html "2.9. Inventory import")
-   [Section 2.10, "Temporal
    processing"](ch02s10.html "2.10. Temporal processing")
-   [Section 2.11, "Chemical speciation
    processing"](ch02s11.html "2.11. Chemical speciation processing")
-   [Section 2.12, "Spatial
    processing"](ch02s12.html "2.12. Spatial processing")
-   [Section 2.16, "Mobile-source processing with
    MOVES"](ch02s16.html "2.16. Mobile-source processing with MOVES")
-   [Section 2.19, "Creating model-ready emissions using MOVES lookup
    tables"](ch02s19.html "2.19. Creating model-ready emissions using MOVES lookup tables")
:::

Processing mobile sources involves a number of concepts that are unique
to mobile sources. These include a special classification of road types
in MOVES, SMOKE and MOVES vehicle types, emissions processes, MOVES
emission factors, representative counties, reference fuel months, and
meteorological processing using **Met4moves**. The following subsections
explain these topics in more detail.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_onroad_sccs}2.8.4.1. Special approach for on-road mobile MOVES SCCs {#special-approach-for-on-road-mobile-moves-sccs .title}

</div>

</div>
:::

SMOKE handles SCCs differently for on-road mobile sources compared with
all other source categories. SMOKE programs assume that on-road mobile
SCCs have the following form:

::: {.informalfigure}
::: {.mediaobject}
![](images\concepts\scc_mobile_html.jpg)
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e2551}2.8.4.2. Fuel types in MOVES {#fuel-types-in-moves .title}

</div>

</div>
:::

MOVES can model six different fuel types: Gasoline, Diesel, Compressed
Natural Gas (CNG), Liquefied Petroleum Gas (LPG), Ethanol, and
Electricity. [Table 2.2, "MOVES Fuel
Type"](ch02s08s04.html#tbl_concepts_moves_fuel "Table 2.2. MOVES Fuel Type")
indicates a list of original MOVES fuel types.

::: {.table}
[]{#tbl_concepts_moves_fuel}

**Table 2.2. MOVES Fuel Type**

  MOVES Fuel Type   Description
  ----------------- -------------------------------
  01                Gasoline
  02                Diesel
  03                Compressed Natural Gas (CNG)
  04                Liquefied Petroleum Gas (LPG)
  05                Ethanol (E-85)
  09                Electricity
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e2604}2.8.4.3. MOVES Vehicle Types {#moves-vehicle-types .title}

</div>

</div>
:::

The vehicle types used in SMOKE's on-road mobile source processing are
described in [Table 2.3, "MOVES Vehicle type codes and
descriptions"](ch02s08s04.html#tbl_concepts_vehicle_types "Table 2.3. MOVES Vehicle type codes and descriptions").

::: {.table}
[]{#tbl_concepts_vehicle_types}

**Table 2.3. MOVES Vehicle type codes and descriptions**

  MOVES Vehicle Type   Description
  -------------------- ------------------------------
  11                   Motorcycle
  21                   Passenger Car
  31                   Passenger Truck
  32                   Light Commercial Truck
  41                   Intercity Bus
  42                   Transit Bus
  43                   School Bus
  51                   Refuse Truck
  52                   Single Unit Short-haul Truck
  53                   Single Unit Long-haul Truck
  54                   Motor Home
  61                   Combination Short-haul Truck
  62                   Combination Long-haul Truck
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e2692}2.8.4.4. MOVES Road Types {#moves-road-types .title}

</div>

</div>
:::

MOVES can model nine different road types: rural restricted/unrestricted
access with ramps, rural restricted/unrestricted access without ramps,
urban restricted/unrestricted access with ramps, urban
restricted/unrestricted access without ramps, and off-network
([Table 2.4, "Road class and corresponding MOVES road
type"](ch02s08s04.html#tbl_concepts_moves_roads "Table 2.4. Road class and corresponding MOVES road type")).

::: {.table}
[]{#tbl_concepts_moves_roads}

**Table 2.4. Road class and corresponding MOVES road type**

  MOVES Road Type   Description
  ----------------- --------------------------------
  01                Off-Network
  02                Rural Restricted Access
  03                Rural Unrestricted Access
  04                Urban Restricted Access
  05                Urban Unrestricted Access
  06                Rural Restricted without Ramps
  07                Urban Restricted without Ramps
  08                Rural Restricted only Ramps
  09                Urban Restricted only Ramps
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e2760}2.8.4.5. MOVES Process Types {#moves-process-types .title}

</div>

</div>
:::

MOVES can model 14 different process types: including on-roadway and
off-network emissions processes, for the selected pollutants.
Off-network emission processes (e.g., parked engine-off, engine starts,
and idling, and fuel vapor venting in MOVES ([Table 2.5, "Process types
and corresponding MOVES road
type"](ch02s08s04.html#tbl_concepts_moves_proc "Table 2.5. Process types and corresponding MOVES road type")).

::: {.table}
[]{#tbl_concepts_moves_proc}

**Table 2.5. Process types and corresponding MOVES road type**

  MOVES Process   Description
  --------------- -----------------------------------
  01              Running Exhaust
  02              Start Exhaust
  09              Brakewear
  10              Tirewear
  11              Evaporative Permeation
  12              Evaporative Fuel Vapor Venting
  13              Evaporative Fuel Leaks
  15              Crankcase Running Exhaust
  16              Crankcase Start Exhaust
  17              Crankcase Extended Idle Exhaust
  18              Refueling Displacement Vapor Loss
  19              Refueling Spillage Loss
  90              Extended Idle Exhaust
  91              Auxiliary Power Exhaust
  99              Well-to-Pump
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_reference_counties_moves}2.8.4.6. Representative Counties {#representative-counties .title}

</div>

</div>
:::

The approach for running MOVES for SMOKE relies on the concept of
representative counties. These are counties that are used during the
creation and use of emission rates to represent a set of similar
counties (i.e., inventory counties) called a county group. The purpose
of the representative county approach is to reduce the computational
burden of running MOVES on every county in your modeling domain. By
using a represenative county, the user generates key emission rates for
the single county in MOVES and then utilizes these factors to estimate
emissions for all counties in the county group through SMOKE. The
representative county is modeled at a range of speeds and temperatures
to produce emission rate lookup tables (grams/mile or
grams/vehicle/hour, depending on mobile emission process). The variables
that are assumed to be constant across the county group members (and the
representative county) are fuel parameters, fleet age distribution and
inspection/maintenance (I/M) programs. The variables that can vary
within the county group are vehicle miles traveled (VMT), source type
vehicle population, roadway speed, and grid cell temperatures.
Determining the representative counties and their respective county
groups is a key aspect of utilizing the SMOKE-MOVES tool. It is ideal
for the user to create each county group based on the similarity between
the county characteristics (e.g., urban and rural) and the
meteorological conditions (e.g., temperature and relative humidity). The
user should avoid grouping counties that have significantly different
meteorological conditions.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_moves_reference_fuel_month}2.8.4.7. Reference Fuel month {#reference-fuel-month .title}

</div>

</div>
:::

Along with the concept of representative county approach, the concept of
a fuel month is very important. It is used to indicate when a particular
set of fuel properties should be used in a MOVES simulation. Similar to
the representative county, the fuel month reduces the computational time
of MOVES by using a single month to represent a set of months. To
determine the fuel month and which months it corresponds to, the user
should review the State-provided fuel supply data in the MOVES database
for each representative county. If the fuel supply data change
throughout the year, then group the months by fuel parameters. For
example, if the grams/mile exhaust emission rates in January are
identical to February\'s rates for a given representative county, then
use a single fuel month to represent January and February. In other
words, only one of the months needs to be modeled through MOVES.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_moves_met_processing}2.8.4.8. Meteorological Data Processing {#meteorological-data-processing .title}

</div>

</div>
:::

The meteorological data processor program **Met4moves** prepares
spatially and temporally averaged temperatures and relative humidity
data to set up the meteorological input conditions for MOVES and SMOKE
using the Meteorology-Chemistry Interface Processor (MCIP) output files.

[**Met4moves**](ch06s07.html "6.7. Met4moves") must be run after MCIP
and before the MOVES Driver script **"[Runspec\_generator.pl]{.quote}"**
and SMOKE modeling system.

The following are the major processing steps that **Met4moves**
performs:

::: {.itemizedlist}
-   Read the representative county cross-reference file
    [`MCXREF`{.envar}](ch08s09s02.html#sect_input_mcxref "8.9.2.1.3. MCXREF: Mobile representative county cross-reference file")
    that contains a list of representative counties and the county
    groups that map to those representative counties.

-   Read the surrogate description file
    [`SRGDESC`{.envar}](ch08s04.html#sect_input_srgdesc "8.4.1. SRGDESC: Surrogate Designation, Description and Surrogate profile filename.")
    and a list of associated spatial surrogate(s) chosen for use in
    selecting grid cells.

-   Determine a list of grid cells for each county. Only the selected
    grid cells are used to estimate the min/max temperatures, 24-hour
    temperature profiles, and RH over the user-specified modeling
    period.

-   Set the dates of the modeling episode in local time using the flags
    `STDATE`{.envar} and `ENDATE`{.envar}

-   Determine the fuel month for the representative county using the
    [`MFMREF`{.envar}](ch08s09s02.html#sect_input_mfmref "8.9.2.1.5. MFMREF: Mobile fuel month file for MOVES")
    input file.

-   Read the country/state/county
    [`COSTCY`{.envar}](ch08s10s02.html "8.10.2. COSTCY: Country, state, and county names and data")
    or
    [`GEOCODE_LEVEL[1-4]`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")
    (if USE\_EXP\_GEOCODES Y) file to define the time zones for county
    groups.

-   Read the meteorology data that have been processed by MCIP.

-   Calculate the min/max temperatures hourly and over the modeling
    period.

-   Calculate average RH for the specified hour range over the modeling
    period.

-   Once min/max temperatures and averaged RH are estimated for all
    representative counties and all inventory counties in the county
    groups, estimate diurnal 24-hour temperature profiles for use by the
    MOVES Driver script. The result is a normalized 24-hour shape
    profile over the user-specified period or fuel month.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_concepts_moves_emission_processes}2.8.4.9.  MOVES Emission Processes by Emission Rate Tables {#moves-emission-processes-by-emission-rate-tables .title}

</div>

</div>
:::

When the MOVES model runs for SMOKE, it runs for all emissions processes
(or modes), including on-roadway and off-network emissions processes,
for the selected pollutants. Off-network emission processes (e.g.,
parked engine-off, engine starts, and idling, and fuel vapor venting) in
MOVES are hour-dependent due to vehicle activity assumptions built into
the MOVES model; the emission rate depends on both hour of the day and
temperature. On-roadway emission processes (e.g., running exhaust,
crankcase running exhaust, brake wear, tire wear, and on-road
evaporative), on the other hand, do not depend on hour. In MOVES, these
emission processes are categorized into three major groups:

::: {.itemizedlist}
-   [**RatePerDistance (RPD) -** ]{.bold}The emission rate of on-roadway
    vehicles (i.e., driving) from MOVES. The rate is expressed in
    grams/mile traveled.
-   [**RatePerVehicle (RPV) -** ]{.bold}The emission rate of vehicles
    off-network (e.g., idling, starts, refueling, parked) from MOVES.
    The rate is given in grams/vehicle/hour.
-   [**RatePerProfile (RPP) -** ]{.bold}The emission rate of vehicles
    off-network specifically, the evaporation from parked vehicles
    (vapor-venting emissions) from MOVES. The rate is expressed in
    grams/vehicle/hour.
-   [**RatePerHour (RPH) -** ]{.bold}The emission rate of extended idle
    exhaust from on-roadway vehicle. The rate is expressed in grams/hour
    traveled.
:::

MOVES emission rates are organized into four lookup tables (RPD, RPV,
RPP, RPH), depending on emission process and whether the vehicle is
parked or in motion. The approach to running MOVES for SMOKE is unique
for each emission rate table listed in [Table 2.6, "MOVES Emission
Processes by Emission Rate
Tables"](ch02s08s04.html#tbl_concepts_moves_emission_rate_tbl "Table 2.6. MOVES Emission Processes by Emission Rate Tables").
A complete inventory must use the emission rates from all three tables.
Note that refueling emission process is not a subject to MOVES emission
rate table approach yet.

::: {.table}
[]{#tbl_concepts_moves_emission_rate_tbl}

**Table 2.6. MOVES Emission Processes by Emission Rate Tables**

MOVES Lookup Table
:::
:::
:::

Units

Emissions Process

RatePerDistance (RPD)

Grams/mile

  ----------------------------------------
  Running Exhaust
  Crankcase Running Exhaust
  Tire Wear
  Brake Wear
  On-road Evaporative Permeation
  On-road Evaporative Fuel Leaks
  On-road Evaporative Fuel Vapor Venting
  ----------------------------------------

RatePerVehicle (RPV)

Grams/vehicle/hour

  ------------------------------------
  Start Exhaust
  Crankcase Start Exhaust
  Off-network Evaporative Permeation
  Off-network Evaporative Fuel Leaks
  Crankcase Extended Idle Exhaust
  Extended Idle Exhaust
  ------------------------------------

RatePerProfile (RPP)

Grams/vehicle/hour

Off-network Evaporative Fuel Vapor Venting

RatePerHour (RPH)

Grams/hour

On-roadway Extended Idle Exhaust

[*The RPD lookup table*]{.emphasis} is used to provide estimates of
on-roadway emissions processes from mobile sources, using a separate
file for each representative county. The on-road running processes that
appear in this table include running exhaust, crankcase running exhaust,
brake wear, tire wear, on-road evaporative permeation, on-road
evaporative fuel leaks, and on-road evaporative vapor venting. The units
of the emission rates in this table are grams/mile. The lookup fields
for the factors are temperature and average speed. There are 16 set
speed bins defined in [Table 2.7, "MOVES Default Speed
Bins"](ch02s08s04.html#tbl_moves_speed_bins "Table 2.7. MOVES Default Speed Bins")
(i.e., avgSpeedBinID 1=2.5mph, 2=5mph, 3=10mph, ...16=75mph). The
avgBinSpeed is used for interpolation in the RPD table.

[*The RPV lookup table*]{.emphasis} is used to provide estimates of
off-network emission processes (parked engine-off, engine starts, and
idling), except for the evaporative off-network vapor venting emissions
process. A separate file is provided for each representative county. The
off-network emission processes include start exhaust, crankcase start
exhaust, off-network evaporative permeation, off-network evaporative
fuel leaks, extended idle exhaust, and crankcase extended idle exhaust.
Fuel month, temperature, and local hour are the lookup fields in this
table, and hours are in the local time of the modeling county. The units
of the emission rates are grams/vehicle/hour. Note: Although the units
are grams/vehicle/hour, the number of vehicles (i.e., population) should
not be temporally allocated to hours in SMOKE. Instead, a county total
of vehicle population should be multiplied by emission rates at any
given hour. The number of starts per vehicle by hour is already
accounted for in the MOVES lookup table.

[*The RPP table*]{.emphasis} is used only to estimate emissions for
off-network fuel vapor venting when the vehicle is parked. This process
type includes diurnal (when the vehicle is parked during the day) and
hot soak (immediately after a trip when the vehicle parks) emissions
types. The process depends on the rate of rise in temperature and the
maximum temperature achieved during the day for the diurnal emissions
type, and on the hourly temperatures for the hot soak emission type. The
lookup fields for this table are reference fuel month and hour of day.
As with the RPV table, the units of the emission rates are
grams/vehicle/hour. The estimated emissions rates need to be multiplied
by the county vehicle population. The representative county lookup
tables contain 24-hour emission rates per hour per vehicle using a
representative county temperature profile with different minimum and
maximum temperatures. The average day county emissions are determined by
interpolating between the minimum and maximum temperatures for the
modeling county generated by **Met4moves**. [Section 2.8.4.8,
"Meteorological Data
Processing"](ch02s08s04.html#sect_concepts_moves_met_processing "2.8.4.8. Meteorological Data Processing")
summarizes how **Met4moves** processes meteorological data for both
MOVES and SMOKE.

[*The RPH table*]{.emphasis} is used only to estimate emissions for
on-roadway extended idle exhaust process from mobile sources, using a
separate file for each representative county.

::: {.table}
[]{#tbl_moves_speed_bins}

**Table 2.7. MOVES Default Speed Bins**

   avgSpeedBinId   avgBinSpeed        AvgSpeedBinDesc
  --------------- ------------- ----------------------------
         1             2.5            speed \< 2.5mph
         2              5         2.5mph ≤ speed \< 7.5mph
         3             10        7.5mph ≤ speed \< 12.5mph
         4             15        12.5mph ≤ speed \< 17.5mph
         5             20        17.5mph ≤ speed \< 22.5mph
         6             25        22.5mph ≤ speed \< 27.5mph
         7             30        27.5mph ≤ speed \< 32.5mph
         8             35        32.5mph ≤ speed \< 37.5mph
         9             40        37.5mph ≤ speed \< 42.5mph
        10             45        42.5mph ≤ speed \< 47.5mph
        11             50        47.5mph ≤ speed \< 52.5mph
        12             55        52.5mph ≤ speed \< 57.5mph
        13             60        57.5mph ≤ speed \< 62.5mph
        14             65        62.5mph ≤ speed \< 67.5mph
        15             70        67.5mph ≤ speed \< 72.5mph
        16             75             72.5mph ≤ speed
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e3201}2.8.4.10. MOVES Pollutant Groups {#moves-pollutant-groups .title}

</div>

</div>
:::

The following [Table 2.8, "MOVES Pollutant
Groups"](ch02s08s04.html#tbl_concepts_moves_pollutant_groups "Table 2.8. MOVES Pollutant Groups")
provides a list of available MOVES pollutant groups that the user can
specify to model within MOVES. The choice of pollutant groups(s)
determines what pollutants are included in the three emission rate
lookup tables (RPD, RPV, and RPP) output by MOVES. The letter \'X\'
marks the key pollutants for inclusion, and a letter \'d\' signifies
that the pollutant is included as a default in the MOVES run because a
key pollutant depends on it. The user modifies the
[control.in](ch08s09s02.html#sect_input_runctlfile "8.9.2.2.1. Run Control File for MOVES Driver Script")
input file to specify the pollutant group.

::: {.table}
[]{#tbl_concepts_moves_pollutant_groups}

**Table 2.8. MOVES Pollutant Groups**

pollutantID
:::
:::

pollutantName

Pollutant Group

Ozone

Toxics

PM

GHG

1

Total Gaseous Hydrocarbons

d

d

d

 

79

Non-Methane Hydrocarbons

d

d

d

 

80

Non-Methane Organic Gases

d

d

d

 

86

Total Organic Gases

X

X

X

 

87

Volatile Organic Compounds

X

X

X

 

2

Carbon Monoxide (CO)

X

 

 

 

3

Oxides of Nitrogen

X

 

X

 

30

Ammonia (NH3)

 

 

X

 

32

Nitrogen Oxide

X

 

X

 

33

Nitrogen Dioxide

X

 

X

 

31

Sulfur Dioxide (SO2)

 

 

X

 

100

Primary Exhaust PM10 - Total

 

d

X

 

101

Primary PM10 - Organic Carbon

 

d

X

 

102

Primary PM10 - Elemental Carbon

 

d

X

 

105

Primary PM10 - Sulfate Particulate

 

d

X

 

106

Primary PM10 - Brakewear Particulate

 

 

X

 

107

Primary PM10 - Tirewear Particulate

 

 

X

 

110

Primary Exhaust PM2.5 - Total

 

 

X

 

111

Primary Exhaust PM2.5 - Organic Carbon

 

 

X

 

112

Primary Exhaust PM2.5 - Elemental Carbon

 

 

X

 

115

Primary Exhaust PM2.5 - Sulfate Particulate

 

 

X

 

116

Primary Exhaust PM2.5 - Brakewear Particulate

 

 

X

 

117

Primary Exhaust PM2.5 - Tirewear Particulate

 

 

X

 

91

Total Energy Consumption

 

d

d

X

92

Petroleum Energy Consumption

 

 

 

X

93

Fossil Fuel Energy Consumption

 

 

 

X

5

Methane (CH4)

d

d

d

X

6

Nitrous Oxide (N2O)

 

 

 

X

90

Atmospheric CO2

 

 

 

X

98

CO2 Equivalent

 

 

 

X

20

Benzene

 

X

X

 

21

Ethanol

 

 

 

 

22

MTBE

 

X

 

 

23

Naphthalene

 

X

 

 

24

1,3-Butadiene

 

X

 

 

25

Formaldehyde

 

X

 

 

26

Acetaldehyde

 

X

 

 

27

Acrolein

 

X

 

 

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------ -------------------- ---------------------------------
  [Prev](ch02s08s03.html)               [Up](ch02s08.html)            [Next](ch02s08s05.html)
  2.8.3. Biogenic-source processing     [Home](index.html)     2.8.5. Point-source processing
  ------------------------------------ -------------------- ---------------------------------
:::
::: {.navheader}
2.8.5. Point-source processing
:::

[Prev](ch02s08s04.html) 

2.8. Area, biogenic, mobile, and point processing summaries

 [Next](ch02s09.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_point_source_processing}2.8.5. Point-source processing {#point-source-processing .title}

</div>

</div>
:::

::: {.toc}
[[2.8.5.1. Flexible source
definitions](ch02s08s05.html#d0e3756)]{.section}

[[2.8.5.2. Stack parameters](ch02s08s05.html#d0e3810)]{.section}

[[2.8.5.3. Day-specific and hour-specific
emissions](ch02s08s05.html#d0e3825)]{.section}

[[2.8.5.4. Different approaches for elevated sources for different
AQMs](ch02s08s05.html#d0e3842)]{.section}

[[2.8.5.5. Wild and prescribed fires point
sources](ch02s08s05.html#d0e3857)]{.section}
:::

Point-source emissions processing in SMOKE focuses on converting annual,
daily, or hourly emissions to hourly, gridded model-ready emissions of
the chemical species used by an AQM. Recall that by "[point
sources]{.quote}" in SMOKE we mean point sources in the usual sense plus
wildfires with/without precomputed plumes. SMOKE processing may be
performed either with or without growth and control of emissions. SMOKE
can process both criteria and toxics inventories for point sources and
combine consistent criteria and toxics inventories in one run (as
explained in more detail in [Section 2.9.5, "Combine toxics and criteria
inventories"](ch02s09s05.html "2.9.5. Combine toxics and criteria inventories")).

Point-source processing can be performed using a CMAQ-based approach or
a UAM-based approach, as previously described in [Section 2.5.3,
"Model-ready files"](ch02s05s03.html "2.5.3. Model-ready files"). The
processing steps for CMAQ base-year processing are shown in
[Figure 2.15, "Base case point-source processing steps for the
CMAQ-based
approach"](ch02s08s05.html#fig_concepts_point_base_CMAQ "Figure 2.15. Base case point-source processing steps for the CMAQ-based approach").
In [Figure 2.4, "Parallel approach to emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing"),
we also included the major intermediate vectors and matrices; please
refer to that diagram for those details.

::: {.figure}
[]{#fig_concepts_point_base_CMAQ}

**Figure 2.15. Base case point-source processing steps for the
CMAQ-based approach**

::: {.mediaobject}
![Base case point-source processing steps for the CMAQ-based
approach](images\concepts\point_base_CMAQ_html.jpg)
:::
:::

The inventory import step reads the raw emissions data, screens them,
processes them, and converts the data to the SMOKE intermediate
inventory file (inventory vectors in [Figure 2.4, "Parallel approach to
emissions
processing"](ch02s07.html#fig_concepts_parallel_approach "Figure 2.4. Parallel approach to emissions processing")).
The import can optionally include day-specific and hour-specific data.
The emissions in the inventory file are subdivided to hourly emissions
during temporal allocation; assigned chemical speciation factors during
speciation, and assigned spatial allocation factors during gridding. The
plume-rise computation estimates vertical plume rise of emissions
sources and computes the fraction of emissions from the sources to go
into the model layers. The results of these steps are combined in a
merge step, which creates model-ready files for CMAQ.

Users may optionally choose to select specific sources to be elevated
sources and/or PinG sources. If this approach is taken, the selection
process can depend on daily-total emissions summed from the **Temporal**
output files. Hence, [Figure 2.15, "Base case point-source processing
steps for the CMAQ-based
approach"](ch02s08s05.html#fig_concepts_point_base_CMAQ "Figure 2.15. Base case point-source processing steps for the CMAQ-based approach")
shows that the elevated-source selection may optionally depend on the
output from the **Temporal** program. If elevated-source selection is
being included, the plume-rise computation uses that information to skip
the point sources that have not been selected as elevated. Thus, plume
rise is only computed for the elevated sources. The elevated-source
selection also provides its results to the merge step, which is where
the special PinG data files for CMAQ are created in addition to the 3-D
model-ready file.

[Figure 2.16, "Base case point-source processing steps for the UAM-based
approach"](ch02s08s05.html#fig_concepts_point_base_UAM "Figure 2.16. Base case point-source processing steps for the UAM-based approach")
describes base-case processing for the UAM-based approach. For this type
of modeling, the elevated-source selection step is required, and the
plume rise computation is not performed. Otherwise, the major processing
steps are the same as for the CMAQ-based approach.

::: {.figure}
[]{#fig_concepts_point_base_UAM}

**Figure 2.16. Base case point-source processing steps for the UAM-based
approach**

::: {.mediaobject}
![Base case point-source processing steps for the UAM-based
approach](images\concepts\point_base_UAM_html.jpg)
:::
:::

In [Figure 2.17, "Future- or past-year growth and control point-source
processing steps for the CMAQ-based
approach"](ch02s08s05.html#fig_concepts_point_growth_CMAQ "Figure 2.17. Future- or past-year growth and control point-source processing steps for the CMAQ-based approach"),
we show the point-source CMAQ-based processing steps for future- or
past-year processing. This processing is similar to the base-year
processing flow, except the growth and controls step in added to
calculate the growth and control matrices. The grow inventory step is
added to convert the inventory from the base year to a future or past
year. The control matrix can optionally be merged to apply control
factors to the future- or past-year emissions. The steps shown with
dotted lines represent steps that can be reused from the base-year
processing because they do not necessarily depend on any of the new
steps. However, if the elevated-source selection is to be performed
based on the grown emissions, then the elevated-source selection and
plume rise computation steps would need to be redone. Note that usually
the same elevated-source list is used in both the base- and future-year
modeling.

::: {.figure}
[]{#fig_concepts_point_growth_CMAQ}

**Figure 2.17. Future- or past-year growth and control point-source
processing steps for the CMAQ-based approach**

::: {.mediaobject}
![Future- or past-year growth and control point-source processing steps
for the CMAQ-based approach](images\concepts\point_growth_CMAQ_html.jpg)
:::
:::

Growth and control can also be used for UAM-based processing
([Figure 2.18, "Future- or past-year growth and control point-source
processing steps for the UAM-based
approach"](ch02s08s05.html#fig_concepts_point_growth_UAM "Figure 2.18. Future- or past-year growth and control point-source processing steps for the UAM-based approach")).
As with the other figures, the dotted lines indicate steps that may be
reused from the base-case processing. If the elevated-source selection
depends on the grown emissions then you will need to regenerate the
elevated-source list, though it is the usual practice in modeling to use
the same elevated-source list in both the base- and future-year
modeling. This allows the air quality modeling results to be more
comparable.

::: {.figure}
[]{#fig_concepts_point_growth_UAM}

**Figure 2.18. Future- or past-year growth and control point-source
processing steps for the UAM-based approach**

::: {.mediaobject}
![Future- or past-year growth and control point-source processing steps
for the UAM-based approach](images\concepts\point_growth_UAM_html.jpg)
:::
:::

As with area sources, you may apply many growth and control matrices at
the front end of processing. The area-source diagram for this approach
was provided as [Figure 2.10, "Alternative future- or past-year growth
and control area-processing
steps"](ch02s08s02.html#fig_concepts_area_projection "Figure 2.10. Alternative future- or past-year growth and control area-processing steps"),
and the point-source approach is quite similar, with the addition of the
elevated-source selection and plume rise computation steps.

In sections later in this chapter, we describe the SMOKE programs that
are needed for each of the processing steps just discussed and
additional details about what activities are accomplished during each
step. These sections are:

::: {.itemizedlist}
-   [Section 2.9, "Inventory
    import"](ch02s09.html "2.9. Inventory import")
-   [Section 2.10, "Temporal
    processing"](ch02s10.html "2.10. Temporal processing")
-   [Section 2.11, "Chemical speciation
    processing"](ch02s11.html "2.11. Chemical speciation processing")
-   [Section 2.12, "Spatial
    processing"](ch02s12.html "2.12. Spatial processing")
-   [Section 2.13, "Growth
    processing"](ch02s13.html "2.13. Growth processing")
-   [Section 2.14, "Control
    processing"](ch02s14.html "2.14. Control processing")
-   [Section 2.15, "Elevated-source
    processing"](ch02s15.html "2.15. Elevated-source processing")
-   [Section 2.18, "Creating model-ready
    emissions"](ch02s18.html "2.18. Creating model-ready emissions")
-   [Section 2.20, "Quality
    assurance"](ch02s20.html "2.20. Quality assurance")
:::

Point-source processing includes a number of additional features that
are not applicable for other SMOKE source categories:

::: {.orderedlist}
1.  Flexible source definitions
2.  Stack parameters
3.  Day- and hour-specific emissions
4.  Different approaches for elevated sources for different AQMs,
    including the use of PinG sources
5.  Elevated-source selection
6.  Wild and prescribed fires point sources
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e3756}2.8.5.1. Flexible source definitions {#flexible-source-definitions .title}

</div>

</div>
:::

::: {.toc}
[[2.8.5.1.1. Point definition header row in cross-reference
files](ch02s08s05.html#d0e3803)]{.section}
:::

Depending on the input format of the point-source emissions (e.g., FF10,
ORL), the set of characteristics that are used to uniquely identify a
point source can be different. For example, the ORL-formatted
inventories define a point source using a country, state, and county
code, an SCC, a plant identifier, a stack number, a point identifier,
and a segment number. The FF10 format, however, identifies a source
using a FIPS state/county code, a plant code, a unit ID, a segment ID,
and SCC. To better support the formats and be adaptable if new formats
are created in the future, SMOKE uses a flexible definition of point
sources. This definition consists of the following source
characteristics to uniquely define the sources:

::: {.itemizedlist}
-   Country, state, and county code

-   Plant ID (15 characters or less)

-   Characteristics 1 through 5 (each 15 characters or less)
:::

Depending on the input format, SMOKE assigns different variables from
the input format to the parts of the SMOKE point-source definition. The
assignments for the remaining characteristics are as follows:

[*ORL format:*]{.emphasis}

::: {.itemizedlist}
-   Char 1: Point ID
-   Char 2: Stack ID
-   Char 3: Segment ID
-   Char 4: SCC
-   Char 5: unused
:::

[*FF10 format:*]{.emphasis}

::: {.itemizedlist}
-   Char 1: Stack ID
-   Char 2: Unit ID
-   Char 3: Segment ID
-   Char 4: SCC
-   Char 5: unused
:::

The meaning of these source characteristics for a given inventory type
needs to be considered when cross-reference files are created, if
cross-reference entries other than state/county and SCC-specific entries
are provided.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#d0e3803}2.8.5.1.1. Point definition header row in cross-reference files {#point-definition-header-row-in-cross-reference-files .title}

</div>

</div>
:::

As just described, SMOKE uses a flexible definition of point sources.
This definition may or may not include the SCC (although SCC is always
at least a source attribute). Cross-reference files for point sources
can contain source-specific records, and they usually use the SCC to
perform the needed assignments during emissions processing. For the
files to be self-describing, they use a header that indicates the number
of characteristics in addition to the plant ID that are being used in
the cross-reference file. This number needs to be consistent with the
number of point-source characteristics used in the inventory files. In
addition, the header indicates which, if any, of the point-source
characteristics is the SCC. This header starts with the characters
/POINT DEFN/, and the files that use it describe it as part of the file
format definition in [Chapter 8, *SMOKE Input
Files*](ch08.html "Chapter 8. SMOKE Input Files").
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e3810}2.8.5.2. Stack parameters {#stack-parameters .title}

</div>

</div>
:::

Several of the source attributes for point sources are stack parameters
- specifically, the stack height, stack diameter, and the stack flue gas
exit temperature, velocity, and flow rate. SMOKE can use hourly data for
the stack flue gas exit temperature, velocity, and flow rate when using
the CMAQ-based approach to modeling with SMOKE computing hourly plume
rise. The hourly stack parameters cannot be used when modeling using a
UAM-based elevated-point-source approach.

During the **Smkinven** program's import of the stack parameters from
the annual or average-day inventory file (i.e., not the hourly stack
parameters), SMOKE needs to read or assign stack parameters for all
point sources. [Section 2.9.9, "Fill in and check point-source stack
parameters"](ch02s09s09.html "2.9.9. Fill in and check point-source stack parameters")
explains in greater detail what the **Smkinven** program does with stack
parameters. The hourly stack parameters are read in without modification
or adjustment.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e3825}2.8.5.3. Day-specific and hour-specific emissions {#day-specific-and-hour-specific-emissions .title}

</div>

</div>
:::

Emissions from point sources are sometimes available as day- or
hour-specific values. **Smkinven** can import the day- and hour-specific
data, and it can also convert the hour-specific data to hour-specific
temporal profiles. When these data are available, the **Temporal**
program overrides the annual or daily emissions with the most specific
data available. If day-specific data are available, **Temporal** uses
them to overwrite the annual or average-day emissions during the time
periods that these data are available. If hour-specific data are
available, **Temporal** uses them to overwrite the annual, average-day
emissions, or day-specific emissions data.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e3842}2.8.5.4. Different approaches for elevated sources for different AQMs {#different-approaches-for-elevated-sources-for-different-aqms .title}

</div>

</div>
:::

As introduced in [Section 2.5.3, "Model-ready
files"](ch02s05s03.html "2.5.3. Model-ready files"), there are two
different major approaches for creating emissions inputs to AQMs: the
CMAQ-based approach and the UAM-based approach. The two approaches
differ only on how point sources are being treated. In the CMAQ-based
approach, SMOKE calculates the plume rise using an algorithm based on a
Briggs plume rise formulation. SMOKE then includes the vertical
distribution of the point-source emissions in the 3-D model-ready file
for CMAQ. For the CMAQ model only, SMOKE can also create two special
PinG files: one to identify the sources, their locations, and their
stack parameters, and the other to provide the hour-specific emissions
for just these sources. In the UAM-based approach, SMOKE creates a
special elevated-point-source file that both identifies the elevated and
PinG sources and includes the hourly emissions values for those sources.

PinG sources are those sources that will be treated in greater detail by
the AQM. In simple terms, the AQMs preprocess the chemistry of the plume
emissions before those emissions are provided to the AQM grid cells and
layers. The intent of the PinG approach is to provide more accurate
modeling at and around very large point sources.

[Section 2.15, "Elevated-source
processing"](ch02s15.html "2.15. Elevated-source processing") describes
in greater detail the steps taken by SMOKE in the layer fraction
processing using a Briggs formulation and the elevated and PinG source
selection.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e3857}2.8.5.5. Wild and prescribed fires point sources {#wild-and-prescribed-fires-point-sources .title}

</div>

</div>
:::

You may also either provide either precomputed point-source plume rise
to SMOKE or internally compute plume rise using acres burned and fuel
loading of fires with both the CMAQ-based and UAM-based approaches to
modeling point sources. Precomputed plume rise point sources are called
explicit plume sources. This capability was implemented for modeling
wildfire sources as point sources in SMOKE using plume rise computed
with a different approach from the Briggs-based approach used for
stack-based plumes ([Section 4.4.17, "Plume Rise Calculation for
Fires"](ch04s04s17.html "4.4.17. Plume Rise Calculation for Fires")).
The input data for this approach are the fraction of emissions in layer
1, the bottom of the plume, and the top of the plume. SMOKE distributes
the emissions across the layers by weighting the emissions by the
pressure difference in each layer over the total pressure difference
between the top and bottom of the plume.

For the UAM-based modeling approach, the file format does not readily
allow you to provide precomputed plume rise; in fact, the entire premise
of the format is that the AQM will compute the plume rise. To enable you
to provide precomputed rise for the UAM-based modeling approach, the
**Smkmerge** program creates an ASCII elevated-point-source file with an
imaginary stack for each layer of each source (e.g., each wildfire). The
stack parameters of the imaginary stack are set to values that will
ensure a zero plume rise will be computed for the stack, and the x-y
location of the stacks are the same for all imaginary stacks
representing the same source. The emissions associated with the
imaginary stacks are provided based on the emissions values that are to
be entered in each layer for the source. The emissions for layer 1 are
written in the point-source file to the imaginary stack associated with
layer 1, and the same is done for all of the other layers. SMOKE uses a
zero value for the imaginary stack when the emissions from a given
source are not in a layer for an hour or when the source stops (e.g.,
once a wildfire ends). While not particularly elegant, this approach
permits providing precomputed plume rise to the UAM-based models without
having to change those models.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------- -------------------- ------------------------
  [Prev](ch02s08s04.html)                         [Up](ch02s08.html)      [Next](ch02s09.html)
  2.8.4. Mobile-source processing using MOVES     [Home](index.html)     2.9. Inventory import
  ---------------------------------------------- -------------------- ------------------------
:::
::: {.navheader}
2.9. Inventory import
:::

[Prev](ch02s08s05.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s09s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_inventory_import}2.9. Inventory import {#inventory-import .title style="clear: both"}
--------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.9.1. Check the correctness and consistency of input file
formats](ch02s09.html#sect_concepts_check_inventory)]{.section}

[[2.9.2. Assign pollutant names to data input by code
numbers](ch02s09s02.html)]{.section}

[[2.9.3. Select pollutants from the input files for further SMOKE
processing](ch02s09s03.html)]{.section}

[[2.9.4. Check for duplicate records](ch02s09s04.html)]{.section}

[[2.9.5. Combine toxics and criteria
inventories](ch02s09s05.html)]{.section}

[[2.9.6. Sort the inventory](ch02s09s06.html)]{.section}

[[2.9.7. Aggregate or disaggregate toxics
emissions](ch02s09s07.html)]{.section}

[[2.9.8. Assign point-source locations to area
sources](ch02s09s08.html)]{.section}

[[2.9.9. Fill in and check point-source stack
parameters](ch02s09s09.html)]{.section}

[[2.9.10. Convert coordinates from UTM to
lat-lon](ch02s09s10.html)]{.section}

[[2.9.11. Optionally ensure that lat-lon coordinates are in the Western
Hemisphere](ch02s09s11.html)]{.section}

[[2.9.12. Convert units of emissions and
activities](ch02s09s12.html)]{.section}

[[2.9.13. Set the weekday averaging
approach](ch02s09s13.html)]{.section}

[[2.9.14. Assign country codes, years, and time
zones](ch02s09s14.html)]{.section}

[[2.9.15. Handle inventories that have data for multiple
years](ch02s09s15.html)]{.section}

[[2.9.16. Set the base year](ch02s09s16.html)]{.section}

[[2.9.17. Report results of import step](ch02s09s17.html)]{.section}

[[2.9.18. Import day-specific and hour-specific
data](ch02s09s18.html)]{.section}

[[2.9.19. Processing hour-specific CEM data](ch02s09s19.html)]{.section}
:::

The importing of emission inventory and related data is the first
processing step needed for any emissions processing effort. The
**Smkinven** program imports data for anthropogenic sources, and the
**Normbeis3** program imports BEIS3 land use data for biogenic sources.
In this section, we focus on the import of the anthropogenic inventories
using **Smkinven**. The biogenic import is further described in
[Section 2.17, "Biogenic
processing"](ch02s17.html "2.17. Biogenic processing").

**Smkinven** performs many types of activities during import of the
anthropogenic inventories. Though the primary purpose is reading the
data from ASCII formats and outputting and I/O API SMOKE intermediate
inventory, there are many other actions that need to be performed
duringthe inventory import stage of processing. These actions are the
following:

::: {.orderedlist}
1.  Check that the formats of the input files are correct and
    consistent, and ensure that all data can be read properly.

2.  Assign pollutant names to data input by code numbers.

3.  Select pollutants from the input files to keep for further SMOKE
    processing.

4.  When multiple files are provided, combine all annual and/or
    average-day data into aconsistent inventory. This includes checking
    for duplicates and possibly aborting, depending on program options
    set by the user.

5.  Combine toxics and criteria inventories, and eliminate duplicate
    mass using either an integrate or no-integrate approach.

6.  Sort the inventory records into the order expected by other SMOKE
    programs.

7.  Aggregate or disaggregate toxics emissions data as specified by user
    inputs.

8.  Assign point-source locations to area sources, when available.

9.  Fill in and check point-source stack parameters.

10. Convert stack locations from UTM to lat-lon.

11. Optionally ensure that lat-lon coordinates are in the Western
    Hemisphere.

12. Convert units of emissions and activities to the units used in the
    SMOKE intermediate inventory.

13. Set the weekday averaging approach.

14. Assign country codes and/or geographic codes
    (GEOCODE\_LEVEL\[1-4\]), years, and time zones.

15. Handle inventories that have data for multiple years.

16. Set the base year.

17. Report results of import including pollutant totals for toxics data
    and other information needed for quality assurance.

18. Import day-specific and hour-specific data, if available, and ensure
    that records in these files match inventory records provided in the
    annual or average-day inputs.
:::

In the following subsections, we describe what SMOKE does for each of
these activities.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_check_inventory}2.9.1. Check the correctness and consistency of input file formats {#check-the-correctness-and-consistency-of-input-file-formats .title}

</div>

</div>
:::

**Smkinven** can read the following ASCII formats for annual and
average-day inventory data:

::: {.itemizedlist}
-   [**ORL format:**]{.bold} This set of input formats is used for
    inputting point, nonpoint, on-road, and nonroad HAP emissions
    inventories, also called toxics emission inventories. There is a
    different ORL format for nonpoint, point, nonroad mobile, and
    on-road mobile sources.

-   [**List format:**]{.bold} This is the input format used to provide
    multiple files to **Smkinven** in a single run. This format is
    simply an ASCII file that contains a list of other files.

-   [**List GRID format:**]{.bold} This is the input format used to
    provide multiple global gridded emission inventory files to
    **Smkinven** in a single run. This format is simply an ASCII file
    that contains a list of other files. To support input of multiple
    pre-gridded NetCDF files, the keyword \#LIST GRID in the header of
    this file will switch SMOKE into gridded inventory processing mode.
    This approach is described more in [Section 2.8.2.2, "Pre-gridded
    Emissions"](ch02s08s02.html#sect_concepts_pregridded_data "2.8.2.2. Pre-gridded Emissions")

-   [**Gridded I/O API format:**]{.bold} This format is a gridded I/O
    API file for allowing the import of pregridded data from the same
    modeling domain. This approach is described more in
    [Section 2.8.2.2, "Pre-gridded
    Emissions"](ch02s08s02.html#sect_concepts_pregridded_data "2.8.2.2. Pre-gridded Emissions").
:::

**Smkinven** ensures that all file formats provided to SMOKE are correct
and include the required data fields. The formats and their required
fields are provided in [Chapter 8, *SMOKE Input
Files*](ch08.html "Chapter 8. SMOKE Input Files").
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------- -------------------- --------------------------------------------------------------
  [Prev](ch02s08s05.html)             [Up](ch02.html)                                           [Next](ch02s09s02.html)
  2.8.5. Point-source processing     [Home](index.html)     2.9.2. Assign pollutant names to data input by code numbers
  --------------------------------- -------------------- --------------------------------------------------------------
:::
::: {.navheader}
2.9.2. Assign pollutant names to data input by code numbers
:::

[Prev](ch02s09.html) 

2.9. Inventory import

 [Next](ch02s09s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_assign_pollutant_names}2.9.2. Assign pollutant names to data input by code numbers {#assign-pollutant-names-to-data-input-by-code-numbers .title}

</div>

</div>
:::

The ORL format use code numbers (usually Chemical Abstracts Service
\[CAS\] numbers) to distinguish which chemical compound or inventory
pollutant is provided on each line of the file. **Smkinven** matches
these numbers with the CAS numbers from an inventory table
(`INVTABLE`{.envar}) file, described in [Section 8.10.4,
"`INVTABLE`{.envar}: Inventory
table"](ch08s10s04.html "8.10.4. INVTABLE: Inventory table"). The CAS
number does not necessarily have to be a valid CAS number; it can be any
number as long as there is a match between the numbers in the ORL file
and the inventory table. The inventory table provides the inventory data
names, such as the pollutant names that SMOKE uses in the remaining
processing steps. Note that the SMOKE inventory pollutants may not be
identical to the pollutants in the inventory fed to SMOKE because of the
aggregation/disaggregation that is performed by **Smkinven** (see
[Section 2.9.7, "Aggregate or disaggregate toxics
emissions"](ch02s09s07.html "2.9.7. Aggregate or disaggregate toxics emissions")
for more information).

For toxics processing, if multiple inventory data names apply for the
same CAS number, the Factor column of `INVTABLE`{.envar} will contain
the split factor used by **Smkinven** to disaggregate the emissions from
that CAS number to multiple inventory data values. If multiple CAS
numbers apply for the same pollutant name, then **Smkinven** will sum
these emissions, but will not report duplicate records unless there are
indeed duplicates in the inventory file. This is described more fully in
[Section 2.9.7, "Aggregate or disaggregate toxics
emissions"](ch02s09s07.html "2.9.7. Aggregate or disaggregate toxics emissions").
Duplicate reporting is described more in [Section 2.9.4, "Check for
duplicate
records"](ch02s09s04.html "2.9.4. Check for duplicate records").

The use of the inventory data name as the unique pollutant identifier in
SMOKE differs from the approach of EMS-HAP, in which the SAROAD code is
the unique identifier for the pollutants to be modeled. Because we
anticipated that some toxics pollutants that do not have unique SAROAD
codes (e.g., divalent particulate mercury) would need to be modeled
explicitly, we did not want to take this approach. If we had, the user
would have been required to create fake and unique SAROAD codes to be
able to model these emissions explicitly.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------ -------------------- -----------------------------------------------------------------------------
  [Prev](ch02s09.html)      [Up](ch02s09.html)                                                        [Next](ch02s09s03.html)
  2.9. Inventory import     [Home](index.html)     2.9.3. Select pollutants from the input files for further SMOKE processing
  ------------------------ -------------------- -----------------------------------------------------------------------------
:::
::: {.navheader}
2.9.3. Select pollutants from the input files for further SMOKE
processing
:::

[Prev](ch02s09s02.html) 

2.9. Inventory import

 [Next](ch02s09s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4027}2.9.3. Select pollutants from the input files for further SMOKE processing {#select-pollutants-from-the-input-files-for-further-smoke-processing .title}

</div>

</div>
:::

In version 1.5 and higher of SMOKE, users can specify the valid data
(pollutants and activities) using the inventory table discussed in
[Section 8.10.4, "`INVTABLE`{.envar}: Inventory
table"](ch08s10s04.html "8.10.4. INVTABLE: Inventory table"), as
described in [Section 2.9.2, "Assign pollutant names to data input by
code
numbers"](ch02s09s02.html "2.9.2. Assign pollutant names to data input by code numbers").
**Smkinven** will read only those entries that have a "[Y]{.quote}" (for
"[Yes]{.quote}") in the Keep column of the inventory table. If a
pollutant has an "[N]{.quote}" (for "[No]{.quote}") in the Keep column,
it will not be output to the SMOKE intermediate files, but will be
included in the inventory reports that **Smkinven** creates. If the
pollutant is not listed at all in the inventory table, it will be
dropped as well; **Smkinven** will also write a warning message and will
not include the pollutant in any reporting. It is a good work practice
for users to put all pollutants in the input inventory in the inventory
table even if it the pollutant will not be used for the AQM. Use of the
`INVTABLE`{.envar} file replaces the use of the `SIPOLS`{.envar} and
`ACTVNAMS`{.envar} files from previous versions of SMOKE.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------------------- -------------------- -------------------------------------
  [Prev](ch02s09s02.html)                                         [Up](ch02s09.html)                [Next](ch02s09s04.html)
  2.9.2. Assign pollutant names to data input by code numbers     [Home](index.html)     2.9.4. Check for duplicate records
  -------------------------------------------------------------- -------------------- -------------------------------------
:::
::: {.navheader}
2.9.4. Check for duplicate records
:::

[Prev](ch02s09s03.html) 

2.9. Inventory import

 [Next](ch02s09s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_check_duplicates}2.9.4. Check for duplicate records {#check-for-duplicate-records .title}

</div>

</div>
:::

In [Section 2.9.1, "Check the correctness and consistency of input file
formats"](ch02s09.html#sect_concepts_check_inventory "2.9.1. Check the correctness and consistency of input file formats"),
we explained that **Smkinven** ensures that the input files are correct
and that the same format is used. In addition, **Smkinven** checks for
duplicate records across the entire set of inventory input files. A
duplicate record is one that has the same source characteristics
(defined in [Section 2.8.1, "Summary of SMOKE processing
categories"](ch02s08.html#sect_concepts_summary_source_processing "2.8.1. Summary of SMOKE processing categories"))
and pollutants as another record in the inventory. **Smkinven** provides
an option that allows you to instruct **Smkinven** whether duplicates
should cause a warning message or an error. In some cases, you may not
expect duplicates in your inventory, in which case you can have
**Smkinven** abort after reporting all duplicates. In other cases, you
can instruct **Smkinven** to sum the emissions across all duplicate
records. See [Section 6.13,
"**Smkinven**"](ch06s13.html "6.13. Smkinven") for more information on
the different approaches.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------------------------------- -------------------- -------------------------------------------------
  [Prev](ch02s09s03.html)                                                        [Up](ch02s09.html)                            [Next](ch02s09s05.html)
  2.9.3. Select pollutants from the input files for further SMOKE processing     [Home](index.html)     2.9.5. Combine toxics and criteria inventories
  ----------------------------------------------------------------------------- -------------------- -------------------------------------------------
:::
::: {.navheader}
2.9.5. Combine toxics and criteria inventories
:::

[Prev](ch02s09s04.html) 

2.9. Inventory import

 [Next](ch02s09s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_combine_toxics}2.9.5. Combine toxics and criteria inventories {#combine-toxics-and-criteria-inventories .title}

</div>

</div>
:::

For point, nonpoint, on-road mobile, and nonroad-mobile sources, the
toxics inventory contains emissions for VOC pollutants that are provided
as explicit chemical compounds (for example, benzene). These same VOC
emissions are also included as an aggregated VOC value in the criteria
emissions inventory. To use these inventories together, **Smkinven**
provides the necessary options to ensure that double counting of VOC
emissions will not occur. These two options are the
"[integrate]{.quote}" and "[no-integrate]{.quote}" options.

The "[integrate]{.quote}" option involves subtracting toxic VOC
emissions from the criteria VOC emissions to avoid double counting of
VOC when the emissions are speciated. With this option the user must
ensure that the sources in the toxics and criteria inventories match up
one-to-one, so that **Smkinven** can properly compute the emissions.

Note that in any discussion of the toxics inventory we have assumed that
all emissions are annual total emissions, because the toxics inventory
that is currently available does not include average-day emissions. We
have also assumed that the inventory contains VOC emissions, but the
same approach can be used to process TOG emissions.

During import of both toxics and criteria emission inventories, SMOKE
matches the area/nonpoint, on-road mobile, and nonroad mobile emission
inventories by country/state/county code and SCC. SMOKE also matches the
toxics and criteria records for the point sources, provided that the
point sources in the two inventories use identical fields for their
source characteristics. You are required to ensure that the source
characteristics for all source categories match between the two
inventories for any sources that you wish to have matched. Once they are
matched, SMOKE will have both a criteria VOC emissions value and toxics
emission values for individual VOC chemical compounds.

SMOKE can optionally compute a NONHAPVOC value by subtracting the sum of
toxics VOC from the criteria VOC value. This same approach can be used
to create a NONHAPTOG value if the inventory or MOVES (when processing
on-road mobile emissions using VMT data) uses a TOG value instead of a
VOC value. (We will not mention NONHAPTOG again, but it could be used to
replace NONHAPVOC throughout this section).

The case of computing NONHAPVOC is called the "[integrate]{.quote}" case
because it involves integration of the VOC mass between the criteria and
toxics inventories. Likewise, the case of not computing NONHAPVOC is
called the "[no-integrate]{.quote}" case. With the "[integrate]{.quote}"
approach, the NONHAPVOC mass and the toxics VOC mass are independent
from one another and will not double count emissions. The calculation
must be performed for each source, and **Smkinven** will set the
criteria VOC value to zero when it computes the NONHAPVOC value.
**Smkinven** determines which pollutants should be subtracted from VOC
using the "[VOC or TOG]{.quote}" column in the inventory table
(`INVTABLE`{.envar}) file.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------- -------------------- ----------------------------
  [Prev](ch02s09s04.html)                [Up](ch02s09.html)       [Next](ch02s09s06.html)
  2.9.4. Check for duplicate records     [Home](index.html)     2.9.6. Sort the inventory
  ------------------------------------- -------------------- ----------------------------
:::
::: {.navheader}
2.9.6. Sort the inventory
:::

[Prev](ch02s09s05.html) 

2.9. Inventory import

 [Next](ch02s09s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4146}2.9.6. Sort the inventory {#sort-the-inventory .title}

</div>

</div>
:::

When **Smkinven** reads an inventory, it also puts its sources into a
special sorted order prior to outputting the SMOKE intermediate
inventory files. All programs that read **Smkinven** outputs, which
includes most of the SMOKE programs, expect this order. The order is
determined by sorting the source characteristics listed in
[Section 2.8.1, "Summary of SMOKE processing
categories"](ch02s08.html#sect_concepts_summary_source_processing "2.8.1. Summary of SMOKE processing categories")
in ascending order. For example, area sources will be sorted in order of
increasing country/state/county code, and within a single
country/state/county code will be sorted in order of increasing SCC. In
[Figure 2.19, "Combining and sorting ASCII inputs to created sorted I/O
API
outputs"](ch02s09s06.html#fig_concepts_sort_inventory "Figure 2.19. Combining and sorting ASCII inputs to created sorted I/O API outputs"),
we show how the sorted order may be completely different from the order
of the files and records provided to **Smkinven**. The figure shows the
unsorted ASCII input files at left (provided to **Smkinven** by logical
files `ARINV`{.envar}, `MBINV`{.envar}, or `PTINV`{.envar}) and how the
records can be rearranged by **Smkinven** to create the sorted I/O API
output files (output from **Smkinven** as `AREA`{.envar},
`MOBL`{.envar}, or `PNTS`{.envar}). Each record in this diagram
represents a complete inventory record with all source characteristics,
source attributes, and emissions.

::: {.figure}
[]{#fig_concepts_sort_inventory}

**Figure 2.19. Combining and sorting ASCII inputs to created sorted I/O
API outputs**

::: {.mediaobject}
![Combining and sorting ASCII inputs to created sorted I/O API
outputs](images\concepts\sort_inventory_html.jpg)
:::
:::

Having this sorted order is important because the programs that depend
on **Smkinven** outputs also store their outputs in the same order.
However, these other programs (such as **Temporal** for temporal
allocation, **Spcmat** for chemical speciation, and **Grdmat** for
spatial allocation) store their records using the record numbers to
match their outputs with the **Smkinven** outputs. This means that the
source characteristics that are stored in the **Smkinven** outputs are
not also included in the outputs from **Temporal**, **Spcmat**,
**Grdmat** and other programs; these programs rely on the sorted order
in the **Smkinven** outputs not changing. This approach allows minimal
redundant data storage, this reducing disk space needs.

As explained previously, the records output from **Smkinven** are
vectors of emissions and source characteristics that make up the SMOKE
intermediate inventory files. Each record number in the file identifies
an element of the vector. The outputs from **Temporal** are also vectors
of hourly emissions. The record number in each hourly vector will match
the record number in the intermediate inventory files. The outputs from
**Spcmat** are a matrix of speciation factors, in which the record
numbers (rows of the matrix) will match the record numbers of the
intermediate inventory files. The columns of the matrix are each valid
pollutant-to-species transformations. The outputs from **Grdmat** are a
sparse matrix, but again the rows of the matrix match the rows of the
intermediate inventory file. Therefore, assignment of factors is a
simple matter of selecting the same record number from the **Smkinven**
output files; this is in fact one part of the vector-matrix
multiplication used by SMOKE.

It is important to remember this sorted-order approach when you have run
an inventory through all of the programs once, and then want to change
your inventory and re-import the data with **Smkinven**. For the
re-importing and subsequent rerun, if any source characteristics in the
inventory change, or if any sources are added or removed, then the
number and/or order of the output sources in the new **Smkinven**
outputs will be different. This means that the outputs from all
processing steps that depend on the **Smkinven** outputs will need to be
rerun.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------- -------------------- ----------------------------------------------------
  [Prev](ch02s09s05.html)                            [Up](ch02s09.html)                               [Next](ch02s09s07.html)
  2.9.5. Combine toxics and criteria inventories     [Home](index.html)     2.9.7. Aggregate or disaggregate toxics emissions
  ------------------------------------------------- -------------------- ----------------------------------------------------
:::
::: {.navheader}
2.9.7. Aggregate or disaggregate toxics emissions
:::

[Prev](ch02s09s06.html) 

2.9. Inventory import

 [Next](ch02s09s08.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_aggregate_toxics}2.9.7. Aggregate or disaggregate toxics emissions {#aggregate-or-disaggregate-toxics-emissions .title}

</div>

</div>
:::

**Smkinven** also supports aggregation and disaggregation of toxics
inventory pollutants to match the input needs for AQMs. There are two
components of this aggregation and disaggregation. The first involves
what to do during inventory import to resolve discrepancies between the
inventory content and what data are most useful for further processing
through SMOKE; this topic is addressed in this subsection. The second
issue is conversion of the toxics inventory to the species needed by the
AQM, which is handled by the **Spcmat** program in SMOKE, as described
in [Section 2.11, "Chemical speciation
processing"](ch02s11.html "2.11. Chemical speciation processing").

**Smkinven** uses the inventory table (`INVTABLE`{.envar}) file to
determine what aggregation and disaggregation are needed. The
`INVTABLE`{.envar} file can have both multiple pollutant names per CAS
number and multiple CAS numbers per pollutant name. In the first case,
**Smkinven** disaggregates the emissions to two or more pollutants using
the number provided in the "[Factor]{.quote}" column of the
`INVTABLE`{.envar} file. In the second case, **Smkinven** combines the
separate records in the inventory into the same pollutant. Depending on
the relationship between the "[Keep]{.quote}" column, the "[Pollutant
Name,]{.quote}" and the "[CAS Number]{.quote}" in the inventory table
file, the reader routines ensure that they will keep emissions only for
pollutants (not CAS numbers) with a "[Y]{.quote}" in the
"[Keep]{.quote}" column. **Smkinven** can also tell the difference
between two CAS numbers that are being aggregated for the same source
and a duplicate record (two records for the same source with emissions
for the same pollutant).
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------- -------------------- -------------------------------------------------------
  [Prev](ch02s09s06.html)       [Up](ch02s09.html)                                  [Next](ch02s09s08.html)
  2.9.6. Sort the inventory     [Home](index.html)     2.9.8. Assign point-source locations to area sources
  ---------------------------- -------------------- -------------------------------------------------------
:::
::: {.navheader}
2.9.8. Assign point-source locations to area sources
:::

[Prev](ch02s09s07.html) 

2.9. Inventory import

 [Next](ch02s09s09.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_assign_point_locations}2.9.8. Assign point-source locations to area sources {#assign-point-source-locations-to-area-sources .title}

</div>

</div>
:::

Some area/nonpoint and nonroad mobile sources can be assigned
point-source locations instead of being assigned spatial surrogates. At
this time, the only allowable cases of this are for toxics processing
for nonroad mobile and stationary area/nonpoint sources related to
airport emissions processes. **Smkinven** has the capability to make
such assignments for any area source from both the toxics and criteria
inventories; the example file that comes with SMOKE for this purpose
(the `ARTOPNT`{.envar} file) only contains entries for the airport
emissions processes. [Section 4.2, "Test case
descriptions"](ch04s02.html "4.2. Test case descriptions") provides more
information about the example `ARTOPNT`{.envar} file provided with
SMOKE.

Because airport location data are readily available, this feature gives
users the ability to model airport-related area-source emissions at
airport locations, as opposed to spatially allocating them to grid cells
using spatial surrogates. Although spatial surrogates could be (and have
been) developed to reproduce the same or similar results as the
point-source assignments for models such as CMAQ, other models that
SMOKE may eventually support (namely ISCST3) require that point-source
inputs include the location coordinates. The area-to-point assignment
feature in SMOKE will support such a need. Note that for large airports
and a small grid, one may want to have the airport emissions gridded
using surrogate data since the airport can be large enough to encompass
multiple grid cells. Thus, the user should decide whether and when to
use this area-to-point feature as opposed to gridding using an airport
surrogate.

In SMOKE version 1.5 and higher, SMOKE can assign an area source to one
or more locations in a county. For example, when multiple airports are
in a county, SMOKE adds sources to the inventory and splits the
county-total emissions among the locations based on a factor provided in
the `ARTOPNT`{.envar} file. All sources remain with the area-source
inventory in which they started; they are not moved to a point-source
inventory. Any area sources that are assigned point locations are
spatially allocated using those locations, as described in
[Section 2.12, "Spatial
processing"](ch02s12.html "2.12. Spatial processing"). Sources that are
not assigned point-source locations are allocated in the standard way
using spatial surrogates.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------- -------------------- ---------------------------------------------------------
  [Prev](ch02s09s07.html)                               [Up](ch02s09.html)                                    [Next](ch02s09s09.html)
  2.9.7. Aggregate or disaggregate toxics emissions     [Home](index.html)     2.9.9. Fill in and check point-source stack parameters
  ---------------------------------------------------- -------------------- ---------------------------------------------------------
:::
::: {.navheader}
2.9.9. Fill in and check point-source stack parameters
:::

[Prev](ch02s09s08.html) 

2.9. Inventory import

 [Next](ch02s09s10.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_check_stack_params}2.9.9. Fill in and check point-source stack parameters {#fill-in-and-check-point-source-stack-parameters .title}

</div>

</div>
:::

An additional action taken by the **Smkinven** program for point sources
only is to check stack parameters and fill them in with valid values if
they are missing. **Smkinven** performs the following steps on stack
parameters from the annual or average-day inventory files, but not the
hour-specific stack parameters file.

::: {.itemizedlist}
-   If the stack parameters are zero, **Smkinven** treats them as
    missing values and writes the warning messages.

-   If the exit velocity is missing or zero and the exit flow is not, or
    if the `VELOC_RECALC`{.envar} option is Y in the run script,
    **Smkinven** automatically calculates the exit velocity using the
    formula:

    velocity = flow / (π \* diameter^2^/4)

-   If the stack parameters are not missing or zero, **Smkinven**
    ensures that their values are within the allowed ranges. The range
    for each stack parameter is as follows:

    ::: {.itemizedlist}
    -   Height: 0.5 to 2100 meters
    -   Diameter: 0.01 to 100 meters
    -   Exit temperature: 260 to 2000 K
    -   Exit velocity: 0.0001 to 500 m/s
    :::

    When a stack parameter falls outside of its associated range,
    **Smkinven** sets it to the top or bottom of the range, depending on
    whether it is higher than the upper end of the range or lower than
    the lower end. Note that a zero value is not treated as an
    out-of-range parameter, but is treated as a missing value.

-   If the stack parameters are missing or zero, **Smkinven** uses the
    `PSTK`{.envar} file to assign new stack parameters using
    country/state/county and SCC assignments. The format of
    `PSTK`{.envar} file is described in [Section 8.9.3.2,
    "`PSTK`{.envar}: Point source stack replacement parameters
    file"](ch08s09s03.html#sect_input_pstk "8.9.3.2. PSTK: Point source stack replacement parameters file").
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------- -------------------- --------------------------------------------------
  [Prev](ch02s09s08.html)                                  [Up](ch02s09.html)                             [Next](ch02s09s10.html)
  2.9.8. Assign point-source locations to area sources     [Home](index.html)     2.9.10. Convert coordinates from UTM to lat-lon
  ------------------------------------------------------- -------------------- --------------------------------------------------
:::
::: {.navheader}
2.9.10. Convert coordinates from UTM to lat-lon
:::

[Prev](ch02s09s09.html) 

2.9. Inventory import

 [Next](ch02s09s11.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4402}2.9.10. Convert coordinates from UTM to lat-lon {#convert-coordinates-from-utm-to-lat-lon .title}

</div>

</div>
:::

The ORL and FF10 point-source formats permit stack coordinates to be
provided in UTM or lat-lon coordinates, and the SMOKE intermediate
inventory stores the coordinates as lat-lon values. **Smkinven**
converts the UTM coordinates to lat-lon coordinates using the I/O API
routine [UTM2LL](http://www.baronams.com/products/ioapi/LL2UTM.html).
Lat-lon coordinates must be provided in decimal degrees, while UTM
coordinates must be provided in meters.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------- -------------------- -----------------------------------------------------------------------------------
  [Prev](ch02s09s09.html)                                    [Up](ch02s09.html)                                                              [Next](ch02s09s11.html)
  2.9.9. Fill in and check point-source stack parameters     [Home](index.html)     2.9.11. Optionally ensure that lat-lon coordinates are in the Western Hemisphere
  --------------------------------------------------------- -------------------- -----------------------------------------------------------------------------------
:::
::: {.navheader}
2.9.11. Optionally ensure that lat-lon coordinates are in the Western
Hemisphere
:::

[Prev](ch02s09s10.html) 

2.9. Inventory import

 [Next](ch02s09s12.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4413}2.9.11. Optionally ensure that lat-lon coordinates are in the Western Hemisphere {#optionally-ensure-that-lat-lon-coordinates-are-in-the-western-hemisphere .title}

</div>

</div>
:::

For any lat-lon coordinates input to **Smkinven** (point-source
locations, link coordinates, and area-to-point coordinates), SMOKE can
optionally ensure that the longitude values are in the Western
Hemisphere. In some cases, the data prepared for input to SMOKE do not
contain the negative sign on the longitude value that indicates the
Western Hemisphere. If the modeling domain is in the Western Hemisphere,
then **Smkinven** will convert all positive longitudes to negative ones
when the `WEST_HSPHERE`{.envar} option is set to Y.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------- -------------------- ----------------------------------------------------
  [Prev](ch02s09s10.html)                             [Up](ch02s09.html)                               [Next](ch02s09s12.html)
  2.9.10. Convert coordinates from UTM to lat-lon     [Home](index.html)     2.9.12. Convert units of emissions and activities
  -------------------------------------------------- -------------------- ----------------------------------------------------
:::
::: {.navheader}
2.9.12. Convert units of emissions and activities
:::

[Prev](ch02s09s11.html) 

2.9. Inventory import

 [Next](ch02s09s13.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4427}2.9.12. Convert units of emissions and activities {#convert-units-of-emissions-and-activities .title}

</div>

</div>
:::

Different input formats in SMOKE have different emissions units. The
SMOKE intermediate inventory file stores all annual and average-day
emissions values from the ORL format in tons/year. These two formats
also support average-day emissions values, which are stored separately
in the SMOKE intermediate inventory in tons/day. The average-weekday
emissions values input are also stored in tons/year, but SMOKE sets an
internal variable called TPFLAG so that later SMOKE processing steps can
properly treat the computed "[annual]{.quote}" value as an average-day
value. The annual VMT data are stored as miles/year. In all cases,
**Smkinven** converts the units of the input emissions to the units used
in the SMOKE intermediate inventory. When this conversion involves a
day-to-year conversion, **Smkinven** considers leap years by using 366
instead of 365 days in the year. See [Section 8.2, "Inventory
Files"](ch08s02.html "8.2. Inventory Files") for information about the
units required for each inventory format.

When emissions are provided as average-day values from the ORL and FF10
formats and these emissions are then used in later processing steps,
SMOKE does not further adjust the emissions using the monthly profiles.
SMOKE assumes that the average-day emissions from these two formats have
been adjusted to a specific month already. In addition, when
**Smkinven** is configured using the `FILL_ANNUAL`{.envar} option to
fill in missing annual values using average-day values, **Smkinven**
sets the TPFLAG internal variable to indicate that monthly adjustments
should not be applied and that the "[annual]{.quote}" emissions should
just be divided by the number of days of the year before being used.
**Smkinven** makes this setting on a source-by-source basis.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------------------------------------- -------------------- ---------------------------------------------
  [Prev](ch02s09s11.html)                                                              [Up](ch02s09.html)                        [Next](ch02s09s13.html)
  2.9.11. Optionally ensure that lat-lon coordinates are in the Western Hemisphere     [Home](index.html)     2.9.13. Set the weekday averaging approach
  ----------------------------------------------------------------------------------- -------------------- ---------------------------------------------
:::
::: {.navheader}
2.9.13. Set the weekday averaging approach
:::

[Prev](ch02s09s12.html) 

2.9. Inventory import

 [Next](ch02s09s14.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_set_weekday_approach}2.9.13. Set the weekday averaging approach {#set-the-weekday-averaging-approach .title}

</div>

</div>
:::

There are two approaches for processing weekly temporal profiles: weekly
normalization and weekday normalization. Although the actual
normalization happens during temporal allocation, **Smkinven** sets the
approach to use for each source. In the weekly approach, the
**Temporal** program normalizes the weekly temporal profiles over every
day of the week. This approach is appropriate for annual-total
inventories or average-day inventories. Weekday normalization normalizes
over just the weekdays (i.e., Monday through Friday) in the profile, or
if the profile indicates no emissions on weekdays, then over just the
weekend days in the profile. This approach is appropriate only for
average-weekday inventories. [Section 2.10, "Temporal
processing"](ch02s10.html "2.10. Temporal processing") describes the two
forms of weekly profile normalization in more detail.

The default normalization setting for ORL and FF10 formats in
**Smkinven** is weekly normalization. The default settings can be
changed using the `WKDAY_NORMALIZE`{.envar} option in the SMOKE run
scripts. When this option is set to Y, the sources will be set to
instruct **Temporal** to use weekday normalization, and when this option
is set to N, the sources will be set to cause weekly normalization.
**Smkinven** gives a warning when an approach is being used that is
inconsistent with the expected approach for the inventory format being
used.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------- -------------------- ------------------------------------------------------
  [Prev](ch02s09s12.html)                               [Up](ch02s09.html)                                 [Next](ch02s09s14.html)
  2.9.12. Convert units of emissions and activities     [Home](index.html)     2.9.14. Assign country codes, years, and time zones
  ---------------------------------------------------- -------------------- ------------------------------------------------------
:::
::: {.navheader}
2.9.14. Assign country codes, years, and time zones
:::

[Prev](ch02s09s13.html) 

2.9. Inventory import

 [Next](ch02s09s15.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_assign_countries}2.9.14. Assign country codes, years, and time zones {#assign-country-codes-years-and-time-zones .title}

</div>

</div>
:::

For all source categories, **Smkinven** assigns country codes, years,
and time zones to inventory files that do not contain this information
in the inventory records.

Since most inventory formats do not include a column for country or
year, the country code and year must be provided in header fields in the
inventory. because most inventory formats do not include a column for
country or year. Users can provide data for up to 10 countries using as
many separate files, or separate headers within a single file, as
needed. The inventory file formats listed in [Section 8.2, "Inventory
Files"](ch08s02.html "8.2. Inventory Files") provide a further
description of these country-setting headers and the valid country
codes.

Users can also provide multiple inventory years in a single **Smkinven**
run. This is necessary in some cases when an inventory for one region
(e.g., Canada or Mexico) is unavailable for the same year as the
majority of the inventory region (e.g., the U.S.). **Smkinven** stores
the inventory year as part of the source attributes.

In addition to country codes and years, **Smkinven** assigns a time zone
to each source based on the county associated with the source.
**Smkinven** uses the `COSTCY`{.envar} or the `GEOCODE_LEVEL4`{.envar}
(if USE\_EXP\_GEOCODES Y) file to get this information. It matches the
county code from the inventory to the county code in this file. If a
county code included in the inventory is missing from this file, or if
the time zone is not provided in the `COSTCY`{.envar} or
`GEOCODE_LEVEL4`{.envar} file, **Smkinven** uses the
`SMK_DEFAULT_TZONE`{.envar} setting to obtain a default time zone for
sources in such a county. In some cases, the time zone set in the
`COSTCY`{.envar} or `GEOCODE_LEVEL4`{.envar} file is an approximation,
since counties that are bisected by two time zones have only the
predominant zone represented in this file.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------- -------------------- ---------------------------------------------------------------
  [Prev](ch02s09s13.html)                        [Up](ch02s09.html)                                          [Next](ch02s09s15.html)
  2.9.13. Set the weekday averaging approach     [Home](index.html)     2.9.15. Handle inventories that have data for multiple years
  --------------------------------------------- -------------------- ---------------------------------------------------------------
:::
::: {.navheader}
2.9.15. Handle inventories that have data for multiple years
:::

[Prev](ch02s09s14.html) 

2.9. Inventory import

 [Next](ch02s09s16.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4539}2.9.15. Handle inventories that have data for multiple years {#handle-inventories-that-have-data-for-multiple-years .title}

</div>

</div>
:::

In some cases, inventories may use data from multiple years; this can
occur when inventory data are not available for the modeling year of
interest, but data from another year are available. SMOKE can handle
this case. Unless growth factors are available to grow the available
data to the desired year, the SMOKE intermediate inventory may include
data from two years. Usually, using data from a nearby year is
preferable to not performing the modeling at all.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------ -------------------- ----------------------------
  [Prev](ch02s09s14.html)                                 [Up](ch02s09.html)       [Next](ch02s09s16.html)
  2.9.14. Assign country codes, years, and time zones     [Home](index.html)     2.9.16. Set the base year
  ------------------------------------------------------ -------------------- ----------------------------
:::
::: {.navheader}
2.9.16. Set the base year
:::

[Prev](ch02s09s15.html) 

2.9. Inventory import

 [Next](ch02s09s17.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4558}2.9.16. Set the base year {#set-the-base-year .title}

</div>

</div>
:::

**Smkinven** imports all data and then sets the inventory base year in
the file as the year that has the most data values. The year of the
inventories is set using the \#YEAR header for ORL and FF10 inputs, (see
[Section 8.2, "Inventory Files"](ch08s02.html "8.2. Inventory Files")
for more information on this header and packet). Usually, the year of
the data is the same for all sources, so you will know what **Smkinven**
will assume is the base year. However, if multiple inventory years are
provided, **Smkinven** will set it using the year that is associated
with the largest number of sources.

If you provide a future-year inventory to SMOKE, you must override the
base-year setting obtained from the values given by the \#YEAR header or
the /INVYEAR/ packet. This is accomplished with the
`SMK_BASEYR_OVERRIDE`{.envar} setting. This is necessary so that later
SMOKE steps will be able to verify that the episode year is consistent
with the base year.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------- -------------------- ----------------------------------------
  [Prev](ch02s09s15.html)                                          [Up](ch02s09.html)                   [Next](ch02s09s17.html)
  2.9.15. Handle inventories that have data for multiple years     [Home](index.html)     2.9.17. Report results of import step
  --------------------------------------------------------------- -------------------- ----------------------------------------
:::
::: {.navheader}
2.9.17. Report results of import step
:::

[Prev](ch02s09s16.html) 

2.9. Inventory import

 [Next](ch02s09s18.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4578}2.9.17. Report results of import step {#report-results-of-import-step .title}

</div>

</div>
:::

The **Smkinven** program writes several reports to help you determine
what it has done.

::: {.orderedlist}
1.  A summary by CAS number of the emissions in tons/year. This includes
    the number of inventory records; whether all, some, or none of the
    pollutants associated with that CAS code are kept; and the CAS
    description. This report is written to a special report file
    (`REPINVEN`{.envar}).

2.  A summary of emissions by CAS number and pollutant before and after
    the application of disaggregation factors based on the inventory
    table. This report shows, for instance, how chromium emissions get
    split out into different pollutants. The report is written to the
    `REPINVEN`{.envar} file.

3.  A listing of the first 10 nonheader records in each inventory file.
    This information is written to the program log file.

4.  For area-to-point conversions (from [Section 2.9.8, "Assign
    point-source locations to area
    sources"](ch02s09s08.html "2.9.8. Assign point-source locations to area sources")),
    a list of the SCCs that were converted, and the section number of
    the `ARTOPNT`{.envar} input file used to assign the point locations.
    This information is written to the program log file.

5.  For area-to-point conversions, a list of any SCCs included in the
    `ARTOPNT`{.envar} input file that do not also appear in the
    inventory. This report is written to the `REPINVEN`{.envar} file.

6.  For area-to-point conversions, a summary of emissions totals by SCC
    and pollutant before and after the factors are applied, and the
    total number of country/state/county codes affected. A separate
    summary is provided that reports emissions by state, SCC, and
    pollutant, but otherwise has the same information. These reports are
    written to the `REPINVEN`{.envar} file.

7.  For area-to-point conversions, a summary by SCC of the number of
    country/state/county codes being assigned area-to-point factors, and
    the number not being assigned those factors. This report is written
    to the `REPINVEN`{.envar} file.

8.  For import of CEM data, a summary of ORIS IDs and boiler IDs from
    the CEM data that have been matched to the inventory. SMOKE allows
    for multiple plant descriptions and country/state/county codes for a
    single ORIS ID that may be identical in their characteristics but
    different boiler IDS. They are treated as separate sources by
    matching boiler IDs. This report is written to the
    `REPINVEN`{.envar} file.
:::

More information about these reports can be found in [Section 10.5.1,
"`REPINVEN`{.envar}"](ch10s05.html#sect_output_repinven "10.5.1. REPINVEN").
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------- -------------------- -----------------------------------------------------
  [Prev](ch02s09s16.html)       [Up](ch02s09.html)                                [Next](ch02s09s18.html)
  2.9.16. Set the base year     [Home](index.html)     2.9.18. Import day-specific and hour-specific data
  ---------------------------- -------------------- -----------------------------------------------------
:::
::: {.navheader}
2.9.18. Import day-specific and hour-specific data
:::

[Prev](ch02s09s17.html) 

2.9. Inventory import

 [Next](ch02s09s19.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4641}2.9.18. Import day-specific and hour-specific data {#import-day-specific-and-hour-specific-data .title}

</div>

</div>
:::

Another function of **Smkinven** that only applies to point sources is
importing day- and hour-specific data. It can read three input ASCII
formats:

::: {.itemizedlist}
-   [**CEM data format:**]{.bold} The CEM data format provides standard
    local time hourly emissions by ORIS identification code and boiler
    number. It was developed in conjunction with the Market Trading
    Division of EPA, and that division now provides this ASCII file
    format when the data are released.

-   [**FF10 format:**]{.bold}The FF10 day- and hour-specific format can
    be input to SMOKE using either the FF10 annual or average-day
    inventories.
:::

In addition to reading the files, **Smkinven** ensures that the records
listed in day- and hour-specific files match records provided in the
annual inventory inputs. This is necessary because SMOKE builds its list
of all point sources based on the annual and/or average-day inventory
files, and these are the only sources that will be listed in the SMOKE
intermediate inventory file. **Smkinven** requires that the year
associated with the date of the day-specific and hour-specific emissions
is the same as the base year. **Smkinven** generates an error message
when it cannot match a day- or hour-specific source with an inventory
source. Please refer to [Section 6.13,
"**Smkinven**"](ch06s13.html "6.13. Smkinven") for more information
about how **Smkinven** can be used to import these data.

**Smkinven** also can process the hourly CEM data in a more
sophisticated way. Hourly heat input from the CEM data are used to
allocate annual emissons to hourly emission data. First of all, the
utility program **CEMScan** must be run before **Smkinven**, see more
information at ([Section 5.3.4,
"**CEMScan**"](ch05s03s04.html "5.3.4. CEMScan")).
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------- -------------------- --------------------------------------------
  [Prev](ch02s09s17.html)                   [Up](ch02s09.html)                       [Next](ch02s09s19.html)
  2.9.17. Report results of import step     [Home](index.html)     2.9.19. Processing hour-specific CEM data
  ---------------------------------------- -------------------- --------------------------------------------
:::
::: {.navheader}
2.9.19. Processing hour-specific CEM data
:::

[Prev](ch02s09s18.html) 

2.9. Inventory import

 [Next](ch02s10.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_hour_specific_cem}2.9.19. Processing hour-specific CEM data {#processing-hour-specific-cem-data .title}

</div>

</div>
:::

**Smkinven** can allocate annual emissions to hourly data using the
hourly heat input from the standard local time CEM data. **Smkinven**
must match the ORIS/boiler combinations that appear in the standard
local time CEM data to sources in the annual emissions inventory.
**Smkinven** will first skip any ORIS/boiler combinations in the input
CEM data that do not appear in the summary list (`CEMSUM`{.envar})
created by CEMScan; it is important that users ensure that their input
CEM data and CEM summary file remain consistent. **Smkinven** will also
skip any CEM ORIS IDs that are not in the inventory and also any ORIS
and boiler combinations that are not in the inventory. Note that the
inventory may contain sources with valid ORIS IDs but blank boiler
codes; none of these sources will be matched to the CEM data. The format
of the CEM hour-specific data is shown in [Table 8.22, "CEM Format for
individual hour-specific data
files"](ch08s02s07.html#tbl_input_pthour_cem "Table 8.22. CEM Format for individual hour-specific data files").

[**Data Check :**]{.bold} Before calculating the hourly emissions,
**Smkinven** first checks if the hourly NOx emissions from the CEM data
are zero or null. If so, **Smkinven** checks if the hourly heat input,
gross load, and steam load values are zero or null before all output
values will be set to zero. In this case a warning will be written to
the **Smkinven** log file.

Special handling is needed when processing SO~2~ and NO~x~ emissions. If
the summed annual CEM SO~2~ and NO~x~ emissions for a particular
ORIS/boiler combination are zero or null, **Smkinven** will calculate
hourly emissions based on the SO~2~ and NO~x~ emissions in the annual
inventory rather than using the hourly CEM data. If the summed annual
SO~2~ and NO~x~emissions are valid but a particular hour is missing the
hourly SO~2~ and NO~x~ emissions, **Smkinven** will set the hourly SO~2~
and NO~x~ emissions to zero and write a warning to the log file.

[**Calculation:**]{.bold} When calculating hourly emissions,
**Smkinven** must use data from the annual inventory. If any of the
matching inventory sources are missing the annual emissions value, the
program will exit with an error. **Smkinven** will start with the hourly
emissns from the CEM data and then disaggregate the emissions to the
matching inventory sources like so:

[*Hourly NOx emissions for source [*i*]{.emphasis} = (annual NOx
emissions for source [*i*]{.emphasis} / summed annual NOx emissions for
all matching sources ) \* hourly CEM NOx emissions \* pounds to tons
conversion*]{.emphasis}

If the summed annual emissions for all matching sources is zero, the
hourly CEM emissions will be distributed evenly to the matching
inventory sources. For all other pollutants, the hourly emissions are
calculated as;

[*Hourly emissions for source [*i*]{.emphasis} = annual factor \* annual
emissions for source [*i*]{.emphasis}*]{.emphasis}

The annual factor in the above calculation will preferentially be:

[*Annual factor = hourly heat input for ORIS/boiler / annual summed heat
input for ORIS/boiler*]{.emphasis}

If heat input data are not available, **Smkinven** will fallback to
steam load followed by gross load. The heat input values do not need to
be disaggregated to the matching inventory sources because the same
disaggregation factor would be used for both the hourly heat input and
summed heat input.

Used to calculate hourly flow rates from hourly heat input when reading
CEM data. If `FLOW_RATE_FACTOR`{.envar} is set to zero or unset, then
**Smkinven** will not calculate hourly flow rates.

[*Hourly flow rate (m^3^/s) = \[`FLOW_RATE_FACTOR`{.envar} (ft^3^/MMBTU)
\* hourly heat input (MMBTU/hr) \* 0.02831 m^3^/ft^3^\] / 3600
s/hr*]{.emphasis}

**Smkinven** then needs to assign the ORIS/boiler-level hourly flow rate
to the matching inventory sources. To do this, it sums the flow rate for
sources with the same stack. **Smkinven** uses the plant ID and stack ID
to determine which sources feed into the same stack. Script setting
information is available at [Section 6.13.3.2, "Input Environment
Variables"](ch06s13s03.html#sect_programs_smkinven_envar "6.13.3.2. Input Environment Variables").

**NOTE**: It is not recommended to run **Smkinven** for an entire
year\'s worth of CEM data since the memory requirements are large.
Instead, users should process only the CEM data for their episode of
interest. This may require multiple runs of **Smkinven** to break up
large episodes.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------- -------------------- ----------------------------
  [Prev](ch02s09s18.html)                                [Up](ch02s09.html)          [Next](ch02s10.html)
  2.9.18. Import day-specific and hour-specific data     [Home](index.html)     2.10. Temporal processing
  ----------------------------------------------------- -------------------- ----------------------------
:::
::: {.navheader}
2.10. Temporal processing
:::

[Prev](ch02s09s19.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s10s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_temporal_processing}2.10. Temporal processing {#temporal-processing .title style="clear: both"}
---------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.10.1. Using annual or average-day
data](ch02s10.html#d0e4954)]{.section}

[[2.10.2. Applying monthly, weekly, and diurnal
profiles](ch02s10s02.html)]{.section}

[[2.10.3. Using day- and hour-specific
emissions](ch02s10s03.html)]{.section}

[[2.10.4. Time zone adjustments](ch02s10s04.html)]{.section}

[[2.10.5. Holiday processing](ch02s10s05.html)]{.section}

[[2.10.6. Monday, weekday, Saturday, Sunday
processing](ch02s10s06.html)]{.section}

[[2.10.7. Processing Non-sequential Dates](ch02s10s07.html)]{.section}

[[2.10.8. Creating the intermediate files](ch02s10s08.html)]{.section}
:::

The temporal allocation of emission inventory data always occurs after
the inventory import processing previously described in [Section 2.9,
"Inventory import"](ch02s09.html "2.9. Inventory import"). The
**Temporal** program processes data for anthropogenic sources, while the
**Tmpbio** program allocates biogenic emissions. In this section, we
focus on the temporal allocation of the anthropogenic inventories using
**Temporal**. The biogenic processing is further described in
[Section 2.17, "Biogenic
processing"](ch02s17.html "2.17. Biogenic processing").

The primary purpose of the **Temporal** program is to create an
intermediate hourly emissions file (`ATMP`{.envar}, `MTMP`{.envar}, or
`PTMP`{.envar}). It also creates a supplementary intermediate file that
indicates which monthly, weekly (day-of-week), and diurnal (hourly)
profiles were assigned to each source (`ATSUP`{.envar}, `MTSUP`{.envar},
or `PTSUP`{.envar}). Since the **Temporal** dynamically create names for
the output files, two new environment variables `[A|M|P]TMPNAME`{.envar}
and `[A|M|P]TSUPNAME`{.envar} are used to set the directory and file
prefix for naming the output files `[A|M|P]TMP`{.envar} and
`[A|M|P]TSUP`{.envar}. The files are named using the starting date of
each time period.For example, if `ATMPNAME`{.envar} is set to
/data/ntmp.nctox., then the `ATMP`{.envar} file for a given time period
will be put in the data directory and named ntmp.nctox.\[start
date\].ncf.

The temporal processing operation applies factors based on the source
characteristics to the emissions data from the SMOKE inventory files.
These factors can include monthly, weekly, and diurnal temporal
profiles. The resulting emissions data vectors (not a matrix) contain
hourly emissions for the inventory species. SMOKE assumes an hourly time
step (Even though the time step is an input setting to SMOKE, it
currently cannot be changed.). Most of the calculations are implemented
as sparse-matrix algebra based upon temporal cross-references and
profiles, augmented by the substitution of values from day- and
hour-specific emissions data sets. For mobile sources, hourly emissions
values also depend on meteorology (e.g., the temperature dependence of
evaporative emissions).

[Figure 2.20, "Transformation of inventory data to hourly
data"](ch02s10.html#fig_concepts_temporal_processing "Figure 2.20. Transformation of inventory data to hourly data")
shows how data from the intermediate inventory are stored in the hourly
file. The arrow represents the temporal processing steps which convert
the annual, average-day, or day- and hour-specific data to hourly data.
After the temporal processing, the hourly emissions are stored in the
intermediate hourly file, by hour and source number. The emissions are
stored in the same order as the sources in the sorted intermediate
inventory file.

::: {.figure}
[]{#fig_concepts_temporal_processing}

**Figure 2.20. Transformation of inventory data to hourly data**

::: {.mediaobject}
![Transformation of inventory data to hourly
data](images\concepts\temporal_processing_html.jpg)
:::
:::

Temporal processing also addresses the following issues that need to be
considered during emissions processing:

::: {.orderedlist}
1.  Using annual or average-day data when both are available in the
    inventory

2.  Applying monthly, weekly, and diurnal profiles

3.  Using day- and hour-specific emissions

4.  Time zone adjustments

5.  Holiday processing

6.  Monday-weekday-Saturday-Sunday (MWSS) processing

7.  Processing non-sequential dates

8.  Creating the intermediate files
:::

In the subsections below, we address each of these issues in the same
order as the list above.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4954}2.10.1. Using annual or average-day data {#using-annual-or-average-day-data .title}

</div>

</div>
:::

When using the ORL or FF10 inventory format, you may choose to use
either the annual or the average-day emissions values when running the
**Temporal** program. The default is to use the annual data. To apply
average-day data instead, the `SMK_AVEDAY`{.envar} setting is used (this
setting is relevant only for ORL or FF10 inventories). These emissions
are then used in the merge-processing step, resulting in model-ready
emissions that depend on the data type selected. If part of your
inventory is available as average-day data and part is available as
annual data, you have used **Smkinven** to fill in annual values based
on the average-day values. The **Temporal** program is then run using
annual values. **Temporal** ensures that for those sources for which
"[annual]{.quote}" values were created, only day-of-week and hourly
adjustments (not monthly profiles) are applied. **Temporal** assumes
that any average-day data provided has already been adjusted for a
specific month, and therefore does not apply the monthly profiles to
them.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------- -------------------- ---------------------------------------------------------
  [Prev](ch02s09s19.html)                        [Up](ch02.html)                                      [Next](ch02s10s02.html)
  2.9.19. Processing hour-specific CEM data     [Home](index.html)     2.10.2. Applying monthly, weekly, and diurnal profiles
  -------------------------------------------- -------------------- ---------------------------------------------------------
:::
::: {.navheader}
2.10.2. Applying monthly, weekly, and diurnal profiles
:::

[Prev](ch02s10.html) 

2.10. Temporal processing

 [Next](ch02s10s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e4980}2.10.2. Applying monthly, weekly, and diurnal profiles {#applying-monthly-weekly-and-diurnal-profiles .title}

</div>

</div>
:::

The **Temporal** program uses a cross-reference file and a temporal
profiles file to assign the temporal profiles to the inventory sources.
The cross-reference file can assign the profiles using a hierarchy that
is based on the source characteristics. A detailed list of valid
assignments is given in [Section 6.16,
"**Temporal**"](ch06s16.html "6.16. Temporal") with the detailed
description of the **Temporal** program. The cross-reference assigns a
monthly, weekly, and diurnal profile to each source, and can also assign
default profiles to sources that don't have more specific matches in the
cross-reference file. When default assignments are made by the
**Temporal** program, you can optionally choose to have warnings given
for all of these assignments, using the `REPORT_DEFAULTS`{.envar}
option.

The temporal profiles file has different sections that contain the
monthly, weekly, and diurnal profiles. Additionally, you may provide
different weekend (Saturday, Sunday) and weekday (Monday through Friday)
diurnal profiles, or you may provide a different set of diurnal profiles
for each day of the week.

When using multiple diurnal profiles, a given source must use a diurnal
profile with the same profile code for each day. For example, if a
source uses diurnal profile 1 for Monday, it will also use profile 1 for
Tuesday, but Monday's profile 1 can be different than Tuesday's profile
1.

For weekly profiles, **Temporal** evaluates the TPFLAG setting (set by
**Smkinven** as explained in [Section 2.9.13, "Set the weekday averaging
approach"](ch02s09s13.html "2.9.13. Set the weekday averaging approach"))
and uses the weekly-normalized weekly profiles or weekday-normalized
weekly profiles, depending on the setting.

One limitation of using monthly, weekly, and diurnal profiles is that
there is no week-to-week variation within a month. For example, all
Tuesdays in a month use the same emissions profile (unless one happens
to be a holiday, see [Section 2.10.5, "Holiday
processing"](ch02s10s05.html "2.10.5. Holiday processing")). This
limitation can be overcome by using day-specific emissions data (only
for point sources).
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------- -------------------- -------------------------------------------------
  [Prev](ch02s10.html)          [Up](ch02s10.html)                            [Next](ch02s10s03.html)
  2.10. Temporal processing     [Home](index.html)     2.10.3. Using day- and hour-specific emissions
  ---------------------------- -------------------- -------------------------------------------------
:::
::: {.navheader}
2.10.3. Using day- and hour-specific emissions
:::

[Prev](ch02s10s02.html) 

2.10. Temporal processing

 [Next](ch02s10s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5021}2.10.3. Using day- and hour-specific emissions {#using-day--and-hour-specific-emissions .title}

</div>

</div>
:::

SMOKE uses the most specific data available for any given source. For
point sources, **Temporal** will read in the day-specific and
hour-specific emissions and use these instead of the annual or
average-day emissions that have been adjusted to hourly values. If both
day-specific and hour-specific data are available for the same source,
**Temporal** will use the hour-specific data. The settings that control
the use of these emissions are `HOUR_SPECIFIC_YN`{.envar} and
`DAY_SPECIFIC_YN`{.envar}.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------- -------------------- --------------------------------
  [Prev](ch02s10s02.html)                                    [Up](ch02s10.html)           [Next](ch02s10s04.html)
  2.10.2. Applying monthly, weekly, and diurnal profiles     [Home](index.html)     2.10.4. Time zone adjustments
  --------------------------------------------------------- -------------------- --------------------------------
:::
::: {.navheader}
2.10.4. Time zone adjustments
:::

[Prev](ch02s10s03.html) 

2.10. Temporal processing

 [Next](ch02s10s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_time_zones}2.10.4. Time zone adjustments {#time-zone-adjustments .title}

</div>

</div>
:::

You can use the `OUTZONE`{.envar} setting to control the output time
zone that defines the hours in the output files. The one constraint on
this setting is that it must be consistent with the time zone of the
meteorology files. These files are used only when processing on-road
mobile sources with MOVES/MOBILE6 (optional), processing elevated point
sources for the CMAQ-based approach (required), or processing biogenic
emissions with SMOKE BEIS3 (required). The time zones must be consistent
among all source categories processed, so if one source category depends
on the meteorology file, then all source categories must be processed
with the same `OUTZONE`{.envar} setting.

**Temporal** compares the `OUTZONE`{.envar} value with the time zone of
the source, which was set in **Smkinven** (see [Section 2.9.14, "Assign
country codes, years, and time
zones"](ch02s09s14.html "2.9.14. Assign country codes, years, and time zones"))
based on the county. Additionally, it assesses and accounts for whether
the date being processed falls within the range of Daylight Savings
Time, and whether the county of the source uses Daylight Savings Time.
**Temporal** uses the `COSTCY`{.envar} or the `GEOCODE_LEVEL4`{.envar}
(if USE\_EXP\_GEOCODES Y) file to determine which counties use Daylight
Savings Time and which do not; for example, the state of Arizona does
not use it. Using these pieces of information, **Temporal** interprets
the diurnal profiles assuming that they are local profiles in order to
map the correct adjustment to the correct output hour in the output time
zone. **Temporal** also uses the time zone of the source and the output
time zone to determine the correct hour for switching from one month to
the next and from one day of the week to the next.

[Table 2.9, "Example `OUTZONE`{.envar} settings and their associated
time
zones"](ch02s10s04.html#tbl_concepts_outzone "Table 2.9. Example OUTZONE settings and their associated time zones")
lists a sampling of `OUTZONE`{.envar} settings and the time zones that
they represent. Note that SMOKE expects `OUTZONE`{.envar} to be set as a
positive number for time zones in the Western Hemisphere, although
standard notation would list these as negative values. For example,
Eastern Standard Time is listed in this table as -5:00 hours from GMT,
but `OUTZONE`{.envar} for EST in SMOKE is 5. One result of this
implementation is that SMOKE does not work perfectly for time zones east
of GMT.

::: {.table}
[]{#tbl_concepts_outzone}

**Table 2.9. Example `OUTZONE`{.envar} settings and their associated
time zones**

  `OUTZONE`{.envar}   GMT      Time zone   Description
  ------------------- -------- ----------- ---------------------------
  12                  -12:00   BIT         Baker Island Time
  11                  -11:00   SST         Samoa Standard Time
  10                  -10:00   HST         Hawaii Standard Time
  9                   -9:00    AKT         Alaska Standard Time
  8                   -8:00    PST         Pacific Standard Time
  7                   -7:00    MST         Mountain Standard Time
  6                   -6:00    CST         Central Standard Time
  5                   -5:00    EST         Eastern Standard Time
  4                   -4:00    AST         Atlantic Standard Time
  3                   -3:00    ART         Argentina Time
  2                   -2:00    FNT         Fernando de Noronha Time
  1                   -1:00    EGT         Eastern Greenland Time
  0                   0:00     GMT         Greenwich Mean Time
  -1                  1:00     CET         Central European Time
  -2                  2:00     EET         Eastern European Time
  -3                  3:00     MSK         Moscow Time
  -4                  4:00     GST         Gulf Standard Time
  -5                  5:00     PKT         Pakistan Standard Time
  -6                  6:00     BST         Bangladesh Standard Time
  -7                  7:00     THA         Thailand Time
  -8                  8:00     HKT         China Standard Time
  -9                  9:00     KST         Korean Standard Time
  -10                 10:00    AET         Australian Eastern Time
  -11                 11:00    ADT         Australian Daylight Time
  -12                 12:00    FJT         Fiji Time
  -13                 13:00    NZT         New Zealand Daylight Time
  -14                 14:00    LNT         Line Islands Time
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------- -------------------- -----------------------------
  [Prev](ch02s10s03.html)                            [Up](ch02s10.html)        [Next](ch02s10s05.html)
  2.10.3. Using day- and hour-specific emissions     [Home](index.html)     2.10.5. Holiday processing
  ------------------------------------------------- -------------------- -----------------------------
:::
::: {.navheader}
2.10.5. Holiday processing
:::

[Prev](ch02s10s04.html) 

2.10. Temporal processing

 [Next](ch02s10s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_holiday_processing}2.10.5. Holiday processing {#holiday-processing .title}

</div>

</div>
:::

Holidays that fall on weekdays can have different activity patterns than
regular weekdays because commercial and commuting activities are
altered. **Temporal** uses the `HOLIDAYS`{.envar} file to identify which
user-defined dates should be processed as holidays and to determine
which day of the week (Saturday or Sunday) to use to model the holiday.
Usually, holidays are modeled as if they were a Sunday; this attempts to
account for things like plants being closed and traffic patterns being
different. Of course, you can also set up specific temporal profile
inputs for a specific holiday and model that day separately, but this is
not automated in SMOKE. Users therefore simply pick Saturday or Sunday
as an alternative date treatment in the hope that it will somewhat
better represent the emissions than using a weekday.

Holidays processing happens automatically if you are running the
**Temporal** program for every day of your episode. If you are using the
Monday-weekday-Saturday-Sunday approach described in [Section 2.10.6,
"Monday, weekday, Saturday, Sunday
processing"](ch02s10s06.html "2.10.6. Monday, weekday, Saturday, Sunday processing"),
then additional scripting steps must be taken to ensure that the
holidays are modeled properly. In particular, for inventories that span
multiple time zones and/or when the output time zone is not the same as
at least one time zone in the inventory, the scripts must be configured
to model the holiday and the next day, so that the final hours in the
holiday that are west of the output time zone will be included in the
next day's file.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------- -------------------- -------------------------------------------------------
  [Prev](ch02s10s04.html)           [Up](ch02s10.html)                                  [Next](ch02s10s06.html)
  2.10.4. Time zone adjustments     [Home](index.html)     2.10.6. Monday, weekday, Saturday, Sunday processing
  -------------------------------- -------------------- -------------------------------------------------------
:::
::: {.navheader}
2.10.6. Monday, weekday, Saturday, Sunday processing
:::

[Prev](ch02s10s05.html) 

2.10. Temporal processing

 [Next](ch02s10s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_mwss_processing}2.10.6. Monday, weekday, Saturday, Sunday processing {#monday-weekday-saturday-sunday-processing .title}

</div>

</div>
:::

The temporal variation of the days in a week is the same from week to
week within a month because SMOKE uses weekly profiles. Also, it is
common that the weekly profiles do not vary on Monday through Friday.
Consequently, it is often desirable for long (e.g., annual) simulations
to use a Monday-weekday-Saturday-Sunday (MWSS) approach. With this
approach, SMOKE computes emissions for a representative Monday, weekday,
Saturday, and Sunday within each month. The representative days cannot
be the first day of the month (to prevent effects from the previous
month from being included in the emissions data), a holiday (as set in
the `HOLIDAYS`{.envar} file), or the day after the holiday. Monday is
distinguished from other weekdays because in multi-time zone cases in
the Western Hemisphere with `OUTZONE`{.envar} set to 0 (i.e. GMT), a few
late-night Sunday hours are included in the hours at the start of the
Monday file. In addition, one must specifically process the holidays and
the day after holidays as separate runs for all holidays set by the
`HOLIDAYS`{.envar} file. During merging of emissions, the Monday,
weekday, Saturday, and Sunday files are reused to create model-ready
emissions for every day and hour needed. The holiday and day-after files
are used for the holiday and day-after dates only.

This approach relies heavily on scripting to select dates for each
month's representative days and to ensure that the days that are run are
consistent with the dates in the `HOLIDAYS`{.envar} file. Scripting is
also responsible for ensuring that the correct files are merged together
by **Smkmerge** to create the model-ready files for all days of the
episode. These scripting issues are described in more detail in
[Chapter 4, *How to Use
SMOKE*](ch04.html "Chapter 4. How to Use SMOKE").

There are some situations in which you cannot use the MWSS approach. In
particular, on-road processing with MOVES must be run for all days of
the episode, although some steps can be sped up by using the meteorology
averaging approach. Additionally, biogenic emissions processing obtains
all of its temporal variation from the meteorology data, and therefore
must be run for all days. Fortunately, biogenic emissions processing is
very fast compared to processing for other source categories.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------- -------------------- ------------------------------------------
  [Prev](ch02s10s05.html)        [Up](ch02s10.html)                     [Next](ch02s10s07.html)
  2.10.5. Holiday processing     [Home](index.html)     2.10.7. Processing Non-sequential Dates
  ----------------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
2.10.7. Processing Non-sequential Dates
:::

[Prev](ch02s10s06.html) 

2.10. Temporal processing

 [Next](ch02s10s08.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_non_seq_processing}2.10.7. Processing Non-sequential Dates {#processing-non-sequential-dates .title}

</div>

</div>
:::

Previously, **Temporal** processed a single continuous time period
during each execution of the program producing one output file.
Typically, only representative Monday, weekday, Saturday and Sunday,
plus any holidays are processed for a single month. This type of
processing can require complex scripting and **Temporal** would need to
be run several times. See [Section 4.4.13.3, "Changing the
episode"](ch04s04s13.html#sect_scripts_change_episode "4.4.13.3. Changing the episode"),
[Section 4.4.13.4, "Changing the dates, times, and duration of
model-ready SMOKE emissions
files"](ch04s04s13.html#sect_scripts_duration_output "4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE emissions files")
and [Section 4.4.13.5, "Setting non-sequential processing
dates"](ch04s04s13.html#sect_scripts_non_seq_dates "4.4.13.5. Setting non-sequential processing dates").

SMOKE now provides the capability for optionally setting non-sequential
date processing during a single execution of **Temporal** using a new
input file `PROCDATES`{.envar} to indicate a list of dates which
**Temporal** should process. The format for `PROCDATES`{.envar} is
described in [Section 8.3.4, "`PROCDATES`{.envar}: Procdates date
list"](ch08s03s04.html "8.3.4. PROCDATES: Procdates date list"). The
format allows for blank lines, comment lines (any lines that start with
a pound sign, and trailing comments (any characters after an exclamation
point).

`G_TSTEP`{.envar} will be used to set the time step for all time
periods. The output data for each time period will be written to an
endividual file.

An example of `PROCDATES`{.envar} file is shown below. In this case, we
are processing the first day of each month in 2005. Twelve output files
will be produced. Each file will contain 25 time steps.

::: {.itemizedlist}
-   \# First day of each month
-   20050101 0 250000 ! January
-   20050201 0 250000 ! February
-   20050301 0 250000 ! March
-   20050401 0 250000 ! April
-   20050501 0 250000 ! May
-   20050601 0 250000 ! June
-   20050701 0 250000 ! July
-   20050801 0 250000 ! August
-   20050901 0 250000 ! September
-   20051001 0 250000 ! October
-   20051101 0 250000 ! November
-   20051201 0 250000 ! December
:::

**Temporal** procduces two output files `[A|M|P]TMP`{.envar} and
`[A|M|P]TSUP`{.envar}. Since **Temporal** will need to dynamically
create names for the output files, we will use two new environment
variables `[A|M|P]TMPNAME`{.envar} and `[A|M|P]TSUPNAME`{.envar} to set
the directory and file prefix used to name the output files. The files
will be named using the starting date of each time period. For example,
if `ATMPNAME`{.envar} is set to /data/ntmp.nctox., (note the period at
the end of the file string) the `ATMP`{.envar} file for a given time
period will be put in the `STATIC`{.envar} directory and named
\"ntmp.nctox.\<start date\>.ncf\".
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------- -------------------- ------------------------------------------
  [Prev](ch02s10s06.html)                                  [Up](ch02s10.html)                     [Next](ch02s10s08.html)
  2.10.6. Monday, weekday, Saturday, Sunday processing     [Home](index.html)     2.10.8. Creating the intermediate files
  ------------------------------------------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
2.10.8. Creating the intermediate files
:::

[Prev](ch02s10s07.html) 

2.10. Temporal processing

 [Next](ch02s11.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5496}2.10.8. Creating the intermediate files {#creating-the-intermediate-files .title}

</div>

</div>
:::

Finally, the **Temporal** program must output intermediate files. The
hourly emissions are written to the `ATMP`{.envar}, `MTMP`{.envar}, and
`PTMP`{.envar} I/O API files. Unlike the other major SMOKE intermediate
files (e.g., the matrices), the actual emissions (not just factors) are
written to this file. This is because day-specific and hour-specific
emissions can be impossible to convert into factors since the annual
inventory emissions for the day- or hour-specific sources could be zero
and factors would not be able to change that.

If **Temporal** has more than 120 variables to output (the limit for the
number of variables in an I/O API file), **Temporal** opens as many
files (using the FileSetAPI wrapper) as are needed to store the data.
SMOKE also estimates how large the output files will be using 120
variables per file and automatically lowers the number of variables that
will be put in each I/O API output file to ensure that the files use
less than 2 GB of disk space. In addition, **Temporal** writes the
supplementary files `ATSUP`{.envar}, `MTSUP`{.envar}, or
`PTSUP`{.envar}, which contain the temporal profiles assigned to each
source. The structures of the SMOKE intermediate files output by
**Temporal** are provided in [Section 9.14,
"**Temporal**"](ch09s14.html "9.14. Temporal").
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------------------
  [Prev](ch02s10s07.html)                     [Up](ch02s10.html)                     [Next](ch02s11.html)
  2.10.7. Processing Non-sequential Dates     [Home](index.html)     2.11. Chemical speciation processing
  ------------------------------------------ -------------------- ---------------------------------------
:::
::: {.navheader}
2.11. Chemical speciation processing
:::

[Prev](ch02s10s08.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s11s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_chemical_processing}2.11. Chemical speciation processing {#chemical-speciation-processing .title style="clear: both"}
--------------------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.11.1. Splitting inventory pollutants into chemical
species](ch02s11.html#d0e5594)]{.section}

[[2.11.2. Pollutant-to-pollutant
conversions](ch02s11s02.html)]{.section}

[[2.11.3. Checking the consistency of the speciation profiles with the
inventory table](ch02s11s03.html)]{.section}

[[2.11.4. Setting the order of the output
species](ch02s11s04.html)]{.section}

[[2.11.5. Creating speciation intermediate
files](ch02s11s05.html)]{.section}
:::

An emission inventory is built and reported for a variety of pollutants,
such as CO, NO~x~, VOC, PM~10~, and SO~2~. However, AQM chemical
mechanisms (e.g., CB6) contain a simplified set of equations that use
"[model species]{.quote}" to represent atmospheric chemistry. Therefore,
emissions processing requires speciation profiles to convert the
emissions in terms of pollutant values to the species used in the
photochemical mechanism. The purpose of the chemical speciation
processing program **Spcmat** is to produce matrices that contain the
factors for converting the input emissions pollutants to the model
species used in the AQM. These species include organics, PM species, and
toxics species.

The speciation matrices that **Spcmat** creates are used transform
column vectors of inventory-pollutant emissions into column vectors of
model-species emissions. As shown in [Figure 2.21, "Relationship of
inventory sources to speciation
matrix"](ch02s11.html#fig_concepts_chemical_processing "Figure 2.21. Relationship of inventory sources to speciation matrix"),
the speciation matrix consists of columns for each required
pollutant-to-species transformation and includes an entry for each
source. The entries are the factors needed to convert the inventory
pollutants into the model species. Note that speciation matrices depend
only upon the chemical mechanism and the inventory, and they are
therefore independent of the other factor-based operations for emissions
processing.

::: {.figure}
[]{#fig_concepts_chemical_processing}

**Figure 2.21. Relationship of inventory sources to speciation matrix**

::: {.mediaobject}
![Relationship of inventory sources to speciation
matrix](images\concepts\chemical_processing_html.jpg)
:::
:::

Chemical speciation processing addresses the following issues during
emissions processing:

::: {.orderedlist}
1.  Splitting inventory pollutants into chemical species

2.  Pollutant-to-pollutant conversions

3.  Checking the consistency of the speciation profiles with the
    inventory

4.  Setting the order of the output species

5.  Creating speciation intermediate files
:::

In the subsections below, we provide additional detail about each of
these steps, in the order in which they are listed above.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5594}2.11.1. Splitting inventory pollutants into chemical species {#splitting-inventory-pollutants-into-chemical-species .title}

</div>

</div>
:::

SMOKE supports run-time, user-selected inventory pollutants and chemical
mechanisms. Before running the chemical speciation step, the only
relevant information that SMOKE has is information about the inventory
pollutants. After **Spcmat** runs, SMOKE then has the instructions for
supporting a specific chemical mechanism, and through the speciation
matrices, SMOKE will be able to generate model-ready emissions for the
specific chemical mechanism set by the user. The inventory pollutants
relate to the chemical mechanism because certain pollutants are needed
to create certain species, but the pollutants do not dictate the
chemical mechanism. As a SMOKE user, you must be aware of what
pollutants are required to generate the model species needed by a
chemical mechanism, so that all needed model species are created.

As we just mentioned, SMOKE learns of the species being created for a
given run through the **Spcmat** program. The chemical speciation
profiles input file (`GSPRO`{.envar}) is the data file that controls the
chemical species SMOKE will create. It contains the chemical speciation
profile code, the pollutant-to-species relationships, and both
mole-based and mass-based conversion factors. The format and contents of
this file are described in detail in [Section 8.5.2, "`GSPRO`{.envar}:
Speciation profile
file"](ch08s05s02.html "8.5.2. GSPRO: Speciation profile file"). Several
`GSPRO`{.envar} files to support many chemical mechanisms are available
for download; see [Section 4.2, "Test case
descriptions"](ch04s02.html "4.2. Test case descriptions") for more
information. How to select an existing chemical mechanism or specify a
new one, and how to ensure that the `GSPRO`{.envar} file is consistent
with other input files, are described in [Section 4.4.10, "Use a
different speciation mechanism or change speciation
inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs").

**Spcmat** uses a cross-reference file to assign the chemical speciation
profiles to the inventory sources and pollutants. The cross-reference
file can assign the profiles using a hierarchy that is based on the
source characteristics; a detailed list of valid assignments is given in
[Section 6.15, "**Spcmat**"](ch06s15.html "6.15. Spcmat"). All
assignments are pollutant-specific, such that each pollutant for a
source can (and often should) use a different speciation profile. The
cross-reference file can also assign a default profile, and some
pollutants that have only one way of being speciated (e.g., mapping the
CO pollutant to the CO species) receive a default profile for every
source. When **Spcmat** makes default assignments, you can optionally
choose to have warnings given for all of these assignments using the
`REPORT_DEFAULTS`{.envar} option. **Spcmat** will also produce a warning
about any inventory pollutants that are not assigned a speciation
profile, because this will result in the emissions for that pollutant
being dropped by SMOKE.

**Spcmat** creates two speciation matrices during each run: a mole-based
matrix and a mass-based matrix. The speciation profile file
(`GSPRO`{.envar}) has different factors for mass- and mole-based
conversions. It is not trivial to convert between mass- and mole-based
factors for some chemical mechanisms like CB6, which use aggregates of
chemical compounds or parts of compounds to define the model species.
One cannot simply use a molecular weight to convert accurately, because
the molecular weight of the chemical species is different for every
speciation profile. This is because different proportions of chemical
compounds are present in each speciation profile, so even though the
species are the same, their molecular weights are different from profile
to profile. This is why SMOKE has the two speciation matrices. The
mole-based matrices are used to create the model-ready files, and the
mass-based matrices are used only to create the reports that require
tons, kilograms, grams, or other mass units. One peculiarity of the
mole-based matrix is that particulate species emissions cannot be
expressed in moles, so the units are still grams in the mole-based
matrices for particulate species.

Chemical speciation has both similarities and differences from the
aggregation and disaggregation that is performed during inventory import
(see [Section 2.9.7, "Aggregate or disaggregate toxics
emissions"](ch02s09s07.html "2.9.7. Aggregate or disaggregate toxics emissions")).
It is similar in that it involves separating one data value into more
than one data value. For example, inventory disaggregation can split
Mercury & Compounds (CAS=199) into elemental mercury, divalent gaseous
mercury, and divalent particulate mercury during inventory import of
nonroad mobile sources. Similarly, NO~x~ can be split into nitrogen
oxide (NO) and nitrogen dioxide (NO~2~) during chemical speciation.
Aggregation is also similar to speciation because it can map multiple
pollutants or parts of pollutants into the same chemical compound, just
as speciation can map parts of the different pollutants (e.g., HGSUM and
HG) to the same model species (e.g., HG). On the other hand, the two
concepts are different for three reasons. First, the pollutants
aggregated and disaggregated by **Smkinven** are still considered by
SMOKE to be pollutants, not species, to pass to later processing steps.
Second, chemical speciation allows multiple split factors to be used for
the same pollutant-to-species conversion, whereas inventory
aggregation/disaggregation uses just one factor across the whole
inventory for each pollutant-to-pollutant conversion. Third, chemical
speciation also converts the units of the pollutants (tons) to the units
of the species (moles for gaseous species and grams for particulate
species).

Speciation profiles do not necessarily conserve mass. For example, it is
possible to input 100 tons of VOC into the **Spcmat** program and have
it output factors that will produce 70 tons of VOC-based species or 110
tons of VOC-based species. The reduced mass occurs when some of the
pollutant's mass does not map to chemically reactive species in the
inventory. In some cases, the nonreactive (NR) species is included in
the speciation profiles so that the speciation profiles do sum to 1.
Increased mass happens because some compounds that are part of VOC may
have chemical reactivity associated with two model species. Since this
one part of the VOC is mapped to two model species, its mass appears to
be double-counted when summing the model-species mass. This is merely an
artifact of how the model species are defined and implemented in the
AQM, and the AQM is responsible for accounting for such issues in its
chemical mechanism.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- ---------------------------------------------
  [Prev](ch02s10s08.html)                      [Up](ch02.html)                          [Next](ch02s11s02.html)
  2.10.8. Creating the intermediate files     [Home](index.html)     2.11.2. Pollutant-to-pollutant conversions
  ------------------------------------------ -------------------- ---------------------------------------------
:::
::: {.navheader}
2.11.2. Pollutant-to-pollutant conversions
:::

[Prev](ch02s11.html) 

2.11. Chemical speciation processing

 [Next](ch02s11s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5662}2.11.2. Pollutant-to-pollutant conversions {#pollutant-to-pollutant-conversions .title}

</div>

</div>
:::

In some cases, the pollutant available in the inventory is not the same
as the pollutant for which speciation profiles have been developed. At
this time, the only known case of this situation is when the inventory
is collected for VOC (or for reactive organic gases \[ROG\]) but the
speciation profiles are available for TOG. For this situation,
VOC-to-TOG factors have been developed that **Spcmat** assigns to the
inventory sources based on the sources' SCCs. The factors are input
using the `GSCNV`{.envar} file, which can support multiple
pollutant-to-pollutant conversions in the same file. The example SMOKE
`GSCNV`{.envar} file has sections for ROG-to-TOG and VOC-to-TOG; it is
described further in [Section 4.2, "Test case
descriptions"](ch04s02.html "4.2. Test case descriptions") and
[Section 8.5.1, "`GSCNV`{.envar}: Pollutant-to-pollutant conversion
file"](ch08s05.html#sect_input_gscnv "8.5.1. GSCNV: Pollutant-to-pollutant conversion file").
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------- -------------------- ---------------------------------------------------------------------------------------
  [Prev](ch02s11.html)                     [Up](ch02s11.html)                                                                  [Next](ch02s11s03.html)
  2.11. Chemical speciation processing     [Home](index.html)     2.11.3. Checking the consistency of the speciation profiles with the inventory table
  --------------------------------------- -------------------- ---------------------------------------------------------------------------------------
:::
::: {.navheader}
2.11.3. Checking the consistency of the speciation profiles with the
inventory table
:::

[Prev](ch02s11s02.html) 

2.11. Chemical speciation processing

 [Next](ch02s11s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5680}2.11.3. Checking the consistency of the speciation profiles with the inventory table {#checking-the-consistency-of-the-speciation-profiles-with-the-inventory-table .title}

</div>

</div>
:::

The **Spcmat** program checks to be sure that the two definitions of the
NONHAPVOC pollutant - one from the speciation profiles (`GSPRO`{.envar})
file and the other from the inventory table (`INVTABLE`{.envar}) file -
are consistent. When you are modeling with both criteria and toxics
inventories and using toxics VOC (i.e., "[integrating]{.quote}" toxics
VOC), you must ensure that the definition of toxics VOC used in the
`INVTABLE`{.envar} file is consistent with the definition in the
`GSPRO`{.envar} file. **Spcmat** cannot assure that these files are
consistent with each other, but does ensure that the information
provided by the user is consistent; it is up to you to make sure that
the information provided is correct and consistent with what is actually
in the files.

These files need to be consistent because the same pollutants that SMOKE
subtracts out of the VOC to create NONHAPVOC must also be removed when
the speciation profiles are being computed. This assures that there will
be no double-counting of mass when calculating model species from both
toxics VOC and from the criteria aggregated VOC value. The
`GSPRO`{.envar} file format includes a header that allows you to define
the toxics VOC that were removed when creating the NONHAPVOC speciation
profiles. This is intended to help you ensure that the NONHAPVOC
definition in the `GSPRO`{.envar} file is consistent with the inventory
table file. One important detail of how this is implemented is that
**Spcmat** will not include inventory pollutants that are not actually
in the inventory in the consistency check, even if the pollutant is
listed in the NONHAPVOC definition in the `GSPRO`{.envar} file.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------- -------------------- --------------------------------------------------
  [Prev](ch02s11s02.html)                        [Up](ch02s11.html)                             [Next](ch02s11s04.html)
  2.11.2. Pollutant-to-pollutant conversions     [Home](index.html)     2.11.4. Setting the order of the output species
  --------------------------------------------- -------------------- --------------------------------------------------
:::
::: {.navheader}
2.11.4. Setting the order of the output species
:::

[Prev](ch02s11s03.html) 

2.11. Chemical speciation processing

 [Next](ch02s11s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5720}2.11.4. Setting the order of the output species {#setting-the-order-of-the-output-species .title}

</div>

</div>
:::

The **Spcmat** program controls the order of the species in the output
files. The order does not matter to any of the AQMs that SMOKE supports,
so there is not very much user control of the order. **Spcmat** arranges
the output species first by the order in which their associated
pollutants appear in the inventory table (`INVTABLE`{.envar}) file, and
next in alphabetical order. For example, if an inventory included CO,
NO~x~, and VOC, the CO species from the CO pollutant would be first,
followed by the NO and NO~2~ species for NO~x~. After that, all of the
VOC species would be output in alphabetical order (e.g., ALD2, ETH,
FORM, ISOP, NR, OLE, PAR, TOL, XYL). If two pollutants create the same
species, the first pollutant in the `INVTABLE`{.envar} file with which
the species is associated will determine its output order.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------------------------------- -------------------- -------------------------------------------------
  [Prev](ch02s11s03.html)                                                                  [Up](ch02s11.html)                            [Next](ch02s11s05.html)
  2.11.3. Checking the consistency of the speciation profiles with the inventory table     [Home](index.html)     2.11.5. Creating speciation intermediate files
  --------------------------------------------------------------------------------------- -------------------- -------------------------------------------------
:::
::: {.navheader}
2.11.5. Creating speciation intermediate files
:::

[Prev](ch02s11s04.html) 

2.11. Chemical speciation processing

 [Next](ch02s12.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5746}2.11.5. Creating speciation intermediate files {#creating-speciation-intermediate-files .title}

</div>

</div>
:::

The last task for the chemical speciation processing is creating the
speciation intermediate files. The **Spcmat** program creates a
mole-based speciation matrix (`ASMAT_L`{.envar}, `MSMAT_L`{.envar}, or
`PSMAT_L`{.envar}) and a mass-based speciation matrix
(`ASMAT_S`{.envar}, `MSMAT_S`{.envar}, or `PSMAT_S`{.envar}), as
previously mentioned. These matrices can have any number of
pollutant-to-species conversions; the **Spcmat** program will open
multiple speciation matrix output files if the number of
pollutant-to-species conversions is greater than 120 (the limit for the
number of variables in an I/O API file). **Spcmat** opens and writes as
many files with 120 variables (using the FileSetAPI wrapper) as are
needed to store the data. In addition, the **Spcmat** program writes a
supplementary speciation file (`ASSUP`{.envar}, `MSSUP`{.envar}, or
`PSSUP`{.envar}) that contains the speciation profile assignments for
each source. The structures of the SMOKE intermediate files output by
**Spcmat** are provided in [Section 9.13,
"**Spcmat**"](ch09s13.html "9.13. Spcmat").
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------- -------------------- ---------------------------
  [Prev](ch02s11s04.html)                             [Up](ch02s11.html)         [Next](ch02s12.html)
  2.11.4. Setting the order of the output species     [Home](index.html)     2.12. Spatial processing
  -------------------------------------------------- -------------------- ---------------------------
:::
::: {.navheader}
2.12. Spatial processing
:::

[Prev](ch02s11s05.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s12s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_spatial_processing}2.12. Spatial processing {#spatial-processing .title style="clear: both"}
-------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.12.1. Defining the gridded region to output from
SMOKE](ch02s12.html#d0e5849)]{.section}

[[2.12.2. Assigning sources to grid cells](ch02s12s02.html)]{.section}

[[2.12.3. Creating the spatial allocation intermediate
files](ch02s12s03.html)]{.section}
:::

The spatial processing operation, or [*gridding*]{.emphasis}, combines
the grid specification for the air-quality modeling domain with source
locations from the SMOKE inventory file. The resulting gridding matrix
is a sparse matrix that describes in which grid cells the emissions for
each source occur within the modeling domain. The gridding matrix is
applied to the inventory emissions to transform source-based inventory
emissions to gridded emissions.

The SMOKE **Grdmat** program creates the gridding matrix for area,
mobile, and point sources. The gridding step is different depending on
the type of source being processed.

::: {.itemizedlist}
-   For area sources, county-total emissions are spread among the cells
    intersecting the county through the use of gridding surrogates.

-   For mobile sources, the data can be provided by county (as area
    sources are), or the data can be provided as line sources
    ("[links]{.quote}"). County-based mobile emissions are apportioned
    with gridding surrogates, preferably with surrogates based on the
    different road types for which the mobile emissions are provided.
    The line-source emissions are apportioned depending on the length of
    the link in each cell.

-   For point sources, emissions are apportioned to the grid cell
    intersecting the point.
:::

As shown in [Figure 2.22, "Relationship between inventory and gridding
matrix"](ch02s12.html#fig_concepts_spatial_processing "Figure 2.22. Relationship between inventory and gridding matrix"),
the gridding matrix contains the SMOKE source IDs that intersect each
grid cell, and the source-to-cell factors for each. The gridding matrix
is a sparse matrix because each source intersects only a small number of
cells relative to the total number of cells in the domain, and the
storage format shown in the figure reflects a sparse storage format. In
the example in [Figure 2.22, "Relationship between inventory and
gridding
matrix"](ch02s12.html#fig_concepts_spatial_processing "Figure 2.22. Relationship between inventory and gridding matrix"),
source 1 intersects cells 1 and 2, with 10% of the emissions in cell 1
and 30% of the emissions in cell 2. The remainder of the source's
emissions (60%) are either outside the grid or in other cells not shown
in this example. Source 2 is completely inside the domain; 40% of its
emissions are in cell 1, 30% are in cell 2, and 30% are in cell 4. If
this were a point-source speciation matrix, there would be only one cell
associated with each source because each point source exists in only one
cell.

::: {.figure}
[]{#fig_concepts_spatial_processing}

**Figure 2.22. Relationship between inventory and gridding matrix**

::: {.mediaobject}
![Relationship between inventory and gridding
matrix](images\concepts\spatial_processing_html.jpg)
:::
:::

Note that the gridding matrix depends only upon the source locations,
the grid definition, and in some cases gridding surrogates and
cross-references. It is therefore independent of the other steps of
emissions processing.

Spatial processing addresses the following issues during emissions
processing:

::: {.orderedlist}
1.  Defining the gridded region to output from SMOKE

2.  Assigning sources to grid cells

3.  Creating the spatial allocation intermediate files
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5849}2.12.1. Defining the gridded region to output from SMOKE {#defining-the-gridded-region-to-output-from-smoke .title}

</div>

</div>
:::

The grid for which the spatial allocation step outputs the gridding
matrix depends upon the `IOAPI_GRIDNAME_1`{.envar} environment variable
setting and the `GRIDDESC`{.envar} input file. The file contains all of
the settings needed by the I/O API to define each grid (together, these
settings are called a grid definition), and it contains many such grid
definitions. The `IOAPI_GRIDNAME_1`{.envar} setting selects the specific
grid to use during a specific run, and it must match the grid name
provided in the `GRIDDESC`{.envar} file. The settings used by the I/O
API to define a grid are documented as part of the [I/O API web
site](http://www.baronams.com/products/ioapi/GRIDDESC.html).

There is another file format, called the `G_GRIDPATH`{.envar} file, that
can be provided to **Grdmat** instead of the `GRIDDESC`{.envar} file.
However, the `G_GRIDPATH`{.envar} format allows only one grid per file.
It is included as an acceptable input to SMOKE to allow SMOKE to be
backwardly compatible with previous versions. All new users are advised
to use a single `GRIDDESC`{.envar} file to store all of their modeling
grids, instead of using multiple `G_GRIDDPATH`{.envar} files, one for
each grid. The `IOAPI_GRIDNAME_1`{.envar} setting is not used by
**Grdmat** when the `G_GRIDPATH`{.envar} format is used.

The gridded region selected at run time does not need to cover all of
the counties in the inventory. If the gridded region is smaller than the
inventory, this processing step will still include the counties or parts
of counties that do not overlap the grid. This allows users who are
performing emissions processing using nested grids to import the
inventory once and apply gridding matrices for each grid to the same
inventory, creating gridded emissions for all nested grids without
having to adjust the inventory files. The downside of this approach is
that SMOKE does not give a warning if a county that is in the inventory
is not in the spatial surrogates, or if a lat-lon coordinate is not
inside the grid. It assumes that these sources are intended to be
dropped and proceeds without comment. Thus, you must ensure that your
surrogate files contain the counties in your inventory that are inside
the grid and that your lat-lon coordinates for point and link sources
are correct.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------- -------------------- ------------------------------------------
  [Prev](ch02s11s05.html)                             [Up](ch02.html)                       [Next](ch02s12s02.html)
  2.11.5. Creating speciation intermediate files     [Home](index.html)     2.12.2. Assigning sources to grid cells
  ------------------------------------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
2.12.2. Assigning sources to grid cells
:::

[Prev](ch02s12.html) 

2.12. Spatial processing

 [Next](ch02s12s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e5900}2.12.2. Assigning sources to grid cells {#assigning-sources-to-grid-cells .title}

</div>

</div>
:::

::: {.toc}
[[2.12.2.1. Spatial allocation of area/nonpoint, nonroad mobile, and
on-road mobile nonlink sources](ch02s12s02.html#d0e5905)]{.section}

[[2.12.2.2. Spatial allocation of area-to-point
sources](ch02s12s02.html#d0e5977)]{.section}

[[2.12.2.3. Spatial allocation of pregridded
sources](ch02s12s02.html#d0e5985)]{.section}

[[2.12.2.4. Spatial allocation of on-road mobile link
sources](ch02s12s02.html#d0e5993)]{.section}

[[2.12.2.5. Spatial allocation of point
sources](ch02s12s02.html#d0e6018)]{.section}
:::

SMOKE takes a different approach to assigning sources to grid cells for
each SMOKE source category and some special cases. In the following
subsections, we describe the concepts of spatial allocation of (1)
area/nonpoint, nonroad, mobile, and on-road mobile nonlink sources; (2)
area-to-point sources; (3) pregridded area sources, (4) on-road mobile
link sources, and (5) point sources.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e5905}2.12.2.1. Spatial allocation of area/nonpoint, nonroad mobile, and on-road mobile nonlink sources {#spatial-allocation-of-areanonpoint-nonroad-mobile-and-on-road-mobile-nonlink-sources .title}

</div>

</div>
:::

The area/nonpoint, nonroad mobile, and on-road mobile nonlink sources
all have emissions in the inventory with county-total values. To
spatially allocate these emissions, factors must be assigned to each
source to distribute the county-total emissions across the grid cells
that intersect the county. This is accomplished using a
cross-referencing approach that assigns a spatial surrogate to each
source in the inventory.

The spatial surrogates files, located in `SRGPRO_PATH`{.envar} contain
factors for allocating emissions from a county-total to a gridded value,
and there are usually many sets of factors available for each county.
The data in this file are used to estimate the spatial distribution of
county-total emissions inside the county. These sets of factors are
calculated from other data that are available at a finer resolution than
the county data, such as census tracks. Examples of commonly available
surrogates are population, housing, urban area, rural area, agriculture,
water, railroads, major highways, airports, ports, and forest. To ensure
correct emissions processing, it is essential that all counties within
the inventory and domain be included in the spatial surrogates file. If
any counties inside the domain are left out of the file, then SMOKE will
not be able to detect this; instead, it will act as though the county is
outside of the domain and drop the emissions.

The general case of cross-referencing and profiles was described in
[Section 2.4, "Cross-referencing and
profiles"](ch02s04.html "2.4. Cross-referencing and profiles"). During
spatial allocation with the **Grdmat** program, the spatial
cross-reference file (`AGREF`{.envar} or `MGREF`{.envar}) assigns
spatial surrogates for area/nonpoint, nonroad mobile, and on-road mobile
nonlink sources. The spatial cross-reference file associates SCCs with a
spatial surrogate code, which is an arbitrary positive integer code that
also appears in the spatial surrogates file along with the spatial
surrogate data. It is important to ensure (if possible) that the spatial
surrogate codes assigned to each SCC are actually available in the
surrogate file for all counties in the inventory with that SCC. For
example, if the water surrogate is assigned to motorboat sources in a
given county, the spatial surrogate file should have values for the
water surrogate in that county. If this is not the case, SMOKE will be
forced to use a "[fallback]{.quote}" surrogate, defined with the
`SMK_DEFAULT_SRGID`{.envar} environment variable setting, which assigns
a surrogate that is defined for every county in the domain.
`SMK_DEFAULT_SRGID`{.envar} is mandatory and must be set to the
population surrogate code listed in the `SRGDESC`{.envar} file. The
population surrogate in this case serves two purposes; 1) It defines all
the FIPS codes contained within the gridded domain which reduces I/O in
the gridding process and 2) this fallback approach prevents the
emissions for that county and source category from being dropped from
the emissions processing. **Grdmat** produces warnings in the log file
whenever the fallback surrogate is used. If the fallback surrogate also
causes the emissions to go to zero, an additional warning that indicates
the emissions are being dropped is also written to the **Grdmat** log
file. It is to the the users discretion to use the fallback described in
purpose 2. This is set by the `SMK_USE_FALLBACK`{.envar} environment
variable either set as \[Y/N\].

The surrogate codes are defined, described and a reference to the
spatial surrogate files listed in the surrogate description file
`SRGDESC`{.envar} which is likewise set as the environment variable
`SRGDESC`{.envar}. Because the surrogate codes are arbitrarily assigned,
you need to make sure that the spatial cross-reference is developed in
conjunction with the spatial surrogates so that the surrogate codes used
in each are consistent. It is not generally wise to develop surrogates
without a cross-reference, unless the surrogate codes used in the
surrogates file are set to the same values that are in a spatial
cross-reference file that is already available. In other words, the
surrogate codes in `SRGDESC`{.envar}, `AMGREF`{.envar} and
`AMGPRO`{.envar} should be in aggrement.

[Figure 2.23, "Spatial allocation of county-total
emissions"](ch02s12s02.html#fig_concepts_spatial_allocation_county "Figure 2.23. Spatial allocation of county-total emissions")
illustrates spatial allocation of all county-based emissions sources.
The box at the left represents a grid with a single county, shaded in
gray to represent an emissions value in that county. The arrow
represents the spatial allocation steps. The box at right shows that all
grid cells that intersect the county have emissions contributed by the
county. Cells that intersect more of the county are shown in darker
colors, simulating the effect of using area surrogates. The darker cells
could also represent cells in which a large city causes the population
surrogate to concentrate the emissions in those cells, while the
surrounding regions within the county have lower emissions.

::: {.figure}
[]{#fig_concepts_spatial_allocation_county}

**Figure 2.23. Spatial allocation of county-total emissions**

::: {.mediaobject}
![Spatial allocation of county-total
emissions](images\concepts\spatial_allocation_county_html.jpg)
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e5977}2.12.2.2. Spatial allocation of area-to-point sources {#spatial-allocation-of-area-to-point-sources .title}

</div>

</div>
:::

In some cases, the inventory import processing (by the **Smkinven**
program) will have assigned point locations to some of the county-based
inventory sources such as airports. Spatial allocation for these sources
ignores the assigned surrogate, sets the surrogate assignment to 0, and
uses the point-source locations and assigned fractions to determine the
cells and associated magnitudes of the emissions from the county-total
source.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e5985}2.12.2.3. Spatial allocation of pregridded sources {#spatial-allocation-of-pregridded-sources .title}

</div>

</div>
:::

When pregridded data are provided to SMOKE, the spatial allocation step
must still be run. In this case, **Grdmat** just maps the pregridded
emissions to the correct cells and outputs a simple gridding matrix that
is used in later processing steps to maintain the pregridded nature of
the inventory.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e5993}2.12.2.4. Spatial allocation of on-road mobile link sources {#spatial-allocation-of-on-road-mobile-link-sources .title}

</div>

</div>
:::

On-road mobile link sources are straight line segments within a county
that have emissions and/or VMT data associated with them as well as the
latitudes and longitudes of the starting and ending positions of the
link. SMOKE determines the fraction of each link within each grid cell,
and then assigns the emissions or VMT from the link to those grid cells
that the link intersects, by weighting the emissions according to the
length of the link within a grid cell divided by the total length of the
link.

As shown in [Figure 2.24, "Spatial allocation of on-road mobile link
sources"](ch02s12s02.html#fig_concepts_spatial_allocation_link "Figure 2.24. Spatial allocation of on-road mobile link sources"),
three link sources in the left-hand diagram are joined at their ends to
represent a road cutting through the county. As shown in the figure,
link sources do not bisect county boundaries (new link sources would be
used to continue the road into an adjoining county). The three portions
of the link have different VMT values, as represented by the three
different shades of gray that highlight the link. The arrow represents
the spatial allocation step. In the right-hand diagram, the cells that
intersect the link sources are shaded, with darker shading used in cells
in which the link intersects the cell more and the link has higher VMT.

::: {.figure}
[]{#fig_concepts_spatial_allocation_link}

**Figure 2.24. Spatial allocation of on-road mobile link sources**

::: {.mediaobject}
![Spatial allocation of on-road mobile link
sources](images\concepts\spatial_allocation_link_html.jpg)
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6018}2.12.2.5. Spatial allocation of point sources {#spatial-allocation-of-point-sources .title}

</div>

</div>
:::

Spatial allocation of point sources in **Grdmat** is very
straightforward. The **Grdmat** program simply determines which cell the
lat-lon coordinates are in and assigns all emissions from that source to
a single grid cell. Except for (1) plume-in-grid sources for all models
and (2) elevated sources for UAM-based models (both addressed in
[Section 2.15, "Elevated-source
processing"](ch02s15.html "2.15. Elevated-source processing"), this
means that the AQMs do not have information about where in the grid cell
the point source is located.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -------------------------------------------------------------
  [Prev](ch02s12.html)         [Up](ch02s12.html)                                        [Next](ch02s12s03.html)
  2.12. Spatial processing     [Home](index.html)     2.12.3. Creating the spatial allocation intermediate files
  --------------------------- -------------------- -------------------------------------------------------------
:::
::: {.navheader}
2.12.3. Creating the spatial allocation intermediate files
:::

[Prev](ch02s12s02.html) 

2.12. Spatial processing

 [Next](ch02s13.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6032}2.12.3. Creating the spatial allocation intermediate files {#creating-the-spatial-allocation-intermediate-files .title}

</div>

</div>
:::

The last task for the spatial allocation processing is creating the
gridding intermediate files. The **Grdmat** program creates a gridding
matrix (`AGMAT`{.envar}, `MGMAT`{.envar}, or `PGMAT`{.envar}) and for
on-road mobile sources an ungridding matrix (`MUMAT`{.envar}). These
matrices contain all of the factors needed to calculate gridded
emissions from a source-based inventory. In addition, the **Grdmat**
program writes a supplementary output file (`AGSUP`{.envar} or
`MGSUP`{.envar}) that contains the spatial surrogates assigned for each
source, indicates whether the assignment was a primary or a fallback,
and identifies area-to-point sources. The structures of the SMOKE
intermediate files output by **Grdmat** are provided in [Section 9.4,
"**Grdmat**"](ch09s04.html "9.4. Grdmat").
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- --------------------------
  [Prev](ch02s12s02.html)                     [Up](ch02s12.html)        [Next](ch02s13.html)
  2.12.2. Assigning sources to grid cells     [Home](index.html)     2.13. Growth processing
  ------------------------------------------ -------------------- --------------------------
:::
::: {.navheader}
2.13. Growth processing
:::

[Prev](ch02s12s03.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s13s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_growth_processing}2.13. Growth processing {#growth-processing .title style="clear: both"}
-----------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.13.1. Assigning growth factors](ch02s13.html#d0e6164)]{.section}

[[2.13.2. Reporting on the factors assigned to each source in the
inventory](ch02s13s02.html)]{.section}

[[2.13.3. Creating the growth matrix](ch02s13s03.html)]{.section}

[[2.13.4. Applying the growth matrix](ch02s13s04.html)]{.section}

[[2.13.5. Creating a grown inventory file](ch02s13s05.html)]{.section}
:::

Growth processing creates emission data sets for years other than a year
for which an emissions inventory is available. For example, if an
inventory is available for 1996, but the modeling effort involves
predicting ozone levels in 2007, then the emissions inventory must be
grown to the year 2007. Previous versions of this document used the term
"[projection]{.quote}" for this function; in this version, however,
"[projection]{.quote}" refers to both growth of emissions (which is
covered in this subsection) and control of emissions (addressed in
[Section 2.14, "Control
processing"](ch02s14.html "2.14. Control processing")). The **Cntlmat**
program performs both growth and control functions. For growth
processing, **Cntlmat** creates a growth matrix that contains the growth
factors for each source and pollutant in the inventory. The **Grwinven**
program then combines the growth matrix with the emission inventory to
create a grown emission inventory.

If no new sources are being added when moving from the inventory year to
the future year, then **Grwinven** can be used with the base case
inventory and the growth matrix based on it. If new sources must be
added, then the data structuring step (performed by **Smkinven**) must
be rerun for the new number of sources, followed by running **Cntlmat**
to create the growth matrix; then **Grwinven** applies the matrix to the
new inventory file. Alternatively, users may elect to prepare a
future-year inventory outside of SMOKE and import it directly with
**Smkinven**, which skips the **Cntlmat** and **Grwinven** steps.

[Figure 2.25, "Relationship between inventory sources and growth
matrix"](ch02s13.html#fig_concepts_growth_processing "Figure 2.25. Relationship between inventory sources and growth matrix")
shows the relationship between the inventory and the growth matrix
created by **Cntlmat**, which consists of columns for each pollutant
being grown from one year to another. The entries in the matrix are the
growth factors needed to grow the inventory to a future or past year;
note that these entries can be greater than, equal to, or less than 1
depending on if the emissions should increase, stay the same, or
decrease after the inventory is grown. If the growth factors are the
same for every pollutant in the inventory, then only one column, called
"[pfac]{.quote}", is included in the growth matrix, rather than using
duplicate columns for every pollutant. The growth matrix depends only
upon the growth factors and the inventory, so it is therefore
independent of other factor-based operations for emissions processing;
however, growth of the inventory (using the **Grwinven** program) must
occur before the temporal allocation step when creating model-ready
emissions using inventories grown with SMOKE.

::: {.figure}
[]{#fig_concepts_growth_processing}

**Figure 2.25. Relationship between inventory sources and growth
matrix**

::: {.mediaobject}
![Relationship between inventory sources and growth
matrix](images\concepts\growth_processing_html.jpg)
:::
:::

**Grwinven** combines the intermediate inventory files with one or more
growth matrices to create a new intermediate inventory file with the
same structure as the original file but with a future (or past) year
stored in the header of this file.

In growth processing, the **Cntlmat** program addresses the following
emissions processing needs when creating the growth matrix:

::: {.orderedlist}
1.  Assigning growth factors

2.  Reporting on the factors assigned to each source in the inventory

3.  Creating the growth matrix
:::

The **Grwinven** program addresses the remaining needs to create a grown
inventory:

::: {.orderedlist}
4.  Applying the growth matrix

5.  Creating a grown inventory file
:::

Each of the issues in the list above is addressed in the following
subsections, in the order in which they appear in the list.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6164}2.13.1. Assigning growth factors {#assigning-growth-factors .title}

</div>

</div>
:::

The **Cntlmat** program assigns growth factors using a cross-reference
approach similar to the approaches used for chemical speciation and
gridding. **Cntlmat** reads the information about the growth factors
from the /PROJECTION/ packet in the control input file
(`GCNTL`{.envar}). As described in detail in [Section 6.2,
"**Cntlmat**"](ch06s02.html "6.2. Cntlmat"), `GCNTL`{.envar} can assign
growth factors by state/county FIPS code, SCC, SIC, MACT, pollutant, and
various combinations of these. The most specific entry is selected by
**Cntlmat** based on the hierarchy described in [Section 6.2,
"**Cntlmat**"](ch06s02.html "6.2. Cntlmat"). Since the /PROJECTION/
packet includes both the cross-referencing information and the growth
factors, there is no need for a profile file (like those used for
chemical speciation). The growth factors may include both positive
growth (factors greater than 1) or negative growth (factors less than 1)
or no growth (factors equal to 1).

The /REACTIVITY/ packet can also be used to grow emissions to a future
or past year, but a different approach is used that includes a
"[phase-in]{.quote}" period and other differences. We describe this
packet in [Section 2.14, "Control
processing"](ch02s14.html "2.14. Control processing").
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------------- -------------------- ----------------------------------------------------------------------------
  [Prev](ch02s12s03.html)                                         [Up](ch02.html)                                                         [Next](ch02s13s02.html)
  2.12.3. Creating the spatial allocation intermediate files     [Home](index.html)     2.13.2. Reporting on the factors assigned to each source in the inventory
  ------------------------------------------------------------- -------------------- ----------------------------------------------------------------------------
:::
::: {.navheader}
2.13.2. Reporting on the factors assigned to each source in the
inventory
:::

[Prev](ch02s13.html) 

2.13. Growth processing

 [Next](ch02s13s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6218}2.13.2. Reporting on the factors assigned to each source in the inventory {#reporting-on-the-factors-assigned-to-each-source-in-the-inventory .title}

</div>

</div>
:::

In addition to actually applying the growth factors, the growth
processing reports the factors that were applied to each source.
**Cntlmat** writes a report that includes the source characteristics and
the factor from the /PROJECTION/ packet assigned to the source. For
example, the area-source report would include the state, county, and
SCCs along with the factor assigned to the source. Only those sources
that have growth factors applied are included in the report. This report
permits you to verify that the assignments you intended were in fact
made by the program. The report is called the `APROJREP`{.envar},
`MPROJREP`{.envar}, or `PPROJREP`{.envar} file for SMOKE area, mobile,
and point sources, respectively.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -------------------------------------
  [Prev](ch02s13.html)        [Up](ch02s13.html)                [Next](ch02s13s03.html)
  2.13. Growth processing     [Home](index.html)     2.13.3. Creating the growth matrix
  -------------------------- -------------------- -------------------------------------
:::
::: {.navheader}
2.13.3. Creating the growth matrix
:::

[Prev](ch02s13s02.html) 

2.13. Growth processing

 [Next](ch02s13s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6235}2.13.3. Creating the growth matrix {#creating-the-growth-matrix .title}

</div>

</div>
:::

The growth matrix created by **Cntlmat** contains the growth factors for
each source and pollutant. If pollutant-specific growth factors are
used, the growth matrix contains one column for each pollutant that is
grown. The names of the columns are the same as the names of the
pollutants from the SMOKE inventory file, so that the **Grwinven**
program knows which column to apply to which inventory pollutant. If the
growth factors are applied uniformly to all pollutants in the inventory,
then **Cntlmat** does not output a separate but identical factor for
each pollutant. Instead, it writes only one column in the matrix, with
the name "[pfac]{.quote}".
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------------------------------- -------------------- -------------------------------------
  [Prev](ch02s13s02.html)                                                       [Up](ch02s13.html)                [Next](ch02s13s04.html)
  2.13.2. Reporting on the factors assigned to each source in the inventory     [Home](index.html)     2.13.4. Applying the growth matrix
  ---------------------------------------------------------------------------- -------------------- -------------------------------------
:::
::: {.navheader}
2.13.4. Applying the growth matrix
:::

[Prev](ch02s13s03.html) 

2.13. Growth processing

 [Next](ch02s13s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_apply_growth_with_grwinven}2.13.4. Applying the growth matrix {#applying-the-growth-matrix .title}

</div>

</div>
:::

The **Grwinven** program applies the growth factors to the inventory
pollutants by simply multiplying the growth matrices for the pollutants
with the annual and average-day emission values. It reads in the SMOKE
intermediate inventory file and up to 80 growth matrices, then applies
the growth factors from all growth matrices to the appropriate
pollutants. If a growth matrix has the "[pfac]{.quote}" variable,
**Grwinven** applies the factors to all pollutants in the inventory; if
instead the matrix has pollutant-specific entries, the factors are
applied by matching the pollutants between the matrix and the inventory.

As is further described in [Section 2.14, "Control
processing"](ch02s14.html "2.14. Control processing"), **Grwinven** can
also apply the control matrix at the same time it applies the growth
matrix, and the total number of growth and control matrices that can be
applied in one run is 80. The **Grwinven** program's growth processing
features cannot be applied to a SMOKE intermediate file that
**Grwinven** has created, because of the /FYEAR/ header element
described in the next section.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------- -------------------- ------------------------------------------
  [Prev](ch02s13s03.html)                [Up](ch02s13.html)                     [Next](ch02s13s05.html)
  2.13.3. Creating the growth matrix     [Home](index.html)     2.13.5. Creating a grown inventory file
  ------------------------------------- -------------------- ------------------------------------------
:::
::: {.navheader}
2.13.5. Creating a grown inventory file
:::

[Prev](ch02s13s04.html) 

2.13. Growth processing

 [Next](ch02s14.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6279}2.13.5. Creating a grown inventory file {#creating-a-grown-inventory-file .title}

</div>

</div>
:::

After applying the growth factors to the SMOKE intermediate inventory
file, the **Grwinven** program writes a new SMOKE intermediate inventory
file that contains the new, grown emissions. **Grwinven** only writes
the I/O API part of the inventory and not the ASCII part, because the
ASCII part that contains the state/county codes, SCCs, and other
character strings does not change between the base and future or past
year. All of the sources in the base and grown inventory files are the
same; the difference is in their emissions values.

**Grwinven** adds a header element to the I/O API part of the inventory
file that indicates the file was created using **Grwinven** and a growth
matrix. The header element is /FYEAR/, which is followed by the date of
the future year (for example, /FYEAR/ 2018). Other programs (such as
**Temporal**) will recognize the /FYEAR/ header element and alter its
messages to indicate that a future year is being processed.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------- -------------------- ---------------------------
  [Prev](ch02s13s04.html)                [Up](ch02s13.html)         [Next](ch02s14.html)
  2.13.4. Applying the growth matrix     [Home](index.html)     2.14. Control processing
  ------------------------------------- -------------------- ---------------------------
:::
::: {.navheader}
2.14. Control processing
:::

[Prev](ch02s13s05.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s14s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_control_processing}2.14. Control processing {#control-processing .title style="clear: both"}
-------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.14.1. Assigning control factors from six control packets to the
sources](ch02s14.html#d0e6364)]{.section}

[[2.14.2. Creating the multiplicative control
matrix](ch02s14s02.html)]{.section}

[[2.14.3. Creating the reactivity control
matrix](ch02s14s03.html)]{.section}

[[2.14.4. Reporting on factors assigned to each source in the
inventory](ch02s14s04.html)]{.section}

[[2.14.5. Using **Grwinven** to apply the multiplicative control
matrices](ch02s14s05.html)]{.section}

[[2.14.6. Creating a controlled intermediate inventory
file](ch02s14s06.html)]{.section}

[[2.14.7. Using **Smkmerge** to apply the multiplicative and/or
reactivity control matrices](ch02s14s07.html)]{.section}
:::

The control processing operation applies control factors from a control
input file (`GCNTL`{.envar}) based on source characteristics in the
inventory. A control scenario involves changing the values of emissions
based on regulations affecting industrial activities or personal
behaviors. The resulting control matrix, created by the **Cntlmat**
program, takes the form of the matrix shown in [Figure 2.25,
"Relationship between inventory sources and growth
matrix"](ch02s13.html#fig_concepts_growth_processing "Figure 2.25. Relationship between inventory sources and growth matrix").
The control matrix depends only upon the source characteristics in the
SMOKE inventory and the set of controls chosen, so control processing
can therefore be decoupled from the rest of the processing steps. The
**Cntlmat** program performs control processing for SMOKE area, mobile,
and point sources; however, much more complex controls for on-road
mobile sources can also be implemented when using MOVES through SMOKE to
calculate emission factors and apply them to VMT.

The emissions control factors can be applied in addition to the
emissions growth factors (described in [Section 2.13, "Growth
processing"](ch02s13.html "2.13. Growth processing")), and the net
effect of this growth and control is called "[projection]{.quote}".
SMOKE control processing can create two types of control matrices during
a given run: a multiplicative control matrix and a reactivity control
matrix.

The **Cntlmat** program performs the following emissions processing
steps in creating the control matrices:

::: {.orderedlist}
1.  Assigning control factors from six control packets to the sources

2.  Creating the multiplicative control matrix

3.  Creating the reactivity control matrix

4.  Reporting on factors assigned to each source in the inventory
:::

The **Grwinven** program addresses the following control processing
steps:

::: {.orderedlist}
5.  Applying the multiplicative control matrices to the inventory

6.  Creating a controlled intermediate inventory file
:::

Finally, the **Smkmerge** program can be used to perform the following
control processing step:

::: {.orderedlist}
7.  Applying the multiplicative and/or reactivity control matrices to
    the inventory to create model-ready inputs
:::

The next seven subsections explain the concepts involved with these
processing steps in more detail.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6364}2.14.1. Assigning control factors from six control packets to the sources {#assigning-control-factors-from-six-control-packets-to-the-sources .title}

</div>

</div>
:::

SMOKE provides six control packets with which users can control
emissions:

::: {.itemizedlist}
-   /MACT/ contains MACT-based assignments for toxics inventories and
    can be used to apply general MACT controls to sources affected by
    MACT regulations. This packet contributes to the multiplicative
    control matrix.

-   /CONTROL/ contains settings for control efficiency, rule
    effectiveness, and rule penetration that can be applied by nearly
    any combination of source characteristics, even targeting a specific
    source. This packet contributes to the multiplicative control
    matrix. This packet cannot appear in the same input file with an
    /EMS\_CONTROL/ packet.

-   /EMS\_CONTROL/ contains settings for control efficiency, rule
    effectiveness, and rule penetration for both the base year
    [*and*]{.emphasis} a future year. It also contains a point-source
    conversion factor and an aggregated control factor that can override
    everything else in the packet. This packet contributes to the
    multiplicative control matrix. This packet cannot appear in the same
    input file with a /CONTROL/ packet, and it can be used for point
    sources only.

-   /CTG/ contains settings for control technology guideline (CTG)
    controls, MACT controls, and reasonably available control technology
    (RACT) controls. It contributes to the multiplicative control
    matrix.

-   /ALLOWABLE/ contains county-specific, SIC-specific, SCC-specific
    controls, caps, and replacement emissions. It contributes to the
    multiplicative control matrix.

-   /REACTIVITY/ contains settings needed for reactivity-based controls
    and its use results in the reactivity control matrix.
:::

[Section 6.2, "**Cntlmat**"](ch06s02.html "6.2. Cntlmat") describes the
**Cntlmat** program in more detail, including the cross-reference
hierarchy of these packets and how they relate to one another. All
packets can be included in a single **Cntlmat** run, with the exception
of the /CONTROL/ and /EMS\_CONTROL/ packets (either one or the other of
these can be included, but not both). In general, these packets can
assign control factors by state/county FIPS code, SCC, SIC, MACT,
pollutant, other plant-specific source characteristics, and various
combinations of these.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------ -------------------- -----------------------------------------------------
  [Prev](ch02s13s05.html)                      [Up](ch02.html)                                  [Next](ch02s14s02.html)
  2.13.5. Creating a grown inventory file     [Home](index.html)     2.14.2. Creating the multiplicative control matrix
  ------------------------------------------ -------------------- -----------------------------------------------------
:::
::: {.navheader}
2.14.2. Creating the multiplicative control matrix
:::

[Prev](ch02s14.html) 

2.14. Control processing

 [Next](ch02s14s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6400}2.14.2. Creating the multiplicative control matrix {#creating-the-multiplicative-control-matrix .title}

</div>

</div>
:::

**Cntlmat** creates the multiplicative control matrix based on the
information contained in the /MACT/, /CONTROL/, /EMS\_CONTROL/, /CTG/,
and /ALLOWABLE/ packets. The specific details of how these packets
interact and how the control factors are calculated is described in the
**Cntlmat** section of [Section 6.2,
"**Cntlmat**"](ch06s02.html "6.2. Cntlmat"). Once the control factors
have been calculated, **Cntlmat** writes a multiplicative control matrix
file that contains one column of control factors for each pollutant;
each row in the matrix represents a source. The names of the columns are
the same as the names of the pollutants from the SMOKE inventory file,
so that either the **Grwinven** or the **Smkmerge** program knows which
control column to apply to which inventory pollutant.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------- -------------------- -------------------------------------------------
  [Prev](ch02s14.html)         [Up](ch02s14.html)                            [Next](ch02s14s03.html)
  2.14. Control processing     [Home](index.html)     2.14.3. Creating the reactivity control matrix
  --------------------------- -------------------- -------------------------------------------------
:::
::: {.navheader}
2.14.3. Creating the reactivity control matrix
:::

[Prev](ch02s14s02.html) 

2.14. Control processing

 [Next](ch02s14s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_create_reactivity}2.14.3. Creating the reactivity control matrix {#creating-the-reactivity-control-matrix .title}

</div>

</div>
:::

Reactivity controls have been included in SMOKE to allow users to
examine what happens to the air quality modeling results when the
chemical mixture of the emissions is changed to reduce its ozone-forming
potential. Examining the effect of reactivity controls is known as
"[reactivity assessment]{.quote}". The implementation of this type of
control includes permitting users to reset the base-year emissions,
reset the SCC, and reset the chemical speciation profile. The controls
can be applied to all sources that match an SCC or a specific facility
or process within a facility.

Several issues are important when addressing emissions processing
requirements for reactivity assessments. Reactivity assessment involves
replacing one compound in the inventory by another compound. This
replacement can impact emission projections, the total magnitude of the
inventory pollutants, and the associated SCCs. The market penetration of
the replacement compound may vary in time and space, which affects the
future-year emissions. Also, the replacement compound may be needed in
much greater or much smaller amounts, thereby affecting the total
inventory emissions. Finally, if a different process is required in
order for a source to use the different compound, the SCC for that
source may change.

The scale of the reactivity assessment is important; it could be local,
statewide, or national. A local case could involve investigating
reactivity for one source. A statewide case could be implementing a
change in compound based on reactivity considerations for a State
Implementation Plan (SIP), and this would affect sources across the
state. A national case could involve an EPA investigation of the
formulation of nationally distributed consumer products.

In addition, exemptions from controls for certain sources must be
permitted as part of an emissions control strategy. These exemptions can
occur when a reactivity assessment determines that certain compounds
and/or processes do not significantly affect pollution formation.

To address these issues, SMOKE is able to target changes in a VOC for
specific classes of VOC emissions, and address the spatial and temporal
considerations implied by market penetration issues. Furthermore, when
replacement options are being investigated, the correct replacement
operations are facilitated by SMOKE. These operations include selecting
sources, changing underlying pollutant emissions, changing SCCs,
correctly projecting future-year emissions based in part on market
penetration issues, and appropriately speciating emissions for the new
compound.

For a single run of **Cntlmat**, reactivity controls can be applied to
only one pollutant, typically a VOC pollutant. Therefore, if you have
more than one VOC pollutant in the inventory (e.g., a toxics VOC and a
particulate pollutant), then separate reactivity matrices will need to
be created for each pollutant that receives reactivity controls, and
these controls will need to be applied in separate SMOKE runs (see
[Section 2.14.7, "Using **Smkmerge** to apply the multiplicative and/or
reactivity control
matrices"](ch02s14s07.html "2.14.7. Using Smkmerge to apply the multiplicative and/or reactivity control matrices")
for more information).
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------- -------------------- ------------------------------------------------------------------------
  [Prev](ch02s14s02.html)                                [Up](ch02s14.html)                                                   [Next](ch02s14s04.html)
  2.14.2. Creating the multiplicative control matrix     [Home](index.html)     2.14.4. Reporting on factors assigned to each source in the inventory
  ----------------------------------------------------- -------------------- ------------------------------------------------------------------------
:::
::: {.navheader}
2.14.4. Reporting on factors assigned to each source in the inventory
:::

[Prev](ch02s14s03.html) 

2.14. Control processing

 [Next](ch02s14s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6444}2.14.4. Reporting on factors assigned to each source in the inventory {#reporting-on-factors-assigned-to-each-source-in-the-inventory .title}

</div>

</div>
:::

In addition to assigning the control factors, **Cntlmat** also creates
reports detailing the factors applied to each source. These reports
include the source characteristics and the factors assigned to the
sources. The reports are:

::: {.itemizedlist}
-   [**`ACREP`{.envar}, `MCREP`{.envar}, or `PCREP`{.envar}:**]{.bold}
    For area and mobile sources, this report includes emissions before
    and after all multiplicative controls have been applied by state,
    county, and SCC. For point sources, the report includes emissions
    before and after all multiplicative controls by facility.

-   [**`AREACREP`{.envar}, `MREACREP`{.envar}, or
    `PREACREP`{.envar}:**]{.bold} For pollutants controlled with
    reactivity controls (usually VOC), this report includes source
    number, base-year emissions, replacement base-year emissions,
    projection factor, future-year SCC, future-year speciation profile
    number, and market penetration rate of reactivity control. This
    report is the only reactivity report that can be generated by SMOKE
    since the **Smkreport** program cannot yet import and apply the
    reactivity matrix to generate reports.

-   [**`ACSUMREP`{.envar}, `MCSUMREP`{.envar}, or
    `PCSUMREP`{.envar}:**]{.bold} For each source, this report includes
    the specific multiplicative controls that were applied to each
    source. It includes the emissions before and after each control, as
    well as the control factor that was applied. The control packet from
    which each control came is included in the report. The reactivity
    controls are not included in this report.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------- -------------------- --------------------------------------------------------------------------
  [Prev](ch02s14s03.html)                            [Up](ch02s14.html)                                                     [Next](ch02s14s05.html)
  2.14.3. Creating the reactivity control matrix     [Home](index.html)     2.14.5. Using **Grwinven** to apply the multiplicative control matrices
  ------------------------------------------------- -------------------- --------------------------------------------------------------------------
:::
::: {.navheader}
2.14.5. Using **Grwinven** to apply the multiplicative control matrices
:::

[Prev](ch02s14s04.html) 

2.14. Control processing

 [Next](ch02s14s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6495}2.14.5. Using **Grwinven** to apply the multiplicative control matrices {#using-grwinven-to-apply-the-multiplicative-control-matrices .title}

</div>

</div>
:::

The **Grwinven** program applies the multiplicative control matrices to
the inventory pollutants by multiplying the control factors for the
pollutants with the annual and average-day emission values. (Reactivity
matrices cannot be applied by **Grwinven**; only the **Smkmerge**
program can apply those, as discussed in [Section 2.14.7, "Using
**Smkmerge** to apply the multiplicative and/or reactivity control
matrices"](ch02s14s07.html "2.14.7. Using Smkmerge to apply the multiplicative and/or reactivity control matrices").)
**Grwinven** reads in the SMOKE intermediate inventory file and up to 80
control matrices and then applies the control factors from all matrices
to the appropriate pollutants.

As discussed in [Section 2.13.4, "Applying the growth
matrix"](ch02s13s04.html "2.13.4. Applying the growth matrix"), the
**Grwinven** program can also apply growth matrices at the same time it
applies control matrices, and the total number of growth and control
matrices that can be applied in one run is 80. If desired, the control
processing features of **Grwinven** can be used on a SMOKE intermediate
file that has been created by **Grwinven** with grown and/or controlled
emissions, as long as no [*growth*]{.emphasis} processing features are
included in that second pass. (See section [Section 2.13.4, "Applying
the growth
matrix"](ch02s13s04.html "2.13.4. Applying the growth matrix") for
discussion of this restriction on applying growth matrices, caused by
**Grwinven**'s addition of the /FYEAR/ header element.)
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------------------------ -------------------- ------------------------------------------------------------
  [Prev](ch02s14s04.html)                                                   [Up](ch02s14.html)                                       [Next](ch02s14s06.html)
  2.14.4. Reporting on factors assigned to each source in the inventory     [Home](index.html)     2.14.6. Creating a controlled intermediate inventory file
  ------------------------------------------------------------------------ -------------------- ------------------------------------------------------------
:::
::: {.navheader}
2.14.6. Creating a controlled intermediate inventory file
:::

[Prev](ch02s14s05.html) 

2.14. Control processing

 [Next](ch02s14s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e6538}2.14.6. Creating a controlled intermediate inventory file {#creating-a-controlled-intermediate-inventory-file .title}

</div>

</div>
:::

After applying the control factors to the SMOKE intermediate inventory
file, the **Grwinven** program writes a new SMOKE intermediate inventory
file that contains the new, controlled emissions. **Grwinven** writes
only the I/O API part of the inventory and not the ASCII part, because
the ASCII part that contains the state/county codes, SCCs, and other
character strings does not change between the base and future or past
year. All of the sources in the base and controlled inventory files are
the same; the difference is in their emissions values.

**Grwinven** can also output the ORL inventory format (in addition to
I/O API format), which is also a SMOKE input format.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------------------------------- -------------------- --------------------------------------------------------------------------------------------
  [Prev](ch02s14s05.html)                                                     [Up](ch02s14.html)                                                                       [Next](ch02s14s07.html)
  2.14.5. Using **Grwinven** to apply the multiplicative control matrices     [Home](index.html)     2.14.7. Using **Smkmerge** to apply the multiplicative and/or reactivity control matrices
  -------------------------------------------------------------------------- -------------------- --------------------------------------------------------------------------------------------
:::
::: {.navheader}
2.14.7. Using **Smkmerge** to apply the multiplicative and/or reactivity
control matrices
:::

[Prev](ch02s14s06.html) 

2.14. Control processing

 [Next](ch02s15.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_apply_controls_with_smkmerge}2.14.7. Using **Smkmerge** to apply the multiplicative and/or reactivity control matrices {#using-smkmerge-to-apply-the-multiplicative-andor-reactivity-control-matrices .title}

</div>

</div>
:::

The **Smkmerge** program is a second option for applying control
matrices. **Smkmerge** can apply both multiplicative control matrices
and reactivity control matrices; it is the only program that can do the
latter. Because the overall purpose of **Smkmerge** is to create the
model-ready input files for an AQM (as discussed in [Section 2.18,
"Creating model-ready
emissions"](ch02s18.html "2.18. Creating model-ready emissions"), the
result of using **Smkmerge** to apply control matrices is a controlled,
model-ready file, as opposed to the controlled intermediate inventory
file output by **Grwinven**.

**Smkmerge** is limited to applying one control matrix and one
reactivity matrix for each SMOKE source category (area, mobile, or
point). Therefore, if multiple reactivity control matrices need to be
applied to create a single set of model-ready emission inputs, then the
processing must be done as multiple SMOKE runs. This includes separating
the sources that need different controls into separate inventory files
and performing all SMOKE processing steps separately on the runs, using
different reactivity controls for each. The resulting two or more sets
of model-ready emissions should not have duplicate sources if the
inventories were separated correctly at the start, and the model-ready
files are combined using the **Mrggrid** program, as discussed in
[Section 2.18, "Creating model-ready
emissions"](ch02s18.html "2.18. Creating model-ready emissions").
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------------ -------------------- -----------------------------------
  [Prev](ch02s14s06.html)                                       [Up](ch02s14.html)                 [Next](ch02s15.html)
  2.14.6. Creating a controlled intermediate inventory file     [Home](index.html)     2.15. Elevated-source processing
  ------------------------------------------------------------ -------------------- -----------------------------------
:::
::: {.navheader}
2.15. Elevated-source processing
:::

[Prev](ch02s14s07.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s15s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_elevated_processing}2.15. Elevated-source processing {#elevated-source-processing .title style="clear: both"}
----------------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.15.1. Computing layer fractions for
CMAQ](ch02s15.html#sect_concepts_compute_layer_cmaq)]{.section}

[[2.15.2. Creating an elevated-source file for UAM and
CAM~X~](ch02s15s02.html)]{.section}
:::

As introduced in [Section 2.5.3, "Model-ready
files"](ch02s05s03.html "2.5.3. Model-ready files") and further
explained in [Section 2.8.5, "Point-source
processing"](ch02s08s05.html "2.8.5. Point-source processing"), there
are two major approaches to processing elevated point sources for air
quality modeling. The first approach is to have SMOKE compute the layer
assignments for the point sources; this method is used for the CMAQ
model. The second approach, which is used for the UAM models and CAM~X~,
is to select specific sources as elevated and then create a special
elevated-point-source file that contains the information needed so that
the AQM can compute the plume rise. In both cases, users can select
elevated sources specifically (in the second approach, that selection is
mandatory). Also, PinG sources can be selected in both cases.

The two approaches have some steps that are the same and some that are
different. The rest of this section is split into the following two
subsections, one for each elevated-point-source processing approach:

::: {.orderedlist}
1.  Computing layer fractions for CMAQ

2.  Creating an elevated-source file for UAM and CAM~X~
:::

Each subsection first overviews the steps in the approach, then gives
more details on some of them.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_compute_layer_cmaq}2.15.1. Computing layer fractions for CMAQ {#computing-layer-fractions-for-cmaq .title}

</div>

</div>
:::

::: {.toc}
[[2.15.1.1. Using **Elevpoint**](ch02s15.html#d0e6672)]{.section}

[[2.15.1.2. Using **Laypoint**](ch02s15.html#d0e6719)]{.section}

[[2.15.1.3. Using **Smkmerge**](ch02s15.html#d0e6751)]{.section}

[[2.15.1.4. Optional use of
**Smkreport**](ch02s15.html#d0e6772)]{.section}
:::

The CMAQ model requires the layer fractions for elevated point sources
to be computed by SMOKE. To do this, SMOKE performs the following steps:

::: {.itemizedlist}
-   Uses the **Smkinven** program to import the annual, average-day,
    day-specific, and/or hour-specific emissions.

-   Optionally uses the **Temporal** program to calculate hourly
    emissions if emissions will be used as a criterion for selecting
    elevated sources or PinG sources. For example, you may wish to
    select facilities with NO~x~ emissions greater than 100 tons/day.

-   Uses the **Elevpoint** program to select elevated and/or PinG
    sources. This step is required if modeling with PinG sources, but
    optional otherwise.

-   Uses the **Elevpoint** program to create the `STACK_GROUPS`{.envar}
    file, which is needed for processing PinG sources with CMAQ.

-   Uses the **Laypoint** program to compute elevated plume rise for all
    elevated sources, and store the layer fractions for each source.
    This step can optionally read the output file from **Elevpoint** to
    identify the elevated sources, but otherwise will compute plume rise
    for [*all*]{.emphasis} sources.

-   Uses the **Smkmerge** program to combine the layer fractions with
    the hourly emissions to generate the model-ready output files and
    optionally generate the PinG hourly emissions file for CMAQ.

-   Optionally uses the **Smkreport** program to report on elevated or
    PinG sources
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6672}2.15.1.1. Using **Elevpoint** {#using-elevpoint .title}

</div>

</div>
:::

**Elevpoint** can select elevated and PinG sources using multiple
criteria based on emissions values, emissions rank, stack parameters,
plant numbers, and an analytical plume rise calculation. The elevated
criteria and PinG criteria are provided to **Elevpoint** using a file
called `PELVCONFIG`{.envar}. You must configure this file to contain the
criteria needed to select elevated and PinG source (if these selection
are needed at all). If emissions values is one of the criteria, the
**Elevpoint** program reads all of the hourly point-source files using
the `PTMPLIST`{.envar} file. This file is a list of all `PTMP`{.envar}
files that will be evaluated to determine which sources have maximum
daily emissions that exceed the specified selection criteria or to
determine the emissions rank. Only the maximum daily facility-total
emissions can be used by **Elevpoint** to select sources based on
emissions.

The elevated sources and PinG sources can each be selected using
different criteria. In general, there are many more elevated sources
than PinG sources for typical applications of SMOKE and AQMs.
**Elevpoint** also permits you to group PinG sources and creates the
`STACK_GROUPS`{.envar} file so that the sources are treated as a single
source in the PinG rise calculation by CMAQ. Grouping is useful to
reduce the total number of PinG stacks processed by CMAQ (PinG
processing is a computationally expensive calculation). Using grouping
makes sense when several stacks at the same plant have the same, or
nearly the same, stack parameters. When that is true, the emissions from
the multiple stacks can be grouped and treated as a single PinG stack.
Finally, there are two SMOKE settings (`SMK_ELEV_METHOD`{.envar} and
`SMK_PING_METHOD`{.envar}) that instruct **Elevpoint** and other SMOKE
programs to actually use these criteria to select the elevated and PinG
sources. If these settings are not set to "[1]{.quote}" the elevated and
PinG selections will not be made, and so will not affect any further
processing steps.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6719}2.15.1.2. Using **Laypoint** {#using-laypoint .title}

</div>

</div>
:::

In this CMAQ approach, **Laypoint** uses gridded, hourly meteorological
data and stack parameters to calculate the plume rise for all
point-source emissions. The program's approach is based on the Briggs
algorithm, as explained in detail in [Section 6.3.1.1, "Plume rise
calculation"](ch06s03.html#sect_programs_elevpoint_briggs "6.3.1.1. Plume rise calculation"),
and provides the top and bottom heights of the plume. **Laypoint** uses
these heights to compute the plumes' distributions into the vertical
layers that the plumes intersect, using the pressure difference across
each layer over the pressure difference across the entire plume as a
weighting factor to make this calculation. This approach gives plume
fractions by layer and source. Only these fractions are stored in the
output file (`PLAY`{.envar}) from the **Laypoint** program (not the
emissions in each layer).

If explicit plume rise sources (e.g., wildfires with precomputed hourly
plume rise) are included in the inventory, **Laypoint** will skip the
plume rise calculation for these sources. Instead, it will use the
hourly data from the SMOKE `PHOUR`{.envar} intermediate file, which
describe the fraction of emissions in layer 1 and the top and bottom of
the plume. **Laypoint** will combine these data with the pressure
weights used for all elevated point sources to compute the fraction of
emissions to go into each layer.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6751}2.15.1.3. Using **Smkmerge** {#using-smkmerge .title}

</div>

</div>
:::

**Smkmerge** applies the layer fractions from **Laypoint** to the
elevated sources to compute the emissions in each layer. This approach
has the advantage of allowing you to avoid repeating the plume rise
calculations for each control strategy or grid. If the
`SMK_PING_METHOD`{.envar} setting (discussed above) indicates that the
special CMAQ PinG file should be created, the **Smkmerge** program will
also output this special file, called the `PINGTS_L`{.envar} file. It
contains the hourly, speciated emissions for each PinG source (which
could be a stack group, as explained above).
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6772}2.15.1.4. Optional use of **Smkreport** {#optional-use-of-smkreport .title}

</div>

</div>
:::

If desired, **Smkreport** can apply the layer fractions and elevated or
PinG statuses to the inventory to generate reports that include layer
information and/or the elevated or PinG status. This reporting could be
used, for example, to create a list of all PinG sources in the
inventory, or to determine the elevated versus layer-1 emissions by
state or SCC.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------------------------------------------------- -------------------- --------------------------------------------------------------
  [Prev](ch02s14s07.html)                                                                        [Up](ch02.html)                                           [Next](ch02s15s02.html)
  2.14.7. Using **Smkmerge** to apply the multiplicative and/or reactivity control matrices     [Home](index.html)     2.15.2. Creating an elevated-source file for UAM and CAM~X~
  -------------------------------------------------------------------------------------------- -------------------- --------------------------------------------------------------
:::
::: {.navheader}
2.15.2. Creating an elevated-source file for UAM and CAM~X~
:::

[Prev](ch02s15.html) 

2.15. Elevated-source processing

 [Next](ch02s16.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_concepts_create_elevated_uam}2.15.2. Creating an elevated-source file for UAM and CAM~X~ {#creating-an-elevated-source-file-for-uam-and-camx .title}

</div>

</div>
:::

::: {.toc}
[[2.15.2.1. Using **Elevpoint**](ch02s15s02.html#d0e6841)]{.section}

[[2.15.2.2. Using **Laypoint**](ch02s15s02.html#d0e6862)]{.section}

[[2.15.2.3. Using **Smkmerge**](ch02s15s02.html#d0e6905)]{.section}
:::

The other approach to modeling elevated sources is to create an
elevated-point-source input file for one of the UAM models or CAM~X~. To
do this, SMOKE performs the following steps:

::: {.itemizedlist}
-   Uses the **Smkinven** program to import the annual, average-day,
    day-specific, and/or hour-specific emissions.

-   Optionally uses the **Temporal** program to calculate hourly
    emissions if emissions will be used as a criterion for selecting
    elevated sources or PinG sources. For example, you may wish to
    select facilities with NO~x~ emissions greater than 100 tons/day.

-   Uses the **Elevpoint** program to select elevated and optionally
    PinG sources. Unlike processing for CMAQ, this step is always
    required.

-   Uses the **Elevpoint** program to create the `STACK_GROUPS`{.envar}
    file, which is needed for creating the elevated-point-source file
    with **Smkmerge**.

-   Uses the **Laypoint** program to compute elevated plume rise for
    explicit plume rise sources, and store the layer fractions for the
    explicit sources only.

-   Uses the **Smkmerge** program to combine the `STACK_GROUPS`{.envar}
    information, optional explicit plume rise information, and the
    hourly emissions to generate an ASCII elevated-point-source file
    with optional PinG flags.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6841}2.15.2.1. Using **Elevpoint** {#using-elevpoint .title}

</div>

</div>
:::

The primary difference between this approach is that the **Elevpoint**
processing step is required. Traditionally, elevated point sources have
been selected for the UAM or CAM~X~ models using the analytical plume
rise calculation. While **Elevpoint** can perform this calculation and
use it exclusively to determine the elevated sources, you can also use
the other selection criteria if desired: emissions values, emissions
rank, stack parameters, and plant numbers. As described in
[Section 2.15.1, "Computing layer fractions for
CMAQ"](ch02s15.html#sect_concepts_compute_layer_cmaq "2.15.1. Computing layer fractions for CMAQ"),
if the selection criteria include emissions, then the `PTMPLIST`{.envar}
file will be used to input all hourly emissions files for the entire
modeling episode.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6862}2.15.2.2. Using **Laypoint** {#using-laypoint .title}

</div>

</div>
:::

If explicit plume rise sources (e.g., wildfires with precomputed hourly
plume rise) are included in the inventory, you must run the **Laypoint**
program to compute the layer fractions for these sources only. This is
the [*only*]{.emphasis} reason **Laypoint** would be run in the
UAM/CAM~X~ processing approach, and it requires that the
`EXPLICIT_PLUMES_YN`{.envar} and the `HOUR_PLUMEDATA_YN`{.envar}
settings be set to Y. These settings cause **Laypoint** to write the
layer fractions to the `PLAY_EX`{.envar} file instead of to the usual
`PLAY`{.envar} file. For these explicit sources, **Laypoint** will skip
the plume rise calculation. Instead, it will use the hourly data from
the SMOKE `PHOUR`{.envar} intermediate file containing the fraction of
emissions in layer 1 and the top and bottom of the plume. **Laypoint**
will combine these data with the pressure weights used for all elevated
point sources to compute the fraction of emissions to go into each
layer.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e6905}2.15.2.3. Using **Smkmerge** {#using-smkmerge .title}

</div>

</div>
:::

The **Smkmerge** program looks for the `SMK_ASCIIELEV_YN`{.envar}
setting to determine whether the ASCII output file should be created.
When this is set to Y, the output files from **Elevpoint**
(`PELV`{.envar} and `STACK_GROUPS`{.envar}) are read to determine which
sources should not be included in the 2-D emissions output file for
point sources. The emissions from these sources are instead output to an
ASCII elevated file along with stack parameters and locations so that
the AQM can compute the plume rise.

If `EXPLICIT_PLUMES_YN`{.envar} is also set to Y, **Smkmerge** will read
the `PLAY_EX`{.envar} file for the explicit plume sources. Since the
UAM-based approach assumes that the AQM will compute the plume rise,
SMOKE must manipulate the input file to trick the model into using
precomputed plume rise. This is done by inserting fake stacks into the
ASCII elevated file that extend to the center of each of the model
layers and setting the stack parameters so that the plume rise
calculation will keep the emissions associated with the fake stacks in
the layer of the stack. As the emissions move from layer to layer,
**Smkmerge** moves the reported emissions in the ASCII elevated file
from fake stack to fake stack to represent the same behavior.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------- -------------------- --------------------------------------------
  [Prev](ch02s15.html)                 [Up](ch02s15.html)                          [Next](ch02s16.html)
  2.15. Elevated-source processing     [Home](index.html)     2.16. Mobile-source processing with MOVES
  ----------------------------------- -------------------- --------------------------------------------
:::
::: {.navheader}
2.16. Mobile-source processing with MOVES
:::

[Prev](ch02s15s02.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s16s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_onroad_processing_moves}2.16. Mobile-source processing with MOVES {#mobile-source-processing-with-moves .title style="clear: both"}
-----------------------------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.16.1. Meteorology Data Processing](ch02s16.html#d0e7006)]{.section}

[[2.16.2. MOVES Model Processing](ch02s16s02.html)]{.section}

[[2.16.3. SMOKE Model Processing](ch02s16s03.html)]{.section}
:::

MOVES is the U.S. Environmental Protection Agency\'s (EPA) Motor Vehicle
Emission Simulator. In the modeling process, the user specifies vehicle
types, time periods, geographical areas, pollutants, vehicle operating
characteristics, and road types to be modeled. The model then performs a
series of calculations, which have been carefully developed to
accurately reflect vehicle operating processes (such as cold start or
extended idle) and provide estimates of bulk emissions or emission
rates.

An important feature of MOVES is that it allows users to choose between
(1) the Inventory calculation type, which provides emission rates in
terms of total quantity of emissions for a given time period; and (2)
Emission Rate calculation type, which gives emission rates in terms of
grams/mile or grams/vehicle/hour. For large-scale emissions modeling
such as that needed for regional- and national-scale air quality
modeling projects, it is desirable to use the Emission Rate calculation
type, which populates emission rate lookup tables that can then be
applied to many times and places, thus reducing the total number of
MOVES runs required.

To reduce the time and effort and to help the user obtain more accurate
modeling results, users need to prepare and post-process MOVES runs for
a representative county (See [Section 2.8.4.6, "Representative
Counties"](ch02s08s04.html#sect_concepts_reference_counties_moves "2.8.4.6. Representative Counties"))
and reference fuel month (See [Section 2.8.4.7, "Reference Fuel
month"](ch02s08s04.html#sect_concepts_moves_reference_fuel_month "2.8.4.7. Reference Fuel month"))
This approach consists of a set of scripts that automate the proper use
of the Emission Rate calculations for the purpose of estimating
mobile-source emissions for air quality (AQ) modeling.

Integrating MOVES into SMOKE modeling system consists of three major
parts:

1\) Meteorological data processing

::: {.itemizedlist}
-   The meteorological data preprocessor program
    [**Met4moves**](ch06s07.html "6.7. Met4moves") prepares spatially
    and temporally averaged temperatures and relative humidity data to
    set up the meteorological input conditions for MOVES and SMOKE using
    the Meteorology-Chemistry Interface Processor (MCIP) output files.
:::

2\) MOVES model processing

::: {.itemizedlist}
-   [The MOVES Driver
    script](ch05s02s02.html "5.2.2. MOVES Driver Scripts") :
    **"[Runspec\_generator.pl]{.quote}"** creates data importer files
    and the MOVES input file (runspec), which specifies the
    characteristics of the particular scenario to be modeled.
-   [The MOVES postprocessing
    scripts](ch05s02s04.html "5.2.4. MOVES Post-processing scripts") :
    **"[Moves2smkEF.pl]{.quote}"** formats the MOVES emission rate
    lookup tables for SMOKE. **"[gen\_8digit\_scc.pl]{.quote}"**
    generates an SCC mapping file used when importing activity data.
:::

3\) SMOKE model processing

::: {.itemizedlist}
-   Spatially and temporally allocate mobile onroad activity data (i.e.,
    Vehicle Mileage Traveled and Vehicle population).
-   The MOVES postprocessing program,
    [**Movesmrg**](ch06s08.html "6.8. Movesmrg"), estimates emissions
    from on-road mobile sources based on MOVES-based emission rate
    lookup tables and meteorology data from **Met4moves**.
-   Creates hourly gridded speciated air quality model-ready input
    files.
-   Produces various types of reports for users.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e7006}2.16.1. Meteorology Data Processing {#meteorology-data-processing .title}

</div>

</div>
:::

With the specified representative county and reference fuel month
approach for temperature and RH calculation for MOVES and SMOKE modeling
systems, **Met4moves** uses hourly min/max temperatures and averaged RH
over the spatial region that includes all of the inventory counties in a
county group over the user-defined modeling period. **Met4moves**
supports the averaging method (monthly or daily) to create min/max
temperatures and averaged RH for all inventory counties in the county
group(s). **Met4moves** determines the min/max grid cell temperatures
and associated RH for both SMOKE and MOVES, and computes average 24-hour
temperature profiles using Meteorology-Chemistry Interface Processor
(MCIP) output files for use in MOVES. These **Met4moves** program is
discussed in detail in [Section 6.7,
"**Met4moves**"](ch06s07.html "6.7. Met4moves").

The 24-hour temperature profiles are averaged over a user-specified time
period and grid cells for all representative counties. For [the MOVES
Driver scripts](ch05s02.html "5.2. MOVES Utility Scripts"),
**Met4moves** outputs monthly average RH, min/max temperatures, and
24-hour temperature profiles in local time for all representative
counties into one output file. For the SMOKE model, **Met4moves**
outputs county-specific min/max temperatures and averaged RH values in
local time for every inventory county and averaging period in the
modeling inventory.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------------------- -------------------- ---------------------------------
  [Prev](ch02s15s02.html)                                          [Up](ch02.html)              [Next](ch02s16s02.html)
  2.15.2. Creating an elevated-source file for UAM and CAM~X~     [Home](index.html)     2.16.2. MOVES Model Processing
  -------------------------------------------------------------- -------------------- ---------------------------------
:::
::: {.navheader}
2.16.2. MOVES Model Processing
:::

[Prev](ch02s16.html) 

2.16. Mobile-source processing with MOVES

 [Next](ch02s16s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e7036}2.16.2. MOVES Model Processing {#moves-model-processing .title}

</div>

</div>
:::

::: {.toc}
[[2.16.2.1. MOVES Driver Script](ch02s16s02.html#d0e7039)]{.section}

[[2.16.2.2. MOVES Post-processing
Script](ch02s16s02.html#d0e7060)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e7039}2.16.2.1. MOVES Driver Script {#moves-driver-script .title}

</div>

</div>
:::

The inputs to [the MOVES Driver
Script](ch05s02s02.html "5.2.2. MOVES Driver Scripts")
(**Runspec\_generator.pl**) include the temperature and humidity
conditions output from **Met4moves** and two additional inputs, the
RunControl and RepCounty files. The RunControl file contains pollutant
selections and the file path location to the **Met4moves** output. The
RepCounty file contains file path locations to user-created
MOVES-formatted inputs for age distribution, fuel supply and
formulation, inspection and maintenance programs, county level
population and annual VMT for each representative county. Precise
formats of the RunControl and RepCounty files can be found in the
[Section 8.9.2.2.2, "Representative County File for MOVES Driver
Script"](ch08s09s02.html#sect_input_refcountyfile "8.9.2.2.2. Representative County File for MOVES Driver Script")
and [Section 8.9.2.2.1, "Run Control File for MOVES Driver
Script"](ch08s09s02.html#sect_input_runctlfile "8.9.2.2.1. Run Control File for MOVES Driver Script").
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e7060}2.16.2.2. MOVES Post-processing Script {#moves-post-processing-script .title}

</div>

</div>
:::

A MOVES Driver Script to automates the MOVES run setups and prepare two
kinds of batch files. When launched, the batch files instruct MOVES to:

::: {.itemizedlist}
-   import data into MySQL County Scale databases

-   run MOVES for each runspec file
:::

The resulting RatePerDistance (RPD), RatePerVehicle (RPV),
RatePerProfile (RPP), and RatePerHour (RPH) tables contain all the
conditions needed for regional modeling using SMOKE modeling system.

Once a MOVES batch run completes, MOVES populates the four output lookup
tables with formats listed in [Table 2.10, "MOVES Emission Rate Lookup
Table (MOVES
Format)"](ch02s16s02.html#tbl_concepts_moves_lookup_tbl_mv_format "Table 2.10. MOVES Emission Rate Lookup Table (MOVES Format)").
A [MOVES Post-processing
Script](ch05s02s04.html "5.2.4. MOVES Post-processing scripts")
(**Moves2smkEF.pl**) in Perl interacts with MySQL to modify the default
formats shown in [Table 2.10, "MOVES Emission Rate Lookup Table (MOVES
Format)"](ch02s16s02.html#tbl_concepts_moves_lookup_tbl_mv_format "Table 2.10. MOVES Emission Rate Lookup Table (MOVES Format)")
into a text ASCII-format readable by SMOKE, shown in [Table 2.11, "MOVES
Emission Rate Lookup Table (SMOKE
Format)"](ch02s16s02.html#tbl_concepts_moves_lookup_tbl_sm_format "Table 2.11. MOVES Emission Rate Lookup Table (SMOKE Format)").

::: {.table}
[]{#tbl_concepts_moves_lookup_tbl_mv_format}

**Table 2.10. MOVES Emission Rate Lookup Table (MOVES Format)**

RatePerDistance (grams/mile)
:::
:::
:::

RatePerVehicle (grams/vehicle/hour)

RatePerProfile (grams/vehicle/hour)

RatePerHour (grams/activity-hour)

MOVESScenarioID

MOVESScenarioID

MOVESScenarioID

MOVESScenarioID

MOVESRunID

MOVESRunID

MOVESRunID

MOVESRunID

yearID

yearID

temperatureProfileID

yearID

monthID

monthID

yearID

monthID

dayID

dayID

dayID

dayID

hourID

hourID

hourID

hourID

linkID

zoneID

pollutantID

linkID

pollutantID

pollutantID

processID

pollutantID

processID

processID

sourceTypeID

processID

sourceTypeID

sourceTypeID

SCC

sourceTypeID

SCC

SCC

fuelTypeID

SCC

fuelTypeID

fuelTypeID

modelYearID

fuelTypeID

modelYearID

modelYearID

Temperature

modelYearID

roadTypeID

Temperature

RatePerProfile

roadTypeID

avgSpeedBinID

RatePerVehicle

 

Temperature

Temperature

 

 

RatePerHour

relHumidity

 

 

 

RatePerDistance

 

 

 

The MOVES Post-processing Script converts the MOVES format Emission Rate
Lookup Table to the SMOKE format Emission Rate Table by performing the
following:

::: {.itemizedlist}
-   Parses the state-county FIPS code from linkID, zoneID or
    TemperatureProfileID and stores it as a unique field, FIPS.

-   Removes fields that are uninformative to SMOKE, including the MOVES
    source type, fuel type and road type, hourID in RatePerDistance,
    TemperatureProfileID in RatePerProfile.

-   Reduces the output database table size by performing a cross-tab
    query on the pollutant emissions, listing each pollutant in a
    separate field rather than in a single column with a higher number
    of data records. The script also sorts the lookup tables by
    countyID, monthID and SCC for more efficient processing in SMOKE.

-   Optionally calculates additional output pollutants or species by
    applying user-specified formulas to MOVES-created emission factors.

-   Write out to the ASCII-formatted four processed SMOKE-ready MOVES
    lookup tables \[RatePerDistance (RPD), RatePerVehicle (RPV),
    RatePerProfile (RPP), and RatePerHour (RPH)\].
:::

::: {.table}
[]{#tbl_concepts_moves_lookup_tbl_sm_format}

**Table 2.11. MOVES Emission Rate Lookup Table (SMOKE Format)**

RatePerDistance (grams/mile)
:::

RatePerVehicle (grams/vehicle/hour)

RatePerProfile (grams/vehicle/hour)

RatePerHour (grams/activity-hour)

MOVESScenarioID

MOVESScenarioID

MOVESScenarioID

MOVESScenarioID

yearID

yearID

yearID

yearID

monthID

monthID

monthID

monthID

FIPS

dayID

dayID

FIPS

SCC

hourID

hourID

SCC

avgSpeedBin

FIPS

FIPS

temperature

temperature

SCC

SCC

CO

relHumidity

temperature (for each grid cell)

temperature (24hr temporal profile)

TOG

CO

CO

THC

BENZENE

TOG

NOX

TOG

NOX

BENZENE

PM10OC

VOC

VOC

\...

\...

\...

\...

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------- -------------------- ---------------------------------
  [Prev](ch02s16.html)                          [Up](ch02s16.html)            [Next](ch02s16s03.html)
  2.16. Mobile-source processing with MOVES     [Home](index.html)     2.16.3. SMOKE Model Processing
  -------------------------------------------- -------------------- ---------------------------------
:::
::: {.navheader}
2.16.3. SMOKE Model Processing
:::

[Prev](ch02s16s02.html) 

2.16. Mobile-source processing with MOVES

 [Next](ch02s17.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e7399}2.16.3. SMOKE Model Processing {#smoke-model-processing .title}

</div>

</div>
:::

Once the **Met4moves** meteorology preprocessor and the MOVES model
processing that results in the SMOKE-formatted emissions factor lookup
tables are completed, we address the remaining major component of the
SMOKE-MOVES tool: the SMOKE model processing step. The goals of this
step are (1) to estimate emissions from on-road mobile sources based on
MOVES-based emissions lookup tables and meteorology data, (2) to create
hourly gridded speciated air quality model-ready input files, and (3) to
produce various types of reports for the user.

As some readers are aware, MOBILE6 and MOVES are both vehicle emissions
modeling systems used with SMOKE. However, they differ in their
approaches to calculating off-network evaporative emissions. In MOBILE6,
off-network emissions processes are calculated as emission factors in
grams/mile, which is related to Vehicle Mileage Travelled (VMT). MOVES,
on the other hand, uses the source (vehicle) type population (VPOP) to
calculate start and off-network evaporative emissions, which are
assigned to off-network emissions processes; these processes are
hour-dependent due to VPOP (activity) assumptions built into the MOVES
model. Thus, compared to the SMOKE-MOBILE6 approach, the SMOKE-MOVES
approach requires additional vehicle population inventory data as input
for estimating mobile-source emissions from off-network emissions
processes. This requirement is reflected in the discussion below.

When processing mobile-source emissions from MOVES, SMOKE performs the
following basic steps.

::: {.itemizedlist}
-   [**Smkinven**](ch06s13.html "6.13. Smkinven") imports county-total
    VMT and average speed, and county-total vehicle hotelling hours
    (HOTELLING) by SCC for On-roadway Emission Processes and
    county-total vehicle population (VPOP) by vehicle type for
    Off-network Emission Processes.
-   [**Spcmat**](ch06s15.html "6.15. Spcmat") computes the chemical
    speciation factors for each county, fuel type, source (=vehicle)
    type, road type, emission process, and pollutant, and stores the
    necessary factors for the VMT-to-species in RatePerDistance (RPD),
    HOTELLING-to-species in RatePerHour (RPH), and VPOP-to-species
    transformations in RatePerVehicle (RPV) and RatePerProfile (RPP).
-   [**Grdmat**](ch06s04.html "6.4. Grdmat") allocates the county
    sources to grid cells and uses spatial surrogates to allocate
    county-total VMT, HOTELLING, and VPOP to grid cells, storing the
    factors needed for these allocations.
-   [**Temporal**](ch06s16.html "6.16. Temporal") computes hourly VMT
    and HOTELLING activity data for On-roadway Emission Processes (RPD
    and RPH tables). Off-network Emission Processes (RPV and RPP tables)
    do not require the **Temporal** program because vehicle population
    does not need to be temporally allocated.
:::

The way the MOVES-generated emissions factor lookup tables are used
varies according to whether SMOKE is modeling on-roadway emission
processes or off-network emissions processes.

On-roadway emission processes: When estimates of all on-roadway emission
processes except for extended idle exhaust are needed, SMOKE requires
county-total VMT and average hourly speed (SPEED) inventory data as
inputs to a SMOKE postprocessor called **Movesmrg** which is part of the
SMOKE-MOVES tool. When extended idle exhaust process is estimated,
counthy-total HOTELLING activity data is needed for **Movesmrg**.
**Movesmrg** uses [the SMOKE-ready MOVES RPD and RPH lookup
tables](ch02s16s02.html#tbl_concepts_moves_lookup_tbl_sm_format "Table 2.11. MOVES Emission Rate Lookup Table (SMOKE Format)")
as an input to estimate on-road sources emission. The key lookup fields
for RPD are gridded hourly temperature and average hourly speed from the
avgSpeedBinID field for RPD. SMOKE interpolates in the emission factors
lookup table (in unit of grams/mile) based on gridded hourly temperature
and average speed. [Figure 2.13, "MOVES mobile RatePerDistance
processing
steps"](ch02s08s04.html#fig_concepts_mobile_moves_onroad "Figure 2.13. MOVES mobile RatePerDistance processing steps")
shows processing steps for on-roadway emissions processes in the SMOKE
system using VMT and SPEED activity inventory data. For RPH, the gridded
houlry temperature is used to interpolate in the emission factors lookup
table (in unit of grams/hour).

Off-network emission processes: When estimates are needed for
off-network emissions processes, including the off-network vapor venting
emissions process, SMOKE uses county-total VPOP by vehicle type as input
to **Movesmrg** together with the SMOKE-ready RatePerVehicle (RPV) and
RatePerProfile (RPP) lookup tables. [Figure 2.14, "MOVES mobile
RatePerVehicle and RatPereProfile (off-network) processing
steps"](ch02s08s04.html#fig_concepts_mobile_moves_offroad "Figure 2.14. MOVES mobile RatePerVehicle and RatPereProfile (off-network) processing steps")
shows processing steps for off-network emissions processes in the SMOKE
modeling system using vehicle population activity inventory data. A
significant difference in the processing steps between the on-roadway
emissions processes (RPD table) and the off-network emissions processes
(RPV and RPP tables) is that off-network emissions processing does not
require the **Temporal** program step because vehicle population (VPOP)
does not need to be temporally allocated. In the RPV table, gridded
hourly temperature and hour of the day are the key lookup fields SMOKE
uses to estimate hourly off-network emissions in unit of
grams/vehicle/hour. For the evaporative fuel off-network vapor venting
emissions process only, **Movesmrg** uses the RPP lookup table to
estimate the emission rates based on the minimum and maximum
temperatures computed by **Met4moves**.

For all SMOKE-ready three emission rate lookup tables (RPD, RPV, RPP),
SMOKE performs linear interpolation when using them.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------- -------------------- ----------------------------
  [Prev](ch02s16s02.html)            [Up](ch02s16.html)          [Next](ch02s17.html)
  2.16.2. MOVES Model Processing     [Home](index.html)     2.17. Biogenic processing
  --------------------------------- -------------------- ----------------------------
:::
::: {.navheader}
2.17. Biogenic processing
:::

[Prev](ch02s16s03.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s18.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_biogenic_processing}2.17. Biogenic processing {#biogenic-processing .title style="clear: both"}
---------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[2.17.1. BEIS3 processing](ch02s17.html#d0e7476)]{.section}
:::

The SMOKE system uses a more advanced emissions modeling approach for
biogenic processing than it uses for the other source types. For
biogenic emissions, the temporal processing is a true simulation model
driven by ambient meteorology and other data. SMOKE currently supports
two methods for computing biogenic land use: BEIS2 and BEIS3. The
overall processing performed by both these models is quite different
from the processing done for anthropogenic source categories. BEIS2 and
BEIS3 start with spatial allocation of land use data as the first
processing step (which is the same as importing the raw inventory data
for anthropogenic sources). They next compute normalized emissions for
each grid cell and land use category. The final step is adjusting the
normalized emissions based on gridded, hourly meteorology data and
assigning the chemical species to output a model-ready biogenic
emissions file. The following two subsections provide more detail about
the two biogenic models in SMOKE and give references to additional
detail elsewhere.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e7476}2.17.1. BEIS3 processing {#beis3-processing .title}

</div>

</div>
:::

The concepts in BEIS3 are similar to those in BEIS2, except the program
**Normbeis3** (instead of **Rawbio**) reads gridded land use data from
three files in I/O API input format (`BELD3_A`{.envar},
`BELD3_B`{.envar}, and `BELD3_TOT`{.envar}). Most users rely on the
BELD3 database to generate these gridded land use files, but other land
use databases may be used, provided the vegetation types and file
formats are consistent with the `BELD3_A`{.envar}, `BELD3_B`{.envar},
and `BELD3_TOT`{.envar} files. This database consists of high-resolution
(1-km horizontal resolution) land use data for 230 land use types.
**Normbeis3** creates normalized biogenic emissions for both winter and
summer. The **Tmpbeis3** program reads the MCIP meteorology data and
makes these adjustments; these include the effects of temperature and
solar radiation. The winter emission factors are to be used during the
\"winter\" period, which is defined as being after the first date of
freezing ground temperature and before the last date of freezing ground
temperature. The SMOKE **Metscan** program can determine this time
period and create a gridded file that indicates whether each grid cell
is in a winter or summer period for each day of the year. Using this
file, which is optional, will cause **Tmpbeis3** to read and use both
the winter and summer normalized emissions files from **Normbeis3**.
Whether the winter or summer normalized emissions are used for a given
grid cell and hour is set by the output from the **Metscan** program.
Users can define the chemical species that are output from **Tmpbeis3**
using the speciation profile file, `GSPRO`{.envar}. In this file, you
can set an environment variable (`BIOG_SPRO`{.envar}) that indicates
which speciation profile code should be used for biogenic emissions.
Note that this `GSPRO`{.envar} file is different than the one used for
BEIS2. More information on **Normbeis3** and **Tmpbeis3** is provided in
[Section 6.12, "**Normbeis3**"](ch06s12.html "6.12. Normbeis3") and
[Section 6.17, "**Tmpbeis3**"](ch06s17.html "6.17. Tmpbeis3").
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------- -------------------- ---------------------------------------
  [Prev](ch02s16s03.html)             [Up](ch02.html)                       [Next](ch02s18.html)
  2.16.3. SMOKE Model Processing     [Home](index.html)     2.18. Creating model-ready emissions
  --------------------------------- -------------------- ---------------------------------------
:::
::: {.navheader}
2.18. Creating model-ready emissions
:::

[Prev](ch02s17.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s19.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_merge_processing}2.18. Creating model-ready emissions {#creating-model-ready-emissions .title style="clear: both"}
-----------------------------------------------------------------------

</div>

</div>
:::

Creating emissions with SMOKE that are ready for input to an AQM must
always include merging the hourly emissions created during temporal
processing with the gridding matrices and the speciation matrices. In
addition, for point sources for CMAQ, creating the model-ready emissions
must also include merging with the layer fractions (see [Section 2.15.1,
"Computing layer fractions for
CMAQ"](ch02s15.html#sect_concepts_compute_layer_cmaq "2.15.1. Computing layer fractions for CMAQ")),
and for UAM-based models it must include creating the ASCII elevated
file (see [Section 2.15.2, "Creating an elevated-source file for UAM and
CAM~X~"](ch02s15s02.html "2.15.2. Creating an elevated-source file for UAM and CAMX")).
The **Smkmerge** program performs these processing steps using
vector-matrix multiplication to combine the matrices and layer fractions
with the hourly emissions vectors from the **Temporal** program.

If the overall SMOKE processing setup includes running the nonroad
mobile category (or other source categories) as separate runs (see
[Chapter 4, *How to Use
SMOKE*](ch04.html "Chapter 4. How to Use SMOKE"), then **Smkmerge**
cannot be used to combine all source categories into a single output
file. Instead, the [**Mrggrid**](ch06s08.html "6.8. Movesmrg") program
would combine the model-ready files from the individual source
categories; for example, from separate SMOKE (including **Smkmerge**)
runs for stationary area/nonpoint, nonroad mobile, windblown dust,
wildfire, on-road mobile, and point sources. There is no limit to the
number of model-ready files that **Mrggrid** can combine into a single
model-ready file, and the input files can be 2-D or 3-D.

**Smkmerge** can be run for any or all SMOKE source categories, but it
can use only one of each SMOKE inventory type (area, biogenic, mobile,
and point source) per run. You can run it to create model-ready files
for only one SMOKE source category (area, biogenic, mobile, or point),
or you can run it to create both the individual and combined model-ready
files. The following list indicates the modes in which **Smkmerge** can
be run:

::: {.itemizedlist}
-   Run for SMOKE area sources to create gridded, hourly, speciated
    emissions in moles/hour or moles/second. Can be used for all area
    sources and/or nonroad mobile sources.

-   Run for SMOKE mobile sources to create gridded, hourly, speciated
    emissions in moles/hour or moles/ second.

-   Run for SMOKE point sources to create 3-D gridded, hourly, speciated
    emissions in moles/ second for CMAQ, [*or*]{.emphasis} run to create
    2-D gridded, hourly, speciated emissions in moles/hour for UAM, or
    CAM~X~ and an ASCII elevated-point-source file.

-   Run to convert the units and calculate state and county totals of
    biogenic emissions output by the **Tmpbio** or **Tmpbeis3**
    programs.

-   Run to perform any combination of the previously listed steps
    simultaneously and create a combined model-ready file that includes
    multiple source categories. In this mode, only one each of SMOKE
    area, mobile, point, and biogenic sources can be included. The same
    output units must be used for all source categories in a single run.
:::

When creating model-ready emissions for any of the anthropogenic source
categories, you may choose to apply one or more control matrices to the
emissions to create controlled model-ready emissions. For each source
category (area, mobile, or point), you can apply one multiplicative
control matrix and one reactivity control matrix per run per source
category. **Smkmerge** is the only way you can apply the reactivity
control matrix to the inventory, while the multiplicative control matrix
can be applied by either **Smkmerge** or the **Grwinven** program.

Many processing steps in SMOKE are independent of one another; for
example, chemical speciation and temporal allocation can change without
affecting one another. This independence means that when one step
changes, another step does not need to be rerun in many cases. However,
because **Smkmerge** combines the data from all of these processing
steps to create the model-ready emissions, if one of the earlier steps
changes, then the merging step must also be rerun. This includes
rerunning **Smkmerge** to generate model-ready files, and if the
**Mrggrid** program was used, also rerunning that to merge data from
multiple source categories together.

**Smkmerge** also has the ability to input hourly emissions by day of
the week and reuse days that are the same. For example, it can input
separate hourly emissions files for Monday, a weekday, Saturday, and
Sunday, and use these four files to generate model-ready emissions for
every day in an entire month. This is accomplished using the
`MRG_BYDAY`{.envar} SMOKE option, described further in [Section 6.14,
"**Smkmerge**"](ch06s14.html "6.14. Smkmerge"). Special treatment can
also be given to holidays in this case, since users generally wish to
model holidays differently than other days.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------- -------------------- -----------------------------------------------------------------
  [Prev](ch02s17.html)           [Up](ch02.html)                                                 [Next](ch02s19.html)
  2.17. Biogenic processing     [Home](index.html)     2.19. Creating model-ready emissions using MOVES lookup tables
  ---------------------------- -------------------- -----------------------------------------------------------------
:::
::: {.navheader}
2.19. Creating model-ready emissions using MOVES lookup tables
:::

[Prev](ch02s18.html) 

Chapter 2. SMOKE Concepts

 [Next](ch02s20.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_merge_processing_moves}2.19. Creating model-ready emissions using MOVES lookup tables {#creating-model-ready-emissions-using-moves-lookup-tables .title style="clear: both"}
-------------------------------------------------------------------------------------------------------

</div>

</div>
:::

Creating emissions with SMOKE using MOVES lookup tables (i.e.,
RatePerDistance \[RPD\], RatePerHour \[RPH\], RatePerVehicle \[RPV\] and
RatePerProfile \[RPP\] ) must always include merging the gridding
matrices from **Grdmat** and the chemical speciation matrices from
**Spcmat**. In addition, for RPD emissions based on VMT data by source
for CMAQ, creating the model-ready emissions must also include merging
with the hourly VMT from **Temporal**. The **Movesmrg** program performs
these processing steps using vector-matrix multiplication to combine the
matrices and the hourly emissions vectors to create CMAQ-ready gridded
and speciated hourly emissions input data.

If the overall SMOKE processing setup includes running the nonroad
mobile category (or other source categories) as separate runs (see
[Chapter 4, *How to Use
SMOKE*](ch04.html "Chapter 4. How to Use SMOKE"), then **Movesmrg**
cannot be used to combine all source categories into a single output
file. Instead, the [**Mrggrid**](ch06s10.html "6.10. Mrggrid") program
would combine the model-ready files from the individual source
categories; for example, from separate SMOKE (including **Movesmrg**)
runs for RPD, RPV and RPP mobile sources. There is no limit to the
number of model-ready files that **Mrggrid** can combine into a single
model-ready file, and the input files can be 2-D or 3-D.

**Movesmrg** can be used only for MOVES-based mobile SMOKE source
categories. It can use only one of each MOVES lookup table (RPD, RPH,
RPV and RPV) per run. You can run it to create model-ready files for
only one SMOKE source category (RPD, RPH, RPV, and RPP). The following
list indicates the modes in which **Movesmrg** can be run:

::: {.itemizedlist}
-   Run for MOVES RPD mobile sources based on VMT data by vehicle and
    road types to create gridded, hourly, speciated emissions in
    moles/hour or moles/second.

-   Run for MOVES RPH mobile sources based on vehicle hotelling
    (HOTELLING) hours activity data by vehicle and road types to create
    gridded, hourly, speciated emissions in moles/hour or moles/second.

-   Run for MOVES RPV mobile sources based on Vehicle population (VPOP)
    data by vehicle to create gridded, hourly, speciated emissions in
    moles/hour or moles/second.

-   Run for MOVES RPP mobile sources based on Vehicle population (VPOP)
    data by vehicle to create gridded, hourly, speciated emissions in
    moles/hour or moles/second.

-   Run to create daily total emissions report by county, by state, and
    by SCC in the unit of tons/day or tons/hour.
:::

Many processing steps in SMOKE are independent of one another; for
example, chemical speciation and temporal allocation can change without
affecting one another. This independence means that when one step
changes, another step does not need to be rerun in many cases. However,
because **Movesmrg** combines the data from all of these processing
steps to create the model-ready emissions, if one of the earlier steps
changes, then the merging step must also be rerun. This includes
rerunning **Movesmrg** to generate model-ready files, and if the
**Mrggrid** program was used, also rerunning that to merge data from
multiple source categories together.

**Movesmrg** also has the ability to input hourly emissions by day of
the week and reuse days that are the same. For example, it can input
separate hourly emissions files for Monday, a weekday, Saturday, and
Sunday, and use these four files to generate model-ready emissions for
every day in an entire month. This is accomplished using the
`MRG_BYDAY`{.envar} SMOKE option, described further in [Section 6.8,
"**Movesmrg**"](ch06s08.html "6.8. Movesmrg"). Special treatment can
also be given to holidays in this case, since users generally wish to
model holidays differently than other days.
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------- -------------------- --------------------------
  [Prev](ch02s18.html)                      [Up](ch02.html)          [Next](ch02s20.html)
  2.18. Creating model-ready emissions     [Home](index.html)     2.20. Quality assurance
  --------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
2.20. Quality assurance
:::

[Prev](ch02s19.html) 

Chapter 2. SMOKE Concepts

 [Next](ch03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_concepts_qa_processing}2.20. Quality assurance {#quality-assurance .title style="clear: both"}
-------------------------------------------------------

</div>

</div>
:::

Quality assuring SMOKE emissions includes a combination of (1) steps
performed by SMOKE programs and (2) postprocessing steps performed by
the user.

The SMOKE components that play a role in quality assurance consist of
the following:

::: {.orderedlist}
1.  The various SMOKE programs perform file format checks of all input
    files to ensure that the files can be read. The programs write
    errors and warnings if files cannot be read properly.

2.  SMOKE gives error and warning messages about inventory data that are
    not complete or are invalid, and about problems or possible problems
    combining the inventory data with the support files.

3.  Core SMOKE programs create reports, such as the area-to-point report
    provided by **Smkinven** and the control reports provided by
    **Cntlmat**.

4.  The **Smkreport** program reports emissions totals at various levels
    of data aggregation. This reporting capability currently allows you
    to generate reports of emissions by source, SCC, region (e.g.,
    state, county, or user-defined region), road class, layer, hour,
    grid cell, speciation profile, gridding surrogate code, temporal
    profile, and elevated status. The most powerful reporting feature is
    that you can combine these reporting resolutions in
    [*any*]{.emphasis} combination. In addition, reports can be created
    at each stage of processing (import, gridding, speciation, temporal
    allocation, layer assignment) or any combination of stages.
:::

**Smkreport** can combine information from any SMOKE intermediate files
(e.g., intermediate inventory file, speciation matrix, gridding matrix)
to create emissions reports. One input file to **Smkreport**, called the
`REPCONFIG`{.envar} file, instructs **Smkreport** on how many and which
reports to create. The `REPCONFIG`{.envar} file contains a series of
instructions that can be set by the user to control the contents of the
reports. More details about **Smkreport** and the `REPCONFIG`{.envar}
are provided in [Section 7.2, "**Smkreport**
Program"](ch07s02.html "7.2. Smkreport Program") and [Section 7.3,
"`REPCONFIG`{.envar} Input
File"](ch07s03.html "7.3. REPCONFIG Input File").

The second major component of quality assuring the SMOKE emissions
processing involves users taking steps to evaluate the
information/reports provided by SMOKE. These steps include:

::: {.orderedlist}
1.  Check that the correct settings have been selected in the run
    scripts, including the settings that control which SMOKE programs
    are run.

2.  Check the log files from all SMOKE programs for errors and warnings.
    Errors will keep the programs from running successfully, so the
    source of the error must be identified and repaired. Warnings may
    indicate that a problem exists that needs to be addressed, or
    warnings can be ignored if they are not something that will impact
    the results for the particular inventory of interest.

3.  Compare the emissions totals provided by **Smkreport** (e.g., by
    state and county) to totals of the emissions inventories computed
    outside of SMOKE. Also, compare the emissions totals from SMOKE
    between each of the processing stages. For example, for area
    sources, compare the emissions after inventory import, gridding,
    chemical speciation, temporal allocation, and final merge to ensure
    that the emissions are consistent from step to step. This involves
    some subjectivity because the emissions do in fact change from step
    to step, and the magnitude of those changes depends on the support
    input files SMOKE uses with the inventory.

4.  Check that the correct chemical speciation profiles, temporal
    profiles, and gridding surrogates were applied, using reports that
    provide this information from **Smkreport**.

5.  Perform other specific checks of **Smkreport** outputs, such as
    ensuring that the correct major point sources are in the inventory,
    comparing population-normalized emissions among the counties, and
    checking stack parameters from point sources.

6.  Ensure that the emissions data look reasonable by viewing them in
    the Visualization Environment for Rich Data Interpretation (VERDI).
:::

[Chapter 7, *SMOKE Quality
Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance") provides
much additional detail about how to proceed with quality assuring your
inventories and emissions processing.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------------------- -------------------- ---------------------------------------
  [Prev](ch02s19.html)                                                [Up](ch02.html)                          [Next](ch03.html)
  2.19. Creating model-ready emissions using MOVES lookup tables     [Home](index.html)     Chapter 3. SMOKE Directory Structure
  ----------------------------------------------------------------- -------------------- ---------------------------------------
:::
