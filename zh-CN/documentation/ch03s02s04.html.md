::: {.navheader}
3.2.4. Locations of intermediate files for base and growth/control cases
:::

[Prev](ch03s02s03.html) 

3.2. Directory structure

 [Next](ch03s02s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_dirs_location_intmed_files}3.2.4. Locations of intermediate files for base and growth/control cases {#locations-of-intermediate-files-for-base-and-growthcontrol-cases .title}

</div>

</div>
:::

::: {.toc}
[[3.2.4.1. Basic configuration for base
case](ch03s02s04.html#sect_dirs_location_intmed_base)]{.section}

[[3.2.4.2. Advanced configuration for base
case](ch03s02s04.html#sect_dirs_location_intmed_advanced)]{.section}

[[3.2.4.3. Configuration for growth and/or control
case](ch03s02s04.html#sect_dirs_location_intmed_growth)]{.section}
:::

The intermediate files for SMOKE are located in three primary
directories for each case: the inventory output directory
(`$INVOPD`{.envar}), the scenario directory (`$SCENARIO`{.envar}), and
the static files directory (`$STATIC`{.envar}). All intermediate file
locations are subdirectories of the `$SMKDAT`{.envar} directory shown in
[Figure 3.1, "Basic SMOKE directories: the first three levels of the
directory
structure"](ch03s02s02.html#fig_dirs_basic_dirs "Figure 3.1. Basic SMOKE directories: the first three levels of the directory structure")
as `$SMK_HOME/data`{.filename}. Note that [Figure 3.4, "Locations of
intermediate and output files for SMOKE base case, basic
configuration"](ch03s02s04.html#fig_dirs_files_base "Figure 3.4. Locations of intermediate and output files for SMOKE base case, basic configuration"),
[Figure 3.5, "Locations of intermediate and output files for SMOKE base
case, advanced
configuration"](ch03s02s04.html#fig_dirs_files_advanced "Figure 3.5. Locations of intermediate and output files for SMOKE base case, advanced configuration"),
and [Figure 3.6, "Locations of intermediate and output files for SMOKE
future-/past-year
case"](ch03s02s04.html#fig_dirs_files_growth "Figure 3.6. Locations of intermediate and output files for SMOKE future-/past-year case")
show both intermediate and output directories. Here we focus only on the
intermediate directories; the output directories are discussed in
[Section 3.2.5, "Locations of model-ready output files for base and
growth/control
cases"](ch03s02s05.html "3.2.5. Locations of model-ready output files for base and growth/control cases").

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_dirs_location_intmed_base}3.2.4.1. Basic configuration for base case {#basic-configuration-for-base-case .title}

</div>

</div>
:::

[Figure 3.4, "Locations of intermediate and output files for SMOKE base
case, basic
configuration"](ch03s02s04.html#fig_dirs_files_base "Figure 3.4. Locations of intermediate and output files for SMOKE base case, basic configuration")
shows the SMOKE intermediate directories for a basic configuration of a
base case. In this configuration, the Assigns file variables
`ASCEN`{.envar}, `BSCEN`{.envar}, `MSCEN`{.envar}, `PSCEN`{.envar}, and
`ESCEN`{.envar} are all set to the same value. These variables are the
scenario names for the four processing categories (area, biogenic,
mobile, and point) and the combined category (used when combining
emissions from multiple source categories). Having these variables set
to the same value allows a simpler structure in which the
`run_$ESCEN`{.filename} directory is the same as the
`run_$ASCEN`{.filename}, `run_$BSCEN`{.filename},
`run_$MSCEN`{.filename}, and `run_$PSCEN`{.filename} directories. In the
figure, this single directory is shown simply as
`run_$ESCEN`{.filename}.

The `$BSCEN`{.envar} setting for biogenic sources is often set to a
different scenario name, usually simply "[beld2]{.quote}" or
"[beld3]{.quote}". This is because there are not very many scenarios to
choose from for biogenic emissions, since users almost always want to
use one of the standard approaches and there are usually no control
strategies considered for biogenic emissions. In this case, the
`run_$BSCEN`{.filename} directory is a separate branch in the directory
structure that stores just the biogenic files for use by both base case
and future-year control scenarios. For the nctox test case, we have not
used this approach since the biogenic data is specific to the nctox
modeling domain.

::: {.figure}
[]{#fig_dirs_files_base}

**Figure 3.4. Locations of intermediate and output files for SMOKE base
case, basic configuration**

::: {.mediaobject}
![Locations of intermediate and output files for SMOKE base case, basic
configuration](images\dirs\files_base_html.jpg)
:::
:::

The following list describes the intermediate files that are associated
with each of the intermediate directories `$INVOPD`{.envar},
`$SCENARIO`{.envar}, and `$STATIC`{.envar}. You can refer to [Chapter 9,
*SMOKE Intermediate
Files*](ch09.html "Chapter 9. SMOKE Intermediate Files") for more
information about each of the intermediate files (look under the logical
file names).

::: {.itemizedlist}
-   `inventory/$INVEN`{.filename}: This directory contains the SMOKE
    intermediate inventory files, including the directories associated
    with them. These files are the outputs from **Smkinven**, and
    **Tmpbeis3**. The outputs from **Smkinven** are map-formatted (see
    below for more information) while the biogenic outputs are I/O API
    NetCDF format. The subdirectories `area_dat`{.filename},
    `mobl_dat`{.filename}, `nroad_dat`{.filename}, and
    `pnts_dat`{.filename} contain the files that store the emissions
    values for each pollutant in the inventory. The intermediate files
    in this directory include:

    ::: {.itemizedlist}
    -   `AREA`{.envar}: Map-formatted SMOKE intermediate files for
        nonpoint/stationary area sources (from the `ARINV`{.envar} input
        file) and/or nonroad mobile sources (from either the
        `ARINV`{.envar} input file or from the `NRINV`{.envar} input
        file if nonroad mobile sources are being run separately from
        other SMOKE area sources). Example file names include
        `area.map.$INVOP`{.filename}.txt and
        `nroad.map.$INVOP`{.filename}.txt.

        The data from the inventories is stored in several different
        files, both ASCII and I/O API format. The map-formatted
        intermediate files are used to organize and keep track of these
        separate files. See [Chapter 9, *SMOKE Intermediate
        Files*](ch09.html "Chapter 9. SMOKE Intermediate Files") for an
        example and further discussion of the intermediate inventory
        files. For the `AREA`{.envar} file, the additional inventory
        files `area.ncf`{.filename} and `asrc.txt`{.filename} are stored
        in the `$INVOPD`{.envar} directory. The pollutant-specific files
        are stored in the `area_dat`{.filename} directory. For the
        `NROAD`{.envar} file, the files are named `nroad.ncf`{.filename}
        and `nsrc.txt`{.filename} and the pollutant-specific files are
        placed in the `nroad_dat`{.filename} directory.

    -   `ARDAY`{.envar}: The day-specific SMOKE area-source intermediate
        inventory.

    -   `ARHOUR`{.envar}:The hour-specific SMOKE area-source
        intermediate inventory.

    -   `ASCC`{.envar}: List of area-source SCCs in the inventory. Can
        include `ASCC.$INVOP`{.filename}.txt and
        `NSCC.$INVOP`{.filename}.txt (e.g., `ASCC.nei99.txt`{.filename}
        and `NSCC.nei99.txt`{.filename}).

    -   `B3GRD`{.envar}: Normalized gridded biogenic emissions.

    -   `MOBL`{.envar}: Map-formatted SMOKE intermediate file for
        on-road mobile sources. Example file name is
        `mobl.map.$INVOP`{.filename}.txt. The additional inventory files
        are named `mobl.ncf`{.filename} and `msrc.txt`{.filename}, and
        the pollutant-specific files are placed in the
        `mobl_dat`{.filename} directory.

    -   `MSCC`{.envar}: List of on-road mobile-source SCCs in the
        inventory; e.g., `MSCC.$INVOP`{.filename}.txt.

    -   `PDAY`{.envar}: The day-specific SMOKE intermediate inventory.

    -   `PHOUR`{.envar}: The hour-specific SMOKE intermediate inventory.

    -   `PNTS`{.envar}: Map-formatted SMOKE intermediate file for point
        sources. Example file name is `pnts.map.$INVOP`{.filename}.txt.
        The additional inventory files are named `pnts.ncf`{.filename}
        and `psrc.txt`{.filename}, and the pollutant-specific files are
        placed in the `pnts_dat`{.filename} directory.

    -   `PSCC`{.envar}: List of point-source SCCs in the inventory;
        e.g., `PSCC.$INVOP`{.filename}.txt.
    :::

-   `reports`{.filename}: Discussed in [Section 3.2.6, "Locations of
    reports"](ch03s02s06.html "3.2.6. Locations of reports")

-   `run_$BSCEN`{.filename}/output/`$SPC`{.envar}: Contains the hourly,
    gridded, speciated biogenic emissions files. These are listed in
    this subsection for intermediate files because in some cases these
    are not ready for the AQM, because the units need to be converted.
    **Tmpbeis3** can output emissions in either moles/hr or moles/s. The
    CMAQ model needs data in units of moles/s.

-   `run_$ESCEN`{.filename}/output: Discussed in [Section 3.2.5,
    "Locations of model-ready output files for base and growth/control
    cases"](ch03s02s05.html "3.2.5. Locations of model-ready output files for base and growth/control cases")

-   `run_$ESCEN`{.filename}/scenario: Contains the intermediate hourly
    emissions files and other time-dependent files. The intermediate
    files in this directory include:

    ::: {.itemizedlist}
    -   `ATMP`{.envar}, `MTMP`{.envar}, `PTMP`{.envar}: The
        area/nonroad, mobile, and point hourly emissions created by the
        **Temporal** program.

    -   `ATSUP`{.envar}, `MTSUP`{.envar}, `PTSUP`{.envar}: The
        area/nonroad, mobile, and point temporal allocation
        supplementary files.

    -   `PLAY`{.envar}: The point-source hourly layer fraction for each
        source.

    -   `PLAY_EX`{.envar}: The point-source hourly layer fractions for
        [*explicit*]{.emphasis} plume rise sources when processing for
        UAM or CAM~X~.
    :::

-   `run_$ESCEN`{.filename}/static: Contains the matrices and other
    time-independent files. The intermediate files in this directory
    include:

    ::: {.itemizedlist}
    -   `ACMAT`{.envar}, `MCMAT`{.envar}, `PCMAT`{.envar}: The
        area/nonroad, mobile, and point multiplicative control matrices.

    -   `AGMAT`{.envar}, `MGMAT`{.envar}, `PGMAT`{.envar}: The
        area/nonroad, mobile, and point gridding matrices.

    -   `AGSUP`{.envar}, `MGSUP`{.envar}: The area/nonroad and mobile
        supplementary gridding files.

    -   `APMAT`{.envar}, `MPMAT`{.envar}, `PPMAT`{.envar}: The
        area/nonroad, mobile, and point growth matrices.

    -   `ARMAT`{.envar}, `MRMAT`{.envar}, `PRMAT`{.envar}: The
        area/nonroad, mobile, and point reactivity control matrices.

    -   `ARSUP`{.envar}, `MRSUP`{.envar}, `MRSUP`{.envar}: The
        area/nonroad, mobile, and point reactivity supplementary files.

    -   `ASMAT_L`{.envar}, `MSMAT_L`{.envar}, `PSMAT_L`{.envar}: The
        area/nonroad, mobile, and point mole-based speciation matrices.

    -   `ASMAT_S`{.envar}, `MSMAT_S`{.envar}, `PSMAT_S`{.envar}: The
        area/nonroad, mobile, and point mass-based speciation matrices.

    -   `ASSUP`{.envar}, `MSSUP`{.envar}, `PSSUP`{.envar}: The
        area/nonroad, mobile, and point supplementary speciation files.

    -   `PELV`{.envar}: The point-source elevated- and PinG-source
        selection file

    -   `$LOGS`{.filename}: Contains the log files created when the
        SMOKE programs are run
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_dirs_location_intmed_advanced}3.2.4.2. Advanced configuration for base case {#advanced-configuration-for-base-case .title}

</div>

</div>
:::

Instead of using the basic configuration technique of setting the
scenario name variables (`ASCEN`{.envar}, `BSCEN`{.envar},
`MSCEN`{.envar}, `PSCEN`{.envar}, and `ESCEN`{.envar}) all to the same
value ([Section 3.2.4.1, "Basic configuration for base
case"](ch03s02s04.html#sect_dirs_location_intmed_base "3.2.4.1. Basic configuration for base case")),
you can set up an Assigns file to use different values for one or more
of these variable. In this more advanced configuration, separate
directories are created and used for intermediate and output files for
each source category (examples of when this would be useful are given in
the bullets below). [Figure 3.5, "Locations of intermediate and output
files for SMOKE base case, advanced
configuration"](ch03s02s04.html#fig_dirs_files_advanced "Figure 3.5. Locations of intermediate and output files for SMOKE base case, advanced configuration")
illustrates the directory structure resulting from this approach;
however, for simplicity's sake, we have not included all of the files in
this structure. The files are the same as in [Figure 3.4, "Locations of
intermediate and output files for SMOKE base case, basic
configuration"](ch03s02s04.html#fig_dirs_files_base "Figure 3.4. Locations of intermediate and output files for SMOKE base case, basic configuration"),
with the exception that files specific to a source category go to their
category-specific directories, based on the values given to
`ASCEN`{.envar}, `BSCEN`{.envar}, `MSCEN`{.envar}, and/or
`PSCEN`{.envar}. Note that the nonpoint (stationary area) and nonroad
mobile sources would need to use the same scenario name, even if they
are processed separately, because the nonroad mobile `static`{.filename}
and `scenario`{.filename} directories are set using the same
`ASCEN`{.envar} variable as for other area sources in the default
Assigns files. Having separate source-category-specific directories does
not change the number of intermediate or output files, it just
rearranges the files and results into fewer intermediate, output, and/or
report files in each directory.

This approach is particularly useful in the following cases:

::: {.itemizedlist}
-   [**Using toxic inventories for some source categories but not
    others:**]{.bold} In this case, different scenario names
    (`ASCEN`{.envar}, `MSCEN`{.envar}, `PSCEN`{.envar}, and
    `ESCEN`{.envar}) can be used to distinguish each case and the
    final-merged files (though it is not required to do this). For
    example, if you were running toxics for on-road mobile sources only,
    `MSCEN`{.envar} could be set to "[case1\_tox]{.quote}", while
    `ASCEN`{.envar} and `PSCEN`{.envar} could be set to just
    "[case1]{.quote}" and `ESCEN`{.envar} could be
    "[case1\_all]{.quote}". If you would prefer instead to name all of
    these "[case1]{.quote}" and simply remember that on-road mobile
    sources include toxics, then that would be fine as well.

-   [**Using the **Mrggrid** program to combine model-ready files from
    several previously run scenarios:**]{.bold} For example, you might
    want to combine the future-year base case for all source categories
    except nonroad with a future-year control case for nonroad, as part
    of an evaluation of the impact of the nonroad control case. If three
    previous Assigns files were set up using the basic structure for
    three different control cases (case1, case2, and case3), and a new
    case is needed that uses area sources from case1, on-road mobile
    sources from case2, and point sources from case3, you could set up a
    new Assigns file that sets `ASCEN`{.envar} to case1, `MSCEN`{.envar}
    to case2, and `PSCEN`{.envar} to case3. When you invoke that new
    Assigns file, all of the environment variables needed by **Mrggrid**
    for combining the model-ready files from the three different cases
    would be set: `AGTS_L`{.envar} would be based on case1,
    `MGTS_L`{.envar} would be based on case2, and `PGTS3D_L`{.envar}
    would be based on case3. See [Section 3.2.5, "Locations of
    model-ready output files for base and growth/control
    cases"](ch03s02s05.html "3.2.5. Locations of model-ready output files for base and growth/control cases")
    for more information on the model-ready files.
:::

::: {.figure}
[]{#fig_dirs_files_advanced}

**Figure 3.5. Locations of intermediate and output files for SMOKE base
case, advanced configuration**

::: {.mediaobject}
![Locations of intermediate and output files for SMOKE base case,
advanced configuration](images\dirs\files_advanced_html.jpg)
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_dirs_location_intmed_growth}3.2.4.3. Configuration for growth and/or control case {#configuration-for-growth-andor-control-case .title}

</div>

</div>
:::

The directory structure changes for growth and control cases. The
default growth and control scripts have additional settings that impact
the intermediate directories when running SMOKE. These settings are
described in more detail in [Chapter 4, *How to Use
SMOKE*](ch04.html "Chapter 4. How to Use SMOKE"), but we introduce them
here because they are closely linked to the directory structures used by
SMOKE. The default configuration of SMOKE uses different directories for
files impacted by growth and control so that they will be separated from
the base-year files; this helps keep users from accidentally confusing
their base and grown and/or controlled files.

The key script environment variables that impact the directory
structures are:

::: {.itemizedlist}
-   `CNTLCASE`{.envar}: Sets the name of the control case that will
    impact the directory names. Also is used by the scripts to set the
    required name of the `GCNTL`{.envar} files containing the packets
    for defining growth and controls for the **Cntlmat** program.

-   `FYEAR`{.envar}: Sets the future year with a four-digit year. The
    last two digits of the year are used to set the internal variable
    `fyr2`{.envar}. For example, if `FYEAR`{.envar} is set to 2018,
    `fyr2`{.envar} will be 18. `FYEAR`{.envar} is also used by the
    scripts to set the required name of the `GCNTL`{.envar} files
    containing the packets for defining growth and controls for the
    **Cntlmat** program.

-   `SMK_FUTURE_YN`{.envar}: When set to Y, this setting causes the
    Assigns file to change the SMOKE intermediate inventory file names
    by inserting `$fyr2`{.envar} into the individual file names. The
    Assigns file also changes the intermediate and output paths by
    appending `$fyr2`{.envar} to `$ASCEN`{.envar}, `$MSCEN`{.envar},
    `$PSCEN`{.envar}, and `$ESCEN`{.envar} (affecting the
    `$STATIC`{.envar} and `$SCENARIO`{.envar} directories and file names
    of intermediate files). This is illustrated in [Figure 3.6,
    "Locations of intermediate and output files for SMOKE
    future-/past-year
    case"](ch03s02s04.html#fig_dirs_files_growth "Figure 3.6. Locations of intermediate and output files for SMOKE future-/past-year case").

-   `SMK_CONTROL_YN`{.envar}: When set to Y, this setting causes the
    Assigns file to change the SMOKE intermediate inventory file names
    by inserting `$CNTLCASE`{.envar} into the individual file names. The
    Assigns file also changes the intermediate and output paths by
    appending `$CNTLCASE`{.envar} to `$ASCEN`{.envar}, `$MSCEN`{.envar},
    `$PSCEN`{.envar}, and `$ESCEN`{.envar} (affecting the
    `$STATIC`{.envar} and `$SCENARIO`{.envar} directories and file names
    of intermediate files).
:::

::: {.figure}
[]{#fig_dirs_files_growth}

**Figure 3.6. Locations of intermediate and output files for SMOKE
future-/past-year case**

::: {.mediaobject}
![Locations of intermediate and output files for SMOKE future-/past-year
case](images\dirs\files_growth_html.jpg)
:::
:::

The `$SCENARIO`{.envar} directory for the future case is now a
subdirectory of `data/run_$ESCEN`{.filename}\_`$fyr2`{.envar}. The
`ATMP`{.envar}, `MTMP`{.envar}, and `PTMP`{.envar} files are stored in
this directory, because these depend on the future-year emissions
inventory. Although the temporal profile assignments stored in the
`ATSUP`{.envar}, `MTSUP`{.envar}, and `PTSUP`{.envar} files may not have
changed from the base case, these files are written out for the
future-/past-year case to be consistent with the output files created by
**Temporal** for the base case.

The `$STATIC`{.envar} directory for the future case is now a
subdirectory of `data/run_$ESCEN`{.filename}\_`$fyr2`{.envar}. However,
unlike [Figure 3.4, "Locations of intermediate and output files for
SMOKE base case, basic
configuration"](ch03s02s04.html#fig_dirs_files_base "Figure 3.4. Locations of intermediate and output files for SMOKE base case, basic configuration"),
[Figure 3.6, "Locations of intermediate and output files for SMOKE
future-/past-year
case"](ch03s02s04.html#fig_dirs_files_growth "Figure 3.6. Locations of intermediate and output files for SMOKE future-/past-year case")
indicates that only the `PELV`{.envar} file is stored in this directory.
This is because SMOKE permits reusing the base-year gridding matrices
and speciation matrices for growth and control cases. The growth and
control matrices will also be stored in the base-year `$STATIC`{.envar}
directory. Therefore, the only file that is stored in the future-year
`$STATIC`{.envar} directory is the `PELV`{.envar} file, which can depend
on the emissions values in the future year. For example, if the
elevated-source selection criteria were based on the future-year daily
maximum emissions, then this `PELV`{.envar} file would be different than
the base-year file. It is therefore most safely stored in a directory
that is named with the future-year (or control case) information.

When using controls only (no growth), `$SCENARIO`{.envar} and
`$STATIC`{.envar} will be subdirectories of
`data/run_$ESCEN`{.filename}\_`$CNTLCASE`{.envar}. For the case of
growth and controls, the directory will be named
`data/run_$ESCEN`{.filename}\_`$fyr2`{.envar}\_`$CNTLCASE`{.envar}.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------- -------------------- ---------------------------------------------------------------------------------
  [Prev](ch03s02s03.html)             [Up](ch03s02.html)                                                            [Next](ch03s02s05.html)
  3.2.3. Locations of input files     [Home](index.html)     3.2.5. Locations of model-ready output files for base and growth/control cases
  ---------------------------------- -------------------- ---------------------------------------------------------------------------------
:::
