::: {.navheader}
Chapter 4. How to Use SMOKE
:::

[Prev](ch03s03.html) 

 

 [Next](ch04s02.html)

------------------------------------------------------------------------

::: {.chapter lang="en"}
::: {.titlepage}
<div>

<div>

[]{#ch_scripts}Chapter 4. How to Use SMOKE {#chapter-4.-how-to-use-smoke .title}
------------------------------------------

</div>

</div>
:::

::: {.toc}
[[4.1. Introduction](ch04.html#sect_scripts_introduction)]{.section}

[[4.2. Test case descriptions](ch04s02.html)]{.section}

[[4.3. Running the SMOKE test case](ch04s03.html)]{.section}

[[4.4. How to use SMOKE](ch04s04.html)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_scripts_introduction}4.1. Introduction {#introduction .title style="clear: both"}
-----------------------------------------------

</div>

</div>
:::

In this chapter, we provide information about using the UNIX scripts
that come with SMOKE to run the test cases and adapting the scripts to
run any case. There are several features of these scripts that
specifically support SMOKE v1.5 and later, and using scripts developed
for earlier versions of SMOKE will not work without adaptations. We
provide a section in this document that explains what changes need to be
made to users' existing scripts to allow them to work with SMOKE.
Alternatively, current users can adapt the new example scripts to their
case. New users are advised to create their scripts based on the example
scripts, following the instructions included in [Section 4.4, "How to
use SMOKE"](ch04s04.html "4.4. How to use SMOKE") this chapter.

For all SMOKE users, a critical file to use and know about is the
Assigns file. If you have followed the SMOKE installation instructions,
then your Assigns file will be located in the directory:
`$SMK_HOME`{.filename}/subsys/smoke/assigns where the `SMK_HOME`{.envar}
directory is set in your `.cshrc`{.filename} file in your home
directory, during the SMOKE installation process.

[**When using SMOKE, the first thing that you should do is go to the
Assigns directory and invoke the Assigns file for the case that you will
be working with. This step needs to be taken in every UNIX window from
which you intend to run SMOKE.**]{.bold}

To invoke the Assigns file, use the following commands:

**`cd $SMK_HOME`/subsys/smoke/assigns** [*(this changes to the correct
directory)*]{.emphasis}

**`source ASSIGNS.nctox.cmaq.cb05_soa.us12-nc`** [*(this invokes the
default assigns file)*]{.emphasis}

Doing this will set a large number of environment variables that you
will then have available for navigating the SMOKE directory structure.
[Table 4.1, "Variable in Assigns file for naming files and
directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories")
and [Table 4.2, "Variables in Assigns file for controlling time period
and grid of
processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing")
in [Section 4.4.1, "Change Assigns file to set scenario names, grid
names, and other case-specific configuration
information"](ch04s04.html#sect_scripts_change_assigns "4.4.1. Change Assigns file to set scenario names, grid names, and other case-specific configuration information")
list those environment variables. The environment variables used to
build some of the directory names are also set by the user in the
Assigns file and described in that section.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------- -------------------- ------------------------------
  [Prev](ch03s03.html)                                                                 [Next](ch04s02.html)
  3.3. How to change the default directory structure     [Home](index.html)     4.2. Test case descriptions
  ----------------------------------------------------- -------------------- ------------------------------
:::
::: {.navheader}
4.2. Test case descriptions
:::

[Prev](ch04.html) 

Chapter 4. How to Use SMOKE

 [Next](ch04s02s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_dirs_example_data_files}4.2. Test case descriptions {#test-case-descriptions .title style="clear: both"}
------------------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[4.2.1. nctox case for area, nonroad, mobile, biogenic and point
sources](ch04s02.html#sect_scripts_nctox_case)]{.section}

[[4.2.2. Script descriptions](ch04s02s02.html)]{.section}

[[4.2.3. Example script files and their
purposes](ch04s02s03.html)]{.section}

[[4.2.4. Script settings](ch04s02s04.html)]{.section}

[[4.2.5. SMOKE settings controlled through
scripts](ch04s02s05.html)]{.section}
:::

Many of the support files used in the test cases are based on the EPA's
NEI modeling platform, available online at EPA's Emission Modeling
Clearinghouse
([http://www.epa.gov/ttn/chief/emch/](http://www.epa.gov/ttn/chief/emch/index.html)).

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_nctox_case}4.2.1. nctox case for area, nonroad, mobile, biogenic and point sources {#nctox-case-for-area-nonroad-mobile-biogenic-and-point-sources .title}

</div>

</div>
:::

The nctox case provides users with an example of using both criteria and
toxics emissions inventories. The purposes of this case include:

::: {.itemizedlist}
-   Providing a test case for SMOKE on users computers. It is not
    recommended for actual user\'s emissions modeling work.

-   Provide example scripts that users may adapt to their own cases
:::

This case has the following major features. It runs for July 10th and
11th, 2005 on a 12-km Lambert Conformal grid over North Carolina. The
spatial extent of this case has been limited to provide a relatively
fast test case, and the domain is a subdomain of EPA's 12-km national
grid. The case includes toxics processing for stationary area, nonroad
mobile, and point sources.

::: {.figure}
[]{#fig_scripts_nctox_domain}

**Figure 4.1. nctox domain**

::: {.mediaobject}
![nctox domain](images\scripts\nctox_domain_html.jpg)
:::
:::

At this time, the case uses North Carolina records [*only*]{.emphasis}
from the following inventory data:

[**stationary area sources:**]{.bold} 2005 NEI for CO, NO~x~, VOC,
SO~2~, NH~3~, PM~10~, and PM~2.5~ from nonpt, averfire and alm sectors

[**nonroad mobile sources:**]{.bold} 2005 NEI for CO, NO~x~, VOC, SO~2~,
NH~3~, PM~10~, and PM~2.5~ from nonroad sector

[**point sources:**]{.bold} 2005 NEI for CO, NO~x~, VOC, SO~2~, NH~3~,
PM~10~, and PM~2.5~ from ptipm and ptnonipm sectors

[**mobile sources:**]{.bold} vehicle mileage traveled (VMT) and its
average speed (SPEED), and vehicle average hotteling (HOTELLING) for
onroad mobile sources, and vehicle population (VPOP) for offroad mobile
sources

[**biogenic sources:**]{.bold} BELD3 data processed using BEIS3 (for
entire grid, even those cells that are not in North Carolina)

For area, mobile, and point sources, this case uses toxics inventories
for ozone modeling. The VOC model species for the current CB6 mechanism
are based in part on the toxic inventory. SMOKE resolves the duplicate
VOC mass caused by combining VOC emissions with toxic VOC emissions by
subtracting the toxic VOC mass from the VOC mass and computing a
NONHAPVOC emissions value. This is the "[integrate]{.quote}" approach
for VOC emissions, described in [Section 2.9.5, "Combine toxics and
criteria
inventories"](ch02s09s05.html "2.9.5. Combine toxics and criteria inventories").
The speciation profiles provided with this version of SMOKE include
profiles that map the toxics VOC and NONHAPVOC pollutants to current CB6
species. Choices for speciation profiles in this version of SMOKE are
listed in [Section 4.4.10, "Use a different speciation mechanism or
change speciation
inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs").

In addition to the inventory data listed above, the parameters of the
case are the following:

::: {.itemizedlist}
-   [**Episode:**]{.bold} July 10th and 11th of 2005

-   [**Output time zone:**]{.bold} Greenwich Mean Time (zone 0)

-   [**Projection:**]{.bold} Lambert Conformal with Alpha=33, Beta=45,
    Gamma=-97, and center at (-97,40)

-   [**Domain:**]{.bold} Origin at (1128, -672) kilometers with 66
    columns by 52 rows and 12-km square grid cells (shown in
    [Figure 4.1, "nctox
    domain"](ch04s02.html#fig_scripts_nctox_domain "Figure 4.1. nctox domain"))

-   [**Meteorology data:**]{.bold} Daily (25-hour) 2005 meteorology
    files generated originally by EPA using MM5 and MCIP; the files have
    been reduced to the modeling domain and contain only the variables
    needed by SMOKE.

-   [**Chemical speciation data:**]{.bold} Revised `GSPRO`{.envar} and
    `GSREF`{.envar} files to include toxic pollutants mapped to
    current-CB6 mechanism for both on-road and nonroad mobile source
    classification category (SCC) codes.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------ -------------------- -----------------------------
  [Prev](ch04.html)                [Up](ch04.html)          [Next](ch04s02s02.html)
  Chapter 4. How to Use SMOKE     [Home](index.html)     4.2.2. Script descriptions
  ------------------------------ -------------------- -----------------------------
:::
::: {.navheader}
4.2.2. Script descriptions
:::

[Prev](ch04s02.html) 

4.2. Test case descriptions

 [Next](ch04s02s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_script_descriptions}4.2.2. Script descriptions {#script-descriptions .title}

</div>

</div>
:::

::: {.toc}
[[4.2.2.1. Overview](ch04s02s02.html#d0e10367)]{.section}

[[4.2.2.2. Assigns
files](ch04s02s02.html#sect_scripts_assigns_files)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e10367}4.2.2.1. Overview {#overview .title}

</div>

</div>
:::

Running SMOKE from scripts provides a flexible approach to running
SMOKE. We recommend that new users start with the standard configuration
of scripts and directories provided with the default installation. This
configuration uses the directory structures described in [Chapter 3,
*SMOKE Directory
Structure*](ch03.html "Chapter 3. SMOKE Directory Structure") and a
separate run script for each source category, as we will get to soon. In
[Section 4.4, "How to use SMOKE"](ch04s04.html "4.4. How to use SMOKE"),
we provide all of the information you need to know to adapt the test
case configuration to your modeling case. If you ever want to move
beyond using the default configuration, we do not describe how to do
that in detail. In fact, we could not describe this, because there are
an infinite number of ways to arrange the directories and scripting for
SMOKE; however, we have provided some information about what do to in
[Section 3.3, "How to change the default directory
structure"](ch03s03.html "3.3. How to change the default directory structure").

Running SMOKE using scripts involves many scripts working together. This
can be confusing for new users, but we have made efforts to make using
the scripts easier and more robust with this version of SMOKE.

All SMOKE scripts can be found in the `$SMKROOT`{.filename}/scripts/run
directory, or simply the `$SCRIPTS`{.filename}/run directory (after
having invoked the Assigns file).
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_assigns_files}4.2.2.2. Assigns files {#assigns-files .title}

</div>

</div>
:::

The assigns files are located in `$SMKROOT`{.filename}/assigns. The
nctox case assigns file is called
`ASSIGNS.nctox.cmaq.cb05_soa.us12-nc`{.filename}. One Assigns file is
provided for the nctox case, and you can create your own files by
copying it to a new name and changing it. At least one Assigns file must
come with each preconfigured run (such as the nctox case) for SMOKE.

The Assigns files are divided into three major sections. The first
section contains environment variables for controlling the setup of a
case, such as the dates being modeled, the name of the grid, and the
name of the chemical mechanism. The second section lists all of the
input files in SMOKE (by source category) and users can change these
adapt the Assigns files to their cases by changing the input files. The
third section calls helper scripts to create input and output
directories and configure the compiler environment variables. It is wise
to copy an existing Assigns files to new files and modify the new files,
so that you do not lose the default configuration.

In addition, there are a number of helper scripts used by the Assigns
files. Unless users are changing the way SMOKE behaves when running from
scripts, it should not be necessary to change these scripts. Changing
them could result in behavior different from what is documented in this
chapter. The helper scripts and their purposes are:

::: {.itemizedlist}
-   `check_settings.scr`{.filename}: Set all environment variables used
    in Assigns file to default values if they are not already defined by
    a calling script (e.g., when invoking the Assigns file from the UNIX
    prompt instead of a script).

-   `set_case.scr`{.filename}: Set the environment variables that
    control output file names (`ABASE`{.envar}, `BBASE`{.envar},
    `MBASE`{.envar}, `PBASE`{.envar}, `EBASE`{.envar}, `ASCEN`{.envar},
    `BSCEN`{.envar}, `MSCEN`{.envar}, `PSCEN`{.envar}, and
    `ESCEN`{.envar}). See also the `SMK_FUTURE_YN`{.envar},
    `FYEAR`{.envar}, `SMK_CONTROL_YN`{.envar}, and `CNTLCASE`{.envar}
    script settings in [Section 4.2.4, "Script
    settings"](ch04s02s04.html "4.2.4. Script settings")

-   `set_dirs.scr`{.filename}: Set the SMOKE directory structure

-   `setmerge_files.scr`{.filename}: Set **Smkmerge** output file names,
    depending on run script settings

-   `smk_mkdir`{.filename}: Create input and output directories

-   `smk_rmfiles.scr`{.filename}: Remove SMOKE intermediate and output
    files

-   `sysflags`{.filename}: Set the compiler options needed for compiling
    SMOKE

-   `unset.scr`{.filename}: Unset environment variables that do not need
    to be defined after the Assigns file has been run
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------ -------------------- -------------------------------------------------
  [Prev](ch04s02.html)            [Up](ch04s02.html)                            [Next](ch04s02s03.html)
  4.2. Test case descriptions     [Home](index.html)     4.2.3. Example script files and their purposes
  ------------------------------ -------------------- -------------------------------------------------
:::
::: {.navheader}
4.2.3. Example script files and their purposes
:::

[Prev](ch04s02s02.html) 

4.2. Test case descriptions

 [Next](ch04s02s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_example_scripts}4.2.3. Example script files and their purposes {#example-script-files-and-their-purposes .title}

</div>

</div>
:::

The following files are currently provided with the SMOKE release. There
are a number of helper scripts. The only one that users may want to
change is the `qa_run.scr`{.filename} script to add configurations for
reporting. The helper scripts are:

::: {.itemizedlist}
-   `cntl_run.csh`{.filename}: Runs the **Cntlmat** and **Grwinven**
    program. Sets the required `GCNTL`{.envar} file name depending on
    script settings, as explained in [Section 4.4.11, "Setup projection
    and control
    scenarios"](ch04s04s11.html "4.4.11. Setup projection and control scenarios").

-   `make_invdir.csh`{.filename}: Sets the `INVNAME1`{.envar} and
    `INVNAME2`{.envar} settings that **Smkinven** uses for creating the
    map-formatted inventory intermediate files.

-   `metcombine.csh`{.filename}: Runs the utility program **Metcombine**
    to combine the `METCRO2D*`{.filename} and `METCRO3D*`{.filename}
    files in the `$METDAT`{.filename} directory. This script creates
    files named `METCOMBO*`{.filename} in the `$METDAT`{.filename}
    directory.

-   `movelog.csh`{.filename}: Deletes or renames the log files,
    depending on the `AUTO_DELETE_LOG`{.envar} setting.

-   `qa_run.csh`{.filename}: Runs the **Smkreport** program

-   `smk_run.csh`{.filename}: Runs the following SMOKE programs:
    **Smkinven**, **Rawbio** (for both winter and summer runs),
    **Normbeis3**, **Spcmat**, **Grdmat**, **Metscan**, **Temporal**,
    **Tmpbio**, **Tmpbeis3**, **Smkmerge**, **Mrggrid**, and
    **Smk2emis**.

    Creates `PTMPLIST`{.envar} file for **Elevpoint** by assuming all
    files with the name pattern `ptmp*$PSCEN`{.filename}\*ncf in the
    `$SMKDAT`{.filename}/run\_`$PSCEN`{.envar}/\* directories should be
    included in the file.

    Creates the `METLIST`{.envar} and `RADLIST`{.envar} files for
    **Tmpbio** by listing `$MET_FILE1`{.envar} to `METLIST`{.envar} and
    `$MET_FILE2`{.envar} to `RADLIST`{.envar}. `MET_FILE1`{.envar} and
    `MET_FILE2`{.envar} are set in the Assigns file.

    Determines which speciation matrix is needed for **Smkmerge**, based
    on the requested units. If the `MRG_GRDOUT_UNIT`{.envar} setting
    contains the string "[mole]{.quote}" then the molar speciation
    matrix and molar gridded, hourly biogenic emissions are set to be
    used by **Smkmerge**.

    Creates the `FILELIST`{.envar} file for **Mrggrid** from the
    `MRGFILES`{.envar} setting in the calling merge run script.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------- -------------------- --------------------------
  [Prev](ch04s02s02.html)        [Up](ch04s02.html)     [Next](ch04s02s04.html)
  4.2.2. Script descriptions     [Home](index.html)      4.2.4. Script settings
  ----------------------------- -------------------- --------------------------
:::
::: {.navheader}
4.2.4. Script settings
:::

[Prev](ch04s02s03.html) 

4.2. Test case descriptions

 [Next](ch04s02s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_script_settings}4.2.4. Script settings {#script-settings .title}

</div>

</div>
:::

The SMOKE scripts have many environment variables that users can set
based on the program documentation in [Chapter 6, *SMOKE Core
Programs*](ch06.html "Chapter 6. SMOKE Core Programs"), as well as
environment variables that control the scripts. The variables that
control the behavior of the scripts are described in this section. The
settings are listed in alphabetical order.

[**Note that using upper case for the names of these settings in the
scripts is required. Any values that are Y or N settings must also be
upper case.**]{.bold}

For documentation on the `A_SPC_OVERRIDE`{.envar},
`N_SPC_OVERRIDE`{.envar}, `B_SPC_OVERRIDE`{.envar},
`M_SPC_OVERRIDE`{.envar}, and `P_SPC_OVERRIDE`{.envar} settings, please
refer to the `SPC_OVERRIDE`{.envar} description.

::: {.itemizedlist}
-   `AUTO_DELETE`{.envar}: \[Y \| N\] When set to Y, will delete all
    SMOKE intermediate and output I/O API files automatically. It will
    not delete intermediate and output ASCII files or reports.

-   `AUTO_DELETE_LOG`{.envar}: \[Y \| N\] When set to Y, SMOKE log files
    will be automatically deleted. Otherwise, the files will be
    automatically renamed by appending a number to the end. The first
    time the a log file needs to be overwritten, but
    `AUTO_DELETE_LOG`{.envar} is N, the file will be renamed to a file
    name with an "[\_1]{.quote}" appended to the original name. If the
    same file needs to be moved on a subsequent rerun and the
    "[\_1]{.quote}" file is already there, then a "[\_2]{.quote}" file
    will be created.

-   `CNTLCASE`{.envar}: When this is defined to a name of the control
    case and the `SMK_CONTROL_YN`{.envar} setting is Y, the following
    changes are made to the naming environment variables by the
    `$ASSIGNS`{.filename}/set\_case.scr file:

    ``` {.programlisting}
    setenv ASCEN ${ASCEN}_${CNTLCASE}
    setenv MSCEN ${MSCEN}_${CNTLCASE}
    setenv PSCEN ${PSCEN}_${CNTLCASE}
    setenv ESCEN ${ESCEN}_${CNTLCASE}
    setenv FYIOP ${FYIOP}_${CNTLCASE}
    ```

    When the `CNTLCASE`{.envar} name is set, regardless of the
    `SMK_CONTROL_YN`{.envar} setting, the
    `$ASSIGNS`{.filename}/set\_case.scr file also resets `FYINV`{.envar}
    as follows:

    ``` {.programlisting}
    setenv FYINV ${FYINV}_${CNTLCASE}
    ```

    This setting is also used for automatic naming of the
    `GCNTL`{.envar} file input to **Cntlmat**. See [Section 4.4.11,
    "Setup projection and control
    scenarios"](ch04s04s11.html "4.4.11. Setup projection and control scenarios").

-   `DEBUG_EXE`{.envar}: Should be set to the name of the fortran
    debugger (e.g., dbx) to use when running with `DEBUGMODE`{.envar}
    set to Y.

-   `DEBUGMODE`{.envar}: \[Y \| N\] When set to Y, the scripts will try
    to invoke the debug versions of the SMOKE executables. These will
    only be available to be used if the debug versions of the
    executables have been created using the **Makeall debug** command in
    the `$SCRIPTS`{.filename}/make directory.

-   `FYEAR`{.envar}: The 4-digit future year value is used for renaming
    files and directories when the `SMK_FUTURE_YN`{.envar} setting is Y.
    When this is true, the following changes are made to the naming
    environment variables by the `$ASSIGNS`{.filename}/set\_case.scr
    script:

    ``` {.programlisting}
    setenv ASCEN   ${ASCEN}-${fyr2}
    setenv MSCEN   ${MSCEN}-${fyr2}
    setenv PSCEN   ${PSCEN}-${fyr2}
    setenv ESCEN   ${ESCEN}-${fyr2}
    setenv FYIOP   ${INVOP}-${fyr2}
    ```

    where `${fyr2}`{.envar} is the last two digits of the
    `FYEAR`{.envar} value. These 2 digits are inserted into the output
    file names for **Smkinven** output files when
    `SMK_FUTURE_YN`{.envar} is set to Y.

    In addition, when `FYEAR`{.envar} is defined, the
    `$ASSIGNS`{.filename}/set\_case.scr script makes the follows
    settings regardless of the value of `SMK_FUTURE_YN`{.envar}.

    ``` {.programlisting}
    setenv FYINV ${FYINV}_${fyr2}
    setenv BYFYR ${BYFYR}_${fyr2}
    ```

    This setting is also used for automatic naming of the
    `GCNTL`{.envar} file input to **Cntlmat**. See [Section 4.4.11,
    "Setup projection and control
    scenarios"](ch04s04s11.html "4.4.11. Setup projection and control scenarios").

-   `G_STDATE_ADVANCE`{.envar}: The value should be set to the number of
    days for 1 run of the **Temporal**, **Laypoint**, and **Smkmerge**
    programs. The example scripts have this set by the `NDAYS`{.envar}
    environment variable in the Assigns file. When this value is set,
    the Assigns file will automatically increment the `ESDATE`{.envar}
    and `G_STDATE`{.envar} environment variables (that control SMOKE
    file names and time-dependent programs, respectively) to the next
    day. This feature is unable to cross from one year to the next.

-   `INVTABLE_OVERRIDE`{.envar}: Sets a file name for the
    `INVTABLE`{.envar} file in the Assigns file that overrides whatever
    value is actually inside the Assigns file. The Assigns file invokes
    the override mechanism when this environment variable is defined, so
    to [*not*]{.emphasis} use this scripting feature, the variable must
    [*not*]{.emphasis} be defined. [**In other words, it is not
    acceptable to set this to a blank value.**]{.bold}

-   `MRG_GRDOUT_UNIT`{.envar}: While this setting is primarily a setting
    for the **Smkmerge** program, it is also used by the SMOKE scripts
    to determine whether **Smkmerge** should use mole-based or
    mass-based speciation matrices and biogenic model-ready files. When
    the variable is set with the first four letters to "[mole]{.quote}",
    for example moles/hr, mole/s, or moles/day, the **Smkmerge** program
    will be provided by the scripts the correct input files. The
    implementation of this feature currently means that units of "[gm
    mole]{.quote}" will not work properly.

-   `NONROAD`{.envar}: \[Y \| N\] When set to Y, the Assigns file will
    automatically rename all of the SMOKE area-source intermediate and
    output files using the "[n]{.quote}" prefix on file names instead of
    the "[a]{.quote}" prefix. For example, the `ATMP`{.envar} file is
    set to `$SCENARIO`{.filename}/ntmp.ncf instead of
    `$SCENARIO`{.filename}/atmp.ncf. Also, the `AREA`{.envar} file
    coming out of **Smkinven** changes to be a different name and use a
    different map-file directory.

-   `PROMPTFLAG`{.envar}: \[Y \| N\] When set to Y, users will be
    prompted for all SMOKE file names. This option should not be set to
    Y for non-interactive processing. In fact, there is little need for
    this to ever be set to Y.

-   `QA_LABEL`{.envar}: Users can label their **Smkreport** log files
    and QA reports using this label. Typically, the QA report names are
    named using the `$FYIOP`{.envar} variable or `$ESCEN`{.envar}
    variable set in the `$ASSIGNS`{.filename}/set\_case.scr script. When
    `QA_LABEL`{.envar} is set to something, the log files and reports
    are labeled with `$FYIOP`{.envar}.`$QA_LABEL`{.envar} or
    `$ESCEN`{.envar}.`$QA_LABEL`{.envar}. This renaming is done in the
    `qa_run.csh`{.filename} helper script in the
    `$SCRIPTS`{.filename}/run directory.

-   `QA_TYPE`{.envar}: \[none \| all \| part1 \| part2 \| part3 \| part4
    or custom\]. This setting controls the `qa_run.csh`{.filename}
    helper script and causes different reports to be written. The
    `QA_TYPE`{.envar} settings will cause the script to use different
    `REPCONFIG`{.envar} files for input to **Smkreport**, and the
    `REPCONFIG`{.envar} files determine which reports are generated.
    [Section 4.4.22, "Change
    reports"](ch04s04s22.html "4.4.22. Change reports") explains these
    default settings and how to change them to create the reports that
    you need.

-   `RUN_PART1`{.envar}, `RUN_PART2`{.envar}, `RUN_PART3`{.envar},
    `RUN_PART4`{.envar}: These settings should not have to be changed by
    most users. They are included for the convenience of those who want
    to more easily rearrange their SMOKE processing. Each source
    category has its own parts for processing as follows:

    ::: {.informaltable}
                            Area                                                              Biogenic                                 Mobile                                                            Point
      --------------------- ----------------------------------------------------------------- ---------------------------------------- ----------------------------------------------------------------- -----------------------------------------------------------------
      `RUN_PART1`{.envar}   **Smkinven**, **Spcmat**, **Grdmat**, **Cntlmat**, **Grwinven**   **Rawbio**, **Normbeis3**, **Metscan**   **Smkinven**, **Spcmat**, **Grdmat**, **Cntlmat**, **Grwinven**   **Smkinven**, **Spcmat**, **Grdmat**, **Cntlmat**, **Grwinven**
      `RUN_PART2`{.envar}   **Temporal**                                                      **Tmpbio**, **Tmpbeis3**                 **Temporal**                                                      **Temporal**
      `RUN_PART3`{.envar}                                                                                                                                                                                **Elevpoint**
      `RUN_PART4`{.envar}   **Smkmerge**, **Mrggrid**, **Smk2emis**                           **Mrggrid**, **Smk2emis**                **Movesmrg**, **Mrggrid**, **Smk2emis**                           **Laypoint**, **Smkmerge**, **Mrggrid**, **Smk2emis**
    :::

-   `RUN_<Program Name>`{.envar}: \[Y \| N\] The collection of
    `RUN_<Program Name>`{.envar} variables control whether a program is
    going to be run during a given script run. These can be set to N if
    the program is not needed for some reason. How these settings should
    be set is described in [Section 4.4.6, "Change which programs are
    run"](ch04s04s06.html "4.4.6. Change which programs are run").

-   `SMK_FUTURE_YN`{.envar}: \[Y \| N\] When set to Y, the file names
    and output directories are changed to use the `FYEAR`{.envar}
    variable setting in the names. See the `FYEAR`{.envar} documentation
    for more information on how the naming variables are set. This
    setting is needed only in scripts for processing future-year cases.

-   `SPC_OVERRIDE`{.envar}: Sets a value for the `SPC`{.envar} variable
    in the Assigns file that overrides whatever value is actually inside
    the Assigns file. The Assigns file invokes the override mechanism
    when this environment variable is defined, so to not use this
    scripting feature, the variable must not be defined. [**In other
    words, it is not acceptable to set this to a blank value.**]{.bold}

    In addition, the merge scripts that run the **Mrggrid** program can
    also use the `A_SPC_OVERRIDE`{.envar}, `N_SPC_OVERRIDE`{.envar},
    `B_SPC_OVERRIDE`{.envar}, `M_SPC_OVERRIDE`{.envar}, and
    `P_SPC_OVERRIDE`{.envar} settings. These settings override the
    `SPC`{.envar} variable used [*only*]{.emphasis} for the definition
    of the `A_OUT`{.envar}, `N_OUT`{.envar}, `B_OUT`{.envar},
    `M_OUT`{.envar}, and `P_OUT`{.envar} directories that contain the
    hourly, gridded, and speciated SMOKE output files. These settings
    can be used to pull multiple chemical mechanisms (such as toxics and
    non-toxics) into a single model-ready file. The user must determine
    which multiple mechanisms are appropriate to combine. It is
    acceptable to combine toxics-integrated and criteria-only current
    CB6 mechanisms, but inappropriate to combine CB6 and SARPRC
    mechanisms.

-   `SRCABBR`{.envar}: Sets the source category abbreviation name for
    use in naming log files. The typical settings are ar (area sources),
    nr (nonroad sources), mb (mobile sources), bg (biogenic sources),
    and pt (point sources).

-   `YEAR_OVERRIDE`{.envar}: Sets a value for the `YEAR`{.envar}
    variable in the Assigns file that overrides whatever value is
    actually inside the Assigns file. The Assigns file invokes the
    override mechanism when this environment variable is defined, so to
    not use this scripting feature, the variable must not be defined.
    [**In other words, it is not acceptable to set this to a blank
    value.**]{.bold}
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------- -------------------- ---------------------------------------------------
  [Prev](ch04s02s03.html)                            [Up](ch04s02.html)                              [Next](ch04s02s05.html)
  4.2.3. Example script files and their purposes     [Home](index.html)     4.2.5. SMOKE settings controlled through scripts
  ------------------------------------------------- -------------------- ---------------------------------------------------
:::
::: {.navheader}
4.2.5. SMOKE settings controlled through scripts
:::

[Prev](ch04s02s04.html) 

4.2. Test case descriptions

 [Next](ch04s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e11279}4.2.5. SMOKE settings controlled through scripts {#smoke-settings-controlled-through-scripts .title}

</div>

</div>
:::

All SMOKE programs can be controlled by input environment variables, and
the run scripts control these variables. The program documentation in
[Chapter 5, *SMOKE Utility
Tools*](ch05.html "Chapter 5. SMOKE Utility Tools"), [Chapter 6, *SMOKE
Core Programs*](ch06.html "Chapter 6. SMOKE Core Programs"), and
[Chapter 7, *SMOKE Quality
Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance") include the
available environment variable settings for each program.

The example run scripts contain most of the major script settings needed
for running SMOKE. The major exception to this is the `UAM_*`{.envar}
settings needed for **Smkmerge** and **Smk2emis**, when running for
UAM-V and CAM~X~. These can be added to the scripts as needed.
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -----------------------------------
  [Prev](ch04s02s04.html)     [Up](ch04s02.html)                 [Next](ch04s03.html)
  4.2.4. Script settings      [Home](index.html)     4.3. Running the SMOKE test case
  -------------------------- -------------------- -----------------------------------
:::
::: {.navheader}
4.3. Running the SMOKE test case
:::

[Prev](ch04s02s05.html) 

Chapter 4. How to Use SMOKE

 [Next](ch04s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_scripts_run_example}4.3. Running the SMOKE test case {#running-the-smoke-test-case .title style="clear: both"}
-------------------------------------------------------------

</div>

</div>
:::

As mentioned in [Section 4.1,
"Introduction"](ch04.html#sect_scripts_introduction "4.1. Introduction"),
the first step in working with SMOKE is invoking the Assigns file. In
this section, we will go beyond that first step to actually running the
scripts for the nctox case. But first, we will review the essential
steps for running SMOKE each and every time you start to work with the
SMOKE system.

First, the `SMK_HOME`{.envar} environment variable needs to be defined.
In [Section 12.3, "Installing
SMOKE"](ch12s03.html "12.3. Installing SMOKE"), we explain that you can
configure your UNIX system to set this automatically each time you log
into your computer. If you have not done that, then you will need to set
the `SMK_HOME`{.envar} variable manually before invoking an Assigns
file:

**`setenv SMK_HOME` *`<directory in which you installed SMOKE>`***

Second, you must invoke the Assigns file for the case that you want to
run. This will make available all of the environment variables that you
can use to navigate through the SMOKE directory structure. There is a
different Assigns file for each case, so we provide this instruction
with the case-specific documentation below. Of course, when you develop
an Assigns file for your case, you will use that instead.

[**NOTE:**]{.bold} All of the SMOKE scripts assume that you are running
a variant of the C-shell (either **csh** or **tcsh**). The scripts will
not work with other shells such as **bash**. If your shell is not
**csh** or **tcsh**, you will need to change into an appropriate shell
before running any SMOKE scripts.

To run the nctox test case, you must first source the Assigns file using
the commands below:

**`cd $SMK_HOME`/subsys/smoke/assigns** [*(change to the assigns
directory)*]{.emphasis}

**`source ASSIGNS.nctox.cmaq.cb05_soa.us12-nc`** [*(set up for the nctox
case)*]{.emphasis}

Next, you'll run the base-year nctox scripts. These scripts process the
stationary area, biogenic, nonroad mobile, and point emissions for the
base year. The commands to run the scripts are below:

**`cd $SCRIPTS`/run** [*(change to the run scripts
directory)*]{.emphasis}

**`smk_area_nctox.csh`** [*(invoke the stationary area run
script)*]{.emphasis}

**`smk_bg_nctox.csh`** [*(invoke the BEIS3 biogenic run
script)*]{.emphasis}

**`smk_nonroad_nctox.csh`** [*(invoke the nonroad mobile run
script)*]{.emphasis}

**`smk_point_nctox.csh`** [*(invoke the point run script)*]{.emphasis}

**`smk_rateperdistance_nctox.csh`** [*(invoke the MOVES mobile sources
on-roadway rate-per-distance (RPD) run script for all
processes)*]{.emphasis}

**`smk_ratepervehicle_nctox.csh`** [*(invoke the MOVES mobile sources
off-network rate-per-vehicle (RPV) run script)*]{.emphasis}

**`smk_rateperprofile_nctox.csh`** [*(invoke the MOVES mobile sources
off-network rate-per-profile (RPP) run script)*]{.emphasis}

**`smk_rateperhour_nctox.csh`** [*(invoke the MOVES mobile sources
off-network rate-per-hour (RPH) run script)*]{.emphasis}

**`smk_mrgall_nctox.csh`** [*(invoke the all-sources merge
script)*]{.emphasis}

To verify that the nctox scripts have run correctly, go to the log file
directory and look for errors by using:

**`cd $LOGS`** [*(change to the log file directory for the test
case)*]{.emphasis}

``` {.programlisting}
grep ERROR *
```

If there are no errors, the next step is to run a QA script to be sure
that the answers match.

**`cd $SCRIPTS`/install** [*(change to the install
directory)*]{.emphasis}

**`check_smk_install`** [*(invoke the smoke install quality assurance
script)*]{.emphasis}
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------- -------------------- ------------------------
  [Prev](ch04s02s05.html)                               [Up](ch04.html)        [Next](ch04s04.html)
  4.2.5. SMOKE settings controlled through scripts     [Home](index.html)     4.4. How to use SMOKE
  --------------------------------------------------- -------------------- ------------------------
:::
::: {.navheader}
4.4. How to use SMOKE
:::

[Prev](ch04s03.html) 

Chapter 4. How to Use SMOKE

 [Next](ch04s04s02.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

[]{#sect_scripts_how_use_smoke}4.4. How to use SMOKE {#how-to-use-smoke .title style="clear: both"}
----------------------------------------------------

</div>

</div>
:::

::: {.toc}
[[4.4.1. Change Assigns file to set scenario names, grid names, and
other case-specific configuration
information](ch04s04.html#sect_scripts_change_assigns)]{.section}

[[4.4.2. Use new inventory data](ch04s04s02.html)]{.section}

[[4.4.3. Select which pollutants in the inventory are
kept](ch04s04s03.html)]{.section}

[[4.4.4. Set fallback stack paramaters](ch04s04s04.html)]{.section}

[[4.4.5. Changing output and intermediate directory
names](ch04s04s05.html)]{.section}

[[4.4.6. Change which programs are run](ch04s04s06.html)]{.section}

[[4.4.7. Set up country codes, state codes, or county
codes](ch04s04s07.html)]{.section}

[[4.4.8. Set up list of known SCCs and ORIS
IDs](ch04s04s08.html)]{.section}

[[4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic
and biogenic)](ch04s04s09.html)]{.section}

[[4.4.10. Use a different speciation mechanism or change speciation
inputs](ch04s04s10.html)]{.section}

[[4.4.11. Setup projection and control
scenarios](ch04s04s11.html)]{.section}

[[4.4.12. Use MOVES for on-road mobile
sources](ch04s04s12.html)]{.section}

[[4.4.13. Change temporal processing](ch04s04s13.html)]{.section}

[[4.4.14. Use **Elevpoint** for selecting elevated and PinG
sources](ch04s04s14.html)]{.section}

[[4.4.15. Use BEIS3](ch04s04s15.html)]{.section}

[[4.4.16. Change meteorology data](ch04s04s16.html)]{.section}

[[4.4.17. Plume Rise Calculation for Fires](ch04s04s17.html)]{.section}

[[4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version
4.7)](ch04s04s18.html)]{.section}

[[4.4.19. Model for CMAQ](ch04s04s19.html)]{.section}

[[4.4.20. Model for UAM and CAM~X~](ch04s04s20.html)]{.section}

[[4.4.21. Determine if a run worked correctly and
troubleshoot](ch04s04s21.html)]{.section}

[[4.4.22. Change reports](ch04s04s22.html)]{.section}

[[4.4.23. Generating CMAQ-ready Source Apportionment Input Data
Files](ch04s04s23.html)]{.section}

[[4.4.24. Generating AERMOD-ready Input Data Files
\[SMOKE4AERMOD)](ch04s04s24.html)]{.section}
:::

This section builds on the previous section to describe how to use the
SMOKE files, scripts, and programs to create emission inputs for your
air quality model. The first part of setting up SMOKE for a case other
than the test case that comes with SMOKE is to create an Assigns file
and script files for your case. If you have not read through the earlier
parts of this chapter, we recommend that you do so. There are some
critical points that you need to understand about the Assigns file and
scripts. In [Section 4.1,
"Introduction"](ch04.html#sect_scripts_introduction "4.1. Introduction"),
we have described that an Assigns file must always be used when starting
to work with SMOKE and the UNIX commands to do that. In [Section 4.2.2,
"Script descriptions"](ch04s02s02.html "4.2.2. Script descriptions"), we
have already described the purpose and use of the Assigns file and
scripts, so please refer to that section for more information on these.

You may use this section as a step-by-step guide for all of the changes
that you need to make to the scripts and files for running SMOKE. If you
read it straight through and follow all of the steps that apply to your
situation, then you will have set up SMOKE for your modeling case. If
you are already familiar with SMOKE, you may also use this section as a
reference for changing specific parts of the configuration to meet
specific needs.

To create your own scripts and use your own data for the first time, you
must take the following steps:

::: {.orderedlist}
1.  Copy the example Assigns file to your own copy. The name of the
    Assigns file is not critical to the success of this step, but it is
    useful to name the file something that you will be able to identify
    easily for the modeling case for which it will be used.

    **`cp ASSIGNS.nctox.cmaq.cb05_soa.us12-nc` *`<yourfile>`***

2.  Modify the necessary features of the Assigns file for your case. For
    example, change the scenario names, episode dates, duration, grid
    name, or speciation name. Some of these changes require additional
    input files. See [Section 4.4.1, "Change Assigns file to set
    scenario names, grid names, and other case-specific configuration
    information"](ch04s04.html#sect_scripts_change_assigns "4.4.1. Change Assigns file to set scenario names, grid names, and other case-specific configuration information")
    for more details on the settings that you can change and the values
    to use for each.

3.  Invoke the Assigns file. This will create all of the input and
    output directories that you will need to set up your case:

    **`source <yourfile>`**

4.  Copy the appropriate nctox scripts to your own scripts, change the
    Assigns file listed in the script to the one that you created in the
    previous step.

5.  Using one or more of the subsections in this chapter, create your
    input files and change the options in the scripts. The subsections
    below explain what files and settings need to be changed and checked
    for many types of operations for configuring SMOKE.
:::

You need not always start from the example Assigns file. Once you have
your own case-specific Assigns files, you may use them as starting
points for creating other files.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_change_assigns}4.4.1. Change Assigns file to set scenario names, grid names, and other case-specific configuration information {#change-assigns-file-to-set-scenario-names-grid-names-and-other-case-specific-configuration-information .title}

</div>

</div>
:::

This subsection provides an overview of all of the Assigns file settings
that you may need to change. The remaining subsections in this chapter
include more detail about the changes as associated with specific
modeling needs. For example, [Section 4.4.10, "Use a different
speciation mechanism or change speciation
inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs")
explains how to change the Assigns file to set different chemical
mechanisms as well as all of the files needed.

In the 5-step list provided in the previous section, note that the
Assigns file must first be changed (step 2) and then invoked (step 3) to
create the input and output directories for your case. Ideally, all of
the settings in the list below would be done in step 2 before step 3 is
performed. If this is not possible, however, you should [*at a
minimum*]{.emphasis} set the first five items on the list below before
moving to step 3. These are the variables that affect the input and
output directory names, so if they are set, then the directories that
you need to use will for all other configuration steps will be set up
for you.

The list below provides the typical settings that may need to be changed
to be consistent with the case that you need. Each item in the list
references a different section of this chapter and [Table 4.1, "Variable
in Assigns file for naming files and
directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories")
or [Table 4.2, "Variables in Assigns file for controlling time period
and grid of
processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing")
for more information. The variables in the [Table 4.1, "Variable in
Assigns file for naming files and
directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories")
are used for naming files and directories. [Table 4.2, "Variables in
Assigns file for controlling time period and grid of
processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing")
includes the settings for controlling the time period and grid of your
SMOKE runs.

The checklist of major Assigns settings to change is:

::: {.orderedlist}
1.  Change the `INVID`{.envar}, `INVEN`{.envar}, and `INVOP`{.envar}
    values to a new inventory name. The simplest approach is to set
    these three variables to the same name, but different names can be
    used. Examples of which files or directories are affected by these
    settings are provided in [Table 4.1, "Variable in Assigns file for
    naming files and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories").
    See also [Section 4.4.2, "Use new inventory
    data"](ch04s04s02.html "4.4.2. Use new inventory data").

2.  Change the `ABASE`{.envar}, `BBASE`{.envar}, `MBASE`{.envar},
    `PBASE`{.envar}, and `EBASE`{.envar} values to a new scenario name.
    The simplest approach is to set these three variables to the same
    name, but different names can be used. Examples of which files or
    directories are affected by these settings are provided in
    [Table 4.1, "Variable in Assigns file for naming files and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories").
    See also [Section 4.4.2, "Use new inventory
    data"](ch04s04s02.html "4.4.2. Use new inventory data").

3.  Change the `METSCEN`{.envar} value to your meteorology scenario
    name. This will affect the name of the input directory for the
    meteorology files (the `$METDAT`{.filename} directory, which can be
    a linked directory if you do not want to install your meteorology
    files under the SMOKE directory structure).

4.  Change the `SPC`{.envar} value to one of the supported speciation
    mechanisms (see [Section 4.4.10.1, "Choosing from default
    mechanisms"](ch04s04s10.html#sect_scripts_use_default_spc "4.4.10.1. Choosing from default mechanisms"))
    or to a new speciation mechanism (see [Section 4.4.10.2, "Setup of
    new mechanism or changing an existing
    mechanism"](ch04s04s10.html#sect_scripts_use_new_spc "4.4.10.2. Setup of new mechanism or changing an existing mechanism")).

5.  Change the `GRID`{.envar} and `IOAPI_GRIDNAME_1`{.envar} values to
    the grid names for naming files. See also [Section 4.4.9, "Use a new
    modeling grid or change spatial inputs (anthropogenic and
    biogenic)"](ch04s04s09.html "4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic and biogenic)").

6.  Change the run period naming settings `ESDATE`{.envar} and
    `NDAYS`{.envar} (see [Table 4.1, "Variable in Assigns file for
    naming files and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories")).
    See also [Section 4.4.13.4, "Changing the dates, times, and duration
    of model-ready SMOKE emissions
    files"](ch04s04s13.html#sect_scripts_duration_output "4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE emissions files").

7.  Change the episode settings `EPI_STDATE`{.envar},
    `EPI_STTIME`{.envar}, `EPI_RUNLEN`{.envar}, and `EPI_NDAY`{.envar}
    and the run period settings `G_STDATE`{.envar}, `G_STTIME`{.envar},
    and `G_RUNLEN`{.envar}. See [Table 4.2, "Variables in Assigns file
    for controlling time period and grid of
    processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing")
    and [Section 4.4.13.3, "Changing the
    episode"](ch04s04s13.html#sect_scripts_change_episode "4.4.13.3. Changing the episode")
    and [Section 4.4.13.4, "Changing the dates, times, and duration of
    model-ready SMOKE emissions
    files"](ch04s04s13.html#sect_scripts_duration_output "4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE emissions files").

8.  Change the `YEAR`{.envar} value to the year of your base case
    inventory.
:::

::: {.table}
[]{#tbl_scripts_variables_files}

**Table 4.1. Variable in Assigns file for naming files and directories**

  Environment Variable   Description
  ---------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `INVID`{.envar}        Inventory input directory identifier. Controls directory path of input inventory. `INVDIR`{.envar} = `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}
  `INVOP`{.envar}        Base year inventory output name. Controls output file names for SMOKE intermediate inventory files and other output files from **Smkinven** and inventory-only reports from **Smkreport**. This variable is used to initialize the `FYIOP`{.envar} variable, which is also used in the Assigns file and is equal to `INVOP`{.envar} for base case modeling. `FYIOP`{.envar} is reset by the `set_case.scr`{.filename} helper script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings") documentation on `FYEAR`{.envar} and `CNTLCASE`{.envar})
  `INVEN`{.envar}        Base year inventory name, with version. Controls directory path of output inventory. `INVOPD`{.envar} = `$SMKDAT`{.filename}/inventory/`$INVEN`{.envar}
  `ABASE`{.envar}        Scenario identifier for area/non-point and nonroad mobile sources. Controls output file names and directories for outputs from SMOKE programs other than **Smkinven** (e.g., locations and file names of all matrices, hourly emissions, model-ready files). This variable is used to initialize the `ASCEN`{.envar} variable, which is also used in the Assigns file and is equal to `ABASE`{.envar} for base case modeling. `ASCEN`{.envar} is reset by the `set_case.scr`{.filename} helper script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings") documentation on `FYEAR`{.envar} and `CNTLCASE`{.envar}). Should be set to the same value as `BBASE`{.envar}, `MBASE`{.envar}, `PBASE`{.envar}, and `EBASE`{.envar} for the basic configuration.
  `BBASE`{.envar}        Scenario identifier for biogenic sources that works the same way as `ABASE`{.envar}, but affects the `BSCEN`{.envar} variable.
  `MBASE`{.envar}        Scenario identifier for on-road mobile sources that works the same way as `ABASE`{.envar}, but affects the `MSCEN`{.envar} variable.
  `PBASE`{.envar}        Scenario identifier for on-road mobile sources that works the same way as `ABASE`{.envar}, but affects the `PSCEN`{.envar} variable.
  `EBASE`{.envar}        Scenario identifier for merged emissions sources. Controls output file names and directories for outputs for final model-ready files. Sets the path for the `STATIC`{.envar}, `SCENARIO`{.envar}, and `OUTPUT`{.envar} directories and file names for the merged outputs for multiple source categories from the **Smkmerge** program (e.g., the `EGTS3D_L`{.envar} file).
  `METSCEN`{.envar}      Meteorology scenario name. Sets the `METDAT`{.envar} directory for the MCIP meteorology files and can be used to set the meteorology file names (not done in example nctox scripts). Also helps set names for meteorology-dependent SMOKE intermediate files for biogenics (**Tmpbeis3** outputs `B3GTS_S`{.envar} and `B3GTS_L`{.envar}), on-road mobile (**Temporal** output `MTMP`{.envar}), and point (**Laypoint** outputs `PLAY`{.envar} and `PLAY_EX`{.envar}).
  `GRID`{.envar}         Grid name used for naming files that depend on the selected grid. User must coordinate `GRID`{.envar} settings with `IOAPI_GRIDNAME_1`{.envar} setting [Table 4.2, "Variables in Assigns file for controlling time period and grid of processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing"). Dependent files include gridding matrix, gridded land use and biogenic emissions, hourly mobile emissions, layer-fractions files, model-ready emissions, and some reports.
  `SPC`{.envar}          Speciation profile name for selecting input files and naming output files and directories that depend on the chemical mechanism. This setting can be overridden by the `SPC_OVERRIDE`{.envar} script setting (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")). The `SPC`{.envar} setting sets input files `GSPRO`{.envar} and `GSREF`{.envar}; speciation matrix intermediate file names, and output directories `OUTPUT`{.envar}, `A_OUT`{.envar}, `B_OUT`{.envar}, `M_OUT`{.envar}, `N_OUT`{.envar}, and `P_OUT`{.envar}.
  `ESDATE`{.envar}       Starting date for first modeled period in episode. Has format YYYYMMDD where YYYY is the 4-digit year, MM is the two-digit month (e.g., 07 for July), and DD is the two-digit day (e.g., 01 for the first). Users should coordinate this with the `G_STDATE`{.envar} setting [Table 4.2, "Variables in Assigns file for controlling time period and grid of processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing"). The Assigns file resets this variable if the `G_STDATE_ADVANCE`{.envar} variable is set by a calling script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")).
  `MSDATE`{.envar}       Meteorology file dates. This variable can be used to help name time-dependent meteorology files or directory names. In the example scripts for the nctox case, however, this variable is not used and the `G_STDATE`{.envar} variable is used instead.
  `NDAYS`{.envar}        Number of days in a modeling period. To break up a modeling episode into multiple modeling periods of one or more days, the user must set and coordinate this setting with the `G_RUNLEN`{.envar} setting [Table 4.2, "Variables in Assigns file for controlling time period and grid of processing"](ch04s04.html#tbl_scripts_variables_time "Table 4.2. Variables in Assigns file for controlling time period and grid of processing"). `NDAYS`{.envar} represents the number of days indicated in hours by the `G_RUNLEN`{.envar} variable. `NDAYS`{.envar} is used for naming hourly emissions files output from the **Temporal** program, biogenic outputs from **Tmpbio**, layer fractions files from **Laypoint**, and model-ready emissions files from **Smkmerge**.
  `YEAR`{.envar}         Base case modeling year. This setting is used to set several things in coordination with the `FYEAR`{.envar} and `SMK_FUTURE_YN`{.envar} script settings (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")). For growth modeling, it is used in the file name for the `GCNTL`{.envar} input file, set by the growth/control example nctox scripts. This setting can be overridden by the `YEAR_OVERRIDE`{.envar} setting, also described in [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings"). Lastly, it is used to set the file name for the winter/summer designations file output from **Metscan**, called the `BIOSEASON`{.envar} file.
:::

::: {.table}
[]{#tbl_scripts_variables_time}

**Table 4.2. Variables in Assigns file for controlling time period and
grid of processing**

  Environment Variable         Description
  ---------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `G_STDATE`{.envar}           Julian starting date of first modeled period in episode. Has format YYYYDDD where YYYY is a 4-digit year and DDD is a 3-digit Julian date (e.g., 001 for the first day of the year). Users should coordinate this with the `ESDATE`{.envar} setting [Table 4.1, "Variable in Assigns file for naming files and directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories"). The Assigns file resets this variable if the `G_STDATE_ADVANCE`{.envar} variable is set by a calling script (see [Section 4.2.4, "Script settings"](ch04s02s04.html "4.2.4. Script settings")). Controls operation of time-dependent programs **Temporal**, **Tmpbio**, **Laypoint**, and **Smkmerge**.
  `G_STTIME`{.envar}           Start time of each period in the episode. Has format HHMMSS where HH is a 2-digit hour (leading zero not required), MM is a 2-digit minute (set to 00 for SMOKE), and SS is a 2-digit second (set to 00 for SMOKE).
  `G_RUNLEN`{.envar}           Duration of each run period in episode. To break up a modeling episode into multiple modeling periods of one or more days, the user must set and coordinate this setting with the `NDAYS`{.envar} setting [Table 4.1, "Variable in Assigns file for naming files and directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories"). `G_RUNLEN`{.envar} has format HHHHMMSS, where HHHH is a 4-digit duration in hours (leading zeros not required), MM and HH should be set as for `G_STTIME`{.envar}. `G_RUNLEN`{.envar} controls the duration modeled for each run of the **Temporal**, **Tmpbio**, **Laypoint**, and **Smkmerge** programs. Must be set one hour greater than the number of days times 24 (e.g., a two-day period length is 2 x 24 + 1 = 49).
  `G_TSTEP`{.envar}            Time step. Has format HHMMSS with format the same as described for `G_STTIME`{.envar}. The current version of SMOKE allows this setting to only be 10000, for hourly timesteps.
  `EPI_STDATE`{.envar}         Episode start date. Has the same format as `G_STDATE`{.envar}. Does not change during the course of an episodic run. In the Assigns file, should be set the same as `G_STDATE`{.envar}.
  `EPI_STTIME`{.envar}         Episode start time. Has the same format as `G_STTIME`{.envar}. Does not change during the course of an episodic run. In the Assigns file, should be set the same as `G_STTIME`{.envar}.
  `EPI_RUNLEN`{.envar}         Episode duration. Has the same format as `G_RUNLEN`{.envar}. Does not change during the course of an episodic run. In the Assigns file, should be set for the entire duration of the modeling episode, which must be greater than or equal to `G_RUNLEN`{.envar} minus one hour, is limited to at most one year, and for best results, should be a multiple of `G_RUNLEN`{.envar} minus one hour. For example, if `G_RUNLEN`{.envar} is 250000 (one day plus the required one additional hour), `EPI_RUNLEN`{.envar} must be at least 240000 and at most 365 x 240000 = 87600000. This example would run an annual episode using 24-hour run periods.
  `EPI_NDAY`{.envar}           The number of days in the episode. Should be the value of `EPI_RUNLEN`{.envar} divided by 240000. This settings controls for how many days to use the automatic looping in the example scripts, which loops over all of the periods (set by `G_RUNLEN`{.envar}) during the episode (set by `EPI_RUNLEN`{.envar}).
  `IOAPI_GRIDNAME_1`{.envar}   The selected grid. Controls which grid will be selected by the **Grdmat** program from the `GRIDDESC`{.envar} file. Users should coordinate this setting with the `GRID`{.envar} setting from [Table 4.1, "Variable in Assigns file for naming files and directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories"), which is used for naming files. This setting must match the grid names in the gridded land use and spatial surrogates files' headers.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------- -------------------- --------------------------------
  [Prev](ch04s03.html)                  [Up](ch04.html)             [Next](ch04s04s02.html)
  4.3. Running the SMOKE test case     [Home](index.html)     4.4.2. Use new inventory data
  ----------------------------------- -------------------- --------------------------------
:::
::: {.navheader}
4.4.2. Use new inventory data
:::

[Prev](ch04s04.html) 

4.4. How to use SMOKE

 [Next](ch04s04s03.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_use_new_inv}4.4.2. Use new inventory data {#use-new-inventory-data .title}

</div>

</div>
:::

::: {.toc}
[[4.4.2.1. Area/non-point
inventories](ch04s04s02.html#sect_scripts_area_invs)]{.section}

[[4.4.2.2. Nonroad mobile
inventories](ch04s04s02.html#sect_scripts_nonroad_invs)]{.section}

[[4.4.2.3. On-road mobile
inventories](ch04s04s02.html#d0e12518)]{.section}

[[4.4.2.4. Point/fires inventories](ch04s04s02.html#d0e12634)]{.section}

[[4.4.2.5. Day-specific and hour-specific point and fire
inventories](ch04s04s02.html#sect_scripts_hour_day_invs)]{.section}

[[4.4.2.6. Future-year
inventories](ch04s04s02.html#sect_scripts_future_invs)]{.section}

[[4.4.2.7. Pre-gridded
inventories](ch04s04s02.html#sect_scripts_pregridded)]{.section}

[[4.4.2.8. Files and settings for all
inventories](ch04s04s02.html#sect_scripts_all_invs)]{.section}

[[4.4.2.9. Using average-day and annual data in the same
run](ch04s04s02.html#sect_scripts_average_day_invs)]{.section}
:::

This section describes what steps are necessary to take when using new
inventory data for anthropogenic sources. For information on biogenic
sources, see [Section 4.4.15, "Use
BEIS3"](ch04s04s15.html "4.4.15. Use BEIS3"). For more information about
the details of each source category (e.g., what is the difference
between using MOVES emission factors or precomputed on-road mobile
emissions), see [Section 2.8.1, "Summary of SMOKE processing
categories"](ch02s08.html#sect_concepts_summary_source_processing "2.8.1. Summary of SMOKE processing categories").

Because this section is so spread out, we provide a small section guide
here. This section includes the following subsections:

::: {.itemizedlist}
-   Area/non-point inventories
-   Nonroad mobile inventories
-   On-road mobile inventories
-   Point inventories
-   Day-specific and hour-specific point and fire inventories
-   Future-year inventories
-   Pre-gridded inventories (for same output modeling domain or for
    converting to a different modeling domain (example: EDGAR/RCP/HTAP
    to CMAQ ready emissions file)
-   Using seasonal and annual data in the same run
-   Files and settings for all inventories
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_area_invs}4.4.2.1. Area/non-point inventories {#areanon-point-inventories .title}

</div>

</div>
:::

::: {.orderedlist}
1.  Determine the file format that you have (for preformatted data) or
    want to create (for new data).

    ::: {.orderedlist}
    a.  Preformatted data considerations

        ::: {.itemizedlist}
        -   If you have preexisting data in SMOKE input format, then you
            will most likely want to use that format to input to SMOKE,
            unless you discover that you need a different format to take
            advantage of a SMOKE feature not available in a different
            format.

        -   If you have multiple files in a single format, then you can
            combine these into a single SMOKE run using a list file.

        -   If you have data in more than one format other than the case
            just mentioned, you must convert all files to the same
            format or process them separately in SMOKE, merging the
            hourly, gridded, speciated emissions files using
            **Mrggrid**.

        -   If your area inventory includes nonroad mobile sources, you
            can process nonroad mobile sources with stationary area
            sources in most cases (see next bullet for exception).

        -   If you want to combine nonroad mobile criteria and toxics
            inventories, you need to process nonroad mobile sources
            separately from area sources (see [Section 4.4.2.2, "Nonroad
            mobile
            inventories"](ch04s04s02.html#sect_scripts_nonroad_invs "4.4.2.2. Nonroad mobile inventories")).

        -   Pregridded data from any source category can be input to
            SMOKE as an area source, but you must convert the data to an
            I/O API NetCDF file format first. See [Section 4.4.2.7.1,
            "Pre-gridded inventories from the same modeling domain as an
            area source without source characterization or
            attributes"](ch04s04s02.html#sect_scripts_pregridded_invs_same "4.4.2.7.1. Pre-gridded inventories from the same modeling domain as an area source without source characterization or attributes")
            for more information.
        :::
    :::

2.  Collect or create inventories in correct formats.

    Inventory files for area sources are usually named starting with
    "[arinv]{.quote}", because `ARINV`{.envar} is the logical file name
    (environment variable) that **Smkinven** uses to read the file. The
    formats available for area/non-point sources are:

    ::: {.orderedlist}
    a.  List format. The list format is simply an ASCII file that lists
        all of the files that you want SMOKE to import in a single run.

    b.  List Grid format. The list grid format is simply an ASCII file
        that lists all of the global gridded inventory files that you
        want SMOKE to import in a single run. The List Grid format has
        four columns. Assigned SCC, Pollutant ID, Local Variable Name,
        Month of inventory and Full inventory fine directory path and
        filename.

    c.  ORL and FF10 formats. These formats are most appropriate for
        non-point toxics inventories, but also can be used for any
        inventory data.

    d.  Pregridded I/O API format. This format can only be used for
        pregridded data that has been converted to a time-independent,
        gridded I/O API file. The variables in the file are the
        pollutants. No SCCs or other source information can be provided
        with this format.
    :::

3.  Set and/or check the file headers that apply for your file format.

    ::: {.orderedlist}
    a.  File format header: Make sure that the first line of the list
        file or individual files start with the \#LIST (for list files
        only),\#LIST GRID, \#ORL, \#FF10 (see [Section 8.2.1.2, "File
        format
        header"](ch08s02.html#sect_input_inventory_format "8.2.1.2. File format header")).

    b.  File type (\#TYPE header): The type is important because it
        helps SMOKE determine the file format. Make sure that the header
        has been set according to the directions in [Section 8.2.1.4,
        "Header
        records"](ch08s02.html#sect_input_inventory_header "8.2.1.4. Header records").

    c.  Country (\#COUNTRY header): Make sure that this head has been
        used and that the country name used in this header matches the
        name in the country section of the `COSTCY`{.envar} or
        `GEOCODE_LEVEL[1-4]`{.envar} file (if USE\_EXP\_GEOCODE Y) file.

    d.  Inventory year (\#YEAR). Make sure that the inventory year is
        accurately reflected in the header. This is the only way SMOKE
        knows what year the data is for. If this year is not a base year
        but a future-year, make sure to follow the additional
        instructions in [Section 4.4.2.6, "Future-year
        inventories"](ch04s04s02.html#sect_scripts_future_invs "4.4.2.6. Future-year inventories").

    e.  Description (\#DESC header): Although this header is not
        required, it is good practice to take advantage of it and
        include as much information about the data as you have. There is
        no limit to the number of \#DESC headers that can be included in
        the file.

    f.  Data header (\#POLID or \#DATA header): Make sure that this
        required header is included in the file. It should accurately
        reflect the data values provided on each line of the file. If
        there are data fields at the end of the file that you want to
        drop from being imported, you can leave them off of the \#POLID
        or \#DATA header to cause them to not be imported by
        **Smkinven** (see also the `INVTABLE`{.envar} file for dropping
        emissions during import).

        For ORL format, this header does not apply. The pollutants are
        designated by code number (i.e., CAS number) in the file format
        and therefore the header is not needed.
    :::

4.  Install inventory files in `$ARDAT`{.filename} directory.

    This directory is
    `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}/area.

5.  Ensure the Assigns file has the `ARINV`{.envar} variable set to the
    `ARINV`{.envar} file name for your area-source inventory file.

6.  Optionally, set up to assign point-source locations to area sources
    using the `ARTOPNT`{.envar} file.

    ::: {.orderedlist}
    a.  Put the `ARTOPNT`{.envar} file in the `$INVDIR`{.filename}/other
        directory.

    b.  Ensure the name of the `ARTOPNT`{.envar} file is consistent with
        the `ARTOPNT`{.envar} setting in the Assigns file.

    c.  Make sure that the `ARTOPNT`{.envar} file data are consistent
        with the year of your inventory (e.g., use 1999 coordinates for
        a 1999 inventory), or that you can accept any discrepancies.
    :::

7.  See also steps for all source categories in [Section 4.4.2.8, "Files
    and settings for all
    inventories"](ch04s04s02.html#sect_scripts_all_invs "4.4.2.8. Files and settings for all inventories").
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_nonroad_invs}4.4.2.2. Nonroad mobile inventories {#nonroad-mobile-inventories .title}

</div>

</div>
:::

::: {.orderedlist}
1.  Determine the file format that you have (for preformatted data) or
    want to create (for new data).

    ::: {.orderedlist}
    a.  ::: {.itemizedlist}
        -   See [Section 4.4.2.1, "Area/non-point
            inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories")
            for issues relating to stationary area / non-point sources.
            These are the same issues as for nonroad mobile sources.

        -   If you need to process nonroad mobile separately from
            stationary area/non-point sources because of recommendations
            in [Section 4.4.2.1, "Area/non-point
            inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories"),
            you must separate the stationary area/non-point and nonroad
            mobile sources to two separate files if they are not already
            separated. There is no SMOKE utility to do this, but the
            UNIX **grep** command can be used to search for all SCCs in
            the nonroad mobile inventory; for example, all SCCs starting
            with "[22]{.quote}".
        :::

    b.  New data considerations

        ::: {.itemizedlist}
        -   See [Section 4.4.2.1, "Area/non-point
            inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories")
            for issues relating to stationary area and non-point
            sources. These are the same issues as for nonroad mobile
            sources.

        -   Decide whether area and nonroad mobile sources will be
            processed together, which may depend on whether the
            available inventory data include both area and nonroad
            mobile or whether they are already separate. One reason for
            separate processing is if you anticipate control strategies
            that affect only stationary area or only nonroad mobile
            sources, though it is not required that the processing be
            separate to apply such controls. A second reason for
            separate files if you are also using toxics inventories.
        :::
    :::

    [*If processing nonroad mobile sources separately, continue with
    these steps. Otherwise, the steps for area/non-point sources listed
    in [Section 4.4.2.1, "Area/non-point
    inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories")
    will be sufficient.*]{.emphasis}

2.  Collect or create inventories in correct formats.

    Inventory files for nonroad sources are usually named starting with
    "[nrinv]{.quote}", because the Assigns file uses the `NRINV`{.envar}
    environment variable to set the `ARINV`{.envar} logical file name
    (environment variable) that **Smkinven** uses to read the file. The
    list of available formats for nonroad mobile sources is:

    ::: {.orderedlist}
    a.  List format. The list format is simply an ASCII file that lists
        all of the files that you want SMOKE to import in a single run.

    b.  ORL format. This format is most appropriate for criteria and
        toxics inventories, but also can be used for any inventory data.

    c.  FF10 format. This format is most appropriate for criteria and
        toxics inventories, but also can be used for any inventory data.
    :::

3.  Set and/or check the file headers that apply for your file format.

    ::: {.orderedlist}
    a.  File format header: Make sure that the first line of the list
        file or individual files start with the \#LIST (for list files
        only),\#LIST GRID, \#ORL, \#FF10.

    b.  For other headers, please refer to the documentation in step (3)
        of the area/non-point steps in [Section 4.4.2.1, "Area/non-point
        inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories").
    :::

4.  Install inventory files in `$NRDAT`{.filename} directory.

    This directory is
    `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}/nonroad.

5.  Ensure the Assigns file has the `NRINV`{.envar} variable set to the
    `NRINV`{.envar} file name for your new nonroad-mobile-source
    inventory file.

6.  Optionally, set up to assign point-source locations to nonroad
    mobile sources using the `ARTOPNT`{.envar} file.

    Please refer to the documentation in step (6) of the area/non-point
    steps in [Section 4.4.2.1, "Area/non-point
    inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories").

7.  See also steps for all source categories in [Section 4.4.2.8, "Files
    and settings for all
    inventories"](ch04s04s02.html#sect_scripts_all_invs "4.4.2.8. Files and settings for all inventories").
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e12518}4.4.2.3. On-road mobile inventories {#on-road-mobile-inventories .title}

</div>

</div>
:::

::: {.orderedlist}
1.  Determine the file format that you have (for preformatted data) or
    want to create (for new data).

    ::: {.orderedlist}
    ::: {.itemizedlist}
    -   If using MOVES emission factors through SMOKE, create a VMT file
        in FF10 on-road mobile activity format (or use in combination
        with list format).

    -   If using both VMT and emissions, you [*must*]{.emphasis} use a
        list-format to import the two separate inventories together.

    -   If using both criteria and toxics data and wish to have the full
        functionality of SMOKE for both inventories, you must use a list
        file to list both inventory files (criteria and toxics) for
        SMOKE to combine.
    :::
    :::

2.  Collect or create inventories in correct formats.

    Inventory files for on-road mobile sources are usually named
    starting with "[mbinv]{.quote}", because **Smkinven** uses the
    `MBINV`{.envar} logical file name (environment variable) to read the
    file. The list of available formats for on-road mobile sources is:

    ::: {.orderedlist}
    a.  List format. The list format is simply an ASCII file that lists
        all of the files that you want SMOKE to import in a single run.

    b.  ORL and FF10 format. These formats are most appropriate for
        toxics inventories, but also can be used for any inventory data.
    :::

3.  Set and/or check the file headers that apply for your file format.

    ::: {.orderedlist}
    a.  Please refer to the documentation in step (3) of the
        area/non-point steps in [Section 4.4.2.1, "Area/non-point
        inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories").
    :::

4.  Install inventory files in `$MBDAT`{.filename} directory.

    This directory is
    `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}/mobile

5.  Install other mobile-specific files in inventory directories.

    The following mobile-specific files must also be installed in the
    `MBDAT`{.envar} directory. These files can usually be copied from
    the example files provided with the SMOKE installation. The formats
    and additional discussion about the contents of these files can be
    found in [Section 8.9.2, "Mobile"](ch08s09s02.html "8.9.2. Mobile").
    These files are:

    ::: {.itemizedlist}
    -   `MCXREF`{.envar} (MOVES usage only)

    -   `MFMREF`{.envar} (MOVES usage only)

    -   `MEPROC`{.envar} (MOVES usage only)
    :::

    For all inputs needed for MOVES usage only, refer to
    [Section 4.4.12, "Use MOVES for on-road mobile
    sources"](ch04s04s12.html "4.4.12. Use MOVES for on-road mobile sources").

6.  See also steps for all source categories in [Section 4.4.2.8, "Files
    and settings for all
    inventories"](ch04s04s02.html#sect_scripts_all_invs "4.4.2.8. Files and settings for all inventories").
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e12634}4.4.2.4. Point/fires inventories {#pointfires-inventories .title}

</div>

</div>
:::

::: {.orderedlist}
1.  Determine the file format that you have (for preformatted data) or
    want to create (for new data).

    ::: {.orderedlist}
    a.  Preformatted data considerations

        ::: {.itemizedlist}
        -   If you have preexisting data in SMOKE input format, then you
            will most likely want to use that format to input to SMOKE,
            unless you discover that you need a different format to take
            advantage of a SMOKE feature not available in a different
            format.

        -   Pregridded data must be input as an area source.
        :::

    b.  New data considerations

        ::: {.itemizedlist}
        -   Hour-specific or day-specific data (including precomputed
            plume-rise data) are covered in [Section 4.4.2.5,
            "Day-specific and hour-specific point and fire
            inventories"](ch04s04s02.html#sect_scripts_hour_day_invs "4.4.2.5. Day-specific and hour-specific point and fire inventories").

        -   For wildfires and prescribed fires emission modeling without
            precomputed plume rise, you could use `ORL FIRE`{.envar}
            format for both criteria and toxics inventory together.
            Using a master (annual) inventory file (`PTINV`{.envar}) for
            fires described in [Section 8.2.8.3, "ORL FIRE
            Format"](ch08s02s08.html#sect_input_ptinv_fire "8.2.8.3. ORL FIRE Format"),
            SMOKE requires day-specific inventory file(s)
            (`PTDAY`{.envar}) described in [Section 8.2.6.2, "ORL
            FIREEMIS Emission
            Format"](ch08s02s06.html#sect_input_ptday_fireemis "8.2.6.2. ORL FIREEMIS Emission Format")
            to provide both criteria and toxics inventories for those
            matched sources. See more infomation about how-to-do at
            [Section 4.4.17, "Plume Rise Calculation for
            Fires"](ch04s04s17.html "4.4.17. Plume Rise Calculation for Fires").
        :::
    :::

2.  Collect or create inventories in correct formats.

    ::: {.orderedlist}
    a.  List format. The list format is simply an ASCII file that lists
        all of the files that you want SMOKE to import in a single run.

    b.  ORL format. This format is most appropriate for point toxics
        inventories, but also can be used for any inventory data.
    :::

3.  Set and/or check the file headers that apply for your file format.

    Please refer to the documentation in step (3) of the area/non-point
    steps in [Section 4.4.2.1, "Area/non-point
    inventories"](ch04s04s02.html#sect_scripts_area_invs "4.4.2.1. Area/non-point inventories").

4.  Install inventory files in `$PTDAT`{.filename} directory.

    This directory is
    `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}/point

5.  Ensure the Assigns file has the `PTINV`{.envar} variable set to the
    `PTINV`{.envar} file name for your point-source inventory file.

6.  For hour-specific and day-specific data, including fire data, see
    [Section 4.4.2.5, "Day-specific and hour-specific point and fire
    inventories"](ch04s04s02.html#sect_scripts_hour_day_invs "4.4.2.5. Day-specific and hour-specific point and fire inventories").

7.  See also steps for all source categories in [Section 4.4.2.8, "Files
    and settings for all
    inventories"](ch04s04s02.html#sect_scripts_all_invs "4.4.2.8. Files and settings for all inventories").
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_hour_day_invs}4.4.2.5. Day-specific and hour-specific point and fire inventories {#day-specific-and-hour-specific-point-and-fire-inventories .title}

</div>

</div>
:::

Point sources in SMOKE can include day-specific or hour-specific data.
This can include fire emissions and plume rise data. The following steps
must be performed to use day-specific and/or hour-specific data in
SMOKE.

::: {.orderedlist}
1.  Determine the files that need to be created and their formats

    ::: {.orderedlist}
    a.  For day-specific emissions data, create the list file
        `PTDAY`{.envar} and one or more files with day-specific
        emissions in the format provided in [Section 8.2.6,
        "`PTDAY`{.envar}: Point source day-specific
        emissions"](ch08s02s06.html "8.2.6. PTDAY: Point source day-specific emissions").
        The format requires that a list file be used to point to the
        actual data files, even if a single data file with emissions
        data is used.

    b.  For day-specific emissions data, the daily total should ideally
        be based on the same time zone as is being modeled by SMOKE.
        SMOKE needs to use the same output time zone (set with the
        `OUTZONE`{.envar} setting) as is used in the meteorology data
        that will be input to the air quality model. For example, if the
        time zone being modeled by SMOKE were GMT, then ideally the
        daily total emissions would be from 0 GMT to 23 GMT for each
        day.

    c.  For hour-specific emissions data that is [*not*]{.emphasis} CEM
        data, create the list file `PTHOUR`{.envar} and one or more
        files with hour-specific emissions in the format provided in
        [Section 8.2.7, "`PTHOUR`{.envar}: Point source hour-specific
        emissions"](ch08s02s07.html "8.2.7. PTHOUR: Point source hour-specific emissions").
        The format requires that a list file be used to point to the
        actual data files, even if a single data file with emissions
        data is used.

    d.  If using CEM data, the data files for 1995 through 2000 are
        available with SMOKE. A list file `PTHOUR`{.envar} must be
        created to list the one or more CEM data files that will be
        input. To speed processing, the DATERANGE setting can be used in
        the list file `PTHOUR`{.envar} to cause SMOKE to skip the dates
        in the CEM files that are not needed. Detail information is
        described in [Section 2.9.19, "Processing hour-specific CEM
        data"](ch02s09s19.html "2.9.19. Processing hour-specific CEM data")

    e.  If using hourly precomputed plume rise (e.g., for fire data),
        the `PTHOUR`{.envar} file should be created as described above
        for emissions data, but specific variable names must be
        provided. The allowable data includes the fraction of the plume
        in layer 1, the plume bottom height, and the plume top height.

    f.  If using daily fire inventories without precomputed plume rise,
        the `PTDAY`{.envar} file should be created as described above
        for emissions data and specific variables ( size of acres
        burned, fuel loading, and duration of fire ) must be provided
        for plume rise calculation and re-normalization of temporal
        profiles, as described in the file format documentation in
        [Section 8.2.8.3, "ORL FIRE
        Format"](ch08s02s08.html#sect_input_ptinv_fire "8.2.8.3. ORL FIRE Format")
        and [Section 8.2.6.2, "ORL FIREEMIS Emission
        Format"](ch08s02s06.html#sect_input_ptday_fireemis "8.2.6.2. ORL FIREEMIS Emission Format").

    g.  If using hourly stack exit temperature, velocity, or flow rates,
        the `PTHOUR`{.envar} file should be created as described above
        for emissions data, but specific variable names must be
        provided, as described in the file format documentation in
        [Section 8.2.7, "`PTHOUR`{.envar}: Point source hour-specific
        emissions"](ch08s02s07.html "8.2.7. PTHOUR: Point source hour-specific emissions").
    :::

2.  Install inventory files in `$PTDAT`{.filename} directory.

    This directory is
    `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}/point

3.  Ensure the Assigns file has the `PTHOUR`{.envar} and `PTDAY`{.envar}
    variables set to the `PTHOUR`{.envar} and `PTDAY`{.envar} file names
    for your inventory files.

4.  Ensure script settings will use the day-specific and hour-specific
    data.

    ::: {.orderedlist}
    a.  For day-specific data import and usage, set
        `DAY_SPECIFIC_YN`{.envar} setting to Y.

    b.  For hour-specific data import and usage, set
        `HOUR_SPECIFIC_YN`{.envar} setting to Y. This applies to using
        either hourly emissions or hourly-precomputed plume rise.
    :::

5.  If using hourly data, make sure the `OUTZONE`{.envar} setting is
    consistent with what will be used for other SMOKE processing steps.

    The example SMOKE scripts make it difficult to not use the same
    `OUTZONE`{.envar} setting for all processing steps. Nevertheless,
    the user is responsible for ensuring that the same setting is used
    for all SMOKE processing steps, including import of hourly
    inventories. The `OUTZONE`{.envar} setting will affect the hourly
    inventory import because the hourly emissions will be adjusted by
    **Smkinven** from the local time zones in the `PTHOUR`{.envar} input
    files to the output time zone set by `OUTZONE`{.envar} to create the
    `PHOUR`{.envar} intermediate file.

6.  If using precomputed plume rise, ensure script settings will cause
    SMOKE to use the plume rise data.

    ::: {.orderedlist}
    a.  Set `HOUR_PLUMEDATA_YN`{.envar} setting to Y.

    b.  For UAM and CAM~X~ modeling, set:

        ::: {.itemizedlist}
        -   `RUN_LAYPOINT`{.envar} setting to Y (this program is not
            usually needed for these models)

        -   `EXPLICIT_PLUMES_YN`{.envar} setting to Y
        :::
    :::

7.  For fires emission modeling with internal plume rise calculation,
    SMOKE compute the plume rise data with internally computed heat flux
    from fuel loading and burned area. See detail at [Section 4.4.17,
    "Plume Rise Calculation for
    Fires"](ch04s04s17.html "4.4.17. Plume Rise Calculation for Fires")

8.  If providing future-year hour-specific data, ensure that the dates
    used in the file are consistent with the [*base year*]{.emphasis}
    dates. The dates must match the dates of the meteorology data that
    will be used by the air quality model.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_future_invs}4.4.2.6. Future-year inventories {#future-year-inventories .title}

</div>

</div>
:::

For future-year modeling, you can choose to input future-year
inventories to SMOKE. This is a different approach from importing a
base-year inventory and using SMOKE growth to create a future-year
inventory. The future-year inventory could be created outside of SMOKE
and would need to be in one of the SMOKE input formats available for the
source categories of interest.

A future-year inventory could also be created by SMOKE, since the
**Grwinven** program can output emissions in ORL format. In this
section, we do not cover importing base year inventories and using SMOKE
to grow them to a future year; that topic is covered in [Section 4.4.11,
"Setup projection and control
scenarios"](ch04s04s11.html "4.4.11. Setup projection and control scenarios").
Following the instructions in that section, it is feasible to create a
future-year inventory in SMOKE raw input format and use it as we
describe in this section.

::: {.orderedlist}
1.  Set the \#YEAR setting in the inventory input files to the future
    inventory year.

2.  Set the `SMK_BASEYR_OVERRIDE`{.envar} setting in the run script to
    the value of the base year.

    Ordinarily, this setting would simply be set to zero, which
    indicates that it is not to be used and the inventory year is the
    same as the base year. In this case, the base year cannot be set by
    the inventory year, so this setting provides the actual year to use.
    The base year is most often the same year as the year of meteorology
    data you are using to model your episode. When this setting is
    defined by a script, **Smkinven** will set the base year with that
    setting and set the future year as the year of the inventory data.

3.  Set the `YEAR`{.envar} setting in the Assigns file to the base year.

4.  Set the `FYEAR`{.envar} setting in the run scripts to the future
    year.

5.  Set the `SMK_FUTURE_YN`{.envar} setting in the run scripts to Y.
:::

See [Section 4.2.4, "Script
settings"](ch04s02s04.html "4.2.4. Script settings") for more
information about how this setting affects the output directory
structure and file names.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_pregridded}4.4.2.7. Pre-gridded inventories {#pre-gridded-inventories .title}

</div>

</div>
:::

::: {.toc}
[[4.4.2.7.1. Pre-gridded inventories from the same modeling domain as an
area source without source characterization or
attributes](ch04s04s02.html#sect_scripts_pregridded_invs_same)]{.section}

[[4.4.2.7.2. Pre-gridded inventories processing for converting between
different modeling domains with source characterization and
attributes](ch04s04s02.html#sect_scripts_pregridded_invs_different)]{.section}
:::

Smoke has two ways of processing the pregridded inventory data. If the
inventory data is in native netCDF format then see [Section 4.4.2.7.1,
"Pre-gridded inventories from the same modeling domain as an area source
without source characterization or
attributes"](ch04s04s02.html#sect_scripts_pregridded_invs_same "4.4.2.7.1. Pre-gridded inventories from the same modeling domain as an area source without source characterization or attributes").
If the inventory is in IO-API/netCDF format then see [Section 4.4.2.7.2,
"Pre-gridded inventories processing for converting between different
modeling domains with source characterization and
attributes"](ch04s04s02.html#sect_scripts_pregridded_invs_different "4.4.2.7.2. Pre-gridded inventories processing for converting between different modeling domains with source characterization and attributes")

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#sect_scripts_pregridded_invs_same}4.4.2.7.1. Pre-gridded inventories from the same modeling domain as an area source without source characterization or attributes {#pre-gridded-inventories-from-the-same-modeling-domain-as-an-area-source-without-source-characterization-or-attributes .title}

</div>

</div>
:::

SMOKE has a limited capability to import pre-gridded data from the same
modeling domain. It can import the data if it is time-independent and if
the grid cell and pollutant names are the only attributes needed to
identify the emissions. If SCC or other attributes are available, SMOKE
cannot use these directly; though in the case of SCCs, each SCC could
conceivably be tediously input as a separate dataset and modeled as a
separate inventory.

If any source category is available as pre-gridded data, the following
steps must be taken.

::: {.orderedlist}
1.  Plan to import the data as an area source.

    Only SMOKE area-source processing can use pre-gridded data, no
    matter that actual source category of origin for the data.
    Essentially, once emissions data no longer has attributes such as
    SCCs, stack information for point sources, or country/state/county
    codes, it all appears to be the same type of data to SMOKE and can
    be processed as an area source.

    This is not to say that all pre-gridded inventories can be processed
    correctly by SMOKE. For example, if a pre-gridded point source
    inventory including stack identifiers and stack parameters were
    provided with grid cell numbers instead of lat/lon coordinates, this
    could not be appropriately processed by SMOKE area processing as
    pre-gridded data.

    If any SMOKE processing steps such as chemical speciation or
    temporal allocation need to be done based on SCC, this is not
    possible. Only a single default profile for speciation or temporal
    allocation can be applied to each pre-gridded inventory.

2.  Convert data to I/O API format.

    Users must convert the pre-gridded data to I/O API format. The
    format is like the `AG`{.envar} file that can be output from
    **Smkmerge**. This format has each pollutant stored as a variable
    and is time independent. Some sort of ASCII-to-I/O API converter
    must be created and used to perform this step. At this time, there
    is no general-purpose tool to make such a conversion released with
    the SMOKE system.

3.  Set the `IMPORT_GRDIOAPI_YN`{.envar} setting to Y.

    This setting will cause **Smkinven** to expect the I/O API gridded
    input and will request the `AG`{.envar} logical file name instead of
    the `ARINV`{.envar} file.

4.  Ensure that the `AG`{.envar} logical file name is set by the Assigns
    file or by the run script.

    This logical file name must be set to the I/O API-formatted
    pre-gridded inventory file.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

##### []{#sect_scripts_pregridded_invs_different}4.4.2.7.2. Pre-gridded inventories processing for converting between different modeling domains with source characterization and attributes {#pre-gridded-inventories-processing-for-converting-between-different-modeling-domains-with-source-characterization-and-attributes .title}

</div>

</div>
:::

SMOKE will regrid the data from the native NetCDF-formatted pregridded
inventory data (e.g. lat-lon for global inventories) to the CMAQ
modeling grid, and apply a unique source ID to each grid cell to allow
SMOKE to perform chemical speciation, temporal allocation from annual to
hourly timesteps, and elevated source selection and vertical allocation.
The pre-gridded inventory files each contain data for a different
sector, the sector and pollutant contained in each pre-gridded inventory
file is specified in the ARINV file using the \#LIST GRID format.

To process pre-gridded data from different modeling domains, the
following steps must be taken.

::: {.orderedlist}
1.  Set the `IMPORT_GRDNETCDF_YN`{.envar} to Y to read the native netCDF
    annual inventory files.

2.  Grdmat is used to convert the data from the input data grid (e.g.
    lat-lon for EDGAR/RCP/HTAP) to the output modeling grid. Set the
    `IOAPI_GRIDNAME_1`{.envar} to specify the output grid.

3.  SMOKE reads each grid cell in the gridded inventory file as a unique
    source that will have a unique source ID. The lower left corner of
    inventory grid will be source 1, cell (2,1) will be source 2, cell
    (3,1) source 3, etc

4.  For each gridded inventory file, a Geographical Code Mask Input file
    (GRIDMASK) is provided by UNC for EDGAR inventory files that assigns
    a GEOGRID\_LEVEL2 value to each grid cell.

5.  The ARINV file is used to read in a list of gridded inventory files
    and to specify the SCC associated with each gridded inventory file

6.  Set the `NETCDF_POL_UNIT`{.envar} to kg m-2 -s

7.  Set the `NETCDF_INV_YEAR`{.envar} to the year of the inventory
    (e.g. 2010)

8.  To apply control factors to adjust emissions by GEOCODE\_LEVEL and
    SCC use the CONTROL packet in the GCNTL file

9.  To apply vertical profiles to gridded inventory data using the SMOKE
    Utility Program Layalloc. The EDGAR inventory includes fixed
    vertical profiles by sector that define the percentages of emissions
    by altitude band. Layalloc will create 3-d output files for the
    gridded emissions sectors that emit above the surface layer (e.g.
    energy and industrial sources).
:::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_all_invs}4.4.2.8. Files and settings for all inventories {#files-and-settings-for-all-inventories .title}

</div>

</div>
:::

For importing all inventories, the following steps should be taken to
review settings and change them as appropriate for your specific
modeling case.

Assigns file settings:

::: {.orderedlist}
1.  Change the Assigns files inventory settings.

    Following the settings in [Section 4.4.1, "Change Assigns file to
    set scenario names, grid names, and other case-specific
    configuration
    information"](ch04s04.html#sect_scripts_change_assigns "4.4.1. Change Assigns file to set scenario names, grid names, and other case-specific configuration information"),
    you should have created a new Assigns file for your case and set the
    `INVID`{.envar}, `INVEN`{.envar}, and `INVOP`{.envar} settings
    described in [Table 4.1, "Variable in Assigns file for naming files
    and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories").
    Since the inventory input directories depend on the `INVID`{.envar}
    setting, you should make sure that the value set for `INVID`{.envar}
    is consistent with the location of the inventory files. For example,
    the `ARINV`{.envar} files should be installed in
    `$SMKDAT`{.filename}/inventory/`$INVID`{.envar}/area. Make sure that
    `$INVID`{.envar} label in the paths for the files installed in prior
    subsections is the same as the `$INVID`{.envar} label in the Assigns
    file that is included in the Assigns file you will use.

2.  Set the `ABASE`{.envar}, `MBASE`{.envar}, `PBASE`{.envar}, and
    `EBASE`{.envar} settings described in [Table 4.1, "Variable in
    Assigns file for naming files and
    directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories").
    This is usually done for a new inventory, and can also be done for
    new scenarios with an existing inventory.
:::

Script settings:

::: {.orderedlist}
3.  Double check that the correct Assigns file (e.g., the one with the
    correct `$INVID`{.envar} setting) is used by the run scripts for
    your case.

4.  Set the `RAW_DUP_CHECK`{.envar} setting to Y if you want
    **Smkinven** to give an error if any duplicate entries are found in
    the inventory. See [Section 6.13,
    "**Smkinven**"](ch06s13.html "6.13. Smkinven") for more information.

5.  Set the `SMKINVEN_FORMULA`{.envar} setting to compute one or more
    pollutant values from teh values of other pollutants.

    This is most commonly used to compute coarse particulates (PMC) from
    PM~10~ and PM~2.5~ using the setting "[PMC = PM10 -
    PM2\_5]{.quote}".

6.  Set the `WEST_HSPHERE`{.envar} setting to reset any positive
    longitude values that are intended for the Western hemisphere to a
    negative value.

7.  Set the `WKDAY_NORMALIZE`{.envar} setting to account for the desired
    weekday normalization approach to be used for hourly emissions. See
    [Section 6.13, "**Smkinven**"](ch06s13.html "6.13. Smkinven") for
    more information.

8.  Set the `SMK_PROCESS_HAPS`{.envar} to read the `NHAPEXCLUDE`{.envar}
    file.

    This setting is only relevant when importing both criteria and toxic
    inventories. In this case, if there are VOCs in both inventories and
    the `INVTABLE`{.envar} has indicate which toxics are VOCs,
    **Smkinven** will attempt to integrate VOC emissions for all sources
    from the criteria and toxics inventories. The `NHAPEXCLUDE`{.envar}
    file provides a list of SCCs for which **Smkinven** should not
    integrate the inventories and should instead drop the toxic VOC
    emissions to prevent double counting. Toxic emissions of explicit
    model species are never dropped, however. More information is
    available in [Section 2.9.5, "Combine toxics and criteria
    inventories"](ch02s09s05.html "2.9.5. Combine toxics and criteria inventories").

9.  Set the `SMK_ARTOPNT_YN`{.envar} setting to Y when **Smkinven**
    should use the `ARTOPNT`{.envar} file to assign point source
    locations to area-source emissions.

10. Set the `FILL_ANNUAL`{.envar} setting to Y to fill annual emissions
    values with average-day values, when average-day values are
    available but annual values are not.

    See [Section 4.4.2.9, "Using average-day and annual data in the same
    run"](ch04s04s02.html#sect_scripts_average_day_invs "4.4.2.9. Using average-day and annual data in the same run")
    for more information on why one might want to use this option.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_average_day_invs}4.4.2.9. Using average-day and annual data in the same run {#using-average-day-and-annual-data-in-the-same-run .title}

</div>

</div>
:::

The ORL and FF10 formats provide fields for both annual and average-day
emissions values. SMOKE will import both values when either of these
formats are used and store all emissions in the SMOKE intermediate
inventory files. To configure the **Temporal** allocation step, you have
the option of using the `SMK_AVEDAY_YN`{.envar} setting to select using
either the annual or average-day data when both are available. This
option and its typical usage will be explained with the **Temporal**
settings.

This section describes what to do when both annual data and average-day
data need to be used in the same SMOKE run. This can occur when part of
an inventory has been provided using annual inventories only (the
average-day values are missing or incorrect) and a different part with
average-day inventories only (the annual values are missing). This is
only a problem when you want to run all of the sources in a single run;
so, if nonroad and stationary area sources are provided with the two
different temporal resolutions, these can just be run with separate
SMOKE runs. If two parts of the stationary area source inventory are
provided with two different temporal resolutions, then this section can
help to setup the modeling correctly.

Two approaches are available in SMOKE to resolve this situation. In the
first approach, one can set SMOKE to run using the average-day data, and
in the second approach, set to use the annual data. These lists describe
these two approaches:

Run all sources using "[annual]{.quote}" data

::: {.orderedlist}
1.  Set the `FILL_ANNUAL`{.envar} setting to Y. This will cause the
    missing annual data to be filled in with the available average-day
    data by multiplying the number of days in the year, accounting for
    leap years.

2.  Ensure that the monthly temporal profile assignments made by the
    `ATREF`{.envar}, `MTREF`{.envar}, or `PTREF`{.envar} files assign
    uniform monthly profiles to any all sources that have the annual
    numbers filled in with seasonal values.

3.  During temporal processing, set `SMK_AVEDAY_YN`{.envar} to N. This
    will ensure that both the annual values that were available in the
    inventory and the annual values that were computed will be used by
    the **Temporal** program. Since the monthly temporal profiles for
    the filled-in annual emissions have been set to uniform, the
    average-day values will be calculated from the filled-in annual
    values.
:::

Run all sources using average-day data

::: {.orderedlist}
1.  Set the `FILL_ANNUAL`{.envar} setting to N. By default, **Smkinven**
    computes an average-day value when none is provided by dividing the
    annual value by the number of days in the year, accounting for leap
    years.

2.  During temporal processing, set `SMK_AVEDAY_YN`{.envar} to Y. This
    will ensure that both the average-day values that were available in
    the inventory and the average-day values that were computed will be
    used by the **Temporal** program.

3.  Note that no monthly profiles are applied to average-day emissions,
    so if monthly variation is needed, it will need to be calculated
    outside of SMOKE. In this case, it might be easier to run all
    sources as annual, as described above.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------ -------------------- -----------------------------------------------------------
  [Prev](ch04s04.html)      [Up](ch04s04.html)                                      [Next](ch04s04s03.html)
  4.4. How to use SMOKE     [Home](index.html)     4.4.3. Select which pollutants in the inventory are kept
  ------------------------ -------------------- -----------------------------------------------------------
:::
::: {.navheader}
4.4.3. Select which pollutants in the inventory are kept
:::

[Prev](ch04s04s02.html) 

4.4. How to use SMOKE

 [Next](ch04s04s04.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e13331}4.4.3. Select which pollutants in the inventory are kept {#select-which-pollutants-in-the-inventory-are-kept .title}

</div>

</div>
:::

Users have the option of deciding at run time which inventory pollutants
will be kept from an inventory provided in ORL format. The
`INVTABLE`{.envar} file lists all possible criteria and toxic
pollutants. While the example files are fairly comprehensive, it is
possible users may need to add pollutants to this file using the
`INVTABLE`{.envar} file format description. Additionally, users can
change which pollutants are kept for further processing in SMOKE. This
is done by setting the Keep column of the file to Y for all pollutants
that SMOKE should keep, all pollutants in these files must have the Keep
column set to Y.

Both the run time and intermediate file sizes can be reduced by keeping
only the pollutants that you need to include for modeling purposes. In
the bulleted list below, we provide several examples of why a user might
want to change which pollutants are kept.

::: {.itemizedlist}
-   You want to model additional toxics not set up in the example
    configuration (e.g., atrazine, dioxin).

-   You want to import ROG emissions instead of VOC emissions from a
    criteria inventory.

-   You want to import only mercury for CMAQ modeling and drop all other
    toxic pollutants.

-   You want to add a tracer to the inventory and need SMOKE to output
    the tracer emissions to the model-ready file.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------- -------------------- ---------------------------------------
  [Prev](ch04s04s02.html)           [Up](ch04s04.html)                  [Next](ch04s04s04.html)
  4.4.2. Use new inventory data     [Home](index.html)     4.4.4. Set fallback stack paramaters
  -------------------------------- -------------------- ---------------------------------------
:::
::: {.navheader}
4.4.4. Set fallback stack paramaters
:::

[Prev](ch04s04s03.html) 

4.4. How to use SMOKE

 [Next](ch04s04s05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e13357}4.4.4. Set fallback stack paramaters {#set-fallback-stack-paramaters .title}

</div>

</div>
:::

The **Smkinven** program allows you to fill in stack parameters for
sources that do not have any. The details of how this is done are
described in [Section 2.9.9, "Fill in and check point-source stack
parameters"](ch02s09s09.html "2.9.9. Fill in and check point-source stack parameters").
To change the defaults, the `PSTK`{.envar} input file to **Smkinven**
must be edited to use different stack parameters and/or include
different state/county and SCC codes.

To discover what if any default stack parameters are being used for your
SMOKE processing, review the **Smkinven** log file, which will contain
warnings about all stack parameters that were filled in and changed from
the inventory values.
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------------------- -------------------- ----------------------------------------------------------
  [Prev](ch04s04s03.html)                                      [Up](ch04s04.html)                                     [Next](ch04s04s05.html)
  4.4.3. Select which pollutants in the inventory are kept     [Home](index.html)     4.4.5. Changing output and intermediate directory names
  ----------------------------------------------------------- -------------------- ----------------------------------------------------------
:::
::: {.navheader}
4.4.5. Changing output and intermediate directory names
:::

[Prev](ch04s04s04.html) 

4.4. How to use SMOKE

 [Next](ch04s04s06.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e13378}4.4.5. Changing output and intermediate directory names {#changing-output-and-intermediate-directory-names .title}

</div>

</div>
:::

As described in [Chapter 3, *SMOKE Directory
Structure*](ch03.html "Chapter 3. SMOKE Directory Structure") and also
[Table 4.1, "Variable in Assigns file for naming files and
directories"](ch04s04.html#tbl_scripts_variables_files "Table 4.1. Variable in Assigns file for naming files and directories"),
the output and intermediate directory names are based on user-defined
environment variables. The following list provides a checklist for all
of the possible changes that you might make and where to find more
information on how changes would affect your output and intermediate
directories. Make sure that the scripts that you are using to run SMOKE
use the same Assigns file in which you are making the changes described
in this list.

::: {.orderedlist}
1.  Set the `INVEN`{.envar} setting in the Assigns file to the label to
    use in the output inventory path
    (`$SMKDAT`{.filename}/inventory/`$INVEN`{.envar}).

2.  Decide whether you want to use the same setting or different
    settings for `ABASE`{.envar}, `MBASE`{.envar}, `PBASE`{.envar}, and
    `EBASE`{.envar} in the Assigns file.

    If these are the same, the directory structure will be the
    "[basic]{.quote}" configuration, and if these are different, the
    structure will be the "[advanced]{.quote}" configuration; both
    configurations are described in [Chapter 3, *SMOKE Directory
    Structure*](ch03.html "Chapter 3. SMOKE Directory Structure").

    ::: {.orderedlist}
    a.  Set the `ABASE`{.envar} setting to change the paths for
        stationary area and nonroad mobile source intermediate and
        output files.

    b.  Set the `MBASE`{.envar} setting to change the paths for on-road
        mobile source intermediate and output files.

    c.  Set the `PBASE`{.envar} setting to change the paths for point
        source intermediate and output files.

    d.  Set the `EBASE`{.envar} setting to change the path for the final
        merged model-ready emissions from all source categories. This
        will also set the output path for QA reports of anthropogenic
        sources. See [Chapter 3, *SMOKE Directory
        Structure*](ch03.html "Chapter 3. SMOKE Directory Structure")
        for specifics.
    :::

3.  Set the `BBASE`{.envar} setting in the Assigns file to select using
    BELD3 or BELD4 data. See [Section 4.4.15, "Use
    BEIS3"](ch04s04s15.html "4.4.15. Use BEIS3").

4.  Set the `SPC`{.envar} setting in the Assigns file to change the
    output paths for all source categories.

    As described in [Chapter 3, *SMOKE Directory
    Structure*](ch03.html "Chapter 3. SMOKE Directory Structure"), the
    `OUTPUT`{.envar} directory is based in part on this `SPC`{.envar}
    setting. This setting must be coordinated with the selection of the
    chemical speciation mechanism (see [Section 4.4.10, "Use a different
    speciation mechanism or change speciation
    inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs")).

5.  For future year modeling, the output paths will be changed
    automatically.

    As described in [Chapter 3, *SMOKE Directory
    Structure*](ch03.html "Chapter 3. SMOKE Directory Structure"), the
    `FYEAR`{.envar}, `CNTLCASE`{.envar}, `SMK_FUTURE_YN`{.envar}, and
    `SMK_CONTROL_YN`{.envar} script settings can have an impact on the
    output directory paths. When either `SMK_FUTURE_YN`{.envar} or
    `SMK_CONTROL_YN`{.envar} are set to Y, the output path will be
    changed as described in [Chapter 3, *SMOKE Directory
    Structure*](ch03.html "Chapter 3. SMOKE Directory Structure") for
    the growth and control case configuration.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------- -------------------- ---------------------------------------
  [Prev](ch04s04s04.html)                  [Up](ch04s04.html)                  [Next](ch04s04s06.html)
  4.4.4. Set fallback stack paramaters     [Home](index.html)     4.4.6. Change which programs are run
  --------------------------------------- -------------------- ---------------------------------------
:::
::: {.navheader}
4.4.6. Change which programs are run
:::

[Prev](ch04s04s05.html) 

4.4. How to use SMOKE

 [Next](ch04s04s07.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_change_programs}4.4.6. Change which programs are run {#change-which-programs-are-run .title}

</div>

</div>
:::

The example SMOKE scripts each have several `RUN_<Program>`{.envar}
settings, where the program names fill in the `<Program>`{.envar}
placeholder. For example, the `RUN_<Program>`{.envar} setting that
controls the **Smkinven** program is `RUN_SMKINVEN`{.envar}. In the
scripts, each `RUN_<Program>`{.envar} setting can be set to either Y for
"[yes]{.quote}" and N for "[no]{.quote}". When a `RUN_<Program>`{.envar}
setting is set to Y, the script will try to run the program associated
with the `RUN_<Program>`{.envar} setting. For example, when
`RUN_SMKINVEN`{.envar} is set to Y in the script, running the script
will cause the **Smkinven** program to run.

[Table 4.3, "List of `RUN_<Program>`{.envar} settings and situations to
set to
Y"](ch04s04s06.html#tbl_scripts_run_programs "Table 4.3. List of RUN_<Program> settings and situations to set to Y")
is the full list of `RUN_<Program>`{.envar} settings available and the
situations in which each needs to be run.

::: {.table}
[]{#tbl_scripts_run_programs}

**Table 4.3. List of `RUN_<Program>`{.envar} settings and situations to
set to Y**

  Setting                   Reasons to set to Y to run program
  ------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  `RUN_SMKINVEN`{.envar}    Import raw inventory data and create SMOKE intermediate inventory file for area, nonroad mobile, on-road mobile, or point sources
  `RUN_SPCMAT`{.envar}      Compute speciation factors and create speciation matrix for area, nonroad mobile, on-road mobile, point sources.
  `RUN_GRDMAT`{.envar}      Compute gridding factors and create gridding matrix for area, nonroad mobile, on-road mobile, or point sources.
  `RUN_CNTLMAT`{.envar}     Compute growth factors and create growth matrix for area, nonroad mobile, on-road mobile, or point sources. Compute control factors and create multiplicative control and/or reactivity control matrices for area, nonroad mobile, on-road mobile, or point sources.
  `RUN_GRWINVEN`{.envar}    Calculate grown and/or controlled inventory and create SMOKE intermediate inventory files for area, nonroad mobile, on-road mobile, or point sources. Required when using SMOKE to create future-year inventories.
  `RUN_TEMPORAL`{.envar}    Calculate hourly emissions and create intermediate hourly emissions file for area, nonroad mobile, on-road mobile, or point sources.
  `RUN_ELEVPOINT`{.envar}   Select elevated and PinG point sources.
  `RUN_LAYPOINT`{.envar}    Calculate plume rise for CMAQ for any point sources. Calculate plume rise for UAM or CAM~X~ for explicit plume-rise sources (i.e., those sources with precomputed plume rise).
  `RUN_MOVESMRG`{.envar}    Create 3-d model-ready emissions by merging MOVES RPD, RPP and RPV Look-up tables with Spcmat and Grdmat for mobile sources.
  `RUN_SMKMERGE`{.envar}    Create 3-d model-ready emissions for point sources or all source categories together for CMAQ. Create 2-d gridded, hourly, speciated emissions for area sources, nonroad mobile sources, on-road mobile sources, point sources, and/or all sources combined in I/O API format. Convert units of biogenic outputs from **Tmpbio** from moles/hr to moles/s for CMAQ. Create ASCII elevated point source file for UAM or CAM~X~.
  `RUN_SMK2EMIS`{.envar}    Convert 2-d merged I/O API file with all low-level emissions from **Smkmerge** to binary input format for UAM or CAM~X~.
  `RUN_SMKREPORT`{.envar}   Create default and/or custom reports of processed emissions.
  `RUN_NORMBEIS3`{.envar}   Import gridded BELD3 landuse for use in creating BEIS3 emissions.
  `RUN_TMPBEIS3`{.envar}    Calculate BEIS3 emissions in gridded, hourly, speciated I/O API format.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------------- -------------------- ------------------------------------------------------------
  [Prev](ch04s04s05.html)                                     [Up](ch04s04.html)                                       [Next](ch04s04s07.html)
  4.4.5. Changing output and intermediate directory names     [Home](index.html)     4.4.7. Set up country codes, state codes, or county codes
  ---------------------------------------------------------- -------------------- ------------------------------------------------------------
:::
::: {.navheader}
4.4.7. Set up country codes, state codes, or county codes
:::

[Prev](ch04s04s06.html) 

4.4. How to use SMOKE

 [Next](ch04s04s08.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e13668}4.4.7. Set up country codes, state codes, or county codes {#set-up-country-codes-state-codes-or-county-codes .title}

</div>

</div>
:::

By default, SMOKE is setup to use the country, state, and county codes
based on a U.S. view. The codes assume a 3-tier system of codes as
described in [Section 2.3.4, "Country, state, and county
codes"](ch02s03s04.html "2.3.4. Country, state, and county codes"). The
three tiers allow specification of regions as follows:

::: {.itemizedlist}
-   One digit for country code

-   Two digits for state codes

-   Three digits for county codes
:::

All codes provided in the emission inventories must be integers and must
match entries in the `COSTCY`{.envar} or
[`GEOCODE_LEVEL4`{.envar}](ch08s10s03.html "8.10.3. GEOCODE_LEVEL[1-4]: Geographical Input Files")
(if USE\_EXP\_GEOCODE Y) file, which is the master list of country,
state, county and tribal codes in any given SMOKE installation. The
format for the COSTCY file can be found in [Chapter 8, *SMOKE Input
Files*](ch08.html "Chapter 8. SMOKE Input Files"). By default, the codes
are shared by all scenarios installed in the same SMOKE system (using
different `COSTCY`{.envar} or `GEOCODE_LEVEL[1-4]`{.envar} (if
USE\_EXP\_GEOCODE Y) files requires changing the Assigns file to not
share the same `COSTCY`{.envar} or `GEOCODE_LEVEL[1-4]`{.envar} (if
USE\_EXP\_GEOCODE Y) file among all cases).

The codes in the inventory must match the codes in this file. SMOKE
assigns time zones, daylight saving time exemptions, state names, and
county names using this file. Therefore, if one of the counties in the
inventory does not match a valid country, state, and county code in the
`COSTCY`{.envar} or `GEOCODE_LEVEL[1-4]`{.envar} file (if
USE\_EXP\_GEOCODE Y), it can cause errors in the modeling.

The following list provides the steps that users should take to ensure
that the file will work for their modeling case:

::: {.orderedlist}
1.  Check whether the countries with data in the inventory are included
    in the /COUNTRY/ section of the `COSTCY`{.envar} or
    `GEOCODE_LEVEL[1-4]`{.envar} (if USE\_EXP\_GEOCODE Y) file.

2.  Change country codes and names if necessary within the limitation of
    10 countries per file. If the country codes change, the
    country-specific SMOKE temporal profile assignments made by
    `ATREF`{.envar}, `MTREF`{.envar}, and `PTREF`{.envar} may no longer
    be valid.

3.  Check whether the states with data in the inventory are included in
    the /STATE/ section of the `COSTCY`{.envar} or
    `GEOCODE_LEVEL[1-4]`{.envar} file (if USE\_EXP\_GEOCODE Y) file.

4.  Change or add state codes and names if necessary to ensure all
    states are listed for all countries.

5.  Check whether the counties with data in the inventory are included
    in the /COUNTY/ section of the `COSTCY`{.envar} or
    `GEOCODE_LEVEL[1-4]`{.envar} file (if USE\_EXP\_GEOCODE Y) file and
    that all counties have assigned time zones.

    **Smkinven** will perform this function for you if needed and will
    list in the **Smkinven** log file all counties that are not included
    in the `COSTCY`{.envar} or `GEOCODE_LEVEL[1-4]`{.envar} file (if
    USE\_EXP\_GEOCODE Y) file or that do not have time zones assigned.
    If county codes have changed for merged or separated counties (e.g.,
    Miami/Dade county in Florida).

6.  Change or add county codes and names if necessary to ensure all
    counties are included in the inventory for all states and countries
    and that time zones have been assigned to each.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------- -------------------- ------------------------------------------------
  [Prev](ch04s04s06.html)                  [Up](ch04s04.html)                           [Next](ch04s04s08.html)
  4.4.6. Change which programs are run     [Home](index.html)     4.4.8. Set up list of known SCCs and ORIS IDs
  --------------------------------------- -------------------- ------------------------------------------------
:::
::: {.navheader}
4.4.8. Set up list of known SCCs and ORIS IDs
:::

[Prev](ch04s04s07.html) 

4.4. How to use SMOKE

 [Next](ch04s04s09.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e13777}4.4.8. Set up list of known SCCs and ORIS IDs {#set-up-list-of-known-sccs-and-oris-ids .title}

</div>

</div>
:::

The descriptions of the SCCs and ORIS IDs in SMOKE can be updated easily
by modifying or adding to the files that contain these codes. The SCC
descriptions are used in **Smkreport** output reports, and the ORIS ID
descriptions are used in **Smkinven** reports when using CEM data.
Updating the files descriptions or valid codes is simply a matter of
editing the ASCII files that contain these codes. The logical file name
for the SCC description file is `SCCDESC`{.envar}, and that for the ORIS
ID description is `ORISDESC`{.envar}. Example `SCCDESC`{.envar} and
`ORISDESC`{.envar} files are in the `$GE_DAT`{.filename} directory and
described in [Section 4.2, "Test case
descriptions"](ch04s02.html "4.2. Test case descriptions").
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------------------ -------------------- ---------------------------------------------------------------------------------------
  [Prev](ch04s04s07.html)                                       [Up](ch04s04.html)                                                                  [Next](ch04s04s09.html)
  4.4.7. Set up country codes, state codes, or county codes     [Home](index.html)     4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic and biogenic)
  ------------------------------------------------------------ -------------------- ---------------------------------------------------------------------------------------
:::
::: {.navheader}
4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic
and biogenic)
:::

[Prev](ch04s04s08.html) 

4.4. How to use SMOKE

 [Next](ch04s04s10.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_use_grid}4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic and biogenic) {#use-a-new-modeling-grid-or-change-spatial-inputs-anthropogenic-and-biogenic .title}

</div>

</div>
:::

::: {.toc}
[[4.4.9.1. Set up for a different modeling
grid](ch04s04s09.html#d0e13811)]{.section}

[[4.4.9.2. Installing or changing spatial input
files](ch04s04s09.html#sect_scripts_install_spatial_inputs)]{.section}
:::

Using a new modeling grid and/or changing the spatial inputs requires a
number of changes to the Assigns file, scripts, and input files. In this
section, we first describe how to set up for a different modeling grid
and then how to install new inputs for that grid or change the spatial
inputs for the existing grid.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e13811}4.4.9.1. Set up for a different modeling grid {#set-up-for-a-different-modeling-grid .title}

</div>

</div>
:::

The following steps are needed to set up for a different modeling grid.

::: {.orderedlist}
1.  Insert or find the grid parameters in the `GRIDDESC`{.envar} file

    The `GRIDDESC`{.envar} file contains many grid descriptions and grid
    projections. Each grid description is defined by a 16-character (or
    less) name. [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files") contains the file
    format. If the grid you want is already in the file, note its name.

    If the grid you want is not in the file, use the format in
    [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files") to insert or
    modify a grid description for the new grid. The grid cells must
    align with the cells of the cross-grid meteorology data files that
    will be used for modeling biogenic emissions and possibly for point
    and on-road mobile sources.

2.  Change the `GRID`{.envar} variable in the Assigns file to a new grid
    name

    As described in Section [Section 4.4.1, "Change Assigns file to set
    scenario names, grid names, and other case-specific configuration
    information"](ch04s04.html#sect_scripts_change_assigns "4.4.1. Change Assigns file to set scenario names, grid names, and other case-specific configuration information"),
    change the `GRID`{.envar} environment variable to a name that will
    be used to name output and intermediate files. This name should be
    coordinated with the selection made in step 3. Since the
    `GRID`{.envar} variable is used in naming files, it is helpful to
    use a name that is easily distinguished from other grid names that
    you might use, but not so long as to add a lot of characters to the
    name of each file that includes the `GRID`{.envar} variable in its
    name. Usually a name of 4 or 5 characters is sufficient.

    Changing the `GRID`{.envar} setting is a good reason to create a new
    Assigns file. To do this, you can copy an existing Assigns file as
    described in [Section 4.4, "How to use
    SMOKE"](ch04s04.html "4.4. How to use SMOKE").

3.  Change the `IOAPI_GRIDNAME_1`{.envar} variable in the Assigns file
    to the name of the grid entered or found in step 1.

    As noted in step 2, the name selected should have some relationship
    to the `GRID`{.envar} environment variable. For example, if the
    `IOAPI_GRIDNAME_1`{.envar} setting is "[US36\_120X90]{.quote}", the
    `GRID`{.envar} setting might be "[us36]{.quote}".

4.  Update the run scripts to use the Assigns file for the new grid.

5.  Follow the remaining steps in the next subsection.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_install_spatial_inputs}4.4.9.2. Installing or changing spatial input files {#installing-or-changing-spatial-input-files .title}

</div>

</div>
:::

The following steps are needed to install or change the spatial input
files.

::: {.orderedlist}
1.  Update or install the grid description in the `GRIDDESC`{.envar}
    file, if not done previously (see step 1 in the previous
    subsection).

2.  Create and install the spatial surrogates file and surrogate
    description file `SRGDESC`{.envar}

    The Area and Mobile spatial surrogates files located in
    `SRGPRO_PATH`{.envar} and the `BGPRO`{.envar} are one of the most
    difficult inputs to create for SMOKE. The gridded data in the files
    must match the definition in the `GRIDDESC`{.envar} and
    `SRGDESC`{.envar} files for the grid selected using the
    `IOAPI_GRIDNAME_1`{.envar} variable.

    The best approach to creating this file is to obtain it from someone
    else who has created surrogates for your domain. For example, EPA
    has developed various spatial surrogates and available at EPA's
    Emission Modeling Clearinghouse
    ([http://www.epa.gov/ttn/chief/emch/](http://www.epa.gov/ttn/chief/emch/index.html)).
    Of course, using a national file has its limitations if your domain
    happens to be far away from the center of the U.S. since the map
    projection for the surrogates is more distorted further away from
    the center of the projection. However, for most users, this
    distortion will be a small price to pay for having readily available
    spatial surrogates.

    The second best approach to creating this file is to use the MIMS
    Spatial Allocator (MSA). This tool can create SMOKE-ready surrogates
    using GIS shape files, which are provided with the tool for multiple
    surrogates. Please refer to the [CMAS web
    site](http://www.cmascenter.org) for more information.

    A third approach to creating this file it to perform the same
    calculations done by the MSA using a GIS like ArcInfo. The
    calculations being done by the MSA are provided on the MSA website
    and could be implemented in a GIS, though this would probably be
    much too difficult an option for most users.

    The surrogate file does not need to have the same outer boundaries
    as your modeling grid, but the grid cells do need to align with the
    grid cells of the surrogate file. This means that the projection of
    the surrogates must be the same as the projection as the modeling
    grid and the cell sizes must also match. SMOKE will produce an error
    if there is an inconsistency. If the grid represented by the
    surrogates file is larger than the modeling grid and the cells
    align, SMOKE will automatically extract the grid cells for the
    modeling domain from the larger grid provided by the surrogates.

    In addition to the surrogate file, it is important to create a
    surrogate description file (`SRGDESC`{.envar}). This is simply a
    file that lists the surrogate codes and their descriptions. Since
    the surrogate file itself does not currently have descriptive text
    that indicate what the surrogate codes mean, the surrogate
    description file is the only way users have of knowing to what data
    the codes in the surrogate file refer.

    The same surrogate file can be used for Area and Mobile. This is
    accomplished by using the same physical file name in the
    `SRGDESC`{.envar}. Please see [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files") for more
    information on these files. The `BGPRO`{.envar} file must include
    the "[county area]{.quote}" spatial surrogate, and is used for
    estimating county-total emissions from gridded emissions.

    The Area and Mobile spatial surrogate file(s) should be installed as
    a sub-directory in the `$GE_DAT`{.filename} directory. This
    sub-directory is assigned to `SRGPRO_PATH`{.envar}. The surrogate
    description file should be stored in `$GE_DAT`{.filename} as well.
    It is useful to include the name of the `GRID`{.envar} in the name
    of the sub-directory `SRGPRO_PATH`{.envar} for you may in the future
    be modeling different grids and therefore needing different
    surrogate files. The Biogenic surrogate file `BGPRO`{.envar} should
    be located in `$GE_DAT`{.filename}.

3.  Create and install the spatial cross-reference file

    An example spatial cross-reference file (`AGREF`{.envar} and
    `MGREF`{.envar}) is provided with SMOKE that can be used for most
    inventories as long as the spatial surrogate codes in the new
    surrogate file match the codes in the example surrogate file, which
    are provided in the `SRGDESC`{.envar} file described in [Chapter 3,
    *SMOKE Directory
    Structure*](ch03.html "Chapter 3. SMOKE Directory Structure"). If
    the codes match then the only concern will be whether the surrogate
    assignments are acceptable. By default, the same file is used for
    both the `AGREF`{.envar} and `MGREF`{.envar} files, which is
    accomplished by using the same physical file name in the Assigns
    file for both logical file names. The files can be the same file or
    two different files, at the discretion of the user - usually one
    file is more convenient unless different default settings (SCC=0)
    are needed, or unless the data all already available as two separate
    files.

    When **Smkinven** imports an area, non-road mobile, or on-road
    mobile inventory, a list of SCCs is created (logical file name
    `ASCC`{.envar}, `NSCC`{.envar}, or `MSCC`{.envar}). After importing
    the data but before running spatial allocation, it is wise to
    examine the list of SCCs included in this file and compare it with
    the list in the example spatial cross-reference files. This
    comparison can be accomplished manually or using the **Smkreport**
    program with a report that includes the surrogate codes assigned to
    each SCC (see [Chapter 7, *SMOKE Quality
    Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance")). The
    **Smkreport** results will list all of the surrogate assignments by
    SCC and the emissions associated with each, with which users may
    evaluate if any SCCs were included in the inventory but not in the
    example SMOKE file. The example spatial cross-reference files
    (`AGREF`{.envar} and `MGREF`{.envar}) can be updated with any new
    assignments or to include SCCs that are in the user's inventory but
    not in the example files.

    If a new surrogates file uses surrogate codes that are different
    from the example codes, then new spatial surrogate cross-reference
    files need to be created. These can be created by copying and
    editing the existing files to replace the example surrogate codes
    with the new codes. For example, the current code for population
    is 100. If the new code for population is 400, then all of the
    "[100]{.quote}" surrogate codes in the file would need to be
    replaced with "[400]{.quote}"s. These replacements must be made
    carefully because the example file also uses "[400]{.quote}" for the
    rural land area surrogate, so if global search and replace is
    performed, one must be careful to change what one intends to change.
    It is much easier to simply use the codes that are already in use in
    any new surrogates file, or modify the surrogate file to use those
    codes.

    The spatial cross-reference file(s) should be installed in the
    `$GE_DAT`{.filename} directory, since the file is likely to be
    shared by many SMOKE runs and source categories. It is useful to
    name the file(s) to include the `GRID`{.envar} environment variable
    for easier identification as association with the surrogate file(s)
    with which it works.

4.  Create and install the biogenic gridded land use data

    You must create a gridded biogenic land use data (`BELD4`{.envar}
    for BEIS3.60 or `BELD3_A`{.envar}, `BELD3_B`{.envar}, and
    `BELD3_TOT`{.envar} for BEIS3.14) to use for your grid. The MSA
    described in step 2 is able to create these files using the BELD3 or
    BELD4 database. Please refer to step 2 for the web address of this
    tool. The outputs of the MSA can be used for BEIS3 modeling
    directory.

    The gridded land use data in the file must match the definition in
    the `GRIDDESC`{.envar} file for the grid selected using the
    `IOAPI_GRIDNAME_1`{.envar} variable. As with the spatial surrogates,
    the grid can be larger than the modeling grid, but it the cells must
    overlay exactly with the grid cells of the actual modeling grid,
    which includes the grid projection and cell sizes.

    The gridded biogenic land use file(s) should be installed in the
    `$BGDAT`{.filename} directory for BEIS3 modeling.

5.  Create and install the meteorology files.

    Meteorology files are a necessary input to the air quality model;
    therefore, the same meteorology files that will be used for the air
    quality modeling can be used for input to SMOKE. The MCIP program (a
    CMAQ preprocessor) can be used to convert the files from MM5 output
    format to the I/O API input format for SMOKE and CMAQ. Other
    user-created programs can be used as well as long as the variable
    names and file arrangements are consistent with what SMOKE expects.
    [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files") explains the
    details on the meteorology files that SMOKE expects and the
    variables that must be included in these files.

    The meteorology files must be consistent with the grid selected.
    Like the surrogate file, the meteorology grid can be larger than the
    SMOKE modeling grid, but the grid cells must align. This includes
    the cell sizes being the same and the projection being the same. If
    this is the case, the SMOKE programs that use the meteorology files
    (**Met4moves**, **Temporal**, **Laypoint**, **Tmpbio**, and
    **Tmpbeis3**) will extract the meteorology data from the region of
    the files that intersects with the modeling grid.

6.  Optionally create the `BIOSEASON`{.envar} file

    If you are modeling biogenic emissions with SMOKE for an episode and
    grid that covers both winter and summer seasons, then the best
    modeling approach is to create a `BIOSEASON`{.envar} file from the
    meteorology data for input to **Tmpbio** or **Tmpbeis3**. This file
    indicates which grid cells and days are during "[winter]{.quote}"
    and which are during "[summer]{.quote}", to allow **Tmpbio** or
    **Tmpbeis3** to apply the winter or summer emission factor for the
    correct cells and days. Summer is defined for biogenic modeling in
    the Northern Hemisphere as the period after the last freeze and
    before the first freeze in each grid cell. This file may not apply
    to some episodes or regions which do not experience freezing
    temperatures, and in those cases, users may run **Tmpbio** or
    **Tmpbeis3** without this file.

7.  Set the fallback surrogate in the run scripts for area/non-point,
    nonroad mobile, and on-road mobile sources.

    All scripts for source categories that use spatial surrogates have a
    **Grdmat** setting `SMK_DEFAULT_SRGID`{.envar} that is used to set a
    fallback surrogate code. The fallback surrogate code is explained in
    [Chapter 6, *SMOKE Core
    Programs*](ch06.html "Chapter 6. SMOKE Core Programs") with the
    **Grdmat** program. It prevents emissions from being zeroed out when
    there is no surrogate of the assigned type for a source. The
    fallback surrogate should therefore be a surrogate that is never
    zero for a county, such as population. Only one fallback surrogate
    can be set for all sources in a given run. The
    `SMK_DEFAULT_SRGID`{.envar} setting should be reset if the surrogate
    codes change (e.g., the default setting of 8 is not population) or
    if you want to change the fallback surrogate to a different one.

8.  Update Assigns file to use all new files.

    Update the Assigns file that you are using for this case to include
    all new files that you have created in this step:

    ::: {.itemizedlist}
    -   `BGPRO`{.envar}

    -   `AGREF`{.envar}, `MGREF`{.envar}

    -   `SRGDESC`{.envar}

    -   `SRGPRO_PATH`{.envar}

    -   `BGUSE`{.envar}

    -   `BELD3_A`{.envar}, `BELD3_B`{.envar}, `BELD3_TOT`{.envar}

    -   `BIOSEASON`{.envar}
    :::

9.  Check that the inventory files cover the region of the grid.

    When using a new grid, it is important to use an inventory that
    covers the states and counties included in your domain. There are
    two ways of checking that this is the case. First, obtain a map of
    your modeling domain prior to creating your inventory and note the
    states that are included wholly or in part in the domain. Before
    modeling, create, adapt, or amend your inventory to ensure that the
    inventories from each of those states are included.

    The second way that you can check that you are using data for all
    regions of the domain is to run the data through SMOKE and look at
    the resulting gridded emissions in PAVE. Using PAVE, reset the scale
    of the plot to a very small maximum value (e.g., 0.001). All areas
    of the domain with emissions should show up red. If any areas show
    up gray, then there are missing values that could be because the
    inventory is not complete.
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------ -------------------- ---------------------------------------------------------------------------
  [Prev](ch04s04s08.html)                           [Up](ch04s04.html)                                                      [Next](ch04s04s10.html)
  4.4.8. Set up list of known SCCs and ORIS IDs     [Home](index.html)     4.4.10. Use a different speciation mechanism or change speciation inputs
  ------------------------------------------------ -------------------- ---------------------------------------------------------------------------
:::
::: {.navheader}
4.4.10. Use a different speciation mechanism or change speciation inputs
:::

[Prev](ch04s04s09.html) 

4.4. How to use SMOKE

 [Next](ch04s04s11.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_change_speciation}4.4.10. Use a different speciation mechanism or change speciation inputs {#use-a-different-speciation-mechanism-or-change-speciation-inputs .title}

</div>

</div>
:::

::: {.toc}
[[4.4.10.1. Choosing from default
mechanisms](ch04s04s10.html#sect_scripts_use_default_spc)]{.section}

[[4.4.10.2. Setup of new mechanism or changing an existing
mechanism](ch04s04s10.html#sect_scripts_use_new_spc)]{.section}

[[4.4.10.3. Changing speciation
assignments](ch04s04s10.html#d0e14544)]{.section}

[[4.4.10.4. Changing the definition of NONHAPVOC or
NONHAPTOG](ch04s04s10.html#d0e14598)]{.section}
:::

A common change to the SMOKE configuration is to select a speciation
approach for an air quality model and chemical mechanism. In [Chapter 4,
*How to Use SMOKE*](ch04.html "Chapter 4. How to Use SMOKE"), we noted
that many speciation files are available for download from EPA. In this
section, we describe how to use the `SPC`{.envar} value in the Assigns
file to select these.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_use_default_spc}4.4.10.1. Choosing from default mechanisms {#choosing-from-default-mechanisms .title}

</div>

</div>
:::

SMOKE provides several chemical mechanisms that one can select for
modeling. In the default SMOKE configuration, only a few small changes
are necessary to the Assigns file and script to use a different chemical
mechanism.

::: {.orderedlist}
1.  Set the `SPC`{.envar} setting in the Assigns file.

    The `SPC`{.envar} setting in the Assigns file controls which
    chemical mechanism is used by the scripts and SMOKE programs.
    Depending on what source categories you are modeling, the air
    quality model that you are using, and the chemical mechanism for
    that air quality model. See the default data files described in
    [Chapter 4, *How to Use
    SMOKE*](ch04.html "Chapter 4. How to Use SMOKE") for the actual file
    names that will be used for each source category. Where different
    files are needed for different source categories, the Assigns file
    will automatically detect this and set the `GSPRO`{.envar} and
    `GSREF`{.envar} files accordingly.

2.  Determine whether VOC-to-TOG or ROG-to-TOG is needed and set script
    accordingly.

    If your inventory contains the pollutant VOC or ROG and you are
    modeling for CMAQ, UAM, or CAM~X~, then you will need to use SMOKE's
    `GSCNV`{.envar} file to convert the VOC or ROG mass to TOG mass.

    The SMOKE **Spcmat** program will use the `GSCNV`{.envar} file if
    the `POLLUTANT_CONVERSION`{.envar} setting in the script is Y. This
    is the default configuration for the CMAQ run scripts.

    If your inventory contains TOG, then the
    `POLLUTANT_CONVERSION`{.envar} setting in the run script should be
    set to N.

3.  Ensure that the inventory pollutants that need speciation match the
    inventory pollutants in the speciation profiles and cross-reference
    files.

    All of the pollutants in your inventory that you wish to include in
    the outputs must have valid profiles in the `GSPRO`{.envar} and
    `GSREF`{.envar} files. If the pollutant is left out of the
    `GSREF`{.envar} file, the pollutant will be dropped from modeling
    (in some cases, this is desirable, but a warning will be generated
    by **Spcmat**). For each pollutant in your inventory check that:

    ::: {.orderedlist}
    a.  The pollutant has one or more entries in the `GSREF`{.envar}
        file. In some cases, you may have to add entries. For example,
        not all `GSREF`{.envar} files have "[ROG]{.quote}" entries, but
        these can easily be added simply by copying the VOC assignments
        and changing the VOC label to ROG.

    b.  For CMAQ, UAM, and CAM~X~ and the pollutant is VOC or ROG, check
        that the TOG profiles are in the `GSPRO`{.envar} file.

    c.  For all models and all other pollutants, check that the profiles
        are included in the `GSPRO`{.envar} file.
    :::

4.  Ensure that the correct Assigns file is used in your run scripts.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_use_new_spc}4.4.10.2. Setup of new mechanism or changing an existing mechanism {#setup-of-new-mechanism-or-changing-an-existing-mechanism .title}

</div>

</div>
:::

::: {.orderedlist}
1.  Create and install the `GSPRO`{.envar} file.

    If only a few changes will be made to a `GSPRO`{.envar} file, you
    can simply copy an existing `GSPRO`{.envar} file to a new file. If
    more extensive changes are needed to create a new mechanism,
    currently, there is no utility for creating a `GSPRO`{.envar} file
    in SMOKE. For now, users must use the file format in [Chapter 8,
    *SMOKE Input Files*](ch08.html "Chapter 8. SMOKE Input Files") and a
    high degree of expertise to develop new `GSPRO`{.envar} files.

    Install the `GSPRO`{.envar} file in the `$GE_DAT`{.filename}
    directory. For the default `GSPRO`{.envar} file for that chemical
    mechanism (i.e., the one that applies to the most source
    categories), name the file `gspro.$SPC`{.filename}.txt. If your
    speciation profile is specific to a certain source category, name
    the `GSPRO`{.envar} file as follows:

    ::: {.itemizedlist}
    -   area/non-road mobile: `gspro.$SPC`{.filename}.a.txt

    -   on-road mobile: `gspro.$SPC`{.filename}.m.txt

    -   point: `gspro.$SPC`{.filename}.p.txt
    :::

2.  Create and install the `GSREF`{.envar} file.

    You may be able to simply copy a `GSREF`{.envar} file to a new name,
    depending on whether the profile codes are different for your new
    mechanism. In many cases, the same profile codes are used (e.g.,
    from the SPECIATE database), but the profiles themselves are all
    that have changed.

    If you need to create a new `GSREF`{.envar} from scratch, you will
    need to ensure that all of the SCCs and all of the pollutants in the
    inventory have profile assignments. Any pollutant in the inventory
    that is not included in the `GSREF`{.envar} file will be dropped
    from modeling. Any SCC that is not included will be assigned the
    default profile, which is the profile assigned to SCC = 0.

    Name the `GSREF`{.envar} file using a similar approach as for the
    `GSPRO`{.envar} file, but use the "[gsref]{.quote}" prefix instead
    of the "[gspro]{.quote}" prefix. Therefore, the default file for
    that chemical mechanism (the one that applies to the most source
    categories) should be named `gsref.$SPC`{.filename}.txt. Any
    source-category-specific files should use the names as follows:

    ::: {.itemizedlist}
    -   area/non-road mobile: `gsref.$SPC`{.filename}.a.txt

    -   on-road mobile: `gsref.$SPC`{.filename}.m.txt

    -   point: `gsref.$SPC`{.filename}.p.txt
    :::

3.  Create the pollutant-to-pollutant conversion file, if necessary.

    If the speciation profiles change or new profiles are added for VOC
    speciation, a `GSCNV`{.envar} file must be created accordingly. This
    can be accomplished by copying and editing the example
    `GSCNV`{.envar} file or creating a new `GSCNV`{.envar} file from
    scratch. This requires a high degree of expertise and must be
    closely coordinated with creating the `GSPRO`{.envar} file.

4.  Edit the `INVTABLE`{.envar} file.

    Particularly for toxics modeling, changes to the `GSPRO`{.envar}
    file must be coordinated with changes to the `INVTABLE`{.envar} file
    in the following ways:

    ::: {.itemizedlist}
    -   If the definition of NONHAPVOC changes, the `INVTABLE`{.envar}
        definition of NONHAPVOC must change as well.

    -   If there are new explicit model species, these must be
        identified in the `INVTABLE`{.envar} file.

    -   If there are new model species that are not part of the chemical
        mechanism, these must be identified in the `INVTABLE`{.envar}
        file.

    -   If there are new pollutants, these must be included in the
        `INVTABLE`{.envar} file (as well as the raw inventories, of
        course).
    :::

5.  Coordinate with MOVES inputs.

    When processing using on-road mobile emissions and SMOKE running
    MOVES, users need to create the `MEPROC`{.envar} file that contains
    a list of MOVES pollutants by emissions processes created by MOVES.
    This SMOKE input need to be coordinated so that the pollutants
    expected by the chemical mechanism are all created by SMOKE/MOVES.
    This requires that the `MEPROC`{.envar} file have all
    pollutant/process combinations for the required pollutants and that
    the MOVES inputs are configured to generate emissions for those
    pollutants. The `MEPROC`{.envar} file is documented in
    [Section 8.9.2.1.4, "`MEPROC`{.envar}: List of mobile emission
    processes and associated activities and
    pollutants"](ch08s09s02.html#sect_input_meproc_moves "8.9.2.1.4. MEPROC: List of mobile emission processes and associated activities and pollutants").
    The MOVES inputs are documented in the MOVES manual, and the
    limitations placed on these files by SMOKE are documented in
    [Section 4.4.12, "Use MOVES for on-road mobile
    sources"](ch04s04s12.html "4.4.12. Use MOVES for on-road mobile sources").

6.  Edit the Assigns file and scripts

    Make sure to change the `SPC`{.envar} variable in your Assigns file
    to the one for your new chemical mechanism. Also make sure that your
    run scripts use the Assigns file with the correct `SPC`{.envar}
    setting.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14544}4.4.10.3. Changing speciation assignments {#changing-speciation-assignments .title}

</div>

</div>
:::

Speciation assignments can be changed so that different speciation
profiles are used for certain SCCs and pollutants or to add SCCs and
pollutants. You will need to ensure that all of the SCCs and all of the
pollutants in the inventory have profile assignments. Any pollutant in
the inventory that is not included in the `GSREF`{.envar} file will be
dropped from modeling. Any SCC that is not included will be assigned the
default profile, which is the profile assigned to SCC = 0.

::: {.orderedlist}
1.  Adding entries to an existing cross-reference file.

    Edit an existing cross-reference file or copy it to a new file for
    editing. Insert the new speciation assignments based on the format
    of the file, described in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files").

2.  Create new speciation cross-reference file(s) for your case.

    Copy the speciation cross-reference (`GSREF`{.envar}) file for the
    chemical mechanism that you are using (or a chemical mechanism that
    is most similar to the one you have created). Edit the speciation
    profile assignments using the file format, described in [Chapter 8,
    *SMOKE Input Files*](ch08.html "Chapter 8. SMOKE Input Files"). The
    naming convention for the new file must be consistent with the
    convention described in the previous subsection.

3.  Change the pollutant-to-pollutant conversion file.

    If different SCCs get different profiles, then the `GSCNV`{.envar}
    file must be changed as well. The VOC-to-TOG factor in the
    `GSCNV`{.envar} depends on the profile that has been assigned to an
    SCC. So, the factor must be consistent with the profile assigned.
    Calculating the VOC-to-TOG factor requires some expertise, and this
    is outside the scope of this manual. However, if you change an SCC
    to use an existing profile, you can determine the correct VOC-to-TOG
    factor by first finding another SCC that uses that profile and then
    setting the VOC-to-TOG factor to be the same as the one for that
    other SCC.

4.  If any new files are created, ensure that the Assigns file uses all
    new files.

    Make sure that the `SPC`{.envar} setting in the Assigns is correct
    and that the Assigns file will set the `GSPRO`{.envar},
    `GSREF`{.envar}, and `GSCNV`{.envar} files so that any new files
    will be used by the programs.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14598}4.4.10.4. Changing the definition of NONHAPVOC or NONHAPTOG {#changing-the-definition-of-nonhapvoc-or-nonhaptog .title}

</div>

</div>
:::

The definition of NONHAPVOC and NONHAPTOG simply must be consistent
between the `GSPRO`{.envar} file and the `INVTABLE`{.envar} file. This
change applies only to chemical mechanisms that use VOC model species
and can therefore benefit from the integration of toxics and criteria
VOC. This includes all models that SMOKE supports.

::: {.orderedlist}
1.  Edit the `INVTABLE`{.envar} file.

    You can add pollutants and change their NONHAPVOC status using the
    `INVTABLE`{.envar} file format provided in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files").

2.  Create new speciation profiles.

    The speciation profiles must use the same definition of NONHAPVOC or
    NONHAPTOG. The header of the file must be updated to reflect the new
    definitions. The profiles for NONHAPVOC and NONHAPTOG must also be
    updated to be consistent. Finally, all other TOG profiles must be
    updated to be consistent with the definition.

3.  Coordinate with MOVES inputs.

    When processing using on-road mobile emissions and SMOKE running
    MOVES, users need to create the `MEPROC`{.envar} file that contains
    a list of MOVES pollutants by emissions processes created by MOVES.
    This SMOKE input need to be coordinated so that the pollutants
    expected by the chemical mechanism are all created by SMOKE/MOVES.
    This requires that the `MEPROC`{.envar} file have all
    pollutant/process combinations for the required pollutants and that
    the MOVES inputs are configured to generate emissions for those
    pollutants. The `MEPROC`{.envar} file is documented in
    [Section 8.9.2.1.4, "`MEPROC`{.envar}: List of mobile emission
    processes and associated activities and
    pollutants"](ch08s09s02.html#sect_input_meproc_moves "8.9.2.1.4. MEPROC: List of mobile emission processes and associated activities and pollutants").
    The MOVES inputs are documented in the MOVES manual, and the
    limitations placed on these files by SMOKE are documented in
    [Section 4.4.12, "Use MOVES for on-road mobile
    sources"](ch04s04s12.html "4.4.12. Use MOVES for on-road mobile sources").
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------------------------------- -------------------- -------------------------------------------------
  [Prev](ch04s04s09.html)                                                                  [Up](ch04s04.html)                            [Next](ch04s04s11.html)
  4.4.9. Use a new modeling grid or change spatial inputs (anthropogenic and biogenic)     [Home](index.html)     4.4.11. Setup projection and control scenarios
  --------------------------------------------------------------------------------------- -------------------- -------------------------------------------------
:::
::: {.navheader}
4.4.11. Setup projection and control scenarios
:::

[Prev](ch04s04s10.html) 

4.4. How to use SMOKE

 [Next](ch04s04s12.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_use_projection}4.4.11. Setup projection and control scenarios {#setup-projection-and-control-scenarios .title}

</div>

</div>
:::

::: {.toc}
[[4.4.11.1. Setup for using growth
only](ch04s04s11.html#d0e14649)]{.section}

[[4.4.11.2. Setup for using controls
only](ch04s04s11.html#d0e14810)]{.section}

[[4.4.11.3. Setup for both growth and
controls](ch04s04s11.html#d0e15188)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14649}4.4.11.1. Setup for using growth only {#setup-for-using-growth-only .title}

</div>

</div>
:::

The SMOKE growth capability is needed when the inventory year and the
modeling year are different. For example, if your base-year inventory is
for 2002 and you must evaluate a control strategy in 2010, then you will
need to use the SMOKE growth capability.

::: {.orderedlist}
1.  Create and install growth packet files

    The /PROJECTION/ packet handles the growth from the base year to a
    future year. This packet is part of the `GCNTL`{.envar} file
    described in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files"). A packet for each
    source category that requires growth should be created and saved in
    a file with the correct name, as described next. Users must ensure
    that all of the SCCs in the inventory that require growth are
    included in this packet. Any source that does not match an entry in
    this file will have a factor of 1 assigned to indicate no change
    from the base to the future year.

    In the default configuration of SMOKE, a `GCNTL`{.envar} file must
    be created that includes the /PROJECTION/ packet to use SMOKE
    growth. This file must follow the naming convention
    `gcntl.$YEAR`{.filename}\_`$FYEAR`{.envar}.txt, where `YEAR`{.envar}
    is set in the Assigns file and `FYEAR`{.envar} is set in the script
    as per [Section 4.2.4, "Script
    settings"](ch04s02s04.html "4.2.4. Script settings").

    The file should be installed in the inventory input directory for
    the source category to which it applies:

    ::: {.itemizedlist}
    -   Non-point (stationary area) files: `$ARDAT`{.filename} directory

    -   Nonroad mobile files: `$NRDAT`{.filename} directory

    -   On-road mobile files: `$MBDAT`{.filename} directory

    -   Point files: `$PTDAT`{.filename} directory
    :::

    Please note that these instructions apply to on-road mobile sources
    in the following ways:

    ::: {.itemizedlist}
    -   Growth of on-road mobile VMT

    -   Growth of on-road mobile precomputed emissions
    :::

    Creating on-road mobile emission factors is accomplished by changing
    the `FYEAR`{.envar} setting and using the `SMK_FUTURE_YN`{.envar}
    set to Y. This is described also in [Section 4.4.12, "Use MOVES for
    on-road mobile
    sources"](ch04s04s12.html "4.4.12. Use MOVES for on-road mobile sources")
    on running SMOKE with MOVES.

2.  Create scripts with correct settings for your particular needs

    To create the scripts with the correct settings, the best starting
    place is one of the SMOKE example future-year scripts, introduced in
    [Section 4.2.3, "Example script files and their
    purposes"](ch04s02s03.html "4.2.3. Example script files and their purposes").
    These scripts are already setup to run for growth only. To help you
    understand what the scripts are doing, we have described in the list
    below the key elements of the script:

    ::: {.itemizedlist}
    -   Uses the base-year Assigns file for the case we are running. The
        script settings (such as `FYEAR`{.envar} and
        `SMK_FUTURE_YN`{.envar}) will adjust what the Assigns file does.

    -   `FYEAR`{.envar} defined and `SMK_FUTURE_YN`{.envar} not defined
        initially (default is N).

    -   Run **Cntlmat** to create growth matrices only (these scripts do
        not create control matrices, although that is not normally what
        users will do in real cases). This program reads the
        `GCNTL`{.envar} file and creates a growth matrix.

    -   Run **Grwinven** to grow base year inventory to future year (no
        controls).

    -   Reset `SMK_FUTURE_YN`{.envar} to Y (note: placeholder for
        resetting `SMK_CONTROL_YN`{.envar} is included, but is not set
        to Y in example script).

    -   Source the Assigns file, which will change output directories
        and file names now that `SMK_FUTURE_YN`{.envar} is set to Y.
        Note that `RUN_PART1`{.envar} is temporarily reset to N in the
        example script to prevent Assigns file from deleting SMOKE
        intermediate files.

    -   Run **Temporal** and **Smkmerge**. The **Temporal** program will
        use the grown emissions to create hourly grown emissions.
        **Smkmerge** will use these in addition to the base-year
        gridding matrix and speciation matrix to create future-year
        model-ready emissions. The base year matrices can be used
        because they are identical to the future-year ones when SMOKE is
        used to apply growth.
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14810}4.4.11.2. Setup for using controls only {#setup-for-using-controls-only .title}

</div>

</div>
:::

Using controls only in the SMOKE scripts is needed when you import a
grown inventory that does not include any or all of the controls that
you wish to apply to the inventory. This is what we have assumed in
these instructions. We assume that in this case, the growth of the
inventory was performed outside of SMOKE, and SMOKE has read in an
inventory for the year defined by the `FYEAR`{.envar} script setting.
This inventory must be imported in a different script that is similar to
the base-year script, but follows the instructions for importing
future-year inventories in [Section 4.4.2.6, "Future-year
inventories"](ch04s04s02.html#sect_scripts_future_invs "4.4.2.6. Future-year inventories").

::: {.orderedlist}
1.  Determine which control packets you need

    Please refer to the **Cntlmat** section of [Chapter 6, *SMOKE Core
    Programs*](ch06.html "Chapter 6. SMOKE Core Programs") for a
    description of what each of the control packets can do and how they
    interact.

    The available packets are:

    ::: {.itemizedlist}
    -   /MACT/ packet

    -   /CONTROL/ packet

    -   /EMS\_CONTROL/ packet

    -   /CTG/ packet

    -   /ALLOWABLE/ packet

    -   /REACTIVITY/ packet
    :::

2.  Create and install control packets file

    The control packets just listed handle the application of controls
    for a certain future year. These controls can represent the existing
    controls that must be applied by emission sources so that they will
    be in compliance with the law. The controls can also represent
    additional controls that you want to evaluate to see their impact on
    modeled air quality. [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files") explains these
    packets and their formats.

    You should create a separate control file for each source category
    that contains all of the control packets that apply to that source
    category. Any inventory source and pollutant that does not receive a
    control is assigned a factor of 1 to indicate no change between the
    base case and the control case.

    In the default configuration of SMOKE, a `GCNTL`{.envar} file must
    be created that includes the only control packets. This file must
    follow the naming convention `gcntl.$CNTLCASE`{.filename}.txt, where
    `CNTLCASE`{.envar} is set in the script as per Section
    [Section 4.2.4, "Script
    settings"](ch04s02s04.html "4.2.4. Script settings").

3.  Create scripts with correct settings for your particular needs

    To create the scripts with the correct settings, the best starting
    place is one of the SMOKE example future-year scripts, introduced in
    [Section 4.2.3, "Example script files and their
    purposes"](ch04s02s03.html "4.2.3. Example script files and their purposes").
    The script must be changed, however, in the following ways to
    implement control-only. There are two ways to run controls in SMOKE.
    The first is to apply multiplicative controls using **Grwinven** and
    reactivity controls (if needed) with **Smkmerge**. The second is the
    apply both multiplicative and reactivity controls using
    **Smkmerge**. The following settings must be used for each case:

    ::: {.itemizedlist}
    -   Apply multiplicative controls with **Grwinven** and reactivity
        control (if any) with **Smkmerge**

        ::: {.itemizedlist}
        -   Uses the base-year Assigns file for the case we are running.
            The script settings (such as `FYEAR`{.envar},
            `CNTLCASE`{.envar}, and `SMK_CONTROL_YN`{.envar}) will
            adjust what the Assigns file does.

        -   Set `FYEAR`{.envar} = the imported future-year inventory

        -   Set `SMK_FUTURE_YN`{.envar} = Y on the line after
            `FYEAR`{.envar}. Remove this setting from later in the
            script (around line 120).

        -   Set `RUN_CNTLMAT`{.envar} = Y to run **Cntlmat** to create
            control matrices only

        -   Set `RUN_GRWINVEN`{.envar} = Y to run **Grwinven** to import
            the control matrices

        -   Set `RUN_TEMORAL`{.envar} = Y to run **Temporal** on
            controlled inventory

        -   Set `RUN_SMKMERGE`{.envar} = Y to run **Smkmerge** on
            controlled inventory

        -   Set options for **Cntlmat**, **Grwinven**, **Temporal**, and
            **Smkmerge** (see [Chapter 6, *SMOKE Core
            Programs*](ch06.html "Chapter 6. SMOKE Core Programs")).

        -   Set `SMK_NUM_CTLMAT`{.envar} to 1

            For area or nonroad mobile, set `ACMAT01`{.envar} to
            `$ACMAT`{.envar}

            For on-road mobile, set `MCMAT01`{.envar} to
            `$MCMAT`{.envar}

            For point, set `PCMAT01`{.envar} to `$PCMAT`{.envar}

            These settings assume that you are using only one
            multiplicative control matrix. **Grwinven** can actually
            import multiple control matrices from different cases. To
            use more than one control matrix, set
            `SMK_NUM_CTLMAT`{.envar} to the number of control matrices
            and set `ACMAT02`{.envar}, `ACMAT03`{.envar}, etc to the
            names of the additional control matrices.

        -   Set `CNTLCASE`{.envar} to the control strategy name that you
            want for the control case.

        -   At line 120 of file, reset `SMK_CONTROL_YN`{.envar} to Y

        -   To run **Smkmerge** for reactivity controls, add the
            `MRG_CTLMAT_REAC`{.envar} option to the **Smkmerge** options
            and set to "[A]{.quote}", "[M]{.quote}", "[P]{.quote}" or
            some combination of those letters to indicate whether you
            want it to use the reactivity matrix for area (including
            nonroad), on-road mobile, or point sources.
        :::

    -   Apply both multiplicative and reactivity controls with
        **Smkmerge**

        ::: {.itemizedlist}
        -   Uses the base-year Assigns file for the case we are running.
            The script settings (such as `FYEAR`{.envar},
            `CNTLCASE`{.envar}, and `SMK_CONTROL_YN`{.envar}) will
            adjust what the Assigns file does.

        -   Set `FYEAR`{.envar} = the imported future-year inventory

        -   Set `SMK_FUTURE_YN`{.envar} = Y on the line after
            `FYEAR`{.envar}. Remove this setting from later in the
            script (around line 120).

        -   Set `RUN_CNTLMAT`{.envar} = Y to run **Cntlmat** to create
            control matrices only

        -   Set `RUN_GRWINVEN`{.envar} = N to run **Grwinven** to import
            the control matrices

        -   Set `RUN_TEMORAL`{.envar} = N

        -   Set `RUN_SMKMERGE`{.envar} = Y to run **Smkmerge** on
            controlled inventory

        -   Set options for **Cntlmat** and **Smkmerge** (see
            [Chapter 6, *SMOKE Core
            Programs*](ch06.html "Chapter 6. SMOKE Core Programs")).

        -   Set `CNTLCASE`{.envar} to the control strategy name that you
            want for the control case.

        -   At line 120 of file, reset `SMK_CONTROL_YN`{.envar} to N

        -   To run **Smkmerge** for multiplicative controls, add the
            `MRG_CTLMAT_MULT`{.envar} setting to **Smkmerge** options
            and set to "[A]{.quote}", "[M]{.quote}", "[P]{.quote}" or
            some combination of those letters to indicate whether you
            want it to use the multiplicative control matrix for area
            (including nonroad), on-road mobile, or point sources.

        -   To run **Smkmerge** for reactivity controls, add the
            `MRG_CTLMAT_REAC`{.envar} setting to the **Smkmerge**
            options and set to "[A]{.quote}", "[M]{.quote}",
            "[P]{.quote}" or some combination of those letters to
            indicate whether you want it to use the reactivity control
            matrix for area (including nonroad), on-road mobile, or
            point sources.
        :::
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e15188}4.4.11.3. Setup for both growth and controls {#setup-for-both-growth-and-controls .title}

</div>

</div>
:::

Follow the instructions that apply for both of the previous two
subsections. The differences between this case and the previous two
cases are as follows:

::: {.itemizedlist}
-   Name the `GCNTL`{.envar} input file differently. It should be named:
    `gcntl.$YEAR`{.filename}\_`$FYEAR`{.envar}\_`$CNTLCASE`{.envar}.txt

-   The **Grwinven** program must be used at least to grow the
    inventory, so you must

    ::: {.itemizedlist}
    -   Set `RUN_GRWINVEN`{.envar} to Y.

    -   Set `SMK_NUM_CTLMAT`{.envar} to at least 1. It should be set to
        the total number of growth and control matrices to be applied by
        the **Grwinven** program.

    -   The `ACMAT01`{.envar}, `ACMAT02`{.envar}, etc file names should
        be set to be consistent with the matrices being applied and the
        source categories (e.g., `ACMAT01`{.envar} should be
        `$APMAT`{.envar} or `$ACMAT`{.envar}, but not `$PCMAT`{.envar},
        since that would be inconsistent between source categories).
    :::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------------------- -------------------- -----------------------------------------------
  [Prev](ch04s04s10.html)                                                      [Up](ch04s04.html)                          [Next](ch04s04s12.html)
  4.4.10. Use a different speciation mechanism or change speciation inputs     [Home](index.html)     4.4.12. Use MOVES for on-road mobile sources
  --------------------------------------------------------------------------- -------------------- -----------------------------------------------
:::
::: {.navheader}
4.4.12. Use MOVES for on-road mobile sources
:::

[Prev](ch04s04s11.html) 

4.4. How to use SMOKE

 [Next](ch04s04s13.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_use_moves}4.4.12. Use MOVES for on-road mobile sources {#use-moves-for-on-road-mobile-sources .title}

</div>

</div>
:::

::: {.toc}
[[4.4.12.1. Coordinating with other input
files](ch04s04s12.html#d0e15304)]{.section}

[[4.4.12.2. Changing representative
counties](ch04s04s12.html#d0e15397)]{.section}

[[4.4.12.3. Changing fuel month for representative
counties](ch04s04s12.html#d0e15407)]{.section}
:::

Extra files are needed for input to SMOKE when running with MOVES. These
files are:

::: {.itemizedlist}
-   `MEPROC`{.envar}: Mobile emission processes

-   `MCXREF`{.envar}: Mobile representative county cross-reference file

-   `MFMREF`{.envar}: Mobile fuel month file

-   `MRCLIST`{.envar}: List of MOVES Lookup Tables for **Movesmrg**

-   `RUNCTL`{.envar}: Runcontrol file
:::

The `MEPROC`{.envar}, `MCXREF`{.envar}, and `MFMREF`{.envar} files are
installed in the `$MBDAT`{.filename} directory for the default SMOKE
configuration.

The subsections below describe how adjusting these files will allow you
to perform a variety of changes to the on-road mobile processing.

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e15304}4.4.12.1. Coordinating with other input files {#coordinating-with-other-input-files .title}

</div>

</div>
:::

The `MEPROC`{.envar} file must be coordinated with the
`INVTABLE`{.envar}, `GSPRO`{.envar}, and `GSREF`{.envar}. The
`MCXREF`{.envar} and `MFMREF`{.envar} must be coordinated with the
inventory. The following list indicates all of the things that you must
check for when creating any of these files.

::: {.itemizedlist}
-   The `MEPROC`{.envar} file must have all of the pollutants (e.g., CO,
    NOX, and so on) as an input file to **Movesmrg**.

-   If a pollutant that you want to model is not in the `MEPROC`{.envar}
    file, it will not be modeled by SMOKE correctly. All pollutants that
    you wish to include in the outputs must be in the `MEPROC`{.envar}
    file.

-   All pollutants in the `MEPROC`{.envar} file must also be in the
    `INVTABLE`{.envar} file with Keep = Y, including the
    `INVTABLE`{.envar} limitation that the file pollutant names are
    limited to 11 characters for on-road mobile pollutants.

-   All pollutants in the `MEPROC`{.envar} file must be available in
    SMOKE-ready MOVES lookup tables.

-   All process-pollutant combinations in the `MEPROC`{.envar} file must
    also be included in the `GSREF`{.envar} file. The format for the
    "[pollutant]{.quote}" entry in the `GSREF`{.envar} is \<emission
    process\>\_\_\<pollutant\>. Note that the joiner between \<emission
    process\> and \<pollutant\> is a double underscore. [**A single
    underscore will prevent the processing from working
    properly.**]{.bold} For example, running exhaust carbon monoxide
    must be included as EXR\_\_CO.

-   When integrating toxics HAPs and criteria TOG and using MOVES, the
    NONHAPTOG definition in the `INVTABLE`{.envar} file and
    `GSPRO`{.envar} files must be consistent.

-   The `MCXREF`{.envar} file should assign representative counties for
    all counties for which you provide VMT data in the inventory.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e15397}4.4.12.2. Changing representative counties {#changing-representative-counties .title}

</div>

</div>
:::

Representative counties have previously been explained in
[Section 2.8.4.6, "Representative
Counties"](ch02s08s04.html#sect_concepts_reference_counties_moves "2.8.4.6. Representative Counties").
The `MCXREF`{.envar} file assigns representative counties for each
county in your domain. To change the representative counties, this file
should be edited to assign different representative counties to each
county in the inventory. After editing this file, you must make sure
that no counties in the inventory have been left out of the file.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e15407}4.4.12.3. Changing fuel month for representative counties {#changing-fuel-month-for-representative-counties .title}

</div>

</div>
:::

Reference fuel month have previously been explained in [Section 2.8.4.7,
"Reference Fuel
month"](ch02s08s04.html#sect_concepts_moves_reference_fuel_month "2.8.4.7. Reference Fuel month").
The `MFMREF`{.envar} file assigns fuel month for each representative
county in your domain. To change the fuel month, this file should be
edited to assign a different fuel month to each representative county in
the inventory. User must meet the criteria to share the same fuel month
between representative counties.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------------- -------------------- -------------------------------------
  [Prev](ch04s04s11.html)                            [Up](ch04s04.html)                [Next](ch04s04s13.html)
  4.4.11. Setup projection and control scenarios     [Home](index.html)     4.4.13. Change temporal processing
  ------------------------------------------------- -------------------- -------------------------------------
:::
::: {.navheader}
4.4.13. Change temporal processing
:::

[Prev](ch04s04s12.html) 

4.4. How to use SMOKE

 [Next](ch04s04s14.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e15417}4.4.13. Change temporal processing {#change-temporal-processing .title}

</div>

</div>
:::

::: {.toc}
[[4.4.13.1. Changing temporal cross-reference and
profiles](ch04s04s13.html#sect_scripts_temporal_xref)]{.section}

[[4.4.13.2. Setting normalization of weekly
profiles](ch04s04s13.html#sect_scripts_normalize_weekly)]{.section}

[[4.4.13.3. Changing the
episode](ch04s04s13.html#sect_scripts_change_episode)]{.section}

[[4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE
emissions
files](ch04s04s13.html#sect_scripts_duration_output)]{.section}

[[4.4.13.5. Setting non-sequential processing
dates](ch04s04s13.html#sect_scripts_non_seq_dates)]{.section}

[[4.4.13.6. Changing holiday
dates](ch04s04s13.html#sect_scripts_change_holidays)]{.section}

[[4.4.13.7. Use uniform temporal profiles for all
sources](ch04s04s13.html#sect_scripts_uniform_profiles)]{.section}
:::

Changing the temporal aspect of SMOKE processing is one of the critical
changes that users must make. One of the most basic changes that you can
make to SMOKE is the time period for which SMOKE will be run. In this
section, we will explain how to make the following changes to your SMOKE
processing:

::: {.itemizedlist}
-   [Section 4.4.13.1, "Changing temporal cross-reference and
    profiles"](ch04s04s13.html#sect_scripts_temporal_xref "4.4.13.1. Changing temporal cross-reference and profiles")

-   [Section 4.4.13.2, "Setting normalization of weekly
    profiles"](ch04s04s13.html#sect_scripts_normalize_weekly "4.4.13.2. Setting normalization of weekly profiles")

-   [Section 4.4.13.3, "Changing the
    episode"](ch04s04s13.html#sect_scripts_change_episode "4.4.13.3. Changing the episode")

-   [Section 4.4.13.4, "Changing the dates, times, and duration of
    model-ready SMOKE emissions
    files"](ch04s04s13.html#sect_scripts_duration_output "4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE emissions files")

-   [Section 4.4.13.5, "Setting non-sequential processing
    dates"](ch04s04s13.html#sect_scripts_non_seq_dates "4.4.13.5. Setting non-sequential processing dates")

-   [Section 4.4.13.6, "Changing holiday
    dates"](ch04s04s13.html#sect_scripts_change_holidays "4.4.13.6. Changing holiday dates")

-   [Section 4.4.13.7, "Use uniform temporal profiles for all
    sources"](ch04s04s13.html#sect_scripts_uniform_profiles "4.4.13.7. Use uniform temporal profiles for all sources")
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_temporal_xref}4.4.13.1. Changing temporal cross-reference and profiles {#changing-temporal-cross-reference-and-profiles .title}

</div>

</div>
:::

To change the temporal cross-reference and profiles the following steps
must be taken.

::: {.orderedlist}
1.  Determine which days of the week will have distinct diurnal
    profiles.

    SMOKE provides the capability for optionally assigning different
    diurnal profiles for different days of the week. The file format for
    the `ATPRO`{.envar}, `MTPRO`{.envar}, and `PTPRO`{.envar} file
    explains the different sections of the file that you can use to
    assign these different profiles. Before you add temporal profiles,
    you must decide which approach you will use for the new profiles:

    ::: {.itemizedlist}
    -   Different diurnal profiles for weekdays and weekends (using the
        /DIURNAL WEEKDAY/ and /DIURNAL WEEKEND/ packets).

    -   Different diurnal profiles for each day of the week (using the
        /DIURNAL \<DAYNAME\>/ packets, where \<DAYNAME\> = the day of
        the week (MONDAY, TUESDAY, etc.).
    :::

2.  Ensure that different diurnal profiles for different days of the
    week will match across the days.

    When setting up new diurnal temporal profiles, it is important is
    ensure that the same temporal profile codes are used across the
    packets for the diurnal profiles because as source can only be
    assigned a single code for all of its diurnal profiles. For example,
    if a source were to use diurnal profile code 50, that code must be
    included in all of the diurnal packets and all instances of code 50
    must be for that source. In other words, it is not possible to
    assign code 50 on Mondays and code 60 on Tuesdays.

3.  Edit the `ATPRO`{.envar}, `MTPRO`{.envar}, or `PTPRO`{.envar} file
    to include new diurnal, weekly, or monthly profiles.

    The file format for the `ATPRO`{.envar}, `MTPRO`{.envar}, and
    `PTPRO`{.envar} files is in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files"). To add new
    diurnal profiles, you must edit these files in a text editor and the
    new profiles added. It is possible to use the same file instead of
    three separate files; in this case, just configure the Assigns file
    to use the same file name for all three logical file names. This has
    been done in the default configuration.

4.  Edit the `ATREF`{.envar}, `MTREF`{.envar}, or `PTREF`{.envar} file
    to add entries or change assignments.

    The file format for the `ATREF`{.envar}, `MTREF`{.envar}, and
    `PTREF`{.envar} files is in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files"). To add or change
    temporal profile assignments, you must edit these files in a text
    editor and select the source characteristics that will be associated
    with a diurnal, weekly, and monthly profile. The example file uses
    primarily SCCs to assign temporal profiles, but the file format
    supports other fields to make more specific assignments by county,
    pollutant, link ID, plant ID, or other point-source characteristics.

5.  Ensure `ATREF`{.envar}, `MTREF`{.envar}, and `PTREF`{.envar} have
    entries for all sources in the inventory.

    Once you have edited the file, you will need to check that all
    sources are being assigned profiles or that the default temporal
    profile is acceptable for sources that do not have more specific
    assignments. The easiest way to check that the files are acceptable
    to you is to run it through the **Temporal** program using the
    `REPORT_DEFAULTS`{.envar} option set to Y. With this option, the
    **Temporal** log file will report all sources that have received the
    default temporal profile. You can review the log file to determine
    if this default is acceptable to you. Additionally, you can run
    **Smkreport** (after **Temporal** has been run) with the following
    instructions in the `REPCONFIG`{.envar} input file to get a report
    with the temporal profile codes that **Temporal** assigned to each
    source. The instructions are:

    ::: {.itemizedlist}
    -   BY DIUCODE
    -   BY WEKCODE
    -   BY MONCODE
    -   BY SOURCE
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_normalize_weekly}4.4.13.2. Setting normalization of weekly profiles {#setting-normalization-of-weekly-profiles .title}

</div>

</div>
:::

To set normalization of weekly profiles, the following steps must be
taken.

::: {.orderedlist}
1.  Determine whether you are using an annual or average-day inventory.

    You are using an annual inventory if you have
    `SMK_AVEDAY_YN`{.envar} is set to N in your run scripts.

    You are using an average-day inventory if you have
    `SMK_AVE_DAY_YN`{.envar} set to Y in your run scripts.

2.  If using an annual inventory, use weekly normalization.

    To do this, make sure the `WKDAY_NORMALIZE`{.envar} setting is set
    to N in your run script when you run **Smkinven**.

3.  If using an average-day inventory, determine whether it is an
    average weekday or not, and set the weekly normalization
    accordingly.

    If your average-day inventory is an average that excludes weekend
    emissions, then you need weekday normalization of your weekly
    profiles. To do this, make sure the `WKDAY_NORMALIZE`{.envar}
    setting is set to Y in your run script when you run **Smkinven**.

    If the values of your average-day inventory include weekend
    emissions, then you do not need weekday normalization and the
    `WKDAY_NORMALIZE`{.envar} setting in your run scripts should be set
    to N when you run **Smkinven**.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_change_episode}4.4.13.3. Changing the episode {#changing-the-episode .title}

</div>

</div>
:::

The episode definition is the period for which you will generate SMOKE
outputs. To change the episode dates, the following steps must be taken.
In addition, the episode dates must be consistent with the run length
settings, described in the next subsection.

::: {.orderedlist}
1.  Choose an episode within a single calendar year.

2.  Set the `EPI_STDATE`{.envar} to the Julian start date of your
    episode.

    In general, this setting is the same as the `G_STDATE`{.envar}
    setting in the Assigns file. As will be described in the next
    subsection, `G_STDATE`{.envar} changes with each modeling period
    within the episode (e.g., modeling with 5-day periods), but the
    `EPI_STDATE`{.envar} setting is the same for the entire SMOKE run.

    The `EPI_STDATE`{.envar} setting is also generally consistent with
    the base model year set by the `YEAR`{.envar} environment variable,
    which in turn is consistent with the year of data in the input
    inventory files.

3.  Set the `EPI_STTIME`{.envar} to the start time that you wish to use
    for each model-ready emissions file created in your SMOKE run. This
    value is usually 0.

4.  Set the `EPI_RUNLEN`{.envar} to the number of hours in the episode.

    Do not add an hour to this duration as with the `G_RUNLEN`{.envar}
    setting described in the next subsection. The format for this
    setting allows up to four hours in the format (i.e., HHHHMMSS).

5.  Set the `EPI_NDAY`{.envar} to the number of days of the episode.

    The minimum value is 1 and the maximum value is 365 (366 for leap
    years).

6.  Ensure that all time dependent input data are available for the run
    period.

    The critical time-dependent data that you must ensure are available
    for the episode duration are:

    ::: {.itemizedlist}
    -   Meteorology data (see [Section 4.4.16, "Change meteorology
        data"](ch04s04s16.html "4.4.16. Change meteorology data"))

    -   Day- and hour-specific point source data (including any
        precomputed plume rise data)
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_duration_output}4.4.13.4. Changing the dates, times, and duration of model-ready SMOKE emissions files {#changing-the-dates-times-and-duration-of-model-ready-smoke-emissions-files .title}

</div>

</div>
:::

The run length is the time period for which each program that uses
temporal process will be run. Sometimes these periods are called the
"[chunks]{.quote}" of processing, as in the episode is being processed
in "[chunks]{.quote}". This period will determine the length of all of
the hourly SMOKE intermediate files including `ATMP`{.envar},
`MTMP`{.envar}, `PTMP`{.envar}, `PLAY`{.envar}, and all model-ready
outputs from **Smkmerge**. To change the run length, the following steps
must be taken.

::: {.orderedlist}
1.  Set the `G_STDATE`{.envar} setting the same as your
    `EPI_STDATE`{.envar}.

    The `G_STDATE`{.envar} setting in the Assigns file is the starting
    date of the first SMOKE model-ready emissions file. The
    `G_STDATE_ADVANCE`{.envar} script variable is set in the scripts so
    that the scripts will automatically reset the `G_STDATE`{.envar}
    variable as need to run SMOKE for each period in the episode. The
    length of those periods is set by the `G_RUNLEN`{.envar} variable
    and the number of periods is `EPI_RUNLEN`{.envar} divided by
    `G_RUNLEN`{.envar}.

2.  Set the `G_STTIME`{.envar} setting the same as the EPI\_STTIME. This
    value is the start time that you wish to use for each model-ready
    emissions file created in your SMOKE run. This value is usually 0.

    Generally, the start time must also be consistent with the start
    time of the other inputs to the air quality model, such as the
    meteorology data. For example, if the meteorology data start at 12
    Greenwich Mean Time (GMT) and the air quality model will also start
    at that time, then the emissions files will also need to start at 12
    GMT. This can be achieved by setting `G_STTIME`{.envar} and
    `EPI_STTIME`{.envar} to 120000 (HHMMSS format).

3.  Set the `G_TSTEP`{.envar} setting to 10000 for 1 hour (HHMMSS
    format). In version 2 of SMOKE and earlier, this is the only setting
    that is supported by the code.

4.  Set the `G_RUNLEN`{.envar} to the period run length for each
    model-ready SMOKE emissions file.

    The run length can be set to as many hours as your air quality model
    can support for a single input file, as long as your files do not
    surpass a 2 GB file size limit, which are be imposed by 32-bit UNIX
    operating systems and by the NetCDF library on which SMOKE is based.
    Generally, the air quality models can accept files for as long as
    the user wishes to provide, so the limit is therefore the file
    sizes, which can be determined by trial and error. The conservative
    approach is to create emissions files for 1 day at a time.

    The air quality models require an extra hour of emissions data for
    each file. Therefore the number of hours for the `G_RUNLEN`{.envar}
    setting is computed as:

    (number of days per file) x 24 + 1

    The `G_RUNLEN`{.envar} setting must be in format of HHHHMMSS where
    HHHH is a four-digit number of hours, MM is the minutes (must be
    00), and SS is the seconds (must also be 00).

5.  Set the `ESDATE`{.envar} setting to the first date of your episode
    in YYYYMMDD format.

    Recall that the `ESDATE`{.envar} setting is for naming files. In the
    Assigns file, the value of this setting should be the starting date
    for the first emissions file to be created by the SMOKE run. The
    default SMOKE script configuration will automatically update
    `ESDATE`{.envar} for subsequent run periods.

6.  Set the `NDAYS`{.envar} setting to the number of days represented by
    `G_RUNLEN`{.envar}.

    For example, if `G_RUNLEN`{.envar} is 490000 (2 days x 24 + 1 = 49
    hours), then `NDAYS`{.envar} should be 2.
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_non_seq_dates}4.4.13.5. Setting non-sequential processing dates {#setting-non-sequential-processing-dates .title}

</div>

</div>
:::

The `PROCDATES`{.envar} option is specifically designed for use on daily
and/or hourly inventory data with **Temporal**. `PROCDATES`{.envar} is
not yet incorporated within other SMOKE core programs, such as
**Grdmat**,**Smkmerge** or **Smkreport**. For creating model-ready
outputs and QA reports, the users need to be sure that the episode dates
(`EPI_STDATE`{.envar} and `G_STDATE`{.envar}) in the assigns file are
listed in `PROCDATES`{.envar}

If `PROCDATES`{.envar} is not assigned, the defaults are
`G_STDATE`{.envar}, `G_STTIME`{.envar} and `G_RUNLEN`{.envar}.

The following steps must be taken to set non-sequential processing
dates.

Area/Non-road/Point Sources

::: {.orderedlist}
1.  Determine whether you need to use `PROCDATES`{.envar}.

2.  If you are using `PROCDATES`{.envar}, you need to set the
    environment variable by uncommenting `PROCDATES`{.envar} in the
    assigns file.

3.  Set the environment variable `PROCDATES`{.envar} to the file
    procdates.txt located in `GE_DAT`{.envar}. (i.e. setenv
    `PROCDATES`{.envar} `$GE_DAT`{.envar}/procdates.txt.
:::

Mobile Source

**Temporal** is responsible to convert annual/monthly to hourly
`VMT`{.envar}. **Movesmrg** is responsible for combining hourly
emissions factors calculated by `MOVES`{.envar} with hourly
`VMT`{.envar} data to generate hourly on-road mobile emissions.

::: {.orderedlist}
1.  Determine whether you need to use `PROCDATES`{.envar}.

2.  If you are using `PROCDATES`{.envar}, you need to set the
    environment variable by uncommenting `PROCDATES`{.envar} in the
    assigns file.

3.  Set the environment variable `PROCDATES`{.envar} to the file
    procdates.txt located in `GE_DAT`{.envar}. (i.e. setenv
    `PROCDATES`{.envar} `$GE_DAT`{.envar}/procdates.txt.
:::

NOTE: Since the **Temporal** dynamically create names for the output
files, two new environment variables `[A|M|P]TMPNAME`{.envar} and
`[A|M|P]TSUPNAME`{.envar} are used to set the directory and file prefix
for naming the output files `[A|M|P]TMP`{.envar} and
`[A|M|P]TSUP`{.envar}. The files are named using the starting date of
each time period.For example, if `ATMPNAME`{.envar} is set to
/data/ntmp.nctox., then the `ATMP`{.envar} file for a given time period
will be put in the data directory and named ntmp.nctox.start date.ncf.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_change_holidays}4.4.13.6. Changing holiday dates {#changing-holiday-dates .title}

</div>

</div>
:::

As previously explain in [Section 2.10.5, "Holiday
processing"](ch02s10s05.html "2.10.5. Holiday processing"), SMOKE can
model holidays as special days. The holidays that are relevant are those
holidays for which anthropogenic activities are significantly altered,
since its those activities that determine the appropriate weight to give
the emissions on each day of the week and the diurnal temporal patterns
for those days. For example, the nearly all workers in the U.S. have a
holiday from their employment on Thanksgiving day, and the patterns of
industrial and motor-vehicle activities are substantially altered
resulting in different emissions patterns on those days. The Valentines
Day holiday, however, does not affect such patterns because employers do
not allow workers a day off on that day.

The `HOLIDAYS`{.envar} file controls which days SMOKE will treat as
holidays and which day of the week SMOKE will emulate for that day. The
file must be created for each year, since some holiday dates are
different each year. Although the format of the file suggests that the
holidays can be modeled differently for different counties in the
inventory, this is not the case - the format is provided for a future
update to SMOKE, which has not yet been implemented.

To change the holiday dates that are modeled by SMOKE, all that is
required is changing the `HOLIDAYS`{.envar} file to include the year and
holidays in which you are interested, and select a day of the week to
use for modeling that holiday. If you do not wish SMOKE to treat a
holiday any differently, then it should be removed from the file. If you
wish no days to be modeled as holidays, we recommend including at least
one date in the file, and assigning its actual day of the week, to
prevent SMOKE from getting confused.
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#sect_scripts_uniform_profiles}4.4.13.7. Use uniform temporal profiles for all sources {#use-uniform-temporal-profiles-for-all-sources .title}

</div>

</div>
:::

SMOKE includes a little-used option to allow SMOKE to ignore all
temporal profile information from the temporal cross-reference and
temporal profiles. In this case, the emissions will be constant for all
hours of all days, except for a slight variation from month to month to
account for the different number of days in each month. This option
still requires the temporal cross-reference and temporal profile input
files, but they are ignored. To use this capability in SMOKE, set the
`UNIFORM_TPROF_YN`{.envar} setting in the run script to Y.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------------------- -------------------- --------------------------------------------------------------------
  [Prev](ch04s04s12.html)                          [Up](ch04s04.html)                                               [Next](ch04s04s14.html)
  4.4.12. Use MOVES for on-road mobile sources     [Home](index.html)     4.4.14. Use **Elevpoint** for selecting elevated and PinG sources
  ----------------------------------------------- -------------------- --------------------------------------------------------------------
:::
::: {.navheader}
4.4.14. Use **Elevpoint** for selecting elevated and PinG sources
:::

[Prev](ch04s04s13.html) 

4.4. How to use SMOKE

 [Next](ch04s04s15.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_use_elevpoint}4.4.14. Use **Elevpoint** for selecting elevated and PinG sources {#use-elevpoint-for-selecting-elevated-and-ping-sources .title}

</div>

</div>
:::

The **Elevpoint** program can select elevated and/or PinG sources as
needed for some air quality models and configurations. You must use the
**Elevpoint** program in the following cases:

::: {.itemizedlist}
-   You are running UAM or CAM~X~ including elevated point sources
    and/or PinG sources.

-   You are running CMAQ and want to select specific elevated sources or
    want to model with the PinG capability.
:::

The following steps must be taken to use **Elevpoint**:

::: {.orderedlist}
1.  Create a `PELVCONFIG`{.envar} file.

    The PELVCONFIG file is the **Elevpoint** input file that controls
    what sources will be selected as elevated and/or PinG. [Chapter 8,
    *SMOKE Input Files*](ch08.html "Chapter 8. SMOKE Input Files")
    explains the file format for this file and how to use this format. A
    example `PELVCONFIG`{.envar} file provided with SMOKE (in the nctox
    case `PTDAT`{.filename} directory) contains additional instructions
    on setting up this file.

2.  Update Assigns file to use the correct name of the
    `PELVCONFIG`{.envar} file.

3.  Set `RUN_ELEVPOINT`{.envar} to Y in point source run script.

4.  If using PinG sources, set `SMK_PING_METHOD`{.envar} to 1 in point
    source run script (otherwise, set to 0).

5.  If selecting specific elevated sources, set
    `SMK_ELEV_METHOD`{.envar} to 1 in point source run script
    (otherwise, set to 0).

6.  See model-specific settings in [Section 4.4.19, "Model for
    CMAQ"](ch04s04s19.html "4.4.19. Model for CMAQ") and
    [Section 4.4.20, "Model for UAM and
    CAM~X~"](ch04s04s20.html "4.4.20. Model for UAM and CAMX").
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------- -------------------- --------------------------
  [Prev](ch04s04s13.html)                [Up](ch04s04.html)     [Next](ch04s04s15.html)
  4.4.13. Change temporal processing     [Home](index.html)           4.4.15. Use BEIS3
  ------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
4.4.15. Use BEIS3
:::

[Prev](ch04s04s14.html) 

4.4. How to use SMOKE

 [Next](ch04s04s16.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_use_beis3}4.4.15. Use BEIS3 {#use-beis3 .title}

</div>

</div>
:::

The steps you need to take to use BEIS3 for your modeling case are:

::: {.orderedlist}
1.  Ensure that the land use file has been created and properly
    installed

    See [Section 4.4.9.2, "Installing or changing spatial input
    files"](ch04s04s09.html#sect_scripts_install_spatial_inputs "4.4.9.2. Installing or changing spatial input files"),
    step 4) for more information on creating and installing the land use
    data.

2.  Ensure that the meteorology data are correct

    See [Section 4.4.9.2, "Installing or changing spatial input
    files"](ch04s04s09.html#sect_scripts_install_spatial_inputs "4.4.9.2. Installing or changing spatial input files"),
    step 5) and [Section 4.4.16, "Change meteorology
    data"](ch04s04s16.html "4.4.16. Change meteorology data") for more
    information on creating and installing the meteorology data.

3.  Ensure that BEIS3 emission factors are in place.

    The `B3FAC`{.envar} file is installed by SMOKE and does not need to
    be changed, so it is very unlikely that this file will not be in its
    `GE_DAT`{.filename} location. The example Assigns file sets the
    logical file names for this file, which should not be changed.

4.  Setup your BEIS3 run script

    To set up your BEIS3 run, copy the example BEIS3 run script listed
    in [Section 4.2.3, "Example script files and their
    purposes"](ch04s02s03.html "4.2.3. Example script files and their purposes")
    and reset the script settings. The settings that you may need to
    reset are as follows (see [Chapter 6, *SMOKE Core
    Programs*](ch06.html "Chapter 6. SMOKE Core Programs") for all
    program options):

    ::: {.itemizedlist}
    -   `RUN_METSCAN`{.envar}: Set to Y if you need to use the
        `BIOSEASON`{.envar} file (see [Section 4.4.9.2, "Installing or
        changing spatial input
        files"](ch04s04s09.html#sect_scripts_install_spatial_inputs "4.4.9.2. Installing or changing spatial input files"),
        step 6).

    -   **Normbeis3** options

    -   **Tmpbeis3** options

    -   **Smkmerge** options - this program is used to create
        state/county totals and/or to change units for CMAQ from
        moles/hr (output by **Tmpbeis3**) to moles/s. Depending on the
        purpose for running **Smkmerge** in your script, adjust the
        **Smkmerge** options accordingly. Please note that you cannot
        create gridded outputs in moles/s and state/county totals in
        tons/day in a single run.

        If creating state/county totals, make sure the
        `AREA_SURROGATE_NUM`{.envar} setting is set to the cell-area
        surrogate number in your `BGPRO`{.envar} file.

    -   `SPC_OVERRIDE`{.envar}: May be needed in some cases (see
        [Section 4.2.4, "Script
        settings"](ch04s02s04.html "4.2.4. Script settings"))
    :::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------------------------------------------------- -------------------- ----------------------------------
  [Prev](ch04s04s14.html)                                               [Up](ch04s04.html)             [Next](ch04s04s16.html)
  4.4.14. Use **Elevpoint** for selecting elevated and PinG sources     [Home](index.html)     4.4.16. Change meteorology data
  -------------------------------------------------------------------- -------------------- ----------------------------------
:::
::: {.navheader}
4.4.16. Change meteorology data
:::

[Prev](ch04s04s15.html) 

4.4. How to use SMOKE

 [Next](ch04s04s17.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_change_meteorology}4.4.16. Change meteorology data {#change-meteorology-data .title}

</div>

</div>
:::

To change the meteorology data, you must take the following steps:

::: {.orderedlist}
1.  Determine what format your air quality model will accept for
    meteorology data and convert data to I/O API format if needed.

    If you are modeling with CMAQ, then the data will be in the I/O API
    format created by MCIP or MCPL that SMOKE can accept. If you are
    modeling with UAM or CAM~X~, then you must check to see which
    meteorology format the model accepts. Some versions of these models
    can use the same I/O API format as for CMAQ, but some cannot.

    If your meteorology data are not in the correct format, then you
    will need to convert the data. There is currently no utility
    provided with SMOKE to convert the meteorology format needed by some
    versions of UAM and CAM~X~ to SMOKE input format.

2.  Ensure required variables are included in meteorology data

3.  Ensure meteorology data cover the correct time period

4.  Ensure meteorology data are on the correct grid

    As described in [Section 4.4.9.2, "Installing or changing spatial
    input
    files"](ch04s04s09.html#sect_scripts_install_spatial_inputs "4.4.9.2. Installing or changing spatial input files")
    step 5, check that the meteorology grid and modeling grid are
    consistent.

5.  Install meteorology data

    The meteorology data should be installed in the `$METDAT`{.filename}
    directory, as explained in [Chapter 3, *SMOKE Directory
    Structure*](ch03.html "Chapter 3. SMOKE Directory Structure"). The
    names of the files are up to you.

6.  Ensure that the meteorology data names match with the names in the
    Assigns file

    Edit the Assigns file and look for the `$METDAT`{.envar} variable.
    Ensure that it is consistent with the actual location of the
    meteorology files. Also check the settings for
    `GRID_CRO_2D`{.envar}, `GRID_CRO_3D`{.envar}, `MET_CRO_2D`{.envar},
    `MET_CRO_3D`{.envar}, and `MET_DOT_3D`{.envar} and make sure that
    the naming scheme for these files is consistent with your file
    names.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -------------------------------------------
  [Prev](ch04s04s15.html)     [Up](ch04s04.html)                      [Next](ch04s04s17.html)
  4.4.15. Use BEIS3           [Home](index.html)     4.4.17. Plume Rise Calculation for Fires
  -------------------------- -------------------- -------------------------------------------
:::
::: {.navheader}
4.4.17. Plume Rise Calculation for Fires
:::

[Prev](ch04s04s16.html) 

4.4. How to use SMOKE

 [Next](ch04s04s18.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_ptfire_emis_cmaq}4.4.17. Plume Rise Calculation for Fires {#plume-rise-calculation-for-fires .title}

</div>

</div>
:::

Starting with version 2.2, SMOKE contains an approach for computing
plume rise for wildfire/prescribed fires using the Bluesky
Pouliot-Godowitch plume rise algorithm
(http://www.epa.gov/ttn/chief/conference/ei14/session12/pouliot.pdf). In
SMOKE version 2.2, SMOKE can compute hourly plume rise from precomputed
hourly heat flux, fuel loading and area burned data using the Bluesky
CONSUME model. The SMOKE preprocessor **Bluesky2Inv** that converts the
output from the CONSUME model into SMOKE-readable annual and daily
inventory files ([Section 5.3.3,
"**BlueSky2Inv**"](ch05s03s03.html "5.3.3. BlueSky2Inv")).

Starting with SMOKE version 2.3, SMOKE can compute hourly plume rise
from an intenally computed heat flux using area burned and fuel loading
data. This approach allows SMOKE to compute hourly heat flux based upon
daily area burned, fuel loading, material burned and a constant default
heat content (8000 BTU/lb) (Equation 1). The daily heat flux and
emissions are temporally allocated to hourly values based upon the
duration of the fire (begining and ending hours). However, if there is a
precomputed heat flux available as a daily inventory, **Smkinven** will
not internally compute the heat flux and drop the begin and end hours of
fire.

::: {.orderedlist}
1.  Heat Flux (BTU/hr) = \[ Area Burned (acre/day) x Fuel Loading
    (tons/acre) x Heat Content (BTU/lb) x (2000lb/ton) \] / Duration of
    fire (hr/day)
:::

Detail information on how the fire emissions are calculated can be found
on the proceeding presented by [Pouliot et al.,
(2005)](https://www3.epa.gov/ttnchie1/conference/ei14/session12/pouliot.pdf).

The SMOKE plume rise requires two ORL formatted files for
wildfire/prescribed fires. The master \#ORL FIRE file ([Section 8.2.8.3,
"ORL FIRE
Format"](ch08s02s08.html#sect_input_ptinv_fire "8.2.8.3. ORL FIRE Format"))
contains the fire characteristics including country/state/county code,
fire idenfication code, geographic coordinate, fire name, heat content,
material burned and NFDRS code. The day-specific \#ORL FIREEMIS file
("[[Section 8.2.6.2, "ORL FIREEMIS Emission
Format"](ch08s02s06.html#sect_input_ptday_fireemis "8.2.6.2. ORL FIREEMIS Emission Format")]{.quote}")
includes daily pollutant emissions, area burned, fuel loading, optional
heat flux, and fire begining and ending time. Starting with SMOKE
version 3.7, **Smkinven** can process these master and daily fire
inventories with precomputed heat flux using current point FF10 formats,
\#FF10\_POINT file ("[[Section 8.2.8.1, "FF10
Format"](ch08s02s08.html#sect_input_ptinv_ff10 "8.2.8.1. FF10 Format")]{.quote}")
and \#FF10\_DAILY\_FF10 file ("[[Section 8.2.6.1, " FF10
Format"](ch08s02s06.html#sect_input_ptday_ff10 "8.2.6.1.  FF10 Format")]{.quote}")

Regardless whether the heat flux for wildfires is precomputed or
internally computed, the fire-specific plume rise algorithm converts the
heat flux to a bouyancy flux for use in the plume rise calculation. See
more detail at [Section 6.6.1.1, "Plume rise calculation for
fires"](ch06s06.html#sect_programs_laypoint_plume_rise_fires "6.6.1.1. Plume rise calculation for fires")

NOTE: SMOKE requires that the fire inventory pollutant names are copied
to the Chemical Abstracts Service (CAS) number column in the inventory
table (`INVTABLE`{.envar}) file (See [Section 8.10.4,
"`INVTABLE`{.envar}: Inventory
table"](ch08s10s04.html "8.10.4. INVTABLE: Inventory table")).

::: {.orderedlist}
1.  To compute plume rise for fires using SMOKE, following these steps.
    Add the fire inventory variables to the `INVTABLE`{.envar} file:

    ``` {.programlisting}
    HFLUX           HFLUX                    Y     1 N N N N   0 tons/yr
    HEATCONTENT     HEATCONTENT              Y     1 N N N N   0 tons/yr
    FUEL_LOAD       FUEL_LOAD                Y     1 N N N N   0 tons/yr
    ACRESBURNED     ACRESBURNED              Y     1 N N N N   0 tons/yr
    BEGHOUR         BEGHOUR                  Y     1 N N N N   0 tons/yr
    ENDHOUR         ENDHOUR                  Y     1 N N N N   0 tons/yr
    ```

2.  Run **Smkinven** with these settings,

    ::: {.itemizedlist}
    -   Set `RUN_SMKINVEN`{.envar} to Y

    -   Set `IMPORT_AVEINV_YN`{.envar} to Y

    -   Set `CHECK_STACKS_YN`{.envar} to N
    :::

3.  Do not run **Elevpoint**,

    ::: {.itemizedlist}
    -   Set `RUN_ELEVPOINT`{.envar} to N

    -   Set `SMK_ELEV_METHOD`{.envar} to 0

    -   Set `SMK_PING_METHOD`{.envar} to 0
    :::

4.  Run **Laypoint** with these settings,

    ::: {.itemizedlist}
    -   Set `RUN_LAYPOINT`{.envar} to Y

    -   Set `FIRE_PLUME_YN`{.envar} to Y

    -   Set `HOURLY_FIRE_YN`{.envar} to Y

    -   Set `SMK_SPECELEV_YN`{.envar} to N
    :::

5.  Run **Smkmerge** with theses settings,

    ::: {.itemizedlist}
    -   Set `RUN_SMKMERGE`{.envar} to Y

    -   Set `SMK_ASCIIELEV_YN`{.envar} to N
    :::

6.  Set these multiple program control settings.

    ::: {.itemizedlist}
    -   Set `DAY_SPECIFIC_YN`{.envar} to Y

    -   Set `EXPLICIT_PLUMES_YN`{.envar} to N

    -   Set `SMK_PING_METHOD`{.envar} to 0

    -   Set `QA_TYPE`{.envar} to part2
    :::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------- -------------------- ---------------------------------------------------------------------------
  [Prev](ch04s04s16.html)             [Up](ch04s04.html)                                                      [Next](ch04s04s18.html)
  4.4.16. Change meteorology data     [Home](index.html)     4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version 4.7)
  ---------------------------------- -------------------- ---------------------------------------------------------------------------
:::
::: {.navheader}
4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version 4.7)
:::

[Prev](ch04s04s17.html) 

4.4. How to use SMOKE

 [Next](ch04s04s19.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_in-line_model_cmaq}4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version 4.7) {#in-line-plume-rise-calculation-in-cmaq-model-as-of-version-4.7 .title}

</div>

</div>
:::

Staring with version 2.5, SMOKE supports the calculation of plume rise
for point sources in CMAQ known as an in-line plume rise calculation.
SMOKE is used to select the point sources to reduce the CMAQ plume rise
treatment. In this section, we give a basic outline of how to run SMOKE
to output emissions for the in-line plume rise processing in CMAQ. To
prepare emissions for the CMAQ in-line plume rise calculation follow
these steps:

::: {.orderedlist}
1.  For fires, the following two lines need to be added to the
    `GSPRO`{.envar} file (See [Section 8.5.2, "`GSPRO`{.envar}:
    Speciation profile
    file"](ch08s05s02.html "8.5.2. GSPRO: Speciation profile file")):

    `"0000";"HFLUX";"HFLUX";1;1;1`{.envar}

    `"0000";"ACRESBURNED";"ACRESBURNED";1;1;1`{.envar}

2.  Set these variables in the SMOKE run scripts.

    ::: {.itemizedlist}
    -   Set `RUN_LAYPOINT`{.envar} to N

    -   Set `RUN_ELEVPOINT`{.envar} to Y

    -   Set `SMK_ELEV_METHOD`{.envar} to 2 (See [Section 6.3.3.2, "Input
        Environment
        Variables"](ch06s03s03.html#sect_programs_elevpoint_envar "6.3.3.2. Input Environment Variables"))

    -   Set `SMK_PING_METHOD`{.envar} to 0

    -   Set `MRG_LAYERS_YN`{.envar} to N
    :::

3.  **Elevpoint** to select the sources to receive the CMAQ in-line
    plume rise treatment. Create a `PELVCONFIG`{.envar} file to group
    sources with nearly identical stack parameters to reduce the total
    number of plume rise calculations performed by the CMAQ in-line
    plume rise module. Non-fire sources with an analytical plume rise
    height greater than 38 meters are typically selected for in-line
    plume rise processing. The `PELVCONFIG`{.envar} file used for CMAQ
    in-line processing of non-fire sources should be similar to the
    following example:

    SMK\_SOURCE P

    /SPECIFY ELEV GROUP/

    HT +/- 0.001 AND DM +/- 0.001 AND TK +/- 0.001 AND VE +/- 0.001

    /END/

    /SPECIFY ELEV/

    RISE \>= 38

    /END/

    For point source fires, such as the EPA ptfire sector, the following
    is an example of a `PELVCONFIG`{.envar} file:

    SMK\_SOURCE P

    /SPECIFY ELEV GROUP/

    HT+/- 1.0

    /END/

    /SPECIFY ELEV/

    PM2\_5 \> 0

    /END/
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ------------------------------------------- -------------------- --------------------------
  [Prev](ch04s04s17.html)                      [Up](ch04s04.html)     [Next](ch04s04s19.html)
  4.4.17. Plume Rise Calculation for Fires     [Home](index.html)      4.4.19. Model for CMAQ
  ------------------------------------------- -------------------- --------------------------
:::
::: {.navheader}
4.4.19. Model for CMAQ
:::

[Prev](ch04s04s18.html) 

4.4. How to use SMOKE

 [Next](ch04s04s20.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_model_cmaq}4.4.19. Model for CMAQ {#model-for-cmaq .title}

</div>

</div>
:::

In this section, we attempt to give a basic outline of the
considerations for script reconfiguration needed for SMOKE output for
the CMAQ model. All models require **Smkmerge** to be configured for
outputting gridded data, with speciation, and with hourly emissions. The
following configurations are needed when modeling for CMAQ.

::: {.orderedlist}
1.  Make sure the chemical speciation is set for one of the CMAQ
    chemical mechanism.

    This check involves the `SPC`{.envar} setting, explained in
    [Section 4.4.10, "Use a different speciation mechanism or change
    speciation
    inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs").

2.  Set the basic settings for CMAQ.

    ::: {.itemizedlist}
    -   Set `RUN_LAYPOINT`{.envar} to Y

    -   Set `REP_LAYER_MAX`{.envar} to the number of the layer you
        expect should be the maximum plume rise layer (the layer that
        includes 2000 meters).

    -   Set `MRG_TEMPORAL_YN`{.envar} to Y

    -   Set `MRG_SPCMAT_YN`{.envar} to Y

    -   Set `MRG_LAYERS_YN`{.envar} to Y

    -   Set `MRG_GRDOUT_YN`{.envar} to Y

    -   Set `SMK_ASCIIELEV_YN`{.envar} to N

    -   Set `SMK_EMLAYS`{.envar} to the number of layers you need for
        your emissions files (usually up to the layer that includes 2000
        meters, unless you are using explicit plume rise, in which case
        the layer that includes the maximum plume height of the
        precomputed plume top).
    :::

3.  Set the correct output units in the runs scripts.

    CMAQ expects output units of moles/s. For biogenic processing, this
    requires the **Smkmerge** program to be run to convert the moles/hr
    units output by **Tmpbio** or **Tmpbeis3** to moles/s.

    Set the `MRG_GRDOUT_UNIT`{.envar} setting in the run script to
    either moles/s (for CMAQ). For biogenics processing, make sure
    `RUN_SMKMERGE`{.envar} is set to Y.

4.  Configure approach for plume rise for standard point sources,
    including optional PinG sources for CMAQ.

    The point-source run script should have the following settings in
    each of the following situations.

    ::: {.orderedlist}
    a.  Calculate plume rise for all point sources.

        ::: {.itemizedlist}
        -   Set `RUN_ELEVPOINT`{.envar} to N

        -   Set `HOUR_PLUMEDATA_YN`{.envar} to N

        -   Set `SMK_SPECELEV_YN`{.envar} to N

        -   Set `EXPLICIT_PLUMES_YN`{.envar} to N

        -   Set `SMK_PING_METHOD`{.envar} to N

        -   Set `SMK_SPECELEV_YN`{.envar} to N
        :::

    b.  Select specific elevated sources for CMAQ and calculate plume
        rise only for those.

        Use the same settings as in part (a) above, except:

        ::: {.itemizedlist}
        -   Set `RUN_ELEVPOINT`{.envar} to Y (See [Section 4.4.14, "Use
            **Elevpoint** for selecting elevated and PinG
            sources"](ch04s04s14.html "4.4.14. Use Elevpoint for selecting elevated and PinG sources")
            for more information about running **Elevpoint** to select
            elevated sources)

        -   Set `SMK_ELEV_METHOD`{.envar} to 1

        -   Set `SMK_SPECELEV_YN`{.envar} to Y
        :::

    c.  Select PinG sources for CMAQ.

        Use the same settings in part (a) above, except:

        ::: {.itemizedlist}
        -   Set `RUN_ELEVPOINT`{.envar} to Y (See [Section 4.4.14, "Use
            **Elevpoint** for selecting elevated and PinG
            sources"](ch04s04s14.html "4.4.14. Use Elevpoint for selecting elevated and PinG sources")
            for more information about running **Elevpoint** to select
            PinG sources)

        -   Set `SMK_PING_METHOD`{.envar} to 1
        :::
    :::

5.  Configure approach for plume rise for explicit plume rise sources.

    Explicit plume rise sources (i.e., sources for which plume rise has
    been computed outside of SMOKE) require additional precomputed plume
    rise information, previously described for inventory data import in
    [Section 4.4.2.5, "Day-specific and hour-specific point and fire
    inventories"](ch04s04s02.html#sect_scripts_hour_day_invs "4.4.2.5. Day-specific and hour-specific point and fire inventories").
    In addition to these data for CMAQ modeling, the following settings
    must be made in the run scripts. These settings are in addition to
    the other configurations you need for the other point sources
    described above. [If the only point sources in your inventory are
    explicit plume rise sources, then use the settings described in
    steps 3 and 5a above.]{.remark}

    ::: {.itemizedlist}
    -   Set `HOUR_PLUMEDATA_YN`{.envar} to Y
    :::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------------------- -------------------- -----------------------------------
  [Prev](ch04s04s18.html)                                                      [Up](ch04s04.html)              [Next](ch04s04s20.html)
  4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version 4.7)     [Home](index.html)     4.4.20. Model for UAM and CAM~X~
  --------------------------------------------------------------------------- -------------------- -----------------------------------
:::
::: {.navheader}
4.4.20. Model for UAM and CAM~X~
:::

[Prev](ch04s04s19.html) 

4.4. How to use SMOKE

 [Next](ch04s04s21.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_model_uam}4.4.20. Model for UAM and CAM~X~ {#model-for-uam-and-camx .title}

</div>

</div>
:::

::: {.orderedlist}
1.  Make sure the chemical speciation is set for one of the UAM or
    CAM~X~ chemical mechanisms.

    This check involves the `SPC`{.envar} setting, explained in
    [Section 4.4.10, "Use a different speciation mechanism or change
    speciation
    inputs"](ch04s04s10.html "4.4.10. Use a different speciation mechanism or change speciation inputs").
    Please note that the files and setup needed for CAM~X~-PM are not
    available in SMOKE v2.1.

2.  Set the basic settings for UAM and CAM~X~

    In these settings, we will configure the system to select elevated
    point sources using the **Elevpoint** program, but not PinG sources.

    ::: {.itemizedlist}
    -   Set `RUN_LAYPOINT`{.envar} to N

    -   Set `RUN_ELEVPOINT`{.envar} to Y (See [Section 4.4.14, "Use
        **Elevpoint** for selecting elevated and PinG
        sources"](ch04s04s14.html "4.4.14. Use Elevpoint for selecting elevated and PinG sources")
        for more information about running **Elevpoint** to select
        elevated sources)

    -   Set `SMK_ELEV_METHOD`{.envar} to 1

    -   Set `MRG_TEMPORAL_YN`{.envar} to Y

    -   Set `MRG_SPCMAT_YN`{.envar} to Y

    -   Set `MRG_LAYERS_YN`{.envar} to N

    -   Set `MRG_GRDOUT_YN`{.envar} to Y

    -   Set `SMK_ASCIIELEV_YN`{.envar} to Y

    -   Set `MRG_GRDOUT_UNIT`{.envar} to moles/hr

    -   Set `EXPLICIT_PLUMES_YN`{.envar} to N

    -   Set `HOUR_PLUMEDATA_YN`{.envar} to N

    -   Set `SMK_SPECELEV_YN`{.envar} to Y
    :::

3.  Optionally configure for PinG sources.

    In addition to different instructions in the `REPCONFIG`{.envar}
    file, the point-source run script should have the following settings
    in each of the following situations.

    ::: {.itemizedlist}
    -   Set SMK\_PING\_METHOD to 1
    :::

4.  Configure approach for plume rise for explicit plume rise sources.

    Explicit plume rise sources (i.e., sources for which plume rise has
    been computed outside of SMOKE) require additional precomputed plume
    rise information, previously described for inventory data import in
    [Section 4.4.2.5, "Day-specific and hour-specific point and fire
    inventories"](ch04s04s02.html#sect_scripts_hour_day_invs "4.4.2.5. Day-specific and hour-specific point and fire inventories").
    In addition to these data for UAM and CAM~X~ modeling, the following
    settings must be made in the run scripts. These settings are in
    addition to the other configurations you need for the other point
    sources described above. [If the only point sources in your
    inventory are explicit plume rise sources, then use the settings
    described in steps 2 and 3 above.]{.remark}

    ::: {.itemizedlist}
    -   Set `RUN_LAYPOINT`{.envar} to Y

    -   Set `EXPLICIT_PLUMES_YN`{.envar} to Y

    -   Set `HOUR_PLUMEDATA_YN`{.envar} to Y
    :::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- ---------------------------------------------------------------
  [Prev](ch04s04s19.html)     [Up](ch04s04.html)                                          [Next](ch04s04s21.html)
  4.4.19. Model for CMAQ      [Home](index.html)     4.4.21. Determine if a run worked correctly and troubleshoot
  -------------------------- -------------------- ---------------------------------------------------------------
:::
::: {.navheader}
4.4.21. Determine if a run worked correctly and troubleshoot
:::

[Prev](ch04s04s20.html) 

4.4. How to use SMOKE

 [Next](ch04s04s22.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#d0e16909}4.4.21. Determine if a run worked correctly and troubleshoot {#determine-if-a-run-worked-correctly-and-troubleshoot .title}

</div>

</div>
:::

Determining if your run worked correctly and troubleshooting are
described in detail in [Chapter 7, *SMOKE Quality
Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance"). We refer
the reader to that chapter for explanations of how to perform these
steps.

::: {.orderedlist}
1.  Resolve all errors and warnings in all log files.

2.  Compare SMOKE output emissions to inventory total emissions at each
    stage of SMOKE processing to ensure emissions have not been
    erroneously lost or added.

3.  Review and analyze SMOKE reports that indicate the speciation
    profiles, temporal profiles, and spatial surrogate codes assigned to
    each SCC in the inventory.

4.  Examine your inventory for interregional inconsistencies.

5.  Visually examine your model-ready emissions to search for possible
    errors.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ----------------------------------- -------------------- --------------------------
  [Prev](ch04s04s20.html)              [Up](ch04s04.html)     [Next](ch04s04s22.html)
  4.4.20. Model for UAM and CAM~X~     [Home](index.html)      4.4.22. Change reports
  ----------------------------------- -------------------- --------------------------
:::
::: {.navheader}
4.4.22. Change reports
:::

[Prev](ch04s04s21.html) 

4.4. How to use SMOKE

 [Next](ch04s04s23.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_change_reports}4.4.22. Change reports {#change-reports .title}

</div>

</div>
:::

SMOKE provides the **Smkreport** tool as a very flexible tool to
generate reports on your inventory and emissions modeling case. This
program is documented in detail in [Chapter 7, *SMOKE Quality
Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance"). Here, we
provide the information that you need to reconfigure your scripts to use
different reporting. The `QA_TYPE`{.envar} and `QA_LABEL`{.envar}
environment variables introduced in [Section 4.2.4, "Script
settings"](ch04s02s04.html "4.2.4. Script settings") are clarified here.

::: {.orderedlist}
1.  Customize the names of the output report files and **Smkreport** log
    files.

    The example SMOKE run scripts will name the log files and report
    output files with preset names. If you set the `QA_LABEL`{.envar}
    setting, the reports and log file names will then include the value
    of that setting. For example, if the default report name were
    `a.state.nei99.rpt`{.filename} and `QA_LABEL`{.envar} were set to
    "[run1]{.quote}", the new report name would be
    `a.state.nei99.run1.rpt`{.filename}. The "[run1]{.quote}" in
    `QA_LABEL`{.envar} is inserted before the final "[rpt]{.quote}"
    extension.

2.  Select from one of the default settings for `QA_TYPE`{.envar}

    The default `QA_TYPE`{.envar} settings allow users to run
    **Smkreport** with the default `REPCONFIG`{.envar} files. These
    files are located in the `$OTHER`{.filename} directory, documented
    in [Chapter 3, *SMOKE Directory
    Structure*](ch03.html "Chapter 3. SMOKE Directory Structure"). Each
    source category has its own valid `QA_TYPE`{.envar} settings, and
    each of these settings causes certain reports to be created.
    [Table 4.4, "`QA_TYPE`{.envar} settings with associated source
    categories and default `REPCONFIG`{.envar}
    files"](ch04s04s22.html#tbl_scripts_qa_type "Table 4.4. QA_TYPE settings with associated source categories and default REPCONFIG files")
    indicates which `QA_TYPE`{.envar} setting can be used in which case,
    and the `REPCONFIG`{.envar} files that will be used.

    ::: {.table}
    []{#tbl_scripts_qa_type}
    **Table 4.4. `QA_TYPE`{.envar} settings with associated source
    categories and default `REPCONFIG`{.envar} files**

    +-----------------------+-------------------+-----------------------+
    | `QA_TYPE`{.envar}     | Source Categories | `REPCONFIG`{.envar}   |
    |                       |                   | file from             |
    |                       |                   | `$SMKDAT`{.filename}/ |
    |                       |                   | inventory/nctox/other |
    +=======================+===================+=======================+
    | part1                 |   ---------       |   --------------      |
    | (`RUN_PART1`{.envar}  |   area            | --------------------- |
    | must be set to Y)     |   nonroad         |   `repconfig.a        |
    |                       |   mobile          | r.inv.txt`{.filename} |
    |                       |   point           |   `repconfig.n        |
    |                       |   ---------       | r.inv.txt`{.filename} |
    |                       |                   |   `repconfig.m        |
    |                       |                   | b.inv.txt`{.filename} |
    |                       |                   |   `repconfig.p        |
    |                       |                   | t.inv.txt`{.filename} |
    |                       |                   |   --------------      |
    |                       |                   | --------------------- |
    +-----------------------+-------------------+-----------------------+
    | part2                 |   ---------       |   ------------------- |
    | (`RUN_PART2`{.envar}  |   area            | --------------------- |
    | must be set to Y)     |   nonroad         |   `repconfig.ar.tem   |
    |                       |   mobile          | poral.txt`{.filename} |
    |                       |   point           |   `repconfig.nr.tem   |
    |                       |   ---------       | poral.txt`{.filename} |
    |                       |                   |   `repconfig.mb.tem   |
    |                       |                   | poral.txt`{.filename} |
    |                       |                   |   `repconfig.pt.tem   |
    |                       |                   | poral.txt`{.filename} |
    |                       |                   |   ------------------- |
    |                       |                   | --------------------- |
    +-----------------------+-------------------+-----------------------+
    | part3                 | point             | `repconfig.pt         |
    | (`RUN_PART3`{.envar}  |                   | .elev.txt`{.filename} |
    | must be set to Y)     |                   |                       |
    +-----------------------+-------------------+-----------------------+
    | part4                 | point             | `repconfig.pt.        |
    | (`RUN_PART4`{.envar}  |                   | lfrac.txt`{.filename} |
    | must be set to Y)     |                   |                       |
    +-----------------------+-------------------+-----------------------+
    | all                   |   ---------       | All of the above      |
    |                       |   area            | reports will be       |
    |                       |   nonroad         | generated, provided   |
    |                       |   mobile          | that the              |
    |                       |   point           | `R                    |
    |                       |   ---------       | UN_PART(1-4)`{.envar} |
    |                       |                   | settings are set as   |
    |                       |                   | listed in column 1 of |
    |                       |                   | this table.           |
    +-----------------------+-------------------+-----------------------+
    | custom                |   ---------       | See step (3) below.   |
    |                       |   area            |                       |
    |                       |   nonroad         |                       |
    |                       |   mobile          |                       |
    |                       |   point           |                       |
    |                       |   ---------       |                       |
    +-----------------------+-------------------+-----------------------+
    :::

    The helper script `qa_run.csh`{.filename} is responsible for
    selecting the correct `REPCONFIG`{.envar} file based on the
    `QA_TYPE`{.envar} setting, and these settings need not be changed.
    If users wish to implement a different configuration, the
    "[custom]{.quote}" value of `QA_TYPE`{.envar} should be able to meet
    those needs without any changes to `qa_run.csh`{.filename}. Copying
    the `REPCONFIG`{.envar} files from the example files to your case
    and changing them changes the default reports that are generated by
    SMOKE for your case.

    Users can examine these `REPCONFIG`{.envar} files along with the
    documentation in [Chapter 7, *SMOKE Quality
    Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance") to
    determine the reports that will be generated by each. These reports
    are also generated during the SMOKE installation and test case run,
    and can provide examples for understanding which reports will be
    written.

3.  Using the "[custom]{.quote}" setting

    If `QA_TYPE`{.envar} is set to "[custom]{.quote}", then the
    `qa_run.csh`{.filename} script expects that users will set the
    correct `REPORT*`{.envar} environment variables in the main body of
    their run script. The `REPORT*`{.envar} environment variables are
    typically used as the logical file names for **Smkreport**, those
    environment variables used are themselves configurable in the
    `REPCONFIG`{.envar} file. The physical file names can also be set in
    the `REPCONFIG`{.envar} file directly, instead of relying on the
    scripts to contain environment variable settings. These options are
    explained in greater detail in [Chapter 7, *SMOKE Quality
    Assurance*](ch07.html "Chapter 7. SMOKE Quality Assurance").
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------- -------------------- ----------------------------------------------------------------------
  [Prev](ch04s04s21.html)                                          [Up](ch04s04.html)                                                 [Next](ch04s04s23.html)
  4.4.21. Determine if a run worked correctly and troubleshoot     [Home](index.html)     4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files
  --------------------------------------------------------------- -------------------- ----------------------------------------------------------------------
:::
::: {.navheader}
4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files
:::

[Prev](ch04s04s22.html) 

4.4. How to use SMOKE

 [Next](ch04s04s24.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_source_apportionment}4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files {#generating-cmaq-ready-source-apportionment-input-data-files .title}

</div>

</div>
:::

Source apportionment in SMOKE consists of grouping sources by
characteristics (i.e. FIPS code, SCC, and point source information) and
then tagging the emissions from those groupings for further analysis in
the air quality model. The SMOKE programs **Movesmrg** and **Smkmerge**
can optionally output the emissions in special files used for later
source apportionment processing.

The following steps outline the process for creating the source
apportionment output files:

::: {.orderedlist}
1.  Define source groups using the `SOURCE_GROUPS`{.envar} file

    The format for the `SOURCE_GROUPS`{.envar} file is described in
    [Section 8.10.13, "`SOURCE_GROUPS`{.envar}: Source apportionment
    groups"](ch08s10s13.html "8.10.13. SOURCE_GROUPS: Source apportionment groups").
    When assigning sources to groups, SMOKE will match each source to
    the most specific line in the `SOURCE_GROUPS`{.envar} file. The
    hierarchy of assignment priority is listed below.

    ::: {.orderedlist}
    a.  Country/state/county code, SCC, plant ID, point ID \[point
        sources only\]

    b.  Country/state/county code, SCC, plant ID \[point sources only\]

    c.  Country/state/county code, plant ID, point ID \[point sources
        only\]

    d.  Country/state/county code, plant ID \[point sources only\]

    e.  Country/state/county code, SCC \[non-biogenic sources only\]

    f.  Country/state code, SCC \[non-biogenic sources only\]

    g.  SCC \[non-biogenic sources only\]

    h.  Country/state/county code

    i.  Country/state code

    j.  Default group (country/state/county code = 0, SCC = 0)
    :::

2.  Define locations for the output files `SRCGROUPS_OUT`{.envar}
    (source group information), `SGINLNTS_L`{.envar} (emissions data),
    and `SRCGRP_REPORT`{.envar} (source group report file)

3.  For point source processing, use in-line plume rise calculation

    Review [Section 4.4.18, "In-line Plume Rise Calculation in CMAQ
    model (as of version
    4.7)"](ch04s04s18.html "4.4.18. In-line Plume Rise Calculation in CMAQ model (as of version 4.7)")
    for instructions on configuring **Elevpoint** and **Laypoint** for
    in-line emissions processing.

4.  After completing other SMOKE processing, run **Movesmrg** (on-road
    mobile emissions using MOVES lookup tables) or **Smkmerge** with
    `SMK_SRCGROUP_OUTPUT_YN`{.envar} set to Y

    When processing emissions using source apportionment, you can only
    run **Smkmerge** for a single source category (i.e. A, B, M, or P).
    For point source processing, **Smkmerge** cannot merge layers
    (`MRG_LAYERS_YN`{.envar} must be N) and in-line emissions must be
    output (`SMK_ELEV_METHOD`{.envar} must be 2). **Movesmrg** and
    **Smkmerge** will create both the source apportionment data files
    and the model-ready output files in a single run. For biogenics, if
    you are running **Smkmerge** for reporting purposes (i.e. to create
    state and county totals), make sure to set the units correctly for
    the source apportionment output data, typically the same as the
    model-ready output units.

5.  Review source grouping assignments

    After running **Movesmrg** or **Smkmerge**, the
    `SRCGRP_REPORT`{.envar} file will list each source in the inventory
    and the group it was assigned to. You can review this report to
    verify that the sources were grouped as desired.
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  -------------------------- -------------------- -------------------------------------------------------------------
  [Prev](ch04s04s22.html)     [Up](ch04s04.html)                                              [Next](ch04s04s24.html)
  4.4.22. Change reports      [Home](index.html)     4.4.24. Generating AERMOD-ready Input Data Files \[SMOKE4AERMOD)
  -------------------------- -------------------- -------------------------------------------------------------------
:::
::: {.navheader}
4.4.24. Generating AERMOD-ready Input Data Files \[SMOKE4AERMOD)
:::

[Prev](ch04s04s23.html) 

4.4. How to use SMOKE

 [Next](ch05.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_aermod}4.4.24. Generating AERMOD-ready Input Data Files \[SMOKE4AERMOD) {#generating-aermod-ready-input-data-files-smoke4aermod .title}

</div>

</div>
:::

As of SMOKE v4.5, The
[SMOKE4AERMOD](https://github.com/CEMPD/SMOKE/tree/master/scripts/aermod)
postprocessing scripts have been developed for SMOKE to generate the
SMOKE-compatible inventory-based AERMOD-ready input data files for
AERMOD modeling run in chi/q mode as a part of [U.S. EPA National Air
Toxics Assessment
(NATA)](https://www.epa.gov/national-air-toxics-assessment/nata-overview)
studies support. The NATA is an EPA's screening tool of ongoing review
of air toxics in the United States for states, local and tribal
agencies. NATA\'s results will help these agencies identify which
pollutatns, emission sources and places they may wish to study further
to better understand any possible risks to public health air toxics.

These postprocessing scripts creates "[helper]{.quote}" files for
several inventory sectors listed below.

::: {.orderedlist}
1.  Nonpoint Sources : nonpt

2.  Nonpoint Oil and Gas Sources : np\_oilgas

3.  Point Energy Generating Unit Sources : ptegu

4.  Point Non-Integrated Planning Model Sources : ptnonipm

5.  Point Airports Sources : ptairport

6.  Nonroad Mobile Sources : nonroad

7.  Onroad Mobile Sources : Onroad

8.  Residential Wood Combustion Sources : RWC

9.  Commercial Marine Vessel Sources : CMV
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  ---------------------------------------------------------------------- -------------------- ---------------------------------
  [Prev](ch04s04s23.html)                                                 [Up](ch04s04.html)                  [Next](ch05.html)
  4.4.23. Generating CMAQ-ready Source Apportionment Input Data Files     [Home](index.html)     Chapter 5. SMOKE Utility Tools
  ---------------------------------------------------------------------- -------------------- ---------------------------------
:::
