::: {.navheader}
4.4.11. Setup projection and control scenarios
:::

[Prev](ch04s04s10.html) 

4.4. How to use SMOKE

 [Next](ch04s04s12.html)

------------------------------------------------------------------------

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

### []{#sect_scripts_use_projection}4.4.11. Setup projection and control scenarios {#setup-projection-and-control-scenarios .title}

</div>

</div>
:::

::: {.toc}
[[4.4.11.1. Setup for using growth
only](ch04s04s11.html#d0e14649)]{.section}

[[4.4.11.2. Setup for using controls
only](ch04s04s11.html#d0e14810)]{.section}

[[4.4.11.3. Setup for both growth and
controls](ch04s04s11.html#d0e15188)]{.section}
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14649}4.4.11.1. Setup for using growth only {#setup-for-using-growth-only .title}

</div>

</div>
:::

The SMOKE growth capability is needed when the inventory year and the
modeling year are different. For example, if your base-year inventory is
for 2002 and you must evaluate a control strategy in 2010, then you will
need to use the SMOKE growth capability.

::: {.orderedlist}
1.  Create and install growth packet files

    The /PROJECTION/ packet handles the growth from the base year to a
    future year. This packet is part of the `GCNTL`{.envar} file
    described in [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files"). A packet for each
    source category that requires growth should be created and saved in
    a file with the correct name, as described next. Users must ensure
    that all of the SCCs in the inventory that require growth are
    included in this packet. Any source that does not match an entry in
    this file will have a factor of 1 assigned to indicate no change
    from the base to the future year.

    In the default configuration of SMOKE, a `GCNTL`{.envar} file must
    be created that includes the /PROJECTION/ packet to use SMOKE
    growth. This file must follow the naming convention
    `gcntl.$YEAR`{.filename}\_`$FYEAR`{.envar}.txt, where `YEAR`{.envar}
    is set in the Assigns file and `FYEAR`{.envar} is set in the script
    as per [Section 4.2.4, "Script
    settings"](ch04s02s04.html "4.2.4. Script settings").

    The file should be installed in the inventory input directory for
    the source category to which it applies:

    ::: {.itemizedlist}
    -   Non-point (stationary area) files: `$ARDAT`{.filename} directory

    -   Nonroad mobile files: `$NRDAT`{.filename} directory

    -   On-road mobile files: `$MBDAT`{.filename} directory

    -   Point files: `$PTDAT`{.filename} directory
    :::

    Please note that these instructions apply to on-road mobile sources
    in the following ways:

    ::: {.itemizedlist}
    -   Growth of on-road mobile VMT

    -   Growth of on-road mobile precomputed emissions
    :::

    Creating on-road mobile emission factors is accomplished by changing
    the `FYEAR`{.envar} setting and using the `SMK_FUTURE_YN`{.envar}
    set to Y. This is described also in [Section 4.4.12, "Use MOVES for
    on-road mobile
    sources"](ch04s04s12.html "4.4.12. Use MOVES for on-road mobile sources")
    on running SMOKE with MOVES.

2.  Create scripts with correct settings for your particular needs

    To create the scripts with the correct settings, the best starting
    place is one of the SMOKE example future-year scripts, introduced in
    [Section 4.2.3, "Example script files and their
    purposes"](ch04s02s03.html "4.2.3. Example script files and their purposes").
    These scripts are already setup to run for growth only. To help you
    understand what the scripts are doing, we have described in the list
    below the key elements of the script:

    ::: {.itemizedlist}
    -   Uses the base-year Assigns file for the case we are running. The
        script settings (such as `FYEAR`{.envar} and
        `SMK_FUTURE_YN`{.envar}) will adjust what the Assigns file does.

    -   `FYEAR`{.envar} defined and `SMK_FUTURE_YN`{.envar} not defined
        initially (default is N).

    -   Run **Cntlmat** to create growth matrices only (these scripts do
        not create control matrices, although that is not normally what
        users will do in real cases). This program reads the
        `GCNTL`{.envar} file and creates a growth matrix.

    -   Run **Grwinven** to grow base year inventory to future year (no
        controls).

    -   Reset `SMK_FUTURE_YN`{.envar} to Y (note: placeholder for
        resetting `SMK_CONTROL_YN`{.envar} is included, but is not set
        to Y in example script).

    -   Source the Assigns file, which will change output directories
        and file names now that `SMK_FUTURE_YN`{.envar} is set to Y.
        Note that `RUN_PART1`{.envar} is temporarily reset to N in the
        example script to prevent Assigns file from deleting SMOKE
        intermediate files.

    -   Run **Temporal** and **Smkmerge**. The **Temporal** program will
        use the grown emissions to create hourly grown emissions.
        **Smkmerge** will use these in addition to the base-year
        gridding matrix and speciation matrix to create future-year
        model-ready emissions. The base year matrices can be used
        because they are identical to the future-year ones when SMOKE is
        used to apply growth.
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e14810}4.4.11.2. Setup for using controls only {#setup-for-using-controls-only .title}

</div>

</div>
:::

Using controls only in the SMOKE scripts is needed when you import a
grown inventory that does not include any or all of the controls that
you wish to apply to the inventory. This is what we have assumed in
these instructions. We assume that in this case, the growth of the
inventory was performed outside of SMOKE, and SMOKE has read in an
inventory for the year defined by the `FYEAR`{.envar} script setting.
This inventory must be imported in a different script that is similar to
the base-year script, but follows the instructions for importing
future-year inventories in [Section 4.4.2.6, "Future-year
inventories"](ch04s04s02.html#sect_scripts_future_invs "4.4.2.6. Future-year inventories").

::: {.orderedlist}
1.  Determine which control packets you need

    Please refer to the **Cntlmat** section of [Chapter 6, *SMOKE Core
    Programs*](ch06.html "Chapter 6. SMOKE Core Programs") for a
    description of what each of the control packets can do and how they
    interact.

    The available packets are:

    ::: {.itemizedlist}
    -   /MACT/ packet

    -   /CONTROL/ packet

    -   /EMS\_CONTROL/ packet

    -   /CTG/ packet

    -   /ALLOWABLE/ packet

    -   /REACTIVITY/ packet
    :::

2.  Create and install control packets file

    The control packets just listed handle the application of controls
    for a certain future year. These controls can represent the existing
    controls that must be applied by emission sources so that they will
    be in compliance with the law. The controls can also represent
    additional controls that you want to evaluate to see their impact on
    modeled air quality. [Chapter 8, *SMOKE Input
    Files*](ch08.html "Chapter 8. SMOKE Input Files") explains these
    packets and their formats.

    You should create a separate control file for each source category
    that contains all of the control packets that apply to that source
    category. Any inventory source and pollutant that does not receive a
    control is assigned a factor of 1 to indicate no change between the
    base case and the control case.

    In the default configuration of SMOKE, a `GCNTL`{.envar} file must
    be created that includes the only control packets. This file must
    follow the naming convention `gcntl.$CNTLCASE`{.filename}.txt, where
    `CNTLCASE`{.envar} is set in the script as per Section
    [Section 4.2.4, "Script
    settings"](ch04s02s04.html "4.2.4. Script settings").

3.  Create scripts with correct settings for your particular needs

    To create the scripts with the correct settings, the best starting
    place is one of the SMOKE example future-year scripts, introduced in
    [Section 4.2.3, "Example script files and their
    purposes"](ch04s02s03.html "4.2.3. Example script files and their purposes").
    The script must be changed, however, in the following ways to
    implement control-only. There are two ways to run controls in SMOKE.
    The first is to apply multiplicative controls using **Grwinven** and
    reactivity controls (if needed) with **Smkmerge**. The second is the
    apply both multiplicative and reactivity controls using
    **Smkmerge**. The following settings must be used for each case:

    ::: {.itemizedlist}
    -   Apply multiplicative controls with **Grwinven** and reactivity
        control (if any) with **Smkmerge**

        ::: {.itemizedlist}
        -   Uses the base-year Assigns file for the case we are running.
            The script settings (such as `FYEAR`{.envar},
            `CNTLCASE`{.envar}, and `SMK_CONTROL_YN`{.envar}) will
            adjust what the Assigns file does.

        -   Set `FYEAR`{.envar} = the imported future-year inventory

        -   Set `SMK_FUTURE_YN`{.envar} = Y on the line after
            `FYEAR`{.envar}. Remove this setting from later in the
            script (around line 120).

        -   Set `RUN_CNTLMAT`{.envar} = Y to run **Cntlmat** to create
            control matrices only

        -   Set `RUN_GRWINVEN`{.envar} = Y to run **Grwinven** to import
            the control matrices

        -   Set `RUN_TEMORAL`{.envar} = Y to run **Temporal** on
            controlled inventory

        -   Set `RUN_SMKMERGE`{.envar} = Y to run **Smkmerge** on
            controlled inventory

        -   Set options for **Cntlmat**, **Grwinven**, **Temporal**, and
            **Smkmerge** (see [Chapter 6, *SMOKE Core
            Programs*](ch06.html "Chapter 6. SMOKE Core Programs")).

        -   Set `SMK_NUM_CTLMAT`{.envar} to 1

            For area or nonroad mobile, set `ACMAT01`{.envar} to
            `$ACMAT`{.envar}

            For on-road mobile, set `MCMAT01`{.envar} to
            `$MCMAT`{.envar}

            For point, set `PCMAT01`{.envar} to `$PCMAT`{.envar}

            These settings assume that you are using only one
            multiplicative control matrix. **Grwinven** can actually
            import multiple control matrices from different cases. To
            use more than one control matrix, set
            `SMK_NUM_CTLMAT`{.envar} to the number of control matrices
            and set `ACMAT02`{.envar}, `ACMAT03`{.envar}, etc to the
            names of the additional control matrices.

        -   Set `CNTLCASE`{.envar} to the control strategy name that you
            want for the control case.

        -   At line 120 of file, reset `SMK_CONTROL_YN`{.envar} to Y

        -   To run **Smkmerge** for reactivity controls, add the
            `MRG_CTLMAT_REAC`{.envar} option to the **Smkmerge** options
            and set to "[A]{.quote}", "[M]{.quote}", "[P]{.quote}" or
            some combination of those letters to indicate whether you
            want it to use the reactivity matrix for area (including
            nonroad), on-road mobile, or point sources.
        :::

    -   Apply both multiplicative and reactivity controls with
        **Smkmerge**

        ::: {.itemizedlist}
        -   Uses the base-year Assigns file for the case we are running.
            The script settings (such as `FYEAR`{.envar},
            `CNTLCASE`{.envar}, and `SMK_CONTROL_YN`{.envar}) will
            adjust what the Assigns file does.

        -   Set `FYEAR`{.envar} = the imported future-year inventory

        -   Set `SMK_FUTURE_YN`{.envar} = Y on the line after
            `FYEAR`{.envar}. Remove this setting from later in the
            script (around line 120).

        -   Set `RUN_CNTLMAT`{.envar} = Y to run **Cntlmat** to create
            control matrices only

        -   Set `RUN_GRWINVEN`{.envar} = N to run **Grwinven** to import
            the control matrices

        -   Set `RUN_TEMORAL`{.envar} = N

        -   Set `RUN_SMKMERGE`{.envar} = Y to run **Smkmerge** on
            controlled inventory

        -   Set options for **Cntlmat** and **Smkmerge** (see
            [Chapter 6, *SMOKE Core
            Programs*](ch06.html "Chapter 6. SMOKE Core Programs")).

        -   Set `CNTLCASE`{.envar} to the control strategy name that you
            want for the control case.

        -   At line 120 of file, reset `SMK_CONTROL_YN`{.envar} to N

        -   To run **Smkmerge** for multiplicative controls, add the
            `MRG_CTLMAT_MULT`{.envar} setting to **Smkmerge** options
            and set to "[A]{.quote}", "[M]{.quote}", "[P]{.quote}" or
            some combination of those letters to indicate whether you
            want it to use the multiplicative control matrix for area
            (including nonroad), on-road mobile, or point sources.

        -   To run **Smkmerge** for reactivity controls, add the
            `MRG_CTLMAT_REAC`{.envar} setting to the **Smkmerge**
            options and set to "[A]{.quote}", "[M]{.quote}",
            "[P]{.quote}" or some combination of those letters to
            indicate whether you want it to use the reactivity control
            matrix for area (including nonroad), on-road mobile, or
            point sources.
        :::
    :::
:::
:::

::: {.section lang="en"}
::: {.titlepage}
<div>

<div>

#### []{#d0e15188}4.4.11.3. Setup for both growth and controls {#setup-for-both-growth-and-controls .title}

</div>

</div>
:::

Follow the instructions that apply for both of the previous two
subsections. The differences between this case and the previous two
cases are as follows:

::: {.itemizedlist}
-   Name the `GCNTL`{.envar} input file differently. It should be named:
    `gcntl.$YEAR`{.filename}\_`$FYEAR`{.envar}\_`$CNTLCASE`{.envar}.txt

-   The **Grwinven** program must be used at least to grow the
    inventory, so you must

    ::: {.itemizedlist}
    -   Set `RUN_GRWINVEN`{.envar} to Y.

    -   Set `SMK_NUM_CTLMAT`{.envar} to at least 1. It should be set to
        the total number of growth and control matrices to be applied by
        the **Grwinven** program.

    -   The `ACMAT01`{.envar}, `ACMAT02`{.envar}, etc file names should
        be set to be consistent with the matrices being applied and the
        source categories (e.g., `ACMAT01`{.envar} should be
        `$APMAT`{.envar} or `$ACMAT`{.envar}, but not `$PCMAT`{.envar},
        since that would be inconsistent between source categories).
    :::
:::
:::
:::

::: {.navfooter}

------------------------------------------------------------------------

  --------------------------------------------------------------------------- -------------------- -----------------------------------------------
  [Prev](ch04s04s10.html)                                                      [Up](ch04s04.html)                          [Next](ch04s04s12.html)
  4.4.10. Use a different speciation mechanism or change speciation inputs     [Home](index.html)     4.4.12. Use MOVES for on-road mobile sources
  --------------------------------------------------------------------------- -------------------- -----------------------------------------------
:::
